(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();function Ag(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var _h={exports:{}},fl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lv;function lL(){if(lv)return fl;lv=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,r,a){var l=null;if(a!==void 0&&(l=""+a),r.key!==void 0&&(l=""+r.key),"key"in r){a={};for(var c in r)c!=="key"&&(a[c]=r[c])}else a=r;return r=a.ref,{$$typeof:n,type:s,key:l,ref:r!==void 0?r:null,props:a}}return fl.Fragment=e,fl.jsx=t,fl.jsxs=t,fl}var cv;function cL(){return cv||(cv=1,_h.exports=lL()),_h.exports}var p=cL(),Ch={exports:{}},ut={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uv;function uL(){if(uv)return ut;uv=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),g=Symbol.iterator;function y(I){return I===null||typeof I!="object"?null:(I=g&&I[g]||I["@@iterator"],typeof I=="function"?I:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,T={};function E(I,j,z){this.props=I,this.context=j,this.refs=T,this.updater=z||v}E.prototype.isReactComponent={},E.prototype.setState=function(I,j){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,j,"setState")},E.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function _(){}_.prototype=E.prototype;function A(I,j,z){this.props=I,this.context=j,this.refs=T,this.updater=z||v}var C=A.prototype=new _;C.constructor=A,b(C,E.prototype),C.isPureReactComponent=!0;var N=Array.isArray,w={H:null,A:null,T:null,S:null,V:null},G=Object.prototype.hasOwnProperty;function M(I,j,z,J,q,P){return z=P.ref,{$$typeof:n,type:I,key:j,ref:z!==void 0?z:null,props:P}}function B(I,j){return M(I.type,j,void 0,void 0,void 0,I.props)}function K(I){return typeof I=="object"&&I!==null&&I.$$typeof===n}function V(I){var j={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(z){return j[z]})}var $=/\/+/g;function ee(I,j){return typeof I=="object"&&I!==null&&I.key!=null?V(""+I.key):j.toString(36)}function he(){}function Z(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(he,he):(I.status="pending",I.then(function(j){I.status==="pending"&&(I.status="fulfilled",I.value=j)},function(j){I.status==="pending"&&(I.status="rejected",I.reason=j)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function H(I,j,z,J,q){var P=typeof I;(P==="undefined"||P==="boolean")&&(I=null);var de=!1;if(I===null)de=!0;else switch(P){case"bigint":case"string":case"number":de=!0;break;case"object":switch(I.$$typeof){case n:case e:de=!0;break;case h:return de=I._init,H(de(I._payload),j,z,J,q)}}if(de)return q=q(I),de=J===""?"."+ee(I,0):J,N(q)?(z="",de!=null&&(z=de.replace($,"$&/")+"/"),H(q,j,z,"",function(Fe){return Fe})):q!=null&&(K(q)&&(q=B(q,z+(q.key==null||I&&I.key===q.key?"":(""+q.key).replace($,"$&/")+"/")+de)),j.push(q)),1;de=0;var _e=J===""?".":J+":";if(N(I))for(var Le=0;Le<I.length;Le++)J=I[Le],P=_e+ee(J,Le),de+=H(J,j,z,P,q);else if(Le=y(I),typeof Le=="function")for(I=Le.call(I),Le=0;!(J=I.next()).done;)J=J.value,P=_e+ee(J,Le++),de+=H(J,j,z,P,q);else if(P==="object"){if(typeof I.then=="function")return H(Z(I),j,z,J,q);throw j=String(I),Error("Objects are not valid as a React child (found: "+(j==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":j)+"). If you meant to render a collection of children, use an array instead.")}return de}function k(I,j,z){if(I==null)return I;var J=[],q=0;return H(I,J,"","",function(P){return j.call(z,P,q++)}),J}function F(I){if(I._status===-1){var j=I._result;j=j(),j.then(function(z){(I._status===0||I._status===-1)&&(I._status=1,I._result=z)},function(z){(I._status===0||I._status===-1)&&(I._status=2,I._result=z)}),I._status===-1&&(I._status=0,I._result=j)}if(I._status===1)return I._result.default;throw I._result}var O=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var j=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(j))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)};function Y(){}return ut.Children={map:k,forEach:function(I,j,z){k(I,function(){j.apply(this,arguments)},z)},count:function(I){var j=0;return k(I,function(){j++}),j},toArray:function(I){return k(I,function(j){return j})||[]},only:function(I){if(!K(I))throw Error("React.Children.only expected to receive a single React element child.");return I}},ut.Component=E,ut.Fragment=t,ut.Profiler=r,ut.PureComponent=A,ut.StrictMode=s,ut.Suspense=f,ut.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,ut.__COMPILER_RUNTIME={__proto__:null,c:function(I){return w.H.useMemoCache(I)}},ut.cache=function(I){return function(){return I.apply(null,arguments)}},ut.cloneElement=function(I,j,z){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var J=b({},I.props),q=I.key,P=void 0;if(j!=null)for(de in j.ref!==void 0&&(P=void 0),j.key!==void 0&&(q=""+j.key),j)!G.call(j,de)||de==="key"||de==="__self"||de==="__source"||de==="ref"&&j.ref===void 0||(J[de]=j[de]);var de=arguments.length-2;if(de===1)J.children=z;else if(1<de){for(var _e=Array(de),Le=0;Le<de;Le++)_e[Le]=arguments[Le+2];J.children=_e}return M(I.type,q,void 0,void 0,P,J)},ut.createContext=function(I){return I={$$typeof:l,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:a,_context:I},I},ut.createElement=function(I,j,z){var J,q={},P=null;if(j!=null)for(J in j.key!==void 0&&(P=""+j.key),j)G.call(j,J)&&J!=="key"&&J!=="__self"&&J!=="__source"&&(q[J]=j[J]);var de=arguments.length-2;if(de===1)q.children=z;else if(1<de){for(var _e=Array(de),Le=0;Le<de;Le++)_e[Le]=arguments[Le+2];q.children=_e}if(I&&I.defaultProps)for(J in de=I.defaultProps,de)q[J]===void 0&&(q[J]=de[J]);return M(I,P,void 0,void 0,null,q)},ut.createRef=function(){return{current:null}},ut.forwardRef=function(I){return{$$typeof:c,render:I}},ut.isValidElement=K,ut.lazy=function(I){return{$$typeof:h,_payload:{_status:-1,_result:I},_init:F}},ut.memo=function(I,j){return{$$typeof:d,type:I,compare:j===void 0?null:j}},ut.startTransition=function(I){var j=w.T,z={};w.T=z;try{var J=I(),q=w.S;q!==null&&q(z,J),typeof J=="object"&&J!==null&&typeof J.then=="function"&&J.then(Y,O)}catch(P){O(P)}finally{w.T=j}},ut.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},ut.use=function(I){return w.H.use(I)},ut.useActionState=function(I,j,z){return w.H.useActionState(I,j,z)},ut.useCallback=function(I,j){return w.H.useCallback(I,j)},ut.useContext=function(I){return w.H.useContext(I)},ut.useDebugValue=function(){},ut.useDeferredValue=function(I,j){return w.H.useDeferredValue(I,j)},ut.useEffect=function(I,j,z){var J=w.H;if(typeof z=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return J.useEffect(I,j)},ut.useId=function(){return w.H.useId()},ut.useImperativeHandle=function(I,j,z){return w.H.useImperativeHandle(I,j,z)},ut.useInsertionEffect=function(I,j){return w.H.useInsertionEffect(I,j)},ut.useLayoutEffect=function(I,j){return w.H.useLayoutEffect(I,j)},ut.useMemo=function(I,j){return w.H.useMemo(I,j)},ut.useOptimistic=function(I,j){return w.H.useOptimistic(I,j)},ut.useReducer=function(I,j,z){return w.H.useReducer(I,j,z)},ut.useRef=function(I){return w.H.useRef(I)},ut.useState=function(I){return w.H.useState(I)},ut.useSyncExternalStore=function(I,j,z){return w.H.useSyncExternalStore(I,j,z)},ut.useTransition=function(){return w.H.useTransition()},ut.version="19.1.1",ut}var dv;function fd(){return dv||(dv=1,Ch.exports=uL()),Ch.exports}var R=fd();const ht=Ag(R);var Lh={exports:{}},hl={},wh={exports:{}},Rh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fv;function dL(){return fv||(fv=1,(function(n){function e(k,F){var O=k.length;k.push(F);e:for(;0<O;){var Y=O-1>>>1,I=k[Y];if(0<r(I,F))k[Y]=F,k[O]=I,O=Y;else break e}}function t(k){return k.length===0?null:k[0]}function s(k){if(k.length===0)return null;var F=k[0],O=k.pop();if(O!==F){k[0]=O;e:for(var Y=0,I=k.length,j=I>>>1;Y<j;){var z=2*(Y+1)-1,J=k[z],q=z+1,P=k[q];if(0>r(J,O))q<I&&0>r(P,J)?(k[Y]=P,k[q]=O,Y=q):(k[Y]=J,k[z]=O,Y=z);else if(q<I&&0>r(P,O))k[Y]=P,k[q]=O,Y=q;else break e}}return F}function r(k,F){var O=k.sortIndex-F.sortIndex;return O!==0?O:k.id-F.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var l=Date,c=l.now();n.unstable_now=function(){return l.now()-c}}var f=[],d=[],h=1,g=null,y=3,v=!1,b=!1,T=!1,E=!1,_=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function N(k){for(var F=t(d);F!==null;){if(F.callback===null)s(d);else if(F.startTime<=k)s(d),F.sortIndex=F.expirationTime,e(f,F);else break;F=t(d)}}function w(k){if(T=!1,N(k),!b)if(t(f)!==null)b=!0,G||(G=!0,ee());else{var F=t(d);F!==null&&H(w,F.startTime-k)}}var G=!1,M=-1,B=5,K=-1;function V(){return E?!0:!(n.unstable_now()-K<B)}function $(){if(E=!1,G){var k=n.unstable_now();K=k;var F=!0;try{e:{b=!1,T&&(T=!1,A(M),M=-1),v=!0;var O=y;try{t:{for(N(k),g=t(f);g!==null&&!(g.expirationTime>k&&V());){var Y=g.callback;if(typeof Y=="function"){g.callback=null,y=g.priorityLevel;var I=Y(g.expirationTime<=k);if(k=n.unstable_now(),typeof I=="function"){g.callback=I,N(k),F=!0;break t}g===t(f)&&s(f),N(k)}else s(f);g=t(f)}if(g!==null)F=!0;else{var j=t(d);j!==null&&H(w,j.startTime-k),F=!1}}break e}finally{g=null,y=O,v=!1}F=void 0}}finally{F?ee():G=!1}}}var ee;if(typeof C=="function")ee=function(){C($)};else if(typeof MessageChannel<"u"){var he=new MessageChannel,Z=he.port2;he.port1.onmessage=$,ee=function(){Z.postMessage(null)}}else ee=function(){_($,0)};function H(k,F){M=_(function(){k(n.unstable_now())},F)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(k){k.callback=null},n.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<k?Math.floor(1e3/k):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function(k){switch(y){case 1:case 2:case 3:var F=3;break;default:F=y}var O=y;y=F;try{return k()}finally{y=O}},n.unstable_requestPaint=function(){E=!0},n.unstable_runWithPriority=function(k,F){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var O=y;y=k;try{return F()}finally{y=O}},n.unstable_scheduleCallback=function(k,F,O){var Y=n.unstable_now();switch(typeof O=="object"&&O!==null?(O=O.delay,O=typeof O=="number"&&0<O?Y+O:Y):O=Y,k){case 1:var I=-1;break;case 2:I=250;break;case 5:I=1073741823;break;case 4:I=1e4;break;default:I=5e3}return I=O+I,k={id:h++,callback:F,priorityLevel:k,startTime:O,expirationTime:I,sortIndex:-1},O>Y?(k.sortIndex=O,e(d,k),t(f)===null&&k===t(d)&&(T?(A(M),M=-1):T=!0,H(w,O-Y))):(k.sortIndex=I,e(f,k),b||v||(b=!0,G||(G=!0,ee()))),k},n.unstable_shouldYield=V,n.unstable_wrapCallback=function(k){var F=y;return function(){var O=y;y=F;try{return k.apply(this,arguments)}finally{y=O}}}})(Rh)),Rh}var hv;function fL(){return hv||(hv=1,wh.exports=dL()),wh.exports}var Dh={exports:{}},Fs={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mv;function hL(){if(mv)return Fs;mv=1;var n=fd();function e(f){var d="https://react.dev/errors/"+f;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)d+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+f+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function a(f,d,h){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:g==null?null:""+g,children:f,containerInfo:d,implementation:h}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(f,d){if(f==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Fs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Fs.createPortal=function(f,d){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return a(f,d,null,h)},Fs.flushSync=function(f){var d=l.T,h=s.p;try{if(l.T=null,s.p=2,f)return f()}finally{l.T=d,s.p=h,s.d.f()}},Fs.preconnect=function(f,d){typeof f=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,s.d.C(f,d))},Fs.prefetchDNS=function(f){typeof f=="string"&&s.d.D(f)},Fs.preinit=function(f,d){if(typeof f=="string"&&d&&typeof d.as=="string"){var h=d.as,g=c(h,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,v=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;h==="style"?s.d.S(f,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:g,integrity:y,fetchPriority:v}):h==="script"&&s.d.X(f,{crossOrigin:g,integrity:y,fetchPriority:v,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Fs.preinitModule=function(f,d){if(typeof f=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var h=c(d.as,d.crossOrigin);s.d.M(f,{crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&s.d.M(f)},Fs.preload=function(f,d){if(typeof f=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var h=d.as,g=c(h,d.crossOrigin);s.d.L(f,h,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Fs.preloadModule=function(f,d){if(typeof f=="string")if(d){var h=c(d.as,d.crossOrigin);s.d.m(f,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else s.d.m(f)},Fs.requestFormReset=function(f){s.d.r(f)},Fs.unstable_batchedUpdates=function(f,d){return f(d)},Fs.useFormState=function(f,d,h){return l.H.useFormState(f,d,h)},Fs.useFormStatus=function(){return l.H.useHostTransitionStatus()},Fs.version="19.1.1",Fs}var gv;function EE(){if(gv)return Dh.exports;gv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Dh.exports=hL(),Dh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pv;function mL(){if(pv)return hl;pv=1;var n=fL(),e=fd(),t=EE();function s(i){var o="https://react.dev/errors/"+i;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function a(i){var o=i,u=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,(o.flags&4098)!==0&&(u=o.return),i=o.return;while(i)}return o.tag===3?u:null}function l(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function c(i){if(a(i)!==i)throw Error(s(188))}function f(i){var o=i.alternate;if(!o){if(o=a(i),o===null)throw Error(s(188));return o!==i?null:i}for(var u=i,m=o;;){var x=u.return;if(x===null)break;var S=x.alternate;if(S===null){if(m=x.return,m!==null){u=m;continue}break}if(x.child===S.child){for(S=x.child;S;){if(S===u)return c(x),i;if(S===m)return c(x),o;S=S.sibling}throw Error(s(188))}if(u.return!==m.return)u=x,m=S;else{for(var D=!1,U=x.child;U;){if(U===u){D=!0,u=x,m=S;break}if(U===m){D=!0,m=x,u=S;break}U=U.sibling}if(!D){for(U=S.child;U;){if(U===u){D=!0,u=S,m=x;break}if(U===m){D=!0,m=S,u=x;break}U=U.sibling}if(!D)throw Error(s(189))}}if(u.alternate!==m)throw Error(s(190))}if(u.tag!==3)throw Error(s(188));return u.stateNode.current===u?i:o}function d(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i;for(i=i.child;i!==null;){if(o=d(i),o!==null)return o;i=i.sibling}return null}var h=Object.assign,g=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),A=Symbol.for("react.consumer"),C=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),K=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),$=Symbol.iterator;function ee(i){return i===null||typeof i!="object"?null:(i=$&&i[$]||i["@@iterator"],typeof i=="function"?i:null)}var he=Symbol.for("react.client.reference");function Z(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===he?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case b:return"Fragment";case E:return"Profiler";case T:return"StrictMode";case w:return"Suspense";case G:return"SuspenseList";case K:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case v:return"Portal";case C:return(i.displayName||"Context")+".Provider";case A:return(i._context.displayName||"Context")+".Consumer";case N:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case M:return o=i.displayName||null,o!==null?o:Z(i.type)||"Memo";case B:o=i._payload,i=i._init;try{return Z(i(o))}catch{}}return null}var H=Array.isArray,k=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O={pending:!1,data:null,method:null,action:null},Y=[],I=-1;function j(i){return{current:i}}function z(i){0>I||(i.current=Y[I],Y[I]=null,I--)}function J(i,o){I++,Y[I]=i.current,i.current=o}var q=j(null),P=j(null),de=j(null),_e=j(null);function Le(i,o){switch(J(de,o),J(P,i),J(q,null),o.nodeType){case 9:case 11:i=(i=o.documentElement)&&(i=i.namespaceURI)?Mx(i):0;break;default:if(i=o.tagName,o=o.namespaceURI)o=Mx(o),i=jx(o,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}z(q),J(q,i)}function Fe(){z(q),z(P),z(de)}function $e(i){i.memoizedState!==null&&J(_e,i);var o=q.current,u=jx(o,i.type);o!==u&&(J(P,i),J(q,u))}function pe(i){P.current===i&&(z(q),z(P)),_e.current===i&&(z(_e),ol._currentValue=O)}var Ne=Object.prototype.hasOwnProperty,Ve=n.unstable_scheduleCallback,Ge=n.unstable_cancelCallback,le=n.unstable_shouldYield,W=n.unstable_requestPaint,te=n.unstable_now,be=n.unstable_getCurrentPriorityLevel,Ie=n.unstable_ImmediatePriority,Ue=n.unstable_UserBlockingPriority,Ke=n.unstable_NormalPriority,We=n.unstable_LowPriority,ae=n.unstable_IdlePriority,ie=n.log,we=n.unstable_setDisableYieldValue,Ae=null,Me=null;function mt(i){if(typeof ie=="function"&&we(i),Me&&typeof Me.setStrictMode=="function")try{Me.setStrictMode(Ae,i)}catch{}}var _t=Math.clz32?Math.clz32:Ys,jt=Math.log,ts=Math.LN2;function Ys(i){return i>>>=0,i===0?32:31-(jt(i)/ts|0)|0}var Os=256,Dt=4194304;function Ms(i){var o=i&42;if(o!==0)return o;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function yn(i,o,u){var m=i.pendingLanes;if(m===0)return 0;var x=0,S=i.suspendedLanes,D=i.pingedLanes;i=i.warmLanes;var U=m&134217727;return U!==0?(m=U&~S,m!==0?x=Ms(m):(D&=U,D!==0?x=Ms(D):u||(u=U&~i,u!==0&&(x=Ms(u))))):(U=m&~S,U!==0?x=Ms(U):D!==0?x=Ms(D):u||(u=m&~i,u!==0&&(x=Ms(u)))),x===0?0:o!==0&&o!==x&&(o&S)===0&&(S=x&-x,u=o&-o,S>=u||S===32&&(u&4194048)!==0)?o:x}function On(i,o){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&o)===0}function xi(i,o){switch(i){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wn(){var i=Os;return Os<<=1,(Os&4194048)===0&&(Os=256),i}function Qn(){var i=Dt;return Dt<<=1,(Dt&62914560)===0&&(Dt=4194304),i}function xn(i){for(var o=[],u=0;31>u;u++)o.push(i);return o}function ps(i,o){i.pendingLanes|=o,o!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function vn(i,o,u,m,x,S){var D=i.pendingLanes;i.pendingLanes=u,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=u,i.entangledLanes&=u,i.errorRecoveryDisabledLanes&=u,i.shellSuspendCounter=0;var U=i.entanglements,Q=i.expirationTimes,me=i.hiddenUpdates;for(u=D&~u;0<u;){var Se=31-_t(u),Ce=1<<Se;U[Se]=0,Q[Se]=-1;var ye=me[Se];if(ye!==null)for(me[Se]=null,Se=0;Se<ye.length;Se++){var xe=ye[Se];xe!==null&&(xe.lane&=-536870913)}u&=~Ce}m!==0&&vi(i,m,0),S!==0&&x===0&&i.tag!==0&&(i.suspendedLanes|=S&~(D&~o))}function vi(i,o,u){i.pendingLanes|=o,i.suspendedLanes&=~o;var m=31-_t(o);i.entangledLanes|=o,i.entanglements[m]=i.entanglements[m]|1073741824|u&4194090}function Mn(i,o){var u=i.entangledLanes|=o;for(i=i.entanglements;u;){var m=31-_t(u),x=1<<m;x&o|i[m]&o&&(i[m]|=o),u&=~x}}function qs(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function zi(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function ne(){var i=F.p;return i!==0?i:(i=window.event,i===void 0?32:sv(i.type))}function Re(i,o){var u=F.p;try{return F.p=i,o()}finally{F.p=u}}var ke=Math.random().toString(36).slice(2),je="__reactFiber$"+ke,ze="__reactProps$"+ke,De="__reactContainer$"+ke,Pe="__reactEvents$"+ke,qe="__reactListeners$"+ke,tt="__reactHandles$"+ke,St="__reactResources$"+ke,At="__reactMarker$"+ke;function Xs(i){delete i[je],delete i[ze],delete i[Pe],delete i[qe],delete i[tt]}function ws(i){var o=i[je];if(o)return o;for(var u=i.parentNode;u;){if(o=u[De]||u[je]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(i=$x(i);i!==null;){if(u=i[je])return u;i=$x(i)}return o}i=u,u=i.parentNode}return null}function js(i){if(i=i[je]||i[De]){var o=i.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return i}return null}function Ts(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i.stateNode;throw Error(s(33))}function Et(i){var o=i[St];return o||(o=i[St]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Vt(i){i[At]=!0}var Zn=new Set,ua={};function X(i,o){ge(i,o),ge(i+"Capture",o)}function ge(i,o){for(ua[i]=o,i=0;i<o.length;i++)Zn.add(o[i])}var ve=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Oe={},Ze={};function et(i){return Ne.call(Ze,i)?!0:Ne.call(Oe,i)?!1:ve.test(i)?Ze[i]=!0:(Oe[i]=!0,!1)}function at(i,o,u){if(et(o))if(u===null)i.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":i.removeAttribute(o);return;case"boolean":var m=o.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){i.removeAttribute(o);return}}i.setAttribute(o,""+u)}}function Rt(i,o,u){if(u===null)i.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(o);return}i.setAttribute(o,""+u)}}function vt(i,o,u,m){if(m===null)i.removeAttribute(u);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(u);return}i.setAttributeNS(o,u,""+m)}}var Ct,bt;function ys(i){if(Ct===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);Ct=o&&o[1]||"",bt=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ct+i+bt}var as=!1;function Wt(i,o){if(!i||as)return"";as=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(o){var Ce=function(){throw Error()};if(Object.defineProperty(Ce.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ce,[])}catch(xe){var ye=xe}Reflect.construct(i,[],Ce)}else{try{Ce.call()}catch(xe){ye=xe}i.call(Ce.prototype)}}else{try{throw Error()}catch(xe){ye=xe}(Ce=i())&&typeof Ce.catch=="function"&&Ce.catch(function(){})}}catch(xe){if(xe&&ye&&typeof xe.stack=="string")return[xe.stack,ye.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=m.DetermineComponentFrameRoot(),D=S[0],U=S[1];if(D&&U){var Q=D.split(`
`),me=U.split(`
`);for(x=m=0;m<Q.length&&!Q[m].includes("DetermineComponentFrameRoot");)m++;for(;x<me.length&&!me[x].includes("DetermineComponentFrameRoot");)x++;if(m===Q.length||x===me.length)for(m=Q.length-1,x=me.length-1;1<=m&&0<=x&&Q[m]!==me[x];)x--;for(;1<=m&&0<=x;m--,x--)if(Q[m]!==me[x]){if(m!==1||x!==1)do if(m--,x--,0>x||Q[m]!==me[x]){var Se=`
`+Q[m].replace(" at new "," at ");return i.displayName&&Se.includes("<anonymous>")&&(Se=Se.replace("<anonymous>",i.displayName)),Se}while(1<=m&&0<=x);break}}}finally{as=!1,Error.prepareStackTrace=u}return(u=i?i.displayName||i.name:"")?ys(u):""}function us(i){switch(i.tag){case 26:case 27:case 5:return ys(i.type);case 16:return ys("Lazy");case 13:return ys("Suspense");case 19:return ys("SuspenseList");case 0:case 15:return Wt(i.type,!1);case 11:return Wt(i.type.render,!1);case 1:return Wt(i.type,!0);case 31:return ys("Activity");default:return""}}function Ws(i){try{var o="";do o+=us(i),i=i.return;while(i);return o}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function xs(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function jn(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function tc(i){var o=jn(i)?"checked":"value",u=Object.getOwnPropertyDescriptor(i.constructor.prototype,o),m=""+i[o];if(!i.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var x=u.get,S=u.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return x.call(this)},set:function(D){m=""+D,S.call(this,D)}}),Object.defineProperty(i,o,{enumerable:u.enumerable}),{getValue:function(){return m},setValue:function(D){m=""+D},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function Ir(i){i._valueTracker||(i._valueTracker=tc(i))}function sc(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var u=o.getValue(),m="";return i&&(m=jn(i)?i.checked?"true":"false":i.value),i=m,i!==u?(o.setValue(i),!0):!1}function da(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var It=/[\n"\\]/g;function ct(i){return i.replace(It,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Nr(i,o,u,m,x,S,D,U){i.name="",D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?i.type=D:i.removeAttribute("type"),o!=null?D==="number"?(o===0&&i.value===""||i.value!=o)&&(i.value=""+xs(o)):i.value!==""+xs(o)&&(i.value=""+xs(o)):D!=="submit"&&D!=="reset"||i.removeAttribute("value"),o!=null?Yi(i,D,xs(o)):u!=null?Yi(i,D,xs(u)):m!=null&&i.removeAttribute("value"),x==null&&S!=null&&(i.defaultChecked=!!S),x!=null&&(i.checked=x&&typeof x!="function"&&typeof x!="symbol"),U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?i.name=""+xs(U):i.removeAttribute("name")}function Jn(i,o,u,m,x,S,D,U){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(i.type=S),o!=null||u!=null){if(!(S!=="submit"&&S!=="reset"||o!=null))return;u=u!=null?""+xs(u):"",o=o!=null?""+xs(o):u,U||o===i.value||(i.value=o),i.defaultValue=o}m=m??x,m=typeof m!="function"&&typeof m!="symbol"&&!!m,i.checked=U?i.checked:!!m,i.defaultChecked=!!m,D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(i.name=D)}function Yi(i,o,u){o==="number"&&da(i.ownerDocument)===i||i.defaultValue===""+u||(i.defaultValue=""+u)}function ds(i,o,u,m){if(i=i.options,o){o={};for(var x=0;x<u.length;x++)o["$"+u[x]]=!0;for(u=0;u<i.length;u++)x=o.hasOwnProperty("$"+i[u].value),i[u].selected!==x&&(i[u].selected=x),x&&m&&(i[u].defaultSelected=!0)}else{for(u=""+xs(u),o=null,x=0;x<i.length;x++){if(i[x].value===u){i[x].selected=!0,m&&(i[x].defaultSelected=!0);return}o!==null||i[x].disabled||(o=i[x])}o!==null&&(o.selected=!0)}}function bn(i,o,u){if(o!=null&&(o=""+xs(o),o!==i.value&&(i.value=o),u==null)){i.defaultValue!==o&&(i.defaultValue=o);return}i.defaultValue=u!=null?""+xs(u):""}function Un(i,o,u,m){if(o==null){if(m!=null){if(u!=null)throw Error(s(92));if(H(m)){if(1<m.length)throw Error(s(93));m=m[0]}u=m}u==null&&(u=""),o=u}u=xs(o),i.defaultValue=u,m=i.textContent,m===u&&m!==""&&m!==null&&(i.value=m)}function Sn(i,o){if(o){var u=i.firstChild;if(u&&u===i.lastChild&&u.nodeType===3){u.nodeValue=o;return}}i.textContent=o}var fa=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bi(i,o,u){var m=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?m?i.setProperty(o,""):o==="float"?i.cssFloat="":i[o]="":m?i.setProperty(o,u):typeof u!="number"||u===0||fa.has(o)?o==="float"?i.cssFloat=u:i[o]=(""+u).trim():i[o]=u+"px"}function Fn(i,o,u){if(o!=null&&typeof o!="object")throw Error(s(62));if(i=i.style,u!=null){for(var m in u)!u.hasOwnProperty(m)||o!=null&&o.hasOwnProperty(m)||(m.indexOf("--")===0?i.setProperty(m,""):m==="float"?i.cssFloat="":i[m]="");for(var x in o)m=o[x],o.hasOwnProperty(x)&&u[x]!==m&&bi(i,x,m)}else for(var S in o)o.hasOwnProperty(S)&&bi(i,S,o[S])}function ha(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ma=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),vo=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Si(i){return vo.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var qi=null;function ga(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Bn=null,$n=null;function Up(i){var o=js(i);if(o&&(i=o.stateNode)){var u=i[ze]||null;e:switch(i=o.stateNode,o.type){case"input":if(Nr(i,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=i;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+ct(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var m=u[o];if(m!==i&&m.form===i.form){var x=m[ze]||null;if(!x)throw Error(s(90));Nr(m,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(o=0;o<u.length;o++)m=u[o],m.form===i.form&&sc(m)}break e;case"textarea":bn(i,u.value,u.defaultValue);break e;case"select":o=u.value,o!=null&&ds(i,!!u.multiple,o,!1)}}}var Cd=!1;function Fp(i,o,u){if(Cd)return i(o,u);Cd=!0;try{var m=i(o);return m}finally{if(Cd=!1,(Bn!==null||$n!==null)&&($c(),Bn&&(o=Bn,i=$n,$n=Bn=null,Up(o),i)))for(o=0;o<i.length;o++)Up(i[o])}}function bo(i,o){var u=i.stateNode;if(u===null)return null;var m=u[ze]||null;if(m===null)return null;u=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(i=i.type,m=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!m;break e;default:i=!1}if(i)return null;if(u&&typeof u!="function")throw Error(s(231,o,typeof u));return u}var Ei=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ld=!1;if(Ei)try{var So={};Object.defineProperty(So,"passive",{get:function(){Ld=!0}}),window.addEventListener("test",So,So),window.removeEventListener("test",So,So)}catch{Ld=!1}var Xi=null,wd=null,nc=null;function Bp(){if(nc)return nc;var i,o=wd,u=o.length,m,x="value"in Xi?Xi.value:Xi.textContent,S=x.length;for(i=0;i<u&&o[i]===x[i];i++);var D=u-i;for(m=1;m<=D&&o[u-m]===x[S-m];m++);return nc=x.slice(i,1<m?1-m:void 0)}function ic(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function rc(){return!0}function $p(){return!1}function Qs(i){function o(u,m,x,S,D){this._reactName=u,this._targetInst=x,this.type=m,this.nativeEvent=S,this.target=D,this.currentTarget=null;for(var U in i)i.hasOwnProperty(U)&&(u=i[U],this[U]=u?u(S):S[U]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?rc:$p,this.isPropagationStopped=$p,this}return h(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=rc)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=rc)},persist:function(){},isPersistent:rc}),o}var kr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ac=Qs(kr),Eo=h({},kr,{view:0,detail:0}),l_=Qs(Eo),Rd,Dd,To,oc=h({},Eo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nd,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==To&&(To&&i.type==="mousemove"?(Rd=i.screenX-To.screenX,Dd=i.screenY-To.screenY):Dd=Rd=0,To=i),Rd)},movementY:function(i){return"movementY"in i?i.movementY:Dd}}),Vp=Qs(oc),c_=h({},oc,{dataTransfer:0}),u_=Qs(c_),d_=h({},Eo,{relatedTarget:0}),Id=Qs(d_),f_=h({},kr,{animationName:0,elapsedTime:0,pseudoElement:0}),h_=Qs(f_),m_=h({},kr,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),g_=Qs(m_),p_=h({},kr,{data:0}),Gp=Qs(p_),y_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},x_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},v_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function b_(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=v_[i])?!!o[i]:!1}function Nd(){return b_}var S_=h({},Eo,{key:function(i){if(i.key){var o=y_[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=ic(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?x_[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nd,charCode:function(i){return i.type==="keypress"?ic(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?ic(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),E_=Qs(S_),T_=h({},oc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Hp=Qs(T_),A_=h({},Eo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nd}),__=Qs(A_),C_=h({},kr,{propertyName:0,elapsedTime:0,pseudoElement:0}),L_=Qs(C_),w_=h({},oc,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),R_=Qs(w_),D_=h({},kr,{newState:0,oldState:0}),I_=Qs(D_),N_=[9,13,27,32],kd=Ei&&"CompositionEvent"in window,Ao=null;Ei&&"documentMode"in document&&(Ao=document.documentMode);var k_=Ei&&"TextEvent"in window&&!Ao,Kp=Ei&&(!kd||Ao&&8<Ao&&11>=Ao),zp=" ",Yp=!1;function qp(i,o){switch(i){case"keyup":return N_.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xp(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var pa=!1;function P_(i,o){switch(i){case"compositionend":return Xp(o);case"keypress":return o.which!==32?null:(Yp=!0,zp);case"textInput":return i=o.data,i===zp&&Yp?null:i;default:return null}}function O_(i,o){if(pa)return i==="compositionend"||!kd&&qp(i,o)?(i=Bp(),nc=wd=Xi=null,pa=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Kp&&o.locale!=="ko"?null:o.data;default:return null}}var M_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wp(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!M_[i.type]:o==="textarea"}function Qp(i,o,u,m){Bn?$n?$n.push(m):$n=[m]:Bn=m,o=Yc(o,"onChange"),0<o.length&&(u=new ac("onChange","change",null,u,m),i.push({event:u,listeners:o}))}var _o=null,Co=null;function j_(i){Ix(i,0)}function lc(i){var o=Ts(i);if(sc(o))return i}function Zp(i,o){if(i==="change")return o}var Jp=!1;if(Ei){var Pd;if(Ei){var Od="oninput"in document;if(!Od){var e0=document.createElement("div");e0.setAttribute("oninput","return;"),Od=typeof e0.oninput=="function"}Pd=Od}else Pd=!1;Jp=Pd&&(!document.documentMode||9<document.documentMode)}function t0(){_o&&(_o.detachEvent("onpropertychange",s0),Co=_o=null)}function s0(i){if(i.propertyName==="value"&&lc(Co)){var o=[];Qp(o,Co,i,ga(i)),Fp(j_,o)}}function U_(i,o,u){i==="focusin"?(t0(),_o=o,Co=u,_o.attachEvent("onpropertychange",s0)):i==="focusout"&&t0()}function F_(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return lc(Co)}function B_(i,o){if(i==="click")return lc(o)}function $_(i,o){if(i==="input"||i==="change")return lc(o)}function V_(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var rn=typeof Object.is=="function"?Object.is:V_;function Lo(i,o){if(rn(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var u=Object.keys(i),m=Object.keys(o);if(u.length!==m.length)return!1;for(m=0;m<u.length;m++){var x=u[m];if(!Ne.call(o,x)||!rn(i[x],o[x]))return!1}return!0}function n0(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function i0(i,o){var u=n0(i);i=0;for(var m;u;){if(u.nodeType===3){if(m=i+u.textContent.length,i<=o&&m>=o)return{node:u,offset:o-i};i=m}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=n0(u)}}function r0(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?r0(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function a0(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var o=da(i.document);o instanceof i.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)i=o.contentWindow;else break;o=da(i.document)}return o}function Md(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}var G_=Ei&&"documentMode"in document&&11>=document.documentMode,ya=null,jd=null,wo=null,Ud=!1;function o0(i,o,u){var m=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Ud||ya==null||ya!==da(m)||(m=ya,"selectionStart"in m&&Md(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),wo&&Lo(wo,m)||(wo=m,m=Yc(jd,"onSelect"),0<m.length&&(o=new ac("onSelect","select",null,o,u),i.push({event:o,listeners:m}),o.target=ya)))}function Pr(i,o){var u={};return u[i.toLowerCase()]=o.toLowerCase(),u["Webkit"+i]="webkit"+o,u["Moz"+i]="moz"+o,u}var xa={animationend:Pr("Animation","AnimationEnd"),animationiteration:Pr("Animation","AnimationIteration"),animationstart:Pr("Animation","AnimationStart"),transitionrun:Pr("Transition","TransitionRun"),transitionstart:Pr("Transition","TransitionStart"),transitioncancel:Pr("Transition","TransitionCancel"),transitionend:Pr("Transition","TransitionEnd")},Fd={},l0={};Ei&&(l0=document.createElement("div").style,"AnimationEvent"in window||(delete xa.animationend.animation,delete xa.animationiteration.animation,delete xa.animationstart.animation),"TransitionEvent"in window||delete xa.transitionend.transition);function Or(i){if(Fd[i])return Fd[i];if(!xa[i])return i;var o=xa[i],u;for(u in o)if(o.hasOwnProperty(u)&&u in l0)return Fd[i]=o[u];return i}var c0=Or("animationend"),u0=Or("animationiteration"),d0=Or("animationstart"),H_=Or("transitionrun"),K_=Or("transitionstart"),z_=Or("transitioncancel"),f0=Or("transitionend"),h0=new Map,Bd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Bd.push("scrollEnd");function Vn(i,o){h0.set(i,o),X(o,[i])}var m0=new WeakMap;function En(i,o){if(typeof i=="object"&&i!==null){var u=m0.get(i);return u!==void 0?u:(o={value:i,source:o,stack:Ws(o)},m0.set(i,o),o)}return{value:i,source:o,stack:Ws(o)}}var Tn=[],va=0,$d=0;function cc(){for(var i=va,o=$d=va=0;o<i;){var u=Tn[o];Tn[o++]=null;var m=Tn[o];Tn[o++]=null;var x=Tn[o];Tn[o++]=null;var S=Tn[o];if(Tn[o++]=null,m!==null&&x!==null){var D=m.pending;D===null?x.next=x:(x.next=D.next,D.next=x),m.pending=x}S!==0&&g0(u,x,S)}}function uc(i,o,u,m){Tn[va++]=i,Tn[va++]=o,Tn[va++]=u,Tn[va++]=m,$d|=m,i.lanes|=m,i=i.alternate,i!==null&&(i.lanes|=m)}function Vd(i,o,u,m){return uc(i,o,u,m),dc(i)}function ba(i,o){return uc(i,null,null,o),dc(i)}function g0(i,o,u){i.lanes|=u;var m=i.alternate;m!==null&&(m.lanes|=u);for(var x=!1,S=i.return;S!==null;)S.childLanes|=u,m=S.alternate,m!==null&&(m.childLanes|=u),S.tag===22&&(i=S.stateNode,i===null||i._visibility&1||(x=!0)),i=S,S=S.return;return i.tag===3?(S=i.stateNode,x&&o!==null&&(x=31-_t(u),i=S.hiddenUpdates,m=i[x],m===null?i[x]=[o]:m.push(o),o.lane=u|536870912),S):null}function dc(i){if(50<Jo)throw Jo=0,Xf=null,Error(s(185));for(var o=i.return;o!==null;)i=o,o=i.return;return i.tag===3?i.stateNode:null}var Sa={};function Y_(i,o,u,m){this.tag=i,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function an(i,o,u,m){return new Y_(i,o,u,m)}function Gd(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Ti(i,o){var u=i.alternate;return u===null?(u=an(i.tag,o,i.key,i.mode),u.elementType=i.elementType,u.type=i.type,u.stateNode=i.stateNode,u.alternate=i,i.alternate=u):(u.pendingProps=o,u.type=i.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=i.flags&65011712,u.childLanes=i.childLanes,u.lanes=i.lanes,u.child=i.child,u.memoizedProps=i.memoizedProps,u.memoizedState=i.memoizedState,u.updateQueue=i.updateQueue,o=i.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=i.sibling,u.index=i.index,u.ref=i.ref,u.refCleanup=i.refCleanup,u}function p0(i,o){i.flags&=65011714;var u=i.alternate;return u===null?(i.childLanes=0,i.lanes=o,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=u.childLanes,i.lanes=u.lanes,i.child=u.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=u.memoizedProps,i.memoizedState=u.memoizedState,i.updateQueue=u.updateQueue,i.type=u.type,o=u.dependencies,i.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),i}function fc(i,o,u,m,x,S){var D=0;if(m=i,typeof i=="function")Gd(i)&&(D=1);else if(typeof i=="string")D=XC(i,u,q.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case K:return i=an(31,u,o,x),i.elementType=K,i.lanes=S,i;case b:return Mr(u.children,x,S,o);case T:D=8,x|=24;break;case E:return i=an(12,u,o,x|2),i.elementType=E,i.lanes=S,i;case w:return i=an(13,u,o,x),i.elementType=w,i.lanes=S,i;case G:return i=an(19,u,o,x),i.elementType=G,i.lanes=S,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case _:case C:D=10;break e;case A:D=9;break e;case N:D=11;break e;case M:D=14;break e;case B:D=16,m=null;break e}D=29,u=Error(s(130,i===null?"null":typeof i,"")),m=null}return o=an(D,u,o,x),o.elementType=i,o.type=m,o.lanes=S,o}function Mr(i,o,u,m){return i=an(7,i,m,o),i.lanes=u,i}function Hd(i,o,u){return i=an(6,i,null,o),i.lanes=u,i}function Kd(i,o,u){return o=an(4,i.children!==null?i.children:[],i.key,o),o.lanes=u,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}var Ea=[],Ta=0,hc=null,mc=0,An=[],_n=0,jr=null,Ai=1,_i="";function Ur(i,o){Ea[Ta++]=mc,Ea[Ta++]=hc,hc=i,mc=o}function y0(i,o,u){An[_n++]=Ai,An[_n++]=_i,An[_n++]=jr,jr=i;var m=Ai;i=_i;var x=32-_t(m)-1;m&=~(1<<x),u+=1;var S=32-_t(o)+x;if(30<S){var D=x-x%5;S=(m&(1<<D)-1).toString(32),m>>=D,x-=D,Ai=1<<32-_t(o)+x|u<<x|m,_i=S+i}else Ai=1<<S|u<<x|m,_i=i}function zd(i){i.return!==null&&(Ur(i,1),y0(i,1,0))}function Yd(i){for(;i===hc;)hc=Ea[--Ta],Ea[Ta]=null,mc=Ea[--Ta],Ea[Ta]=null;for(;i===jr;)jr=An[--_n],An[_n]=null,_i=An[--_n],An[_n]=null,Ai=An[--_n],An[_n]=null}var Vs=null,ss=null,wt=!1,Fr=null,ei=!1,qd=Error(s(519));function Br(i){var o=Error(s(418,""));throw Io(En(o,i)),qd}function x0(i){var o=i.stateNode,u=i.type,m=i.memoizedProps;switch(o[je]=i,o[ze]=m,u){case"dialog":xt("cancel",o),xt("close",o);break;case"iframe":case"object":case"embed":xt("load",o);break;case"video":case"audio":for(u=0;u<tl.length;u++)xt(tl[u],o);break;case"source":xt("error",o);break;case"img":case"image":case"link":xt("error",o),xt("load",o);break;case"details":xt("toggle",o);break;case"input":xt("invalid",o),Jn(o,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0),Ir(o);break;case"select":xt("invalid",o);break;case"textarea":xt("invalid",o),Un(o,m.value,m.defaultValue,m.children),Ir(o)}u=m.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||m.suppressHydrationWarning===!0||Ox(o.textContent,u)?(m.popover!=null&&(xt("beforetoggle",o),xt("toggle",o)),m.onScroll!=null&&xt("scroll",o),m.onScrollEnd!=null&&xt("scrollend",o),m.onClick!=null&&(o.onclick=qc),o=!0):o=!1,o||Br(i)}function v0(i){for(Vs=i.return;Vs;)switch(Vs.tag){case 5:case 13:ei=!1;return;case 27:case 3:ei=!0;return;default:Vs=Vs.return}}function Ro(i){if(i!==Vs)return!1;if(!wt)return v0(i),wt=!0,!1;var o=i.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=i.type,u=!(u!=="form"&&u!=="button")||dh(i.type,i.memoizedProps)),u=!u),u&&ss&&Br(i),v0(i),o===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));e:{for(i=i.nextSibling,o=0;i;){if(i.nodeType===8)if(u=i.data,u==="/$"){if(o===0){ss=Hn(i.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++;i=i.nextSibling}ss=null}}else o===27?(o=ss,dr(i.type)?(i=gh,gh=null,ss=i):ss=o):ss=Vs?Hn(i.stateNode.nextSibling):null;return!0}function Do(){ss=Vs=null,wt=!1}function b0(){var i=Fr;return i!==null&&(en===null?en=i:en.push.apply(en,i),Fr=null),i}function Io(i){Fr===null?Fr=[i]:Fr.push(i)}var Xd=j(null),$r=null,Ci=null;function Wi(i,o,u){J(Xd,o._currentValue),o._currentValue=u}function Li(i){i._currentValue=Xd.current,z(Xd)}function Wd(i,o,u){for(;i!==null;){var m=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),i===u)break;i=i.return}}function Qd(i,o,u,m){var x=i.child;for(x!==null&&(x.return=i);x!==null;){var S=x.dependencies;if(S!==null){var D=x.child;S=S.firstContext;e:for(;S!==null;){var U=S;S=x;for(var Q=0;Q<o.length;Q++)if(U.context===o[Q]){S.lanes|=u,U=S.alternate,U!==null&&(U.lanes|=u),Wd(S.return,u,i),m||(D=null);break e}S=U.next}}else if(x.tag===18){if(D=x.return,D===null)throw Error(s(341));D.lanes|=u,S=D.alternate,S!==null&&(S.lanes|=u),Wd(D,u,i),D=null}else D=x.child;if(D!==null)D.return=x;else for(D=x;D!==null;){if(D===i){D=null;break}if(x=D.sibling,x!==null){x.return=D.return,D=x;break}D=D.return}x=D}}function No(i,o,u,m){i=null;for(var x=o,S=!1;x!==null;){if(!S){if((x.flags&524288)!==0)S=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var D=x.alternate;if(D===null)throw Error(s(387));if(D=D.memoizedProps,D!==null){var U=x.type;rn(x.pendingProps.value,D.value)||(i!==null?i.push(U):i=[U])}}else if(x===_e.current){if(D=x.alternate,D===null)throw Error(s(387));D.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(i!==null?i.push(ol):i=[ol])}x=x.return}i!==null&&Qd(o,i,u,m),o.flags|=262144}function gc(i){for(i=i.firstContext;i!==null;){if(!rn(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Vr(i){$r=i,Ci=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Us(i){return S0($r,i)}function pc(i,o){return $r===null&&Vr(i),S0(i,o)}function S0(i,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},Ci===null){if(i===null)throw Error(s(308));Ci=o,i.dependencies={lanes:0,firstContext:o},i.flags|=524288}else Ci=Ci.next=o;return u}var q_=typeof AbortController<"u"?AbortController:function(){var i=[],o=this.signal={aborted:!1,addEventListener:function(u,m){i.push(m)}};this.abort=function(){o.aborted=!0,i.forEach(function(u){return u()})}},X_=n.unstable_scheduleCallback,W_=n.unstable_NormalPriority,vs={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Zd(){return{controller:new q_,data:new Map,refCount:0}}function ko(i){i.refCount--,i.refCount===0&&X_(W_,function(){i.controller.abort()})}var Po=null,Jd=0,Aa=0,_a=null;function Q_(i,o){if(Po===null){var u=Po=[];Jd=0,Aa=sh(),_a={status:"pending",value:void 0,then:function(m){u.push(m)}}}return Jd++,o.then(E0,E0),o}function E0(){if(--Jd===0&&Po!==null){_a!==null&&(_a.status="fulfilled");var i=Po;Po=null,Aa=0,_a=null;for(var o=0;o<i.length;o++)(0,i[o])()}}function Z_(i,o){var u=[],m={status:"pending",value:null,reason:null,then:function(x){u.push(x)}};return i.then(function(){m.status="fulfilled",m.value=o;for(var x=0;x<u.length;x++)(0,u[x])(o)},function(x){for(m.status="rejected",m.reason=x,x=0;x<u.length;x++)(0,u[x])(void 0)}),m}var T0=k.S;k.S=function(i,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&Q_(i,o),T0!==null&&T0(i,o)};var Gr=j(null);function ef(){var i=Gr.current;return i!==null?i:zt.pooledCache}function yc(i,o){o===null?J(Gr,Gr.current):J(Gr,o.pool)}function A0(){var i=ef();return i===null?null:{parent:vs._currentValue,pool:i}}var Oo=Error(s(460)),_0=Error(s(474)),xc=Error(s(542)),tf={then:function(){}};function C0(i){return i=i.status,i==="fulfilled"||i==="rejected"}function vc(){}function L0(i,o,u){switch(u=i[u],u===void 0?i.push(o):u!==o&&(o.then(vc,vc),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,R0(i),i;default:if(typeof o.status=="string")o.then(vc,vc);else{if(i=zt,i!==null&&100<i.shellSuspendCounter)throw Error(s(482));i=o,i.status="pending",i.then(function(m){if(o.status==="pending"){var x=o;x.status="fulfilled",x.value=m}},function(m){if(o.status==="pending"){var x=o;x.status="rejected",x.reason=m}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,R0(i),i}throw Mo=o,Oo}}var Mo=null;function w0(){if(Mo===null)throw Error(s(459));var i=Mo;return Mo=null,i}function R0(i){if(i===Oo||i===xc)throw Error(s(483))}var Qi=!1;function sf(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function nf(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Zi(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Ji(i,o,u){var m=i.updateQueue;if(m===null)return null;if(m=m.shared,(Nt&2)!==0){var x=m.pending;return x===null?o.next=o:(o.next=x.next,x.next=o),m.pending=o,o=dc(i),g0(i,null,u),o}return uc(i,m,o,u),dc(i)}function jo(i,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var m=o.lanes;m&=i.pendingLanes,u|=m,o.lanes=u,Mn(i,u)}}function rf(i,o){var u=i.updateQueue,m=i.alternate;if(m!==null&&(m=m.updateQueue,u===m)){var x=null,S=null;if(u=u.firstBaseUpdate,u!==null){do{var D={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};S===null?x=S=D:S=S.next=D,u=u.next}while(u!==null);S===null?x=S=o:S=S.next=o}else x=S=o;u={baseState:m.baseState,firstBaseUpdate:x,lastBaseUpdate:S,shared:m.shared,callbacks:m.callbacks},i.updateQueue=u;return}i=u.lastBaseUpdate,i===null?u.firstBaseUpdate=o:i.next=o,u.lastBaseUpdate=o}var af=!1;function Uo(){if(af){var i=_a;if(i!==null)throw i}}function Fo(i,o,u,m){af=!1;var x=i.updateQueue;Qi=!1;var S=x.firstBaseUpdate,D=x.lastBaseUpdate,U=x.shared.pending;if(U!==null){x.shared.pending=null;var Q=U,me=Q.next;Q.next=null,D===null?S=me:D.next=me,D=Q;var Se=i.alternate;Se!==null&&(Se=Se.updateQueue,U=Se.lastBaseUpdate,U!==D&&(U===null?Se.firstBaseUpdate=me:U.next=me,Se.lastBaseUpdate=Q))}if(S!==null){var Ce=x.baseState;D=0,Se=me=Q=null,U=S;do{var ye=U.lane&-536870913,xe=ye!==U.lane;if(xe?(Tt&ye)===ye:(m&ye)===ye){ye!==0&&ye===Aa&&(af=!0),Se!==null&&(Se=Se.next={lane:0,tag:U.tag,payload:U.payload,callback:null,next:null});e:{var it=i,st=U;ye=o;var Bt=u;switch(st.tag){case 1:if(it=st.payload,typeof it=="function"){Ce=it.call(Bt,Ce,ye);break e}Ce=it;break e;case 3:it.flags=it.flags&-65537|128;case 0:if(it=st.payload,ye=typeof it=="function"?it.call(Bt,Ce,ye):it,ye==null)break e;Ce=h({},Ce,ye);break e;case 2:Qi=!0}}ye=U.callback,ye!==null&&(i.flags|=64,xe&&(i.flags|=8192),xe=x.callbacks,xe===null?x.callbacks=[ye]:xe.push(ye))}else xe={lane:ye,tag:U.tag,payload:U.payload,callback:U.callback,next:null},Se===null?(me=Se=xe,Q=Ce):Se=Se.next=xe,D|=ye;if(U=U.next,U===null){if(U=x.shared.pending,U===null)break;xe=U,U=xe.next,xe.next=null,x.lastBaseUpdate=xe,x.shared.pending=null}}while(!0);Se===null&&(Q=Ce),x.baseState=Q,x.firstBaseUpdate=me,x.lastBaseUpdate=Se,S===null&&(x.shared.lanes=0),or|=D,i.lanes=D,i.memoizedState=Ce}}function D0(i,o){if(typeof i!="function")throw Error(s(191,i));i.call(o)}function I0(i,o){var u=i.callbacks;if(u!==null)for(i.callbacks=null,i=0;i<u.length;i++)D0(u[i],o)}var Ca=j(null),bc=j(0);function N0(i,o){i=Pi,J(bc,i),J(Ca,o),Pi=i|o.baseLanes}function of(){J(bc,Pi),J(Ca,Ca.current)}function lf(){Pi=bc.current,z(Ca),z(bc)}var er=0,dt=null,Ut=null,fs=null,Sc=!1,La=!1,Hr=!1,Ec=0,Bo=0,wa=null,J_=0;function os(){throw Error(s(321))}function cf(i,o){if(o===null)return!1;for(var u=0;u<o.length&&u<i.length;u++)if(!rn(i[u],o[u]))return!1;return!0}function uf(i,o,u,m,x,S){return er=S,dt=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,k.H=i===null||i.memoizedState===null?gy:py,Hr=!1,S=u(m,x),Hr=!1,La&&(S=P0(o,u,m,x)),k0(i),S}function k0(i){k.H=wc;var o=Ut!==null&&Ut.next!==null;if(er=0,fs=Ut=dt=null,Sc=!1,Bo=0,wa=null,o)throw Error(s(300));i===null||As||(i=i.dependencies,i!==null&&gc(i)&&(As=!0))}function P0(i,o,u,m){dt=i;var x=0;do{if(La&&(wa=null),Bo=0,La=!1,25<=x)throw Error(s(301));if(x+=1,fs=Ut=null,i.updateQueue!=null){var S=i.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}k.H=aC,S=o(u,m)}while(La);return S}function eC(){var i=k.H,o=i.useState()[0];return o=typeof o.then=="function"?$o(o):o,i=i.useState()[0],(Ut!==null?Ut.memoizedState:null)!==i&&(dt.flags|=1024),o}function df(){var i=Ec!==0;return Ec=0,i}function ff(i,o,u){o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~u}function hf(i){if(Sc){for(i=i.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}Sc=!1}er=0,fs=Ut=dt=null,La=!1,Bo=Ec=0,wa=null}function Zs(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return fs===null?dt.memoizedState=fs=i:fs=fs.next=i,fs}function hs(){if(Ut===null){var i=dt.alternate;i=i!==null?i.memoizedState:null}else i=Ut.next;var o=fs===null?dt.memoizedState:fs.next;if(o!==null)fs=o,Ut=i;else{if(i===null)throw dt.alternate===null?Error(s(467)):Error(s(310));Ut=i,i={memoizedState:Ut.memoizedState,baseState:Ut.baseState,baseQueue:Ut.baseQueue,queue:Ut.queue,next:null},fs===null?dt.memoizedState=fs=i:fs=fs.next=i}return fs}function mf(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function $o(i){var o=Bo;return Bo+=1,wa===null&&(wa=[]),i=L0(wa,i,o),o=dt,(fs===null?o.memoizedState:fs.next)===null&&(o=o.alternate,k.H=o===null||o.memoizedState===null?gy:py),i}function Tc(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return $o(i);if(i.$$typeof===C)return Us(i)}throw Error(s(438,String(i)))}function gf(i){var o=null,u=dt.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var m=dt.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(o={data:m.data.map(function(x){return x.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=mf(),dt.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(i),m=0;m<i;m++)u[m]=V;return o.index++,u}function wi(i,o){return typeof o=="function"?o(i):o}function Ac(i){var o=hs();return pf(o,Ut,i)}function pf(i,o,u){var m=i.queue;if(m===null)throw Error(s(311));m.lastRenderedReducer=u;var x=i.baseQueue,S=m.pending;if(S!==null){if(x!==null){var D=x.next;x.next=S.next,S.next=D}o.baseQueue=x=S,m.pending=null}if(S=i.baseState,x===null)i.memoizedState=S;else{o=x.next;var U=D=null,Q=null,me=o,Se=!1;do{var Ce=me.lane&-536870913;if(Ce!==me.lane?(Tt&Ce)===Ce:(er&Ce)===Ce){var ye=me.revertLane;if(ye===0)Q!==null&&(Q=Q.next={lane:0,revertLane:0,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null}),Ce===Aa&&(Se=!0);else if((er&ye)===ye){me=me.next,ye===Aa&&(Se=!0);continue}else Ce={lane:0,revertLane:me.revertLane,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},Q===null?(U=Q=Ce,D=S):Q=Q.next=Ce,dt.lanes|=ye,or|=ye;Ce=me.action,Hr&&u(S,Ce),S=me.hasEagerState?me.eagerState:u(S,Ce)}else ye={lane:Ce,revertLane:me.revertLane,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},Q===null?(U=Q=ye,D=S):Q=Q.next=ye,dt.lanes|=Ce,or|=Ce;me=me.next}while(me!==null&&me!==o);if(Q===null?D=S:Q.next=U,!rn(S,i.memoizedState)&&(As=!0,Se&&(u=_a,u!==null)))throw u;i.memoizedState=S,i.baseState=D,i.baseQueue=Q,m.lastRenderedState=S}return x===null&&(m.lanes=0),[i.memoizedState,m.dispatch]}function yf(i){var o=hs(),u=o.queue;if(u===null)throw Error(s(311));u.lastRenderedReducer=i;var m=u.dispatch,x=u.pending,S=o.memoizedState;if(x!==null){u.pending=null;var D=x=x.next;do S=i(S,D.action),D=D.next;while(D!==x);rn(S,o.memoizedState)||(As=!0),o.memoizedState=S,o.baseQueue===null&&(o.baseState=S),u.lastRenderedState=S}return[S,m]}function O0(i,o,u){var m=dt,x=hs(),S=wt;if(S){if(u===void 0)throw Error(s(407));u=u()}else u=o();var D=!rn((Ut||x).memoizedState,u);D&&(x.memoizedState=u,As=!0),x=x.queue;var U=U0.bind(null,m,x,i);if(Vo(2048,8,U,[i]),x.getSnapshot!==o||D||fs!==null&&fs.memoizedState.tag&1){if(m.flags|=2048,Ra(9,_c(),j0.bind(null,m,x,u,o),null),zt===null)throw Error(s(349));S||(er&124)!==0||M0(m,o,u)}return u}function M0(i,o,u){i.flags|=16384,i={getSnapshot:o,value:u},o=dt.updateQueue,o===null?(o=mf(),dt.updateQueue=o,o.stores=[i]):(u=o.stores,u===null?o.stores=[i]:u.push(i))}function j0(i,o,u,m){o.value=u,o.getSnapshot=m,F0(o)&&B0(i)}function U0(i,o,u){return u(function(){F0(o)&&B0(i)})}function F0(i){var o=i.getSnapshot;i=i.value;try{var u=o();return!rn(i,u)}catch{return!0}}function B0(i){var o=ba(i,2);o!==null&&dn(o,i,2)}function xf(i){var o=Zs();if(typeof i=="function"){var u=i;if(i=u(),Hr){mt(!0);try{u()}finally{mt(!1)}}}return o.memoizedState=o.baseState=i,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:wi,lastRenderedState:i},o}function $0(i,o,u,m){return i.baseState=u,pf(i,Ut,typeof m=="function"?m:wi)}function tC(i,o,u,m,x){if(Lc(i))throw Error(s(485));if(i=o.action,i!==null){var S={payload:x,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(D){S.listeners.push(D)}};k.T!==null?u(!0):S.isTransition=!1,m(S),u=o.pending,u===null?(S.next=o.pending=S,V0(o,S)):(S.next=u.next,o.pending=u.next=S)}}function V0(i,o){var u=o.action,m=o.payload,x=i.state;if(o.isTransition){var S=k.T,D={};k.T=D;try{var U=u(x,m),Q=k.S;Q!==null&&Q(D,U),G0(i,o,U)}catch(me){vf(i,o,me)}finally{k.T=S}}else try{S=u(x,m),G0(i,o,S)}catch(me){vf(i,o,me)}}function G0(i,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(m){H0(i,o,m)},function(m){return vf(i,o,m)}):H0(i,o,u)}function H0(i,o,u){o.status="fulfilled",o.value=u,K0(o),i.state=u,o=i.pending,o!==null&&(u=o.next,u===o?i.pending=null:(u=u.next,o.next=u,V0(i,u)))}function vf(i,o,u){var m=i.pending;if(i.pending=null,m!==null){m=m.next;do o.status="rejected",o.reason=u,K0(o),o=o.next;while(o!==m)}i.action=null}function K0(i){i=i.listeners;for(var o=0;o<i.length;o++)(0,i[o])()}function z0(i,o){return o}function Y0(i,o){if(wt){var u=zt.formState;if(u!==null){e:{var m=dt;if(wt){if(ss){t:{for(var x=ss,S=ei;x.nodeType!==8;){if(!S){x=null;break t}if(x=Hn(x.nextSibling),x===null){x=null;break t}}S=x.data,x=S==="F!"||S==="F"?x:null}if(x){ss=Hn(x.nextSibling),m=x.data==="F!";break e}}Br(m)}m=!1}m&&(o=u[0])}}return u=Zs(),u.memoizedState=u.baseState=o,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:z0,lastRenderedState:o},u.queue=m,u=fy.bind(null,dt,m),m.dispatch=u,m=xf(!1),S=Af.bind(null,dt,!1,m.queue),m=Zs(),x={state:o,dispatch:null,action:i,pending:null},m.queue=x,u=tC.bind(null,dt,x,S,u),x.dispatch=u,m.memoizedState=i,[o,u,!1]}function q0(i){var o=hs();return X0(o,Ut,i)}function X0(i,o,u){if(o=pf(i,o,z0)[0],i=Ac(wi)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var m=$o(o)}catch(D){throw D===Oo?xc:D}else m=o;o=hs();var x=o.queue,S=x.dispatch;return u!==o.memoizedState&&(dt.flags|=2048,Ra(9,_c(),sC.bind(null,x,u),null)),[m,S,i]}function sC(i,o){i.action=o}function W0(i){var o=hs(),u=Ut;if(u!==null)return X0(o,u,i);hs(),o=o.memoizedState,u=hs();var m=u.queue.dispatch;return u.memoizedState=i,[o,m,!1]}function Ra(i,o,u,m){return i={tag:i,create:u,deps:m,inst:o,next:null},o=dt.updateQueue,o===null&&(o=mf(),dt.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=i.next=i:(m=u.next,u.next=i,i.next=m,o.lastEffect=i),i}function _c(){return{destroy:void 0,resource:void 0}}function Q0(){return hs().memoizedState}function Cc(i,o,u,m){var x=Zs();m=m===void 0?null:m,dt.flags|=i,x.memoizedState=Ra(1|o,_c(),u,m)}function Vo(i,o,u,m){var x=hs();m=m===void 0?null:m;var S=x.memoizedState.inst;Ut!==null&&m!==null&&cf(m,Ut.memoizedState.deps)?x.memoizedState=Ra(o,S,u,m):(dt.flags|=i,x.memoizedState=Ra(1|o,S,u,m))}function Z0(i,o){Cc(8390656,8,i,o)}function J0(i,o){Vo(2048,8,i,o)}function ey(i,o){return Vo(4,2,i,o)}function ty(i,o){return Vo(4,4,i,o)}function sy(i,o){if(typeof o=="function"){i=i();var u=o(i);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function ny(i,o,u){u=u!=null?u.concat([i]):null,Vo(4,4,sy.bind(null,o,i),u)}function bf(){}function iy(i,o){var u=hs();o=o===void 0?null:o;var m=u.memoizedState;return o!==null&&cf(o,m[1])?m[0]:(u.memoizedState=[i,o],i)}function ry(i,o){var u=hs();o=o===void 0?null:o;var m=u.memoizedState;if(o!==null&&cf(o,m[1]))return m[0];if(m=i(),Hr){mt(!0);try{i()}finally{mt(!1)}}return u.memoizedState=[m,o],m}function Sf(i,o,u){return u===void 0||(er&1073741824)!==0?i.memoizedState=o:(i.memoizedState=u,i=lx(),dt.lanes|=i,or|=i,u)}function ay(i,o,u,m){return rn(u,o)?u:Ca.current!==null?(i=Sf(i,u,m),rn(i,o)||(As=!0),i):(er&42)===0?(As=!0,i.memoizedState=u):(i=lx(),dt.lanes|=i,or|=i,o)}function oy(i,o,u,m,x){var S=F.p;F.p=S!==0&&8>S?S:8;var D=k.T,U={};k.T=U,Af(i,!1,o,u);try{var Q=x(),me=k.S;if(me!==null&&me(U,Q),Q!==null&&typeof Q=="object"&&typeof Q.then=="function"){var Se=Z_(Q,m);Go(i,o,Se,un(i))}else Go(i,o,m,un(i))}catch(Ce){Go(i,o,{then:function(){},status:"rejected",reason:Ce},un())}finally{F.p=S,k.T=D}}function nC(){}function Ef(i,o,u,m){if(i.tag!==5)throw Error(s(476));var x=ly(i).queue;oy(i,x,o,O,u===null?nC:function(){return cy(i),u(m)})}function ly(i){var o=i.memoizedState;if(o!==null)return o;o={memoizedState:O,baseState:O,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:wi,lastRenderedState:O},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:wi,lastRenderedState:u},next:null},i.memoizedState=o,i=i.alternate,i!==null&&(i.memoizedState=o),o}function cy(i){var o=ly(i).next.queue;Go(i,o,{},un())}function Tf(){return Us(ol)}function uy(){return hs().memoizedState}function dy(){return hs().memoizedState}function iC(i){for(var o=i.return;o!==null;){switch(o.tag){case 24:case 3:var u=un();i=Zi(u);var m=Ji(o,i,u);m!==null&&(dn(m,o,u),jo(m,o,u)),o={cache:Zd()},i.payload=o;return}o=o.return}}function rC(i,o,u){var m=un();u={lane:m,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},Lc(i)?hy(o,u):(u=Vd(i,o,u,m),u!==null&&(dn(u,i,m),my(u,o,m)))}function fy(i,o,u){var m=un();Go(i,o,u,m)}function Go(i,o,u,m){var x={lane:m,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(Lc(i))hy(o,x);else{var S=i.alternate;if(i.lanes===0&&(S===null||S.lanes===0)&&(S=o.lastRenderedReducer,S!==null))try{var D=o.lastRenderedState,U=S(D,u);if(x.hasEagerState=!0,x.eagerState=U,rn(U,D))return uc(i,o,x,0),zt===null&&cc(),!1}catch{}finally{}if(u=Vd(i,o,x,m),u!==null)return dn(u,i,m),my(u,o,m),!0}return!1}function Af(i,o,u,m){if(m={lane:2,revertLane:sh(),action:m,hasEagerState:!1,eagerState:null,next:null},Lc(i)){if(o)throw Error(s(479))}else o=Vd(i,u,m,2),o!==null&&dn(o,i,2)}function Lc(i){var o=i.alternate;return i===dt||o!==null&&o===dt}function hy(i,o){La=Sc=!0;var u=i.pending;u===null?o.next=o:(o.next=u.next,u.next=o),i.pending=o}function my(i,o,u){if((u&4194048)!==0){var m=o.lanes;m&=i.pendingLanes,u|=m,o.lanes=u,Mn(i,u)}}var wc={readContext:Us,use:Tc,useCallback:os,useContext:os,useEffect:os,useImperativeHandle:os,useLayoutEffect:os,useInsertionEffect:os,useMemo:os,useReducer:os,useRef:os,useState:os,useDebugValue:os,useDeferredValue:os,useTransition:os,useSyncExternalStore:os,useId:os,useHostTransitionStatus:os,useFormState:os,useActionState:os,useOptimistic:os,useMemoCache:os,useCacheRefresh:os},gy={readContext:Us,use:Tc,useCallback:function(i,o){return Zs().memoizedState=[i,o===void 0?null:o],i},useContext:Us,useEffect:Z0,useImperativeHandle:function(i,o,u){u=u!=null?u.concat([i]):null,Cc(4194308,4,sy.bind(null,o,i),u)},useLayoutEffect:function(i,o){return Cc(4194308,4,i,o)},useInsertionEffect:function(i,o){Cc(4,2,i,o)},useMemo:function(i,o){var u=Zs();o=o===void 0?null:o;var m=i();if(Hr){mt(!0);try{i()}finally{mt(!1)}}return u.memoizedState=[m,o],m},useReducer:function(i,o,u){var m=Zs();if(u!==void 0){var x=u(o);if(Hr){mt(!0);try{u(o)}finally{mt(!1)}}}else x=o;return m.memoizedState=m.baseState=x,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:x},m.queue=i,i=i.dispatch=rC.bind(null,dt,i),[m.memoizedState,i]},useRef:function(i){var o=Zs();return i={current:i},o.memoizedState=i},useState:function(i){i=xf(i);var o=i.queue,u=fy.bind(null,dt,o);return o.dispatch=u,[i.memoizedState,u]},useDebugValue:bf,useDeferredValue:function(i,o){var u=Zs();return Sf(u,i,o)},useTransition:function(){var i=xf(!1);return i=oy.bind(null,dt,i.queue,!0,!1),Zs().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,o,u){var m=dt,x=Zs();if(wt){if(u===void 0)throw Error(s(407));u=u()}else{if(u=o(),zt===null)throw Error(s(349));(Tt&124)!==0||M0(m,o,u)}x.memoizedState=u;var S={value:u,getSnapshot:o};return x.queue=S,Z0(U0.bind(null,m,S,i),[i]),m.flags|=2048,Ra(9,_c(),j0.bind(null,m,S,u,o),null),u},useId:function(){var i=Zs(),o=zt.identifierPrefix;if(wt){var u=_i,m=Ai;u=(m&~(1<<32-_t(m)-1)).toString(32)+u,o=""+o+"R"+u,u=Ec++,0<u&&(o+="H"+u.toString(32)),o+=""}else u=J_++,o=""+o+"r"+u.toString(32)+"";return i.memoizedState=o},useHostTransitionStatus:Tf,useFormState:Y0,useActionState:Y0,useOptimistic:function(i){var o=Zs();o.memoizedState=o.baseState=i;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=Af.bind(null,dt,!0,u),u.dispatch=o,[i,o]},useMemoCache:gf,useCacheRefresh:function(){return Zs().memoizedState=iC.bind(null,dt)}},py={readContext:Us,use:Tc,useCallback:iy,useContext:Us,useEffect:J0,useImperativeHandle:ny,useInsertionEffect:ey,useLayoutEffect:ty,useMemo:ry,useReducer:Ac,useRef:Q0,useState:function(){return Ac(wi)},useDebugValue:bf,useDeferredValue:function(i,o){var u=hs();return ay(u,Ut.memoizedState,i,o)},useTransition:function(){var i=Ac(wi)[0],o=hs().memoizedState;return[typeof i=="boolean"?i:$o(i),o]},useSyncExternalStore:O0,useId:uy,useHostTransitionStatus:Tf,useFormState:q0,useActionState:q0,useOptimistic:function(i,o){var u=hs();return $0(u,Ut,i,o)},useMemoCache:gf,useCacheRefresh:dy},aC={readContext:Us,use:Tc,useCallback:iy,useContext:Us,useEffect:J0,useImperativeHandle:ny,useInsertionEffect:ey,useLayoutEffect:ty,useMemo:ry,useReducer:yf,useRef:Q0,useState:function(){return yf(wi)},useDebugValue:bf,useDeferredValue:function(i,o){var u=hs();return Ut===null?Sf(u,i,o):ay(u,Ut.memoizedState,i,o)},useTransition:function(){var i=yf(wi)[0],o=hs().memoizedState;return[typeof i=="boolean"?i:$o(i),o]},useSyncExternalStore:O0,useId:uy,useHostTransitionStatus:Tf,useFormState:W0,useActionState:W0,useOptimistic:function(i,o){var u=hs();return Ut!==null?$0(u,Ut,i,o):(u.baseState=i,[i,u.queue.dispatch])},useMemoCache:gf,useCacheRefresh:dy},Da=null,Ho=0;function Rc(i){var o=Ho;return Ho+=1,Da===null&&(Da=[]),L0(Da,i,o)}function Ko(i,o){o=o.props.ref,i.ref=o!==void 0?o:null}function Dc(i,o){throw o.$$typeof===g?Error(s(525)):(i=Object.prototype.toString.call(o),Error(s(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i)))}function yy(i){var o=i._init;return o(i._payload)}function xy(i){function o(re,se){if(i){var fe=re.deletions;fe===null?(re.deletions=[se],re.flags|=16):fe.push(se)}}function u(re,se){if(!i)return null;for(;se!==null;)o(re,se),se=se.sibling;return null}function m(re){for(var se=new Map;re!==null;)re.key!==null?se.set(re.key,re):se.set(re.index,re),re=re.sibling;return se}function x(re,se){return re=Ti(re,se),re.index=0,re.sibling=null,re}function S(re,se,fe){return re.index=fe,i?(fe=re.alternate,fe!==null?(fe=fe.index,fe<se?(re.flags|=67108866,se):fe):(re.flags|=67108866,se)):(re.flags|=1048576,se)}function D(re){return i&&re.alternate===null&&(re.flags|=67108866),re}function U(re,se,fe,Te){return se===null||se.tag!==6?(se=Hd(fe,re.mode,Te),se.return=re,se):(se=x(se,fe),se.return=re,se)}function Q(re,se,fe,Te){var Ye=fe.type;return Ye===b?Se(re,se,fe.props.children,Te,fe.key):se!==null&&(se.elementType===Ye||typeof Ye=="object"&&Ye!==null&&Ye.$$typeof===B&&yy(Ye)===se.type)?(se=x(se,fe.props),Ko(se,fe),se.return=re,se):(se=fc(fe.type,fe.key,fe.props,null,re.mode,Te),Ko(se,fe),se.return=re,se)}function me(re,se,fe,Te){return se===null||se.tag!==4||se.stateNode.containerInfo!==fe.containerInfo||se.stateNode.implementation!==fe.implementation?(se=Kd(fe,re.mode,Te),se.return=re,se):(se=x(se,fe.children||[]),se.return=re,se)}function Se(re,se,fe,Te,Ye){return se===null||se.tag!==7?(se=Mr(fe,re.mode,Te,Ye),se.return=re,se):(se=x(se,fe),se.return=re,se)}function Ce(re,se,fe){if(typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint")return se=Hd(""+se,re.mode,fe),se.return=re,se;if(typeof se=="object"&&se!==null){switch(se.$$typeof){case y:return fe=fc(se.type,se.key,se.props,null,re.mode,fe),Ko(fe,se),fe.return=re,fe;case v:return se=Kd(se,re.mode,fe),se.return=re,se;case B:var Te=se._init;return se=Te(se._payload),Ce(re,se,fe)}if(H(se)||ee(se))return se=Mr(se,re.mode,fe,null),se.return=re,se;if(typeof se.then=="function")return Ce(re,Rc(se),fe);if(se.$$typeof===C)return Ce(re,pc(re,se),fe);Dc(re,se)}return null}function ye(re,se,fe,Te){var Ye=se!==null?se.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return Ye!==null?null:U(re,se,""+fe,Te);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case y:return fe.key===Ye?Q(re,se,fe,Te):null;case v:return fe.key===Ye?me(re,se,fe,Te):null;case B:return Ye=fe._init,fe=Ye(fe._payload),ye(re,se,fe,Te)}if(H(fe)||ee(fe))return Ye!==null?null:Se(re,se,fe,Te,null);if(typeof fe.then=="function")return ye(re,se,Rc(fe),Te);if(fe.$$typeof===C)return ye(re,se,pc(re,fe),Te);Dc(re,fe)}return null}function xe(re,se,fe,Te,Ye){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return re=re.get(fe)||null,U(se,re,""+Te,Ye);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case y:return re=re.get(Te.key===null?fe:Te.key)||null,Q(se,re,Te,Ye);case v:return re=re.get(Te.key===null?fe:Te.key)||null,me(se,re,Te,Ye);case B:var gt=Te._init;return Te=gt(Te._payload),xe(re,se,fe,Te,Ye)}if(H(Te)||ee(Te))return re=re.get(fe)||null,Se(se,re,Te,Ye,null);if(typeof Te.then=="function")return xe(re,se,fe,Rc(Te),Ye);if(Te.$$typeof===C)return xe(re,se,fe,pc(se,Te),Ye);Dc(se,Te)}return null}function it(re,se,fe,Te){for(var Ye=null,gt=null,Je=se,nt=se=0,Cs=null;Je!==null&&nt<fe.length;nt++){Je.index>nt?(Cs=Je,Je=null):Cs=Je.sibling;var Lt=ye(re,Je,fe[nt],Te);if(Lt===null){Je===null&&(Je=Cs);break}i&&Je&&Lt.alternate===null&&o(re,Je),se=S(Lt,se,nt),gt===null?Ye=Lt:gt.sibling=Lt,gt=Lt,Je=Cs}if(nt===fe.length)return u(re,Je),wt&&Ur(re,nt),Ye;if(Je===null){for(;nt<fe.length;nt++)Je=Ce(re,fe[nt],Te),Je!==null&&(se=S(Je,se,nt),gt===null?Ye=Je:gt.sibling=Je,gt=Je);return wt&&Ur(re,nt),Ye}for(Je=m(Je);nt<fe.length;nt++)Cs=xe(Je,re,nt,fe[nt],Te),Cs!==null&&(i&&Cs.alternate!==null&&Je.delete(Cs.key===null?nt:Cs.key),se=S(Cs,se,nt),gt===null?Ye=Cs:gt.sibling=Cs,gt=Cs);return i&&Je.forEach(function(pr){return o(re,pr)}),wt&&Ur(re,nt),Ye}function st(re,se,fe,Te){if(fe==null)throw Error(s(151));for(var Ye=null,gt=null,Je=se,nt=se=0,Cs=null,Lt=fe.next();Je!==null&&!Lt.done;nt++,Lt=fe.next()){Je.index>nt?(Cs=Je,Je=null):Cs=Je.sibling;var pr=ye(re,Je,Lt.value,Te);if(pr===null){Je===null&&(Je=Cs);break}i&&Je&&pr.alternate===null&&o(re,Je),se=S(pr,se,nt),gt===null?Ye=pr:gt.sibling=pr,gt=pr,Je=Cs}if(Lt.done)return u(re,Je),wt&&Ur(re,nt),Ye;if(Je===null){for(;!Lt.done;nt++,Lt=fe.next())Lt=Ce(re,Lt.value,Te),Lt!==null&&(se=S(Lt,se,nt),gt===null?Ye=Lt:gt.sibling=Lt,gt=Lt);return wt&&Ur(re,nt),Ye}for(Je=m(Je);!Lt.done;nt++,Lt=fe.next())Lt=xe(Je,re,nt,Lt.value,Te),Lt!==null&&(i&&Lt.alternate!==null&&Je.delete(Lt.key===null?nt:Lt.key),se=S(Lt,se,nt),gt===null?Ye=Lt:gt.sibling=Lt,gt=Lt);return i&&Je.forEach(function(oL){return o(re,oL)}),wt&&Ur(re,nt),Ye}function Bt(re,se,fe,Te){if(typeof fe=="object"&&fe!==null&&fe.type===b&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case y:e:{for(var Ye=fe.key;se!==null;){if(se.key===Ye){if(Ye=fe.type,Ye===b){if(se.tag===7){u(re,se.sibling),Te=x(se,fe.props.children),Te.return=re,re=Te;break e}}else if(se.elementType===Ye||typeof Ye=="object"&&Ye!==null&&Ye.$$typeof===B&&yy(Ye)===se.type){u(re,se.sibling),Te=x(se,fe.props),Ko(Te,fe),Te.return=re,re=Te;break e}u(re,se);break}else o(re,se);se=se.sibling}fe.type===b?(Te=Mr(fe.props.children,re.mode,Te,fe.key),Te.return=re,re=Te):(Te=fc(fe.type,fe.key,fe.props,null,re.mode,Te),Ko(Te,fe),Te.return=re,re=Te)}return D(re);case v:e:{for(Ye=fe.key;se!==null;){if(se.key===Ye)if(se.tag===4&&se.stateNode.containerInfo===fe.containerInfo&&se.stateNode.implementation===fe.implementation){u(re,se.sibling),Te=x(se,fe.children||[]),Te.return=re,re=Te;break e}else{u(re,se);break}else o(re,se);se=se.sibling}Te=Kd(fe,re.mode,Te),Te.return=re,re=Te}return D(re);case B:return Ye=fe._init,fe=Ye(fe._payload),Bt(re,se,fe,Te)}if(H(fe))return it(re,se,fe,Te);if(ee(fe)){if(Ye=ee(fe),typeof Ye!="function")throw Error(s(150));return fe=Ye.call(fe),st(re,se,fe,Te)}if(typeof fe.then=="function")return Bt(re,se,Rc(fe),Te);if(fe.$$typeof===C)return Bt(re,se,pc(re,fe),Te);Dc(re,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint"?(fe=""+fe,se!==null&&se.tag===6?(u(re,se.sibling),Te=x(se,fe),Te.return=re,re=Te):(u(re,se),Te=Hd(fe,re.mode,Te),Te.return=re,re=Te),D(re)):u(re,se)}return function(re,se,fe,Te){try{Ho=0;var Ye=Bt(re,se,fe,Te);return Da=null,Ye}catch(Je){if(Je===Oo||Je===xc)throw Je;var gt=an(29,Je,null,re.mode);return gt.lanes=Te,gt.return=re,gt}finally{}}}var Ia=xy(!0),vy=xy(!1),Cn=j(null),ti=null;function tr(i){var o=i.alternate;J(bs,bs.current&1),J(Cn,i),ti===null&&(o===null||Ca.current!==null||o.memoizedState!==null)&&(ti=i)}function by(i){if(i.tag===22){if(J(bs,bs.current),J(Cn,i),ti===null){var o=i.alternate;o!==null&&o.memoizedState!==null&&(ti=i)}}else sr()}function sr(){J(bs,bs.current),J(Cn,Cn.current)}function Ri(i){z(Cn),ti===i&&(ti=null),z(bs)}var bs=j(0);function Ic(i){for(var o=i;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||mh(u)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function _f(i,o,u,m){o=i.memoizedState,u=u(m,o),u=u==null?o:h({},o,u),i.memoizedState=u,i.lanes===0&&(i.updateQueue.baseState=u)}var Cf={enqueueSetState:function(i,o,u){i=i._reactInternals;var m=un(),x=Zi(m);x.payload=o,u!=null&&(x.callback=u),o=Ji(i,x,m),o!==null&&(dn(o,i,m),jo(o,i,m))},enqueueReplaceState:function(i,o,u){i=i._reactInternals;var m=un(),x=Zi(m);x.tag=1,x.payload=o,u!=null&&(x.callback=u),o=Ji(i,x,m),o!==null&&(dn(o,i,m),jo(o,i,m))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var u=un(),m=Zi(u);m.tag=2,o!=null&&(m.callback=o),o=Ji(i,m,u),o!==null&&(dn(o,i,u),jo(o,i,u))}};function Sy(i,o,u,m,x,S,D){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(m,S,D):o.prototype&&o.prototype.isPureReactComponent?!Lo(u,m)||!Lo(x,S):!0}function Ey(i,o,u,m){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,m),o.state!==i&&Cf.enqueueReplaceState(o,o.state,null)}function Kr(i,o){var u=o;if("ref"in o){u={};for(var m in o)m!=="ref"&&(u[m]=o[m])}if(i=i.defaultProps){u===o&&(u=h({},u));for(var x in i)u[x]===void 0&&(u[x]=i[x])}return u}var Nc=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function Ty(i){Nc(i)}function Ay(i){console.error(i)}function _y(i){Nc(i)}function kc(i,o){try{var u=i.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(m){setTimeout(function(){throw m})}}function Cy(i,o,u){try{var m=i.onCaughtError;m(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function Lf(i,o,u){return u=Zi(u),u.tag=3,u.payload={element:null},u.callback=function(){kc(i,o)},u}function Ly(i){return i=Zi(i),i.tag=3,i}function wy(i,o,u,m){var x=u.type.getDerivedStateFromError;if(typeof x=="function"){var S=m.value;i.payload=function(){return x(S)},i.callback=function(){Cy(o,u,m)}}var D=u.stateNode;D!==null&&typeof D.componentDidCatch=="function"&&(i.callback=function(){Cy(o,u,m),typeof x!="function"&&(lr===null?lr=new Set([this]):lr.add(this));var U=m.stack;this.componentDidCatch(m.value,{componentStack:U!==null?U:""})})}function oC(i,o,u,m,x){if(u.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(o=u.alternate,o!==null&&No(o,u,x,!0),u=Cn.current,u!==null){switch(u.tag){case 13:return ti===null?Qf():u.alternate===null&&ns===0&&(ns=3),u.flags&=-257,u.flags|=65536,u.lanes=x,m===tf?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([m]):o.add(m),Jf(i,m,x)),!1;case 22:return u.flags|=65536,m===tf?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([m])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([m]):u.add(m)),Jf(i,m,x)),!1}throw Error(s(435,u.tag))}return Jf(i,m,x),Qf(),!1}if(wt)return o=Cn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=x,m!==qd&&(i=Error(s(422),{cause:m}),Io(En(i,u)))):(m!==qd&&(o=Error(s(423),{cause:m}),Io(En(o,u))),i=i.current.alternate,i.flags|=65536,x&=-x,i.lanes|=x,m=En(m,u),x=Lf(i.stateNode,m,x),rf(i,x),ns!==4&&(ns=2)),!1;var S=Error(s(520),{cause:m});if(S=En(S,u),Zo===null?Zo=[S]:Zo.push(S),ns!==4&&(ns=2),o===null)return!0;m=En(m,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,i=x&-x,u.lanes|=i,i=Lf(u.stateNode,m,i),rf(u,i),!1;case 1:if(o=u.type,S=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(lr===null||!lr.has(S))))return u.flags|=65536,x&=-x,u.lanes|=x,x=Ly(x),wy(x,i,u,m),rf(u,x),!1}u=u.return}while(u!==null);return!1}var Ry=Error(s(461)),As=!1;function Rs(i,o,u,m){o.child=i===null?vy(o,null,u,m):Ia(o,i.child,u,m)}function Dy(i,o,u,m,x){u=u.render;var S=o.ref;if("ref"in m){var D={};for(var U in m)U!=="ref"&&(D[U]=m[U])}else D=m;return Vr(o),m=uf(i,o,u,D,S,x),U=df(),i!==null&&!As?(ff(i,o,x),Di(i,o,x)):(wt&&U&&zd(o),o.flags|=1,Rs(i,o,m,x),o.child)}function Iy(i,o,u,m,x){if(i===null){var S=u.type;return typeof S=="function"&&!Gd(S)&&S.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=S,Ny(i,o,S,m,x)):(i=fc(u.type,null,m,o,o.mode,x),i.ref=o.ref,i.return=o,o.child=i)}if(S=i.child,!Of(i,x)){var D=S.memoizedProps;if(u=u.compare,u=u!==null?u:Lo,u(D,m)&&i.ref===o.ref)return Di(i,o,x)}return o.flags|=1,i=Ti(S,m),i.ref=o.ref,i.return=o,o.child=i}function Ny(i,o,u,m,x){if(i!==null){var S=i.memoizedProps;if(Lo(S,m)&&i.ref===o.ref)if(As=!1,o.pendingProps=m=S,Of(i,x))(i.flags&131072)!==0&&(As=!0);else return o.lanes=i.lanes,Di(i,o,x)}return wf(i,o,u,m,x)}function ky(i,o,u){var m=o.pendingProps,x=m.children,S=i!==null?i.memoizedState:null;if(m.mode==="hidden"){if((o.flags&128)!==0){if(m=S!==null?S.baseLanes|u:u,i!==null){for(x=o.child=i.child,S=0;x!==null;)S=S|x.lanes|x.childLanes,x=x.sibling;o.childLanes=S&~m}else o.childLanes=0,o.child=null;return Py(i,o,m,u)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},i!==null&&yc(o,S!==null?S.cachePool:null),S!==null?N0(o,S):of(),by(o);else return o.lanes=o.childLanes=536870912,Py(i,o,S!==null?S.baseLanes|u:u,u)}else S!==null?(yc(o,S.cachePool),N0(o,S),sr(),o.memoizedState=null):(i!==null&&yc(o,null),of(),sr());return Rs(i,o,x,u),o.child}function Py(i,o,u,m){var x=ef();return x=x===null?null:{parent:vs._currentValue,pool:x},o.memoizedState={baseLanes:u,cachePool:x},i!==null&&yc(o,null),of(),by(o),i!==null&&No(i,o,m,!0),null}function Pc(i,o){var u=o.ref;if(u===null)i!==null&&i.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(s(284));(i===null||i.ref!==u)&&(o.flags|=4194816)}}function wf(i,o,u,m,x){return Vr(o),u=uf(i,o,u,m,void 0,x),m=df(),i!==null&&!As?(ff(i,o,x),Di(i,o,x)):(wt&&m&&zd(o),o.flags|=1,Rs(i,o,u,x),o.child)}function Oy(i,o,u,m,x,S){return Vr(o),o.updateQueue=null,u=P0(o,m,u,x),k0(i),m=df(),i!==null&&!As?(ff(i,o,S),Di(i,o,S)):(wt&&m&&zd(o),o.flags|=1,Rs(i,o,u,S),o.child)}function My(i,o,u,m,x){if(Vr(o),o.stateNode===null){var S=Sa,D=u.contextType;typeof D=="object"&&D!==null&&(S=Us(D)),S=new u(m,S),o.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=Cf,o.stateNode=S,S._reactInternals=o,S=o.stateNode,S.props=m,S.state=o.memoizedState,S.refs={},sf(o),D=u.contextType,S.context=typeof D=="object"&&D!==null?Us(D):Sa,S.state=o.memoizedState,D=u.getDerivedStateFromProps,typeof D=="function"&&(_f(o,u,D,m),S.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(D=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),D!==S.state&&Cf.enqueueReplaceState(S,S.state,null),Fo(o,m,S,x),Uo(),S.state=o.memoizedState),typeof S.componentDidMount=="function"&&(o.flags|=4194308),m=!0}else if(i===null){S=o.stateNode;var U=o.memoizedProps,Q=Kr(u,U);S.props=Q;var me=S.context,Se=u.contextType;D=Sa,typeof Se=="object"&&Se!==null&&(D=Us(Se));var Ce=u.getDerivedStateFromProps;Se=typeof Ce=="function"||typeof S.getSnapshotBeforeUpdate=="function",U=o.pendingProps!==U,Se||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(U||me!==D)&&Ey(o,S,m,D),Qi=!1;var ye=o.memoizedState;S.state=ye,Fo(o,m,S,x),Uo(),me=o.memoizedState,U||ye!==me||Qi?(typeof Ce=="function"&&(_f(o,u,Ce,m),me=o.memoizedState),(Q=Qi||Sy(o,u,Q,m,ye,me,D))?(Se||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(o.flags|=4194308)):(typeof S.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=me),S.props=m,S.state=me,S.context=D,m=Q):(typeof S.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{S=o.stateNode,nf(i,o),D=o.memoizedProps,Se=Kr(u,D),S.props=Se,Ce=o.pendingProps,ye=S.context,me=u.contextType,Q=Sa,typeof me=="object"&&me!==null&&(Q=Us(me)),U=u.getDerivedStateFromProps,(me=typeof U=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(D!==Ce||ye!==Q)&&Ey(o,S,m,Q),Qi=!1,ye=o.memoizedState,S.state=ye,Fo(o,m,S,x),Uo();var xe=o.memoizedState;D!==Ce||ye!==xe||Qi||i!==null&&i.dependencies!==null&&gc(i.dependencies)?(typeof U=="function"&&(_f(o,u,U,m),xe=o.memoizedState),(Se=Qi||Sy(o,u,Se,m,ye,xe,Q)||i!==null&&i.dependencies!==null&&gc(i.dependencies))?(me||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(m,xe,Q),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(m,xe,Q)),typeof S.componentDidUpdate=="function"&&(o.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof S.componentDidUpdate!="function"||D===i.memoizedProps&&ye===i.memoizedState||(o.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||D===i.memoizedProps&&ye===i.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=xe),S.props=m,S.state=xe,S.context=Q,m=Se):(typeof S.componentDidUpdate!="function"||D===i.memoizedProps&&ye===i.memoizedState||(o.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||D===i.memoizedProps&&ye===i.memoizedState||(o.flags|=1024),m=!1)}return S=m,Pc(i,o),m=(o.flags&128)!==0,S||m?(S=o.stateNode,u=m&&typeof u.getDerivedStateFromError!="function"?null:S.render(),o.flags|=1,i!==null&&m?(o.child=Ia(o,i.child,null,x),o.child=Ia(o,null,u,x)):Rs(i,o,u,x),o.memoizedState=S.state,i=o.child):i=Di(i,o,x),i}function jy(i,o,u,m){return Do(),o.flags|=256,Rs(i,o,u,m),o.child}var Rf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Df(i){return{baseLanes:i,cachePool:A0()}}function If(i,o,u){return i=i!==null?i.childLanes&~u:0,o&&(i|=Ln),i}function Uy(i,o,u){var m=o.pendingProps,x=!1,S=(o.flags&128)!==0,D;if((D=S)||(D=i!==null&&i.memoizedState===null?!1:(bs.current&2)!==0),D&&(x=!0,o.flags&=-129),D=(o.flags&32)!==0,o.flags&=-33,i===null){if(wt){if(x?tr(o):sr(),wt){var U=ss,Q;if(Q=U){e:{for(Q=U,U=ei;Q.nodeType!==8;){if(!U){U=null;break e}if(Q=Hn(Q.nextSibling),Q===null){U=null;break e}}U=Q}U!==null?(o.memoizedState={dehydrated:U,treeContext:jr!==null?{id:Ai,overflow:_i}:null,retryLane:536870912,hydrationErrors:null},Q=an(18,null,null,0),Q.stateNode=U,Q.return=o,o.child=Q,Vs=o,ss=null,Q=!0):Q=!1}Q||Br(o)}if(U=o.memoizedState,U!==null&&(U=U.dehydrated,U!==null))return mh(U)?o.lanes=32:o.lanes=536870912,null;Ri(o)}return U=m.children,m=m.fallback,x?(sr(),x=o.mode,U=Oc({mode:"hidden",children:U},x),m=Mr(m,x,u,null),U.return=o,m.return=o,U.sibling=m,o.child=U,x=o.child,x.memoizedState=Df(u),x.childLanes=If(i,D,u),o.memoizedState=Rf,m):(tr(o),Nf(o,U))}if(Q=i.memoizedState,Q!==null&&(U=Q.dehydrated,U!==null)){if(S)o.flags&256?(tr(o),o.flags&=-257,o=kf(i,o,u)):o.memoizedState!==null?(sr(),o.child=i.child,o.flags|=128,o=null):(sr(),x=m.fallback,U=o.mode,m=Oc({mode:"visible",children:m.children},U),x=Mr(x,U,u,null),x.flags|=2,m.return=o,x.return=o,m.sibling=x,o.child=m,Ia(o,i.child,null,u),m=o.child,m.memoizedState=Df(u),m.childLanes=If(i,D,u),o.memoizedState=Rf,o=x);else if(tr(o),mh(U)){if(D=U.nextSibling&&U.nextSibling.dataset,D)var me=D.dgst;D=me,m=Error(s(419)),m.stack="",m.digest=D,Io({value:m,source:null,stack:null}),o=kf(i,o,u)}else if(As||No(i,o,u,!1),D=(u&i.childLanes)!==0,As||D){if(D=zt,D!==null&&(m=u&-u,m=(m&42)!==0?1:qs(m),m=(m&(D.suspendedLanes|u))!==0?0:m,m!==0&&m!==Q.retryLane))throw Q.retryLane=m,ba(i,m),dn(D,i,m),Ry;U.data==="$?"||Qf(),o=kf(i,o,u)}else U.data==="$?"?(o.flags|=192,o.child=i.child,o=null):(i=Q.treeContext,ss=Hn(U.nextSibling),Vs=o,wt=!0,Fr=null,ei=!1,i!==null&&(An[_n++]=Ai,An[_n++]=_i,An[_n++]=jr,Ai=i.id,_i=i.overflow,jr=o),o=Nf(o,m.children),o.flags|=4096);return o}return x?(sr(),x=m.fallback,U=o.mode,Q=i.child,me=Q.sibling,m=Ti(Q,{mode:"hidden",children:m.children}),m.subtreeFlags=Q.subtreeFlags&65011712,me!==null?x=Ti(me,x):(x=Mr(x,U,u,null),x.flags|=2),x.return=o,m.return=o,m.sibling=x,o.child=m,m=x,x=o.child,U=i.child.memoizedState,U===null?U=Df(u):(Q=U.cachePool,Q!==null?(me=vs._currentValue,Q=Q.parent!==me?{parent:me,pool:me}:Q):Q=A0(),U={baseLanes:U.baseLanes|u,cachePool:Q}),x.memoizedState=U,x.childLanes=If(i,D,u),o.memoizedState=Rf,m):(tr(o),u=i.child,i=u.sibling,u=Ti(u,{mode:"visible",children:m.children}),u.return=o,u.sibling=null,i!==null&&(D=o.deletions,D===null?(o.deletions=[i],o.flags|=16):D.push(i)),o.child=u,o.memoizedState=null,u)}function Nf(i,o){return o=Oc({mode:"visible",children:o},i.mode),o.return=i,i.child=o}function Oc(i,o){return i=an(22,i,null,o),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function kf(i,o,u){return Ia(o,i.child,null,u),i=Nf(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function Fy(i,o,u){i.lanes|=o;var m=i.alternate;m!==null&&(m.lanes|=o),Wd(i.return,o,u)}function Pf(i,o,u,m,x){var S=i.memoizedState;S===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:u,tailMode:x}:(S.isBackwards=o,S.rendering=null,S.renderingStartTime=0,S.last=m,S.tail=u,S.tailMode=x)}function By(i,o,u){var m=o.pendingProps,x=m.revealOrder,S=m.tail;if(Rs(i,o,m.children,u),m=bs.current,(m&2)!==0)m=m&1|2,o.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Fy(i,u,o);else if(i.tag===19)Fy(i,u,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}m&=1}switch(J(bs,m),x){case"forwards":for(u=o.child,x=null;u!==null;)i=u.alternate,i!==null&&Ic(i)===null&&(x=u),u=u.sibling;u=x,u===null?(x=o.child,o.child=null):(x=u.sibling,u.sibling=null),Pf(o,!1,x,u,S);break;case"backwards":for(u=null,x=o.child,o.child=null;x!==null;){if(i=x.alternate,i!==null&&Ic(i)===null){o.child=x;break}i=x.sibling,x.sibling=u,u=x,x=i}Pf(o,!0,u,null,S);break;case"together":Pf(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Di(i,o,u){if(i!==null&&(o.dependencies=i.dependencies),or|=o.lanes,(u&o.childLanes)===0)if(i!==null){if(No(i,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(i!==null&&o.child!==i.child)throw Error(s(153));if(o.child!==null){for(i=o.child,u=Ti(i,i.pendingProps),o.child=u,u.return=o;i.sibling!==null;)i=i.sibling,u=u.sibling=Ti(i,i.pendingProps),u.return=o;u.sibling=null}return o.child}function Of(i,o){return(i.lanes&o)!==0?!0:(i=i.dependencies,!!(i!==null&&gc(i)))}function lC(i,o,u){switch(o.tag){case 3:Le(o,o.stateNode.containerInfo),Wi(o,vs,i.memoizedState.cache),Do();break;case 27:case 5:$e(o);break;case 4:Le(o,o.stateNode.containerInfo);break;case 10:Wi(o,o.type,o.memoizedProps.value);break;case 13:var m=o.memoizedState;if(m!==null)return m.dehydrated!==null?(tr(o),o.flags|=128,null):(u&o.child.childLanes)!==0?Uy(i,o,u):(tr(o),i=Di(i,o,u),i!==null?i.sibling:null);tr(o);break;case 19:var x=(i.flags&128)!==0;if(m=(u&o.childLanes)!==0,m||(No(i,o,u,!1),m=(u&o.childLanes)!==0),x){if(m)return By(i,o,u);o.flags|=128}if(x=o.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),J(bs,bs.current),m)break;return null;case 22:case 23:return o.lanes=0,ky(i,o,u);case 24:Wi(o,vs,i.memoizedState.cache)}return Di(i,o,u)}function $y(i,o,u){if(i!==null)if(i.memoizedProps!==o.pendingProps)As=!0;else{if(!Of(i,u)&&(o.flags&128)===0)return As=!1,lC(i,o,u);As=(i.flags&131072)!==0}else As=!1,wt&&(o.flags&1048576)!==0&&y0(o,mc,o.index);switch(o.lanes=0,o.tag){case 16:e:{i=o.pendingProps;var m=o.elementType,x=m._init;if(m=x(m._payload),o.type=m,typeof m=="function")Gd(m)?(i=Kr(m,i),o.tag=1,o=My(null,o,m,i,u)):(o.tag=0,o=wf(null,o,m,i,u));else{if(m!=null){if(x=m.$$typeof,x===N){o.tag=11,o=Dy(null,o,m,i,u);break e}else if(x===M){o.tag=14,o=Iy(null,o,m,i,u);break e}}throw o=Z(m)||m,Error(s(306,o,""))}}return o;case 0:return wf(i,o,o.type,o.pendingProps,u);case 1:return m=o.type,x=Kr(m,o.pendingProps),My(i,o,m,x,u);case 3:e:{if(Le(o,o.stateNode.containerInfo),i===null)throw Error(s(387));m=o.pendingProps;var S=o.memoizedState;x=S.element,nf(i,o),Fo(o,m,null,u);var D=o.memoizedState;if(m=D.cache,Wi(o,vs,m),m!==S.cache&&Qd(o,[vs],u,!0),Uo(),m=D.element,S.isDehydrated)if(S={element:m,isDehydrated:!1,cache:D.cache},o.updateQueue.baseState=S,o.memoizedState=S,o.flags&256){o=jy(i,o,m,u);break e}else if(m!==x){x=En(Error(s(424)),o),Io(x),o=jy(i,o,m,u);break e}else{switch(i=o.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(ss=Hn(i.firstChild),Vs=o,wt=!0,Fr=null,ei=!0,u=vy(o,null,m,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Do(),m===x){o=Di(i,o,u);break e}Rs(i,o,m,u)}o=o.child}return o;case 26:return Pc(i,o),i===null?(u=Kx(o.type,null,o.pendingProps,null))?o.memoizedState=u:wt||(u=o.type,i=o.pendingProps,m=Xc(de.current).createElement(u),m[je]=o,m[ze]=i,Is(m,u,i),Vt(m),o.stateNode=m):o.memoizedState=Kx(o.type,i.memoizedProps,o.pendingProps,i.memoizedState),null;case 27:return $e(o),i===null&&wt&&(m=o.stateNode=Vx(o.type,o.pendingProps,de.current),Vs=o,ei=!0,x=ss,dr(o.type)?(gh=x,ss=Hn(m.firstChild)):ss=x),Rs(i,o,o.pendingProps.children,u),Pc(i,o),i===null&&(o.flags|=4194304),o.child;case 5:return i===null&&wt&&((x=m=ss)&&(m=MC(m,o.type,o.pendingProps,ei),m!==null?(o.stateNode=m,Vs=o,ss=Hn(m.firstChild),ei=!1,x=!0):x=!1),x||Br(o)),$e(o),x=o.type,S=o.pendingProps,D=i!==null?i.memoizedProps:null,m=S.children,dh(x,S)?m=null:D!==null&&dh(x,D)&&(o.flags|=32),o.memoizedState!==null&&(x=uf(i,o,eC,null,null,u),ol._currentValue=x),Pc(i,o),Rs(i,o,m,u),o.child;case 6:return i===null&&wt&&((i=u=ss)&&(u=jC(u,o.pendingProps,ei),u!==null?(o.stateNode=u,Vs=o,ss=null,i=!0):i=!1),i||Br(o)),null;case 13:return Uy(i,o,u);case 4:return Le(o,o.stateNode.containerInfo),m=o.pendingProps,i===null?o.child=Ia(o,null,m,u):Rs(i,o,m,u),o.child;case 11:return Dy(i,o,o.type,o.pendingProps,u);case 7:return Rs(i,o,o.pendingProps,u),o.child;case 8:return Rs(i,o,o.pendingProps.children,u),o.child;case 12:return Rs(i,o,o.pendingProps.children,u),o.child;case 10:return m=o.pendingProps,Wi(o,o.type,m.value),Rs(i,o,m.children,u),o.child;case 9:return x=o.type._context,m=o.pendingProps.children,Vr(o),x=Us(x),m=m(x),o.flags|=1,Rs(i,o,m,u),o.child;case 14:return Iy(i,o,o.type,o.pendingProps,u);case 15:return Ny(i,o,o.type,o.pendingProps,u);case 19:return By(i,o,u);case 31:return m=o.pendingProps,u=o.mode,m={mode:m.mode,children:m.children},i===null?(u=Oc(m,u),u.ref=o.ref,o.child=u,u.return=o,o=u):(u=Ti(i.child,m),u.ref=o.ref,o.child=u,u.return=o,o=u),o;case 22:return ky(i,o,u);case 24:return Vr(o),m=Us(vs),i===null?(x=ef(),x===null&&(x=zt,S=Zd(),x.pooledCache=S,S.refCount++,S!==null&&(x.pooledCacheLanes|=u),x=S),o.memoizedState={parent:m,cache:x},sf(o),Wi(o,vs,x)):((i.lanes&u)!==0&&(nf(i,o),Fo(o,null,null,u),Uo()),x=i.memoizedState,S=o.memoizedState,x.parent!==m?(x={parent:m,cache:m},o.memoizedState=x,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=x),Wi(o,vs,m)):(m=S.cache,Wi(o,vs,m),m!==x.cache&&Qd(o,[vs],u,!0))),Rs(i,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(s(156,o.tag))}function Ii(i){i.flags|=4}function Vy(i,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!Wx(o)){if(o=Cn.current,o!==null&&((Tt&4194048)===Tt?ti!==null:(Tt&62914560)!==Tt&&(Tt&536870912)===0||o!==ti))throw Mo=tf,_0;i.flags|=8192}}function Mc(i,o){o!==null&&(i.flags|=4),i.flags&16384&&(o=i.tag!==22?Qn():536870912,i.lanes|=o,Oa|=o)}function zo(i,o){if(!wt)switch(i.tailMode){case"hidden":o=i.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?i.tail=null:u.sibling=null;break;case"collapsed":u=i.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:m.sibling=null}}function Qt(i){var o=i.alternate!==null&&i.alternate.child===i.child,u=0,m=0;if(o)for(var x=i.child;x!==null;)u|=x.lanes|x.childLanes,m|=x.subtreeFlags&65011712,m|=x.flags&65011712,x.return=i,x=x.sibling;else for(x=i.child;x!==null;)u|=x.lanes|x.childLanes,m|=x.subtreeFlags,m|=x.flags,x.return=i,x=x.sibling;return i.subtreeFlags|=m,i.childLanes=u,o}function cC(i,o,u){var m=o.pendingProps;switch(Yd(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qt(o),null;case 1:return Qt(o),null;case 3:return u=o.stateNode,m=null,i!==null&&(m=i.memoizedState.cache),o.memoizedState.cache!==m&&(o.flags|=2048),Li(vs),Fe(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(i===null||i.child===null)&&(Ro(o)?Ii(o):i===null||i.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,b0())),Qt(o),null;case 26:return u=o.memoizedState,i===null?(Ii(o),u!==null?(Qt(o),Vy(o,u)):(Qt(o),o.flags&=-16777217)):u?u!==i.memoizedState?(Ii(o),Qt(o),Vy(o,u)):(Qt(o),o.flags&=-16777217):(i.memoizedProps!==m&&Ii(o),Qt(o),o.flags&=-16777217),null;case 27:pe(o),u=de.current;var x=o.type;if(i!==null&&o.stateNode!=null)i.memoizedProps!==m&&Ii(o);else{if(!m){if(o.stateNode===null)throw Error(s(166));return Qt(o),null}i=q.current,Ro(o)?x0(o):(i=Vx(x,m,u),o.stateNode=i,Ii(o))}return Qt(o),null;case 5:if(pe(o),u=o.type,i!==null&&o.stateNode!=null)i.memoizedProps!==m&&Ii(o);else{if(!m){if(o.stateNode===null)throw Error(s(166));return Qt(o),null}if(i=q.current,Ro(o))x0(o);else{switch(x=Xc(de.current),i){case 1:i=x.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:i=x.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":i=x.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":i=x.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":i=x.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof m.is=="string"?x.createElement("select",{is:m.is}):x.createElement("select"),m.multiple?i.multiple=!0:m.size&&(i.size=m.size);break;default:i=typeof m.is=="string"?x.createElement(u,{is:m.is}):x.createElement(u)}}i[je]=o,i[ze]=m;e:for(x=o.child;x!==null;){if(x.tag===5||x.tag===6)i.appendChild(x.stateNode);else if(x.tag!==4&&x.tag!==27&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===o)break e;for(;x.sibling===null;){if(x.return===null||x.return===o)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}o.stateNode=i;e:switch(Is(i,u,m),u){case"button":case"input":case"select":case"textarea":i=!!m.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&Ii(o)}}return Qt(o),o.flags&=-16777217,null;case 6:if(i&&o.stateNode!=null)i.memoizedProps!==m&&Ii(o);else{if(typeof m!="string"&&o.stateNode===null)throw Error(s(166));if(i=de.current,Ro(o)){if(i=o.stateNode,u=o.memoizedProps,m=null,x=Vs,x!==null)switch(x.tag){case 27:case 5:m=x.memoizedProps}i[je]=o,i=!!(i.nodeValue===u||m!==null&&m.suppressHydrationWarning===!0||Ox(i.nodeValue,u)),i||Br(o)}else i=Xc(i).createTextNode(m),i[je]=o,o.stateNode=i}return Qt(o),null;case 13:if(m=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(x=Ro(o),m!==null&&m.dehydrated!==null){if(i===null){if(!x)throw Error(s(318));if(x=o.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(s(317));x[je]=o}else Do(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Qt(o),x=!1}else x=b0(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=x),x=!0;if(!x)return o.flags&256?(Ri(o),o):(Ri(o),null)}if(Ri(o),(o.flags&128)!==0)return o.lanes=u,o;if(u=m!==null,i=i!==null&&i.memoizedState!==null,u){m=o.child,x=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(x=m.alternate.memoizedState.cachePool.pool);var S=null;m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(S=m.memoizedState.cachePool.pool),S!==x&&(m.flags|=2048)}return u!==i&&u&&(o.child.flags|=8192),Mc(o,o.updateQueue),Qt(o),null;case 4:return Fe(),i===null&&ah(o.stateNode.containerInfo),Qt(o),null;case 10:return Li(o.type),Qt(o),null;case 19:if(z(bs),x=o.memoizedState,x===null)return Qt(o),null;if(m=(o.flags&128)!==0,S=x.rendering,S===null)if(m)zo(x,!1);else{if(ns!==0||i!==null&&(i.flags&128)!==0)for(i=o.child;i!==null;){if(S=Ic(i),S!==null){for(o.flags|=128,zo(x,!1),i=S.updateQueue,o.updateQueue=i,Mc(o,i),o.subtreeFlags=0,i=u,u=o.child;u!==null;)p0(u,i),u=u.sibling;return J(bs,bs.current&1|2),o.child}i=i.sibling}x.tail!==null&&te()>Fc&&(o.flags|=128,m=!0,zo(x,!1),o.lanes=4194304)}else{if(!m)if(i=Ic(S),i!==null){if(o.flags|=128,m=!0,i=i.updateQueue,o.updateQueue=i,Mc(o,i),zo(x,!0),x.tail===null&&x.tailMode==="hidden"&&!S.alternate&&!wt)return Qt(o),null}else 2*te()-x.renderingStartTime>Fc&&u!==536870912&&(o.flags|=128,m=!0,zo(x,!1),o.lanes=4194304);x.isBackwards?(S.sibling=o.child,o.child=S):(i=x.last,i!==null?i.sibling=S:o.child=S,x.last=S)}return x.tail!==null?(o=x.tail,x.rendering=o,x.tail=o.sibling,x.renderingStartTime=te(),o.sibling=null,i=bs.current,J(bs,m?i&1|2:i&1),o):(Qt(o),null);case 22:case 23:return Ri(o),lf(),m=o.memoizedState!==null,i!==null?i.memoizedState!==null!==m&&(o.flags|=8192):m&&(o.flags|=8192),m?(u&536870912)!==0&&(o.flags&128)===0&&(Qt(o),o.subtreeFlags&6&&(o.flags|=8192)):Qt(o),u=o.updateQueue,u!==null&&Mc(o,u.retryQueue),u=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),m=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(m=o.memoizedState.cachePool.pool),m!==u&&(o.flags|=2048),i!==null&&z(Gr),null;case 24:return u=null,i!==null&&(u=i.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),Li(vs),Qt(o),null;case 25:return null;case 30:return null}throw Error(s(156,o.tag))}function uC(i,o){switch(Yd(o),o.tag){case 1:return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return Li(vs),Fe(),i=o.flags,(i&65536)!==0&&(i&128)===0?(o.flags=i&-65537|128,o):null;case 26:case 27:case 5:return pe(o),null;case 13:if(Ri(o),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(s(340));Do()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return z(bs),null;case 4:return Fe(),null;case 10:return Li(o.type),null;case 22:case 23:return Ri(o),lf(),i!==null&&z(Gr),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 24:return Li(vs),null;case 25:return null;default:return null}}function Gy(i,o){switch(Yd(o),o.tag){case 3:Li(vs),Fe();break;case 26:case 27:case 5:pe(o);break;case 4:Fe();break;case 13:Ri(o);break;case 19:z(bs);break;case 10:Li(o.type);break;case 22:case 23:Ri(o),lf(),i!==null&&z(Gr);break;case 24:Li(vs)}}function Yo(i,o){try{var u=o.updateQueue,m=u!==null?u.lastEffect:null;if(m!==null){var x=m.next;u=x;do{if((u.tag&i)===i){m=void 0;var S=u.create,D=u.inst;m=S(),D.destroy=m}u=u.next}while(u!==x)}}catch(U){Gt(o,o.return,U)}}function nr(i,o,u){try{var m=o.updateQueue,x=m!==null?m.lastEffect:null;if(x!==null){var S=x.next;m=S;do{if((m.tag&i)===i){var D=m.inst,U=D.destroy;if(U!==void 0){D.destroy=void 0,x=o;var Q=u,me=U;try{me()}catch(Se){Gt(x,Q,Se)}}}m=m.next}while(m!==S)}}catch(Se){Gt(o,o.return,Se)}}function Hy(i){var o=i.updateQueue;if(o!==null){var u=i.stateNode;try{I0(o,u)}catch(m){Gt(i,i.return,m)}}}function Ky(i,o,u){u.props=Kr(i.type,i.memoizedProps),u.state=i.memoizedState;try{u.componentWillUnmount()}catch(m){Gt(i,o,m)}}function qo(i,o){try{var u=i.ref;if(u!==null){switch(i.tag){case 26:case 27:case 5:var m=i.stateNode;break;case 30:m=i.stateNode;break;default:m=i.stateNode}typeof u=="function"?i.refCleanup=u(m):u.current=m}}catch(x){Gt(i,o,x)}}function si(i,o){var u=i.ref,m=i.refCleanup;if(u!==null)if(typeof m=="function")try{m()}catch(x){Gt(i,o,x)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(x){Gt(i,o,x)}else u.current=null}function zy(i){var o=i.type,u=i.memoizedProps,m=i.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&m.focus();break e;case"img":u.src?m.src=u.src:u.srcSet&&(m.srcset=u.srcSet)}}catch(x){Gt(i,i.return,x)}}function Mf(i,o,u){try{var m=i.stateNode;IC(m,i.type,u,o),m[ze]=o}catch(x){Gt(i,i.return,x)}}function Yy(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&dr(i.type)||i.tag===4}function jf(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Yy(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&dr(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Uf(i,o,u){var m=i.tag;if(m===5||m===6)i=i.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(i,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(i),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=qc));else if(m!==4&&(m===27&&dr(i.type)&&(u=i.stateNode,o=null),i=i.child,i!==null))for(Uf(i,o,u),i=i.sibling;i!==null;)Uf(i,o,u),i=i.sibling}function jc(i,o,u){var m=i.tag;if(m===5||m===6)i=i.stateNode,o?u.insertBefore(i,o):u.appendChild(i);else if(m!==4&&(m===27&&dr(i.type)&&(u=i.stateNode),i=i.child,i!==null))for(jc(i,o,u),i=i.sibling;i!==null;)jc(i,o,u),i=i.sibling}function qy(i){var o=i.stateNode,u=i.memoizedProps;try{for(var m=i.type,x=o.attributes;x.length;)o.removeAttributeNode(x[0]);Is(o,m,u),o[je]=i,o[ze]=u}catch(S){Gt(i,i.return,S)}}var Ni=!1,ls=!1,Ff=!1,Xy=typeof WeakSet=="function"?WeakSet:Set,_s=null;function dC(i,o){if(i=i.containerInfo,ch=tu,i=a0(i),Md(i)){if("selectionStart"in i)var u={start:i.selectionStart,end:i.selectionEnd};else e:{u=(u=i.ownerDocument)&&u.defaultView||window;var m=u.getSelection&&u.getSelection();if(m&&m.rangeCount!==0){u=m.anchorNode;var x=m.anchorOffset,S=m.focusNode;m=m.focusOffset;try{u.nodeType,S.nodeType}catch{u=null;break e}var D=0,U=-1,Q=-1,me=0,Se=0,Ce=i,ye=null;t:for(;;){for(var xe;Ce!==u||x!==0&&Ce.nodeType!==3||(U=D+x),Ce!==S||m!==0&&Ce.nodeType!==3||(Q=D+m),Ce.nodeType===3&&(D+=Ce.nodeValue.length),(xe=Ce.firstChild)!==null;)ye=Ce,Ce=xe;for(;;){if(Ce===i)break t;if(ye===u&&++me===x&&(U=D),ye===S&&++Se===m&&(Q=D),(xe=Ce.nextSibling)!==null)break;Ce=ye,ye=Ce.parentNode}Ce=xe}u=U===-1||Q===-1?null:{start:U,end:Q}}else u=null}u=u||{start:0,end:0}}else u=null;for(uh={focusedElem:i,selectionRange:u},tu=!1,_s=o;_s!==null;)if(o=_s,i=o.child,(o.subtreeFlags&1024)!==0&&i!==null)i.return=o,_s=i;else for(;_s!==null;){switch(o=_s,S=o.alternate,i=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&S!==null){i=void 0,u=o,x=S.memoizedProps,S=S.memoizedState,m=u.stateNode;try{var it=Kr(u.type,x,u.elementType===u.type);i=m.getSnapshotBeforeUpdate(it,S),m.__reactInternalSnapshotBeforeUpdate=i}catch(st){Gt(u,u.return,st)}}break;case 3:if((i&1024)!==0){if(i=o.stateNode.containerInfo,u=i.nodeType,u===9)hh(i);else if(u===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":hh(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(s(163))}if(i=o.sibling,i!==null){i.return=o.return,_s=i;break}_s=o.return}}function Wy(i,o,u){var m=u.flags;switch(u.tag){case 0:case 11:case 15:ir(i,u),m&4&&Yo(5,u);break;case 1:if(ir(i,u),m&4)if(i=u.stateNode,o===null)try{i.componentDidMount()}catch(D){Gt(u,u.return,D)}else{var x=Kr(u.type,o.memoizedProps);o=o.memoizedState;try{i.componentDidUpdate(x,o,i.__reactInternalSnapshotBeforeUpdate)}catch(D){Gt(u,u.return,D)}}m&64&&Hy(u),m&512&&qo(u,u.return);break;case 3:if(ir(i,u),m&64&&(i=u.updateQueue,i!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{I0(i,o)}catch(D){Gt(u,u.return,D)}}break;case 27:o===null&&m&4&&qy(u);case 26:case 5:ir(i,u),o===null&&m&4&&zy(u),m&512&&qo(u,u.return);break;case 12:ir(i,u);break;case 13:ir(i,u),m&4&&Jy(i,u),m&64&&(i=u.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(u=bC.bind(null,u),UC(i,u))));break;case 22:if(m=u.memoizedState!==null||Ni,!m){o=o!==null&&o.memoizedState!==null||ls,x=Ni;var S=ls;Ni=m,(ls=o)&&!S?rr(i,u,(u.subtreeFlags&8772)!==0):ir(i,u),Ni=x,ls=S}break;case 30:break;default:ir(i,u)}}function Qy(i){var o=i.alternate;o!==null&&(i.alternate=null,Qy(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&Xs(o)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Yt=null,Js=!1;function ki(i,o,u){for(u=u.child;u!==null;)Zy(i,o,u),u=u.sibling}function Zy(i,o,u){if(Me&&typeof Me.onCommitFiberUnmount=="function")try{Me.onCommitFiberUnmount(Ae,u)}catch{}switch(u.tag){case 26:ls||si(u,o),ki(i,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:ls||si(u,o);var m=Yt,x=Js;dr(u.type)&&(Yt=u.stateNode,Js=!1),ki(i,o,u),nl(u.stateNode),Yt=m,Js=x;break;case 5:ls||si(u,o);case 6:if(m=Yt,x=Js,Yt=null,ki(i,o,u),Yt=m,Js=x,Yt!==null)if(Js)try{(Yt.nodeType===9?Yt.body:Yt.nodeName==="HTML"?Yt.ownerDocument.body:Yt).removeChild(u.stateNode)}catch(S){Gt(u,o,S)}else try{Yt.removeChild(u.stateNode)}catch(S){Gt(u,o,S)}break;case 18:Yt!==null&&(Js?(i=Yt,Bx(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,u.stateNode),dl(i)):Bx(Yt,u.stateNode));break;case 4:m=Yt,x=Js,Yt=u.stateNode.containerInfo,Js=!0,ki(i,o,u),Yt=m,Js=x;break;case 0:case 11:case 14:case 15:ls||nr(2,u,o),ls||nr(4,u,o),ki(i,o,u);break;case 1:ls||(si(u,o),m=u.stateNode,typeof m.componentWillUnmount=="function"&&Ky(u,o,m)),ki(i,o,u);break;case 21:ki(i,o,u);break;case 22:ls=(m=ls)||u.memoizedState!==null,ki(i,o,u),ls=m;break;default:ki(i,o,u)}}function Jy(i,o){if(o.memoizedState===null&&(i=o.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{dl(i)}catch(u){Gt(o,o.return,u)}}function fC(i){switch(i.tag){case 13:case 19:var o=i.stateNode;return o===null&&(o=i.stateNode=new Xy),o;case 22:return i=i.stateNode,o=i._retryCache,o===null&&(o=i._retryCache=new Xy),o;default:throw Error(s(435,i.tag))}}function Bf(i,o){var u=fC(i);o.forEach(function(m){var x=SC.bind(null,i,m);u.has(m)||(u.add(m),m.then(x,x))})}function on(i,o){var u=o.deletions;if(u!==null)for(var m=0;m<u.length;m++){var x=u[m],S=i,D=o,U=D;e:for(;U!==null;){switch(U.tag){case 27:if(dr(U.type)){Yt=U.stateNode,Js=!1;break e}break;case 5:Yt=U.stateNode,Js=!1;break e;case 3:case 4:Yt=U.stateNode.containerInfo,Js=!0;break e}U=U.return}if(Yt===null)throw Error(s(160));Zy(S,D,x),Yt=null,Js=!1,S=x.alternate,S!==null&&(S.return=null),x.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)ex(o,i),o=o.sibling}var Gn=null;function ex(i,o){var u=i.alternate,m=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:on(o,i),ln(i),m&4&&(nr(3,i,i.return),Yo(3,i),nr(5,i,i.return));break;case 1:on(o,i),ln(i),m&512&&(ls||u===null||si(u,u.return)),m&64&&Ni&&(i=i.updateQueue,i!==null&&(m=i.callbacks,m!==null&&(u=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=u===null?m:u.concat(m))));break;case 26:var x=Gn;if(on(o,i),ln(i),m&512&&(ls||u===null||si(u,u.return)),m&4){var S=u!==null?u.memoizedState:null;if(m=i.memoizedState,u===null)if(m===null)if(i.stateNode===null){e:{m=i.type,u=i.memoizedProps,x=x.ownerDocument||x;t:switch(m){case"title":S=x.getElementsByTagName("title")[0],(!S||S[At]||S[je]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=x.createElement(m),x.head.insertBefore(S,x.querySelector("head > title"))),Is(S,m,u),S[je]=i,Vt(S),m=S;break e;case"link":var D=qx("link","href",x).get(m+(u.href||""));if(D){for(var U=0;U<D.length;U++)if(S=D[U],S.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&S.getAttribute("rel")===(u.rel==null?null:u.rel)&&S.getAttribute("title")===(u.title==null?null:u.title)&&S.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){D.splice(U,1);break t}}S=x.createElement(m),Is(S,m,u),x.head.appendChild(S);break;case"meta":if(D=qx("meta","content",x).get(m+(u.content||""))){for(U=0;U<D.length;U++)if(S=D[U],S.getAttribute("content")===(u.content==null?null:""+u.content)&&S.getAttribute("name")===(u.name==null?null:u.name)&&S.getAttribute("property")===(u.property==null?null:u.property)&&S.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&S.getAttribute("charset")===(u.charSet==null?null:u.charSet)){D.splice(U,1);break t}}S=x.createElement(m),Is(S,m,u),x.head.appendChild(S);break;default:throw Error(s(468,m))}S[je]=i,Vt(S),m=S}i.stateNode=m}else Xx(x,i.type,i.stateNode);else i.stateNode=Yx(x,m,i.memoizedProps);else S!==m?(S===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):S.count--,m===null?Xx(x,i.type,i.stateNode):Yx(x,m,i.memoizedProps)):m===null&&i.stateNode!==null&&Mf(i,i.memoizedProps,u.memoizedProps)}break;case 27:on(o,i),ln(i),m&512&&(ls||u===null||si(u,u.return)),u!==null&&m&4&&Mf(i,i.memoizedProps,u.memoizedProps);break;case 5:if(on(o,i),ln(i),m&512&&(ls||u===null||si(u,u.return)),i.flags&32){x=i.stateNode;try{Sn(x,"")}catch(xe){Gt(i,i.return,xe)}}m&4&&i.stateNode!=null&&(x=i.memoizedProps,Mf(i,x,u!==null?u.memoizedProps:x)),m&1024&&(Ff=!0);break;case 6:if(on(o,i),ln(i),m&4){if(i.stateNode===null)throw Error(s(162));m=i.memoizedProps,u=i.stateNode;try{u.nodeValue=m}catch(xe){Gt(i,i.return,xe)}}break;case 3:if(Zc=null,x=Gn,Gn=Wc(o.containerInfo),on(o,i),Gn=x,ln(i),m&4&&u!==null&&u.memoizedState.isDehydrated)try{dl(o.containerInfo)}catch(xe){Gt(i,i.return,xe)}Ff&&(Ff=!1,tx(i));break;case 4:m=Gn,Gn=Wc(i.stateNode.containerInfo),on(o,i),ln(i),Gn=m;break;case 12:on(o,i),ln(i);break;case 13:on(o,i),ln(i),i.child.flags&8192&&i.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(zf=te()),m&4&&(m=i.updateQueue,m!==null&&(i.updateQueue=null,Bf(i,m)));break;case 22:x=i.memoizedState!==null;var Q=u!==null&&u.memoizedState!==null,me=Ni,Se=ls;if(Ni=me||x,ls=Se||Q,on(o,i),ls=Se,Ni=me,ln(i),m&8192)e:for(o=i.stateNode,o._visibility=x?o._visibility&-2:o._visibility|1,x&&(u===null||Q||Ni||ls||zr(i)),u=null,o=i;;){if(o.tag===5||o.tag===26){if(u===null){Q=u=o;try{if(S=Q.stateNode,x)D=S.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none";else{U=Q.stateNode;var Ce=Q.memoizedProps.style,ye=Ce!=null&&Ce.hasOwnProperty("display")?Ce.display:null;U.style.display=ye==null||typeof ye=="boolean"?"":(""+ye).trim()}}catch(xe){Gt(Q,Q.return,xe)}}}else if(o.tag===6){if(u===null){Q=o;try{Q.stateNode.nodeValue=x?"":Q.memoizedProps}catch(xe){Gt(Q,Q.return,xe)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===i)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break e;for(;o.sibling===null;){if(o.return===null||o.return===i)break e;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}m&4&&(m=i.updateQueue,m!==null&&(u=m.retryQueue,u!==null&&(m.retryQueue=null,Bf(i,u))));break;case 19:on(o,i),ln(i),m&4&&(m=i.updateQueue,m!==null&&(i.updateQueue=null,Bf(i,m)));break;case 30:break;case 21:break;default:on(o,i),ln(i)}}function ln(i){var o=i.flags;if(o&2){try{for(var u,m=i.return;m!==null;){if(Yy(m)){u=m;break}m=m.return}if(u==null)throw Error(s(160));switch(u.tag){case 27:var x=u.stateNode,S=jf(i);jc(i,S,x);break;case 5:var D=u.stateNode;u.flags&32&&(Sn(D,""),u.flags&=-33);var U=jf(i);jc(i,U,D);break;case 3:case 4:var Q=u.stateNode.containerInfo,me=jf(i);Uf(i,me,Q);break;default:throw Error(s(161))}}catch(Se){Gt(i,i.return,Se)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function tx(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var o=i;tx(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),i=i.sibling}}function ir(i,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)Wy(i,o.alternate,o),o=o.sibling}function zr(i){for(i=i.child;i!==null;){var o=i;switch(o.tag){case 0:case 11:case 14:case 15:nr(4,o,o.return),zr(o);break;case 1:si(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&Ky(o,o.return,u),zr(o);break;case 27:nl(o.stateNode);case 26:case 5:si(o,o.return),zr(o);break;case 22:o.memoizedState===null&&zr(o);break;case 30:zr(o);break;default:zr(o)}i=i.sibling}}function rr(i,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var m=o.alternate,x=i,S=o,D=S.flags;switch(S.tag){case 0:case 11:case 15:rr(x,S,u),Yo(4,S);break;case 1:if(rr(x,S,u),m=S,x=m.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(me){Gt(m,m.return,me)}if(m=S,x=m.updateQueue,x!==null){var U=m.stateNode;try{var Q=x.shared.hiddenCallbacks;if(Q!==null)for(x.shared.hiddenCallbacks=null,x=0;x<Q.length;x++)D0(Q[x],U)}catch(me){Gt(m,m.return,me)}}u&&D&64&&Hy(S),qo(S,S.return);break;case 27:qy(S);case 26:case 5:rr(x,S,u),u&&m===null&&D&4&&zy(S),qo(S,S.return);break;case 12:rr(x,S,u);break;case 13:rr(x,S,u),u&&D&4&&Jy(x,S);break;case 22:S.memoizedState===null&&rr(x,S,u),qo(S,S.return);break;case 30:break;default:rr(x,S,u)}o=o.sibling}}function $f(i,o){var u=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),i=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(i=o.memoizedState.cachePool.pool),i!==u&&(i!=null&&i.refCount++,u!=null&&ko(u))}function Vf(i,o){i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&ko(i))}function ni(i,o,u,m){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)sx(i,o,u,m),o=o.sibling}function sx(i,o,u,m){var x=o.flags;switch(o.tag){case 0:case 11:case 15:ni(i,o,u,m),x&2048&&Yo(9,o);break;case 1:ni(i,o,u,m);break;case 3:ni(i,o,u,m),x&2048&&(i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&ko(i)));break;case 12:if(x&2048){ni(i,o,u,m),i=o.stateNode;try{var S=o.memoizedProps,D=S.id,U=S.onPostCommit;typeof U=="function"&&U(D,o.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(Q){Gt(o,o.return,Q)}}else ni(i,o,u,m);break;case 13:ni(i,o,u,m);break;case 23:break;case 22:S=o.stateNode,D=o.alternate,o.memoizedState!==null?S._visibility&2?ni(i,o,u,m):Xo(i,o):S._visibility&2?ni(i,o,u,m):(S._visibility|=2,Na(i,o,u,m,(o.subtreeFlags&10256)!==0)),x&2048&&$f(D,o);break;case 24:ni(i,o,u,m),x&2048&&Vf(o.alternate,o);break;default:ni(i,o,u,m)}}function Na(i,o,u,m,x){for(x=x&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var S=i,D=o,U=u,Q=m,me=D.flags;switch(D.tag){case 0:case 11:case 15:Na(S,D,U,Q,x),Yo(8,D);break;case 23:break;case 22:var Se=D.stateNode;D.memoizedState!==null?Se._visibility&2?Na(S,D,U,Q,x):Xo(S,D):(Se._visibility|=2,Na(S,D,U,Q,x)),x&&me&2048&&$f(D.alternate,D);break;case 24:Na(S,D,U,Q,x),x&&me&2048&&Vf(D.alternate,D);break;default:Na(S,D,U,Q,x)}o=o.sibling}}function Xo(i,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=i,m=o,x=m.flags;switch(m.tag){case 22:Xo(u,m),x&2048&&$f(m.alternate,m);break;case 24:Xo(u,m),x&2048&&Vf(m.alternate,m);break;default:Xo(u,m)}o=o.sibling}}var Wo=8192;function ka(i){if(i.subtreeFlags&Wo)for(i=i.child;i!==null;)nx(i),i=i.sibling}function nx(i){switch(i.tag){case 26:ka(i),i.flags&Wo&&i.memoizedState!==null&&QC(Gn,i.memoizedState,i.memoizedProps);break;case 5:ka(i);break;case 3:case 4:var o=Gn;Gn=Wc(i.stateNode.containerInfo),ka(i),Gn=o;break;case 22:i.memoizedState===null&&(o=i.alternate,o!==null&&o.memoizedState!==null?(o=Wo,Wo=16777216,ka(i),Wo=o):ka(i));break;default:ka(i)}}function ix(i){var o=i.alternate;if(o!==null&&(i=o.child,i!==null)){o.child=null;do o=i.sibling,i.sibling=null,i=o;while(i!==null)}}function Qo(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var m=o[u];_s=m,ax(m,i)}ix(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)rx(i),i=i.sibling}function rx(i){switch(i.tag){case 0:case 11:case 15:Qo(i),i.flags&2048&&nr(9,i,i.return);break;case 3:Qo(i);break;case 12:Qo(i);break;case 22:var o=i.stateNode;i.memoizedState!==null&&o._visibility&2&&(i.return===null||i.return.tag!==13)?(o._visibility&=-3,Uc(i)):Qo(i);break;default:Qo(i)}}function Uc(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var m=o[u];_s=m,ax(m,i)}ix(i)}for(i=i.child;i!==null;){switch(o=i,o.tag){case 0:case 11:case 15:nr(8,o,o.return),Uc(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,Uc(o));break;default:Uc(o)}i=i.sibling}}function ax(i,o){for(;_s!==null;){var u=_s;switch(u.tag){case 0:case 11:case 15:nr(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var m=u.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:ko(u.memoizedState.cache)}if(m=u.child,m!==null)m.return=u,_s=m;else e:for(u=i;_s!==null;){m=_s;var x=m.sibling,S=m.return;if(Qy(m),m===u){_s=null;break e}if(x!==null){x.return=S,_s=x;break e}_s=S}}}var hC={getCacheForType:function(i){var o=Us(vs),u=o.data.get(i);return u===void 0&&(u=i(),o.data.set(i,u)),u}},mC=typeof WeakMap=="function"?WeakMap:Map,Nt=0,zt=null,yt=null,Tt=0,kt=0,cn=null,ar=!1,Pa=!1,Gf=!1,Pi=0,ns=0,or=0,Yr=0,Hf=0,Ln=0,Oa=0,Zo=null,en=null,Kf=!1,zf=0,Fc=1/0,Bc=null,lr=null,Ds=0,cr=null,Ma=null,ja=0,Yf=0,qf=null,ox=null,Jo=0,Xf=null;function un(){if((Nt&2)!==0&&Tt!==0)return Tt&-Tt;if(k.T!==null){var i=Aa;return i!==0?i:sh()}return ne()}function lx(){Ln===0&&(Ln=(Tt&536870912)===0||wt?Wn():536870912);var i=Cn.current;return i!==null&&(i.flags|=32),Ln}function dn(i,o,u){(i===zt&&(kt===2||kt===9)||i.cancelPendingCommit!==null)&&(Ua(i,0),ur(i,Tt,Ln,!1)),ps(i,u),((Nt&2)===0||i!==zt)&&(i===zt&&((Nt&2)===0&&(Yr|=u),ns===4&&ur(i,Tt,Ln,!1)),ii(i))}function cx(i,o,u){if((Nt&6)!==0)throw Error(s(327));var m=!u&&(o&124)===0&&(o&i.expiredLanes)===0||On(i,o),x=m?yC(i,o):Zf(i,o,!0),S=m;do{if(x===0){Pa&&!m&&ur(i,o,0,!1);break}else{if(u=i.current.alternate,S&&!gC(u)){x=Zf(i,o,!1),S=!1;continue}if(x===2){if(S=o,i.errorRecoveryDisabledLanes&S)var D=0;else D=i.pendingLanes&-536870913,D=D!==0?D:D&536870912?536870912:0;if(D!==0){o=D;e:{var U=i;x=Zo;var Q=U.current.memoizedState.isDehydrated;if(Q&&(Ua(U,D).flags|=256),D=Zf(U,D,!1),D!==2){if(Gf&&!Q){U.errorRecoveryDisabledLanes|=S,Yr|=S,x=4;break e}S=en,en=x,S!==null&&(en===null?en=S:en.push.apply(en,S))}x=D}if(S=!1,x!==2)continue}}if(x===1){Ua(i,0),ur(i,o,0,!0);break}e:{switch(m=i,S=x,S){case 0:case 1:throw Error(s(345));case 4:if((o&4194048)!==o)break;case 6:ur(m,o,Ln,!ar);break e;case 2:en=null;break;case 3:case 5:break;default:throw Error(s(329))}if((o&62914560)===o&&(x=zf+300-te(),10<x)){if(ur(m,o,Ln,!ar),yn(m,0,!0)!==0)break e;m.timeoutHandle=Ux(ux.bind(null,m,u,en,Bc,Kf,o,Ln,Yr,Oa,ar,S,2,-0,0),x);break e}ux(m,u,en,Bc,Kf,o,Ln,Yr,Oa,ar,S,0,-0,0)}}break}while(!0);ii(i)}function ux(i,o,u,m,x,S,D,U,Q,me,Se,Ce,ye,xe){if(i.timeoutHandle=-1,Ce=o.subtreeFlags,(Ce&8192||(Ce&16785408)===16785408)&&(al={stylesheets:null,count:0,unsuspend:WC},nx(o),Ce=ZC(),Ce!==null)){i.cancelPendingCommit=Ce(yx.bind(null,i,o,S,u,m,x,D,U,Q,Se,1,ye,xe)),ur(i,S,D,!me);return}yx(i,o,S,u,m,x,D,U,Q)}function gC(i){for(var o=i;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var m=0;m<u.length;m++){var x=u[m],S=x.getSnapshot;x=x.value;try{if(!rn(S(),x))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function ur(i,o,u,m){o&=~Hf,o&=~Yr,i.suspendedLanes|=o,i.pingedLanes&=~o,m&&(i.warmLanes|=o),m=i.expirationTimes;for(var x=o;0<x;){var S=31-_t(x),D=1<<S;m[S]=-1,x&=~D}u!==0&&vi(i,u,o)}function $c(){return(Nt&6)===0?(el(0),!1):!0}function Wf(){if(yt!==null){if(kt===0)var i=yt.return;else i=yt,Ci=$r=null,hf(i),Da=null,Ho=0,i=yt;for(;i!==null;)Gy(i.alternate,i),i=i.return;yt=null}}function Ua(i,o){var u=i.timeoutHandle;u!==-1&&(i.timeoutHandle=-1,kC(u)),u=i.cancelPendingCommit,u!==null&&(i.cancelPendingCommit=null,u()),Wf(),zt=i,yt=u=Ti(i.current,null),Tt=o,kt=0,cn=null,ar=!1,Pa=On(i,o),Gf=!1,Oa=Ln=Hf=Yr=or=ns=0,en=Zo=null,Kf=!1,(o&8)!==0&&(o|=o&32);var m=i.entangledLanes;if(m!==0)for(i=i.entanglements,m&=o;0<m;){var x=31-_t(m),S=1<<x;o|=i[x],m&=~S}return Pi=o,cc(),u}function dx(i,o){dt=null,k.H=wc,o===Oo||o===xc?(o=w0(),kt=3):o===_0?(o=w0(),kt=4):kt=o===Ry?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,cn=o,yt===null&&(ns=1,kc(i,En(o,i.current)))}function fx(){var i=k.H;return k.H=wc,i===null?wc:i}function hx(){var i=k.A;return k.A=hC,i}function Qf(){ns=4,ar||(Tt&4194048)!==Tt&&Cn.current!==null||(Pa=!0),(or&134217727)===0&&(Yr&134217727)===0||zt===null||ur(zt,Tt,Ln,!1)}function Zf(i,o,u){var m=Nt;Nt|=2;var x=fx(),S=hx();(zt!==i||Tt!==o)&&(Bc=null,Ua(i,o)),o=!1;var D=ns;e:do try{if(kt!==0&&yt!==null){var U=yt,Q=cn;switch(kt){case 8:Wf(),D=6;break e;case 3:case 2:case 9:case 6:Cn.current===null&&(o=!0);var me=kt;if(kt=0,cn=null,Fa(i,U,Q,me),u&&Pa){D=0;break e}break;default:me=kt,kt=0,cn=null,Fa(i,U,Q,me)}}pC(),D=ns;break}catch(Se){dx(i,Se)}while(!0);return o&&i.shellSuspendCounter++,Ci=$r=null,Nt=m,k.H=x,k.A=S,yt===null&&(zt=null,Tt=0,cc()),D}function pC(){for(;yt!==null;)mx(yt)}function yC(i,o){var u=Nt;Nt|=2;var m=fx(),x=hx();zt!==i||Tt!==o?(Bc=null,Fc=te()+500,Ua(i,o)):Pa=On(i,o);e:do try{if(kt!==0&&yt!==null){o=yt;var S=cn;t:switch(kt){case 1:kt=0,cn=null,Fa(i,o,S,1);break;case 2:case 9:if(C0(S)){kt=0,cn=null,gx(o);break}o=function(){kt!==2&&kt!==9||zt!==i||(kt=7),ii(i)},S.then(o,o);break e;case 3:kt=7;break e;case 4:kt=5;break e;case 7:C0(S)?(kt=0,cn=null,gx(o)):(kt=0,cn=null,Fa(i,o,S,7));break;case 5:var D=null;switch(yt.tag){case 26:D=yt.memoizedState;case 5:case 27:var U=yt;if(!D||Wx(D)){kt=0,cn=null;var Q=U.sibling;if(Q!==null)yt=Q;else{var me=U.return;me!==null?(yt=me,Vc(me)):yt=null}break t}}kt=0,cn=null,Fa(i,o,S,5);break;case 6:kt=0,cn=null,Fa(i,o,S,6);break;case 8:Wf(),ns=6;break e;default:throw Error(s(462))}}xC();break}catch(Se){dx(i,Se)}while(!0);return Ci=$r=null,k.H=m,k.A=x,Nt=u,yt!==null?0:(zt=null,Tt=0,cc(),ns)}function xC(){for(;yt!==null&&!le();)mx(yt)}function mx(i){var o=$y(i.alternate,i,Pi);i.memoizedProps=i.pendingProps,o===null?Vc(i):yt=o}function gx(i){var o=i,u=o.alternate;switch(o.tag){case 15:case 0:o=Oy(u,o,o.pendingProps,o.type,void 0,Tt);break;case 11:o=Oy(u,o,o.pendingProps,o.type.render,o.ref,Tt);break;case 5:hf(o);default:Gy(u,o),o=yt=p0(o,Pi),o=$y(u,o,Pi)}i.memoizedProps=i.pendingProps,o===null?Vc(i):yt=o}function Fa(i,o,u,m){Ci=$r=null,hf(o),Da=null,Ho=0;var x=o.return;try{if(oC(i,x,o,u,Tt)){ns=1,kc(i,En(u,i.current)),yt=null;return}}catch(S){if(x!==null)throw yt=x,S;ns=1,kc(i,En(u,i.current)),yt=null;return}o.flags&32768?(wt||m===1?i=!0:Pa||(Tt&536870912)!==0?i=!1:(ar=i=!0,(m===2||m===9||m===3||m===6)&&(m=Cn.current,m!==null&&m.tag===13&&(m.flags|=16384))),px(o,i)):Vc(o)}function Vc(i){var o=i;do{if((o.flags&32768)!==0){px(o,ar);return}i=o.return;var u=cC(o.alternate,o,Pi);if(u!==null){yt=u;return}if(o=o.sibling,o!==null){yt=o;return}yt=o=i}while(o!==null);ns===0&&(ns=5)}function px(i,o){do{var u=uC(i.alternate,i);if(u!==null){u.flags&=32767,yt=u;return}if(u=i.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(i=i.sibling,i!==null)){yt=i;return}yt=i=u}while(i!==null);ns=6,yt=null}function yx(i,o,u,m,x,S,D,U,Q){i.cancelPendingCommit=null;do Gc();while(Ds!==0);if((Nt&6)!==0)throw Error(s(327));if(o!==null){if(o===i.current)throw Error(s(177));if(S=o.lanes|o.childLanes,S|=$d,vn(i,u,S,D,U,Q),i===zt&&(yt=zt=null,Tt=0),Ma=o,cr=i,ja=u,Yf=S,qf=x,ox=m,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,EC(Ke,function(){return Ex(),null})):(i.callbackNode=null,i.callbackPriority=0),m=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||m){m=k.T,k.T=null,x=F.p,F.p=2,D=Nt,Nt|=4;try{dC(i,o,u)}finally{Nt=D,F.p=x,k.T=m}}Ds=1,xx(),vx(),bx()}}function xx(){if(Ds===1){Ds=0;var i=cr,o=Ma,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=k.T,k.T=null;var m=F.p;F.p=2;var x=Nt;Nt|=4;try{ex(o,i);var S=uh,D=a0(i.containerInfo),U=S.focusedElem,Q=S.selectionRange;if(D!==U&&U&&U.ownerDocument&&r0(U.ownerDocument.documentElement,U)){if(Q!==null&&Md(U)){var me=Q.start,Se=Q.end;if(Se===void 0&&(Se=me),"selectionStart"in U)U.selectionStart=me,U.selectionEnd=Math.min(Se,U.value.length);else{var Ce=U.ownerDocument||document,ye=Ce&&Ce.defaultView||window;if(ye.getSelection){var xe=ye.getSelection(),it=U.textContent.length,st=Math.min(Q.start,it),Bt=Q.end===void 0?st:Math.min(Q.end,it);!xe.extend&&st>Bt&&(D=Bt,Bt=st,st=D);var re=i0(U,st),se=i0(U,Bt);if(re&&se&&(xe.rangeCount!==1||xe.anchorNode!==re.node||xe.anchorOffset!==re.offset||xe.focusNode!==se.node||xe.focusOffset!==se.offset)){var fe=Ce.createRange();fe.setStart(re.node,re.offset),xe.removeAllRanges(),st>Bt?(xe.addRange(fe),xe.extend(se.node,se.offset)):(fe.setEnd(se.node,se.offset),xe.addRange(fe))}}}}for(Ce=[],xe=U;xe=xe.parentNode;)xe.nodeType===1&&Ce.push({element:xe,left:xe.scrollLeft,top:xe.scrollTop});for(typeof U.focus=="function"&&U.focus(),U=0;U<Ce.length;U++){var Te=Ce[U];Te.element.scrollLeft=Te.left,Te.element.scrollTop=Te.top}}tu=!!ch,uh=ch=null}finally{Nt=x,F.p=m,k.T=u}}i.current=o,Ds=2}}function vx(){if(Ds===2){Ds=0;var i=cr,o=Ma,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=k.T,k.T=null;var m=F.p;F.p=2;var x=Nt;Nt|=4;try{Wy(i,o.alternate,o)}finally{Nt=x,F.p=m,k.T=u}}Ds=3}}function bx(){if(Ds===4||Ds===3){Ds=0,W();var i=cr,o=Ma,u=ja,m=ox;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Ds=5:(Ds=0,Ma=cr=null,Sx(i,i.pendingLanes));var x=i.pendingLanes;if(x===0&&(lr=null),zi(u),o=o.stateNode,Me&&typeof Me.onCommitFiberRoot=="function")try{Me.onCommitFiberRoot(Ae,o,void 0,(o.current.flags&128)===128)}catch{}if(m!==null){o=k.T,x=F.p,F.p=2,k.T=null;try{for(var S=i.onRecoverableError,D=0;D<m.length;D++){var U=m[D];S(U.value,{componentStack:U.stack})}}finally{k.T=o,F.p=x}}(ja&3)!==0&&Gc(),ii(i),x=i.pendingLanes,(u&4194090)!==0&&(x&42)!==0?i===Xf?Jo++:(Jo=0,Xf=i):Jo=0,el(0)}}function Sx(i,o){(i.pooledCacheLanes&=o)===0&&(o=i.pooledCache,o!=null&&(i.pooledCache=null,ko(o)))}function Gc(i){return xx(),vx(),bx(),Ex()}function Ex(){if(Ds!==5)return!1;var i=cr,o=Yf;Yf=0;var u=zi(ja),m=k.T,x=F.p;try{F.p=32>u?32:u,k.T=null,u=qf,qf=null;var S=cr,D=ja;if(Ds=0,Ma=cr=null,ja=0,(Nt&6)!==0)throw Error(s(331));var U=Nt;if(Nt|=4,rx(S.current),sx(S,S.current,D,u),Nt=U,el(0,!1),Me&&typeof Me.onPostCommitFiberRoot=="function")try{Me.onPostCommitFiberRoot(Ae,S)}catch{}return!0}finally{F.p=x,k.T=m,Sx(i,o)}}function Tx(i,o,u){o=En(u,o),o=Lf(i.stateNode,o,2),i=Ji(i,o,2),i!==null&&(ps(i,2),ii(i))}function Gt(i,o,u){if(i.tag===3)Tx(i,i,u);else for(;o!==null;){if(o.tag===3){Tx(o,i,u);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(lr===null||!lr.has(m))){i=En(u,i),u=Ly(2),m=Ji(o,u,2),m!==null&&(wy(u,m,o,i),ps(m,2),ii(m));break}}o=o.return}}function Jf(i,o,u){var m=i.pingCache;if(m===null){m=i.pingCache=new mC;var x=new Set;m.set(o,x)}else x=m.get(o),x===void 0&&(x=new Set,m.set(o,x));x.has(u)||(Gf=!0,x.add(u),i=vC.bind(null,i,o,u),o.then(i,i))}function vC(i,o,u){var m=i.pingCache;m!==null&&m.delete(o),i.pingedLanes|=i.suspendedLanes&u,i.warmLanes&=~u,zt===i&&(Tt&u)===u&&(ns===4||ns===3&&(Tt&62914560)===Tt&&300>te()-zf?(Nt&2)===0&&Ua(i,0):Hf|=u,Oa===Tt&&(Oa=0)),ii(i)}function Ax(i,o){o===0&&(o=Qn()),i=ba(i,o),i!==null&&(ps(i,o),ii(i))}function bC(i){var o=i.memoizedState,u=0;o!==null&&(u=o.retryLane),Ax(i,u)}function SC(i,o){var u=0;switch(i.tag){case 13:var m=i.stateNode,x=i.memoizedState;x!==null&&(u=x.retryLane);break;case 19:m=i.stateNode;break;case 22:m=i.stateNode._retryCache;break;default:throw Error(s(314))}m!==null&&m.delete(o),Ax(i,u)}function EC(i,o){return Ve(i,o)}var Hc=null,Ba=null,eh=!1,Kc=!1,th=!1,qr=0;function ii(i){i!==Ba&&i.next===null&&(Ba===null?Hc=Ba=i:Ba=Ba.next=i),Kc=!0,eh||(eh=!0,AC())}function el(i,o){if(!th&&Kc){th=!0;do for(var u=!1,m=Hc;m!==null;){if(i!==0){var x=m.pendingLanes;if(x===0)var S=0;else{var D=m.suspendedLanes,U=m.pingedLanes;S=(1<<31-_t(42|i)+1)-1,S&=x&~(D&~U),S=S&201326741?S&201326741|1:S?S|2:0}S!==0&&(u=!0,wx(m,S))}else S=Tt,S=yn(m,m===zt?S:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(S&3)===0||On(m,S)||(u=!0,wx(m,S));m=m.next}while(u);th=!1}}function TC(){_x()}function _x(){Kc=eh=!1;var i=0;qr!==0&&(NC()&&(i=qr),qr=0);for(var o=te(),u=null,m=Hc;m!==null;){var x=m.next,S=Cx(m,o);S===0?(m.next=null,u===null?Hc=x:u.next=x,x===null&&(Ba=u)):(u=m,(i!==0||(S&3)!==0)&&(Kc=!0)),m=x}el(i)}function Cx(i,o){for(var u=i.suspendedLanes,m=i.pingedLanes,x=i.expirationTimes,S=i.pendingLanes&-62914561;0<S;){var D=31-_t(S),U=1<<D,Q=x[D];Q===-1?((U&u)===0||(U&m)!==0)&&(x[D]=xi(U,o)):Q<=o&&(i.expiredLanes|=U),S&=~U}if(o=zt,u=Tt,u=yn(i,i===o?u:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),m=i.callbackNode,u===0||i===o&&(kt===2||kt===9)||i.cancelPendingCommit!==null)return m!==null&&m!==null&&Ge(m),i.callbackNode=null,i.callbackPriority=0;if((u&3)===0||On(i,u)){if(o=u&-u,o===i.callbackPriority)return o;switch(m!==null&&Ge(m),zi(u)){case 2:case 8:u=Ue;break;case 32:u=Ke;break;case 268435456:u=ae;break;default:u=Ke}return m=Lx.bind(null,i),u=Ve(u,m),i.callbackPriority=o,i.callbackNode=u,o}return m!==null&&m!==null&&Ge(m),i.callbackPriority=2,i.callbackNode=null,2}function Lx(i,o){if(Ds!==0&&Ds!==5)return i.callbackNode=null,i.callbackPriority=0,null;var u=i.callbackNode;if(Gc()&&i.callbackNode!==u)return null;var m=Tt;return m=yn(i,i===zt?m:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),m===0?null:(cx(i,m,o),Cx(i,te()),i.callbackNode!=null&&i.callbackNode===u?Lx.bind(null,i):null)}function wx(i,o){if(Gc())return null;cx(i,o,!0)}function AC(){PC(function(){(Nt&6)!==0?Ve(Ie,TC):_x()})}function sh(){return qr===0&&(qr=Wn()),qr}function Rx(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Si(""+i)}function Dx(i,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,i.id&&u.setAttribute("form",i.id),o.parentNode.insertBefore(u,o),i=new FormData(i),u.parentNode.removeChild(u),i}function _C(i,o,u,m,x){if(o==="submit"&&u&&u.stateNode===x){var S=Rx((x[ze]||null).action),D=m.submitter;D&&(o=(o=D[ze]||null)?Rx(o.formAction):D.getAttribute("formAction"),o!==null&&(S=o,D=null));var U=new ac("action","action",null,m,x);i.push({event:U,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(qr!==0){var Q=D?Dx(x,D):new FormData(x);Ef(u,{pending:!0,data:Q,method:x.method,action:S},null,Q)}}else typeof S=="function"&&(U.preventDefault(),Q=D?Dx(x,D):new FormData(x),Ef(u,{pending:!0,data:Q,method:x.method,action:S},S,Q))},currentTarget:x}]})}}for(var nh=0;nh<Bd.length;nh++){var ih=Bd[nh],CC=ih.toLowerCase(),LC=ih[0].toUpperCase()+ih.slice(1);Vn(CC,"on"+LC)}Vn(c0,"onAnimationEnd"),Vn(u0,"onAnimationIteration"),Vn(d0,"onAnimationStart"),Vn("dblclick","onDoubleClick"),Vn("focusin","onFocus"),Vn("focusout","onBlur"),Vn(H_,"onTransitionRun"),Vn(K_,"onTransitionStart"),Vn(z_,"onTransitionCancel"),Vn(f0,"onTransitionEnd"),ge("onMouseEnter",["mouseout","mouseover"]),ge("onMouseLeave",["mouseout","mouseover"]),ge("onPointerEnter",["pointerout","pointerover"]),ge("onPointerLeave",["pointerout","pointerover"]),X("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),X("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),X("onBeforeInput",["compositionend","keypress","textInput","paste"]),X("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),X("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),X("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var tl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wC=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(tl));function Ix(i,o){o=(o&4)!==0;for(var u=0;u<i.length;u++){var m=i[u],x=m.event;m=m.listeners;e:{var S=void 0;if(o)for(var D=m.length-1;0<=D;D--){var U=m[D],Q=U.instance,me=U.currentTarget;if(U=U.listener,Q!==S&&x.isPropagationStopped())break e;S=U,x.currentTarget=me;try{S(x)}catch(Se){Nc(Se)}x.currentTarget=null,S=Q}else for(D=0;D<m.length;D++){if(U=m[D],Q=U.instance,me=U.currentTarget,U=U.listener,Q!==S&&x.isPropagationStopped())break e;S=U,x.currentTarget=me;try{S(x)}catch(Se){Nc(Se)}x.currentTarget=null,S=Q}}}}function xt(i,o){var u=o[Pe];u===void 0&&(u=o[Pe]=new Set);var m=i+"__bubble";u.has(m)||(Nx(o,i,2,!1),u.add(m))}function rh(i,o,u){var m=0;o&&(m|=4),Nx(u,i,m,o)}var zc="_reactListening"+Math.random().toString(36).slice(2);function ah(i){if(!i[zc]){i[zc]=!0,Zn.forEach(function(u){u!=="selectionchange"&&(wC.has(u)||rh(u,!1,i),rh(u,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[zc]||(o[zc]=!0,rh("selectionchange",!1,o))}}function Nx(i,o,u,m){switch(sv(o)){case 2:var x=tL;break;case 8:x=sL;break;default:x=bh}u=x.bind(null,o,u,i),x=void 0,!Ld||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(x=!0),m?x!==void 0?i.addEventListener(o,u,{capture:!0,passive:x}):i.addEventListener(o,u,!0):x!==void 0?i.addEventListener(o,u,{passive:x}):i.addEventListener(o,u,!1)}function oh(i,o,u,m,x){var S=m;if((o&1)===0&&(o&2)===0&&m!==null)e:for(;;){if(m===null)return;var D=m.tag;if(D===3||D===4){var U=m.stateNode.containerInfo;if(U===x)break;if(D===4)for(D=m.return;D!==null;){var Q=D.tag;if((Q===3||Q===4)&&D.stateNode.containerInfo===x)return;D=D.return}for(;U!==null;){if(D=ws(U),D===null)return;if(Q=D.tag,Q===5||Q===6||Q===26||Q===27){m=S=D;continue e}U=U.parentNode}}m=m.return}Fp(function(){var me=S,Se=ga(u),Ce=[];e:{var ye=h0.get(i);if(ye!==void 0){var xe=ac,it=i;switch(i){case"keypress":if(ic(u)===0)break e;case"keydown":case"keyup":xe=E_;break;case"focusin":it="focus",xe=Id;break;case"focusout":it="blur",xe=Id;break;case"beforeblur":case"afterblur":xe=Id;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":xe=Vp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":xe=u_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":xe=__;break;case c0:case u0:case d0:xe=h_;break;case f0:xe=L_;break;case"scroll":case"scrollend":xe=l_;break;case"wheel":xe=R_;break;case"copy":case"cut":case"paste":xe=g_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":xe=Hp;break;case"toggle":case"beforetoggle":xe=I_}var st=(o&4)!==0,Bt=!st&&(i==="scroll"||i==="scrollend"),re=st?ye!==null?ye+"Capture":null:ye;st=[];for(var se=me,fe;se!==null;){var Te=se;if(fe=Te.stateNode,Te=Te.tag,Te!==5&&Te!==26&&Te!==27||fe===null||re===null||(Te=bo(se,re),Te!=null&&st.push(sl(se,Te,fe))),Bt)break;se=se.return}0<st.length&&(ye=new xe(ye,it,null,u,Se),Ce.push({event:ye,listeners:st}))}}if((o&7)===0){e:{if(ye=i==="mouseover"||i==="pointerover",xe=i==="mouseout"||i==="pointerout",ye&&u!==qi&&(it=u.relatedTarget||u.fromElement)&&(ws(it)||it[De]))break e;if((xe||ye)&&(ye=Se.window===Se?Se:(ye=Se.ownerDocument)?ye.defaultView||ye.parentWindow:window,xe?(it=u.relatedTarget||u.toElement,xe=me,it=it?ws(it):null,it!==null&&(Bt=a(it),st=it.tag,it!==Bt||st!==5&&st!==27&&st!==6)&&(it=null)):(xe=null,it=me),xe!==it)){if(st=Vp,Te="onMouseLeave",re="onMouseEnter",se="mouse",(i==="pointerout"||i==="pointerover")&&(st=Hp,Te="onPointerLeave",re="onPointerEnter",se="pointer"),Bt=xe==null?ye:Ts(xe),fe=it==null?ye:Ts(it),ye=new st(Te,se+"leave",xe,u,Se),ye.target=Bt,ye.relatedTarget=fe,Te=null,ws(Se)===me&&(st=new st(re,se+"enter",it,u,Se),st.target=fe,st.relatedTarget=Bt,Te=st),Bt=Te,xe&&it)t:{for(st=xe,re=it,se=0,fe=st;fe;fe=$a(fe))se++;for(fe=0,Te=re;Te;Te=$a(Te))fe++;for(;0<se-fe;)st=$a(st),se--;for(;0<fe-se;)re=$a(re),fe--;for(;se--;){if(st===re||re!==null&&st===re.alternate)break t;st=$a(st),re=$a(re)}st=null}else st=null;xe!==null&&kx(Ce,ye,xe,st,!1),it!==null&&Bt!==null&&kx(Ce,Bt,it,st,!0)}}e:{if(ye=me?Ts(me):window,xe=ye.nodeName&&ye.nodeName.toLowerCase(),xe==="select"||xe==="input"&&ye.type==="file")var Ye=Zp;else if(Wp(ye))if(Jp)Ye=$_;else{Ye=F_;var gt=U_}else xe=ye.nodeName,!xe||xe.toLowerCase()!=="input"||ye.type!=="checkbox"&&ye.type!=="radio"?me&&ha(me.elementType)&&(Ye=Zp):Ye=B_;if(Ye&&(Ye=Ye(i,me))){Qp(Ce,Ye,u,Se);break e}gt&&gt(i,ye,me),i==="focusout"&&me&&ye.type==="number"&&me.memoizedProps.value!=null&&Yi(ye,"number",ye.value)}switch(gt=me?Ts(me):window,i){case"focusin":(Wp(gt)||gt.contentEditable==="true")&&(ya=gt,jd=me,wo=null);break;case"focusout":wo=jd=ya=null;break;case"mousedown":Ud=!0;break;case"contextmenu":case"mouseup":case"dragend":Ud=!1,o0(Ce,u,Se);break;case"selectionchange":if(G_)break;case"keydown":case"keyup":o0(Ce,u,Se)}var Je;if(kd)e:{switch(i){case"compositionstart":var nt="onCompositionStart";break e;case"compositionend":nt="onCompositionEnd";break e;case"compositionupdate":nt="onCompositionUpdate";break e}nt=void 0}else pa?qp(i,u)&&(nt="onCompositionEnd"):i==="keydown"&&u.keyCode===229&&(nt="onCompositionStart");nt&&(Kp&&u.locale!=="ko"&&(pa||nt!=="onCompositionStart"?nt==="onCompositionEnd"&&pa&&(Je=Bp()):(Xi=Se,wd="value"in Xi?Xi.value:Xi.textContent,pa=!0)),gt=Yc(me,nt),0<gt.length&&(nt=new Gp(nt,i,null,u,Se),Ce.push({event:nt,listeners:gt}),Je?nt.data=Je:(Je=Xp(u),Je!==null&&(nt.data=Je)))),(Je=k_?P_(i,u):O_(i,u))&&(nt=Yc(me,"onBeforeInput"),0<nt.length&&(gt=new Gp("onBeforeInput","beforeinput",null,u,Se),Ce.push({event:gt,listeners:nt}),gt.data=Je)),_C(Ce,i,me,u,Se)}Ix(Ce,o)})}function sl(i,o,u){return{instance:i,listener:o,currentTarget:u}}function Yc(i,o){for(var u=o+"Capture",m=[];i!==null;){var x=i,S=x.stateNode;if(x=x.tag,x!==5&&x!==26&&x!==27||S===null||(x=bo(i,u),x!=null&&m.unshift(sl(i,x,S)),x=bo(i,o),x!=null&&m.push(sl(i,x,S))),i.tag===3)return m;i=i.return}return[]}function $a(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function kx(i,o,u,m,x){for(var S=o._reactName,D=[];u!==null&&u!==m;){var U=u,Q=U.alternate,me=U.stateNode;if(U=U.tag,Q!==null&&Q===m)break;U!==5&&U!==26&&U!==27||me===null||(Q=me,x?(me=bo(u,S),me!=null&&D.unshift(sl(u,me,Q))):x||(me=bo(u,S),me!=null&&D.push(sl(u,me,Q)))),u=u.return}D.length!==0&&i.push({event:o,listeners:D})}var RC=/\r\n?/g,DC=/\u0000|\uFFFD/g;function Px(i){return(typeof i=="string"?i:""+i).replace(RC,`
`).replace(DC,"")}function Ox(i,o){return o=Px(o),Px(i)===o}function qc(){}function Ft(i,o,u,m,x,S){switch(u){case"children":typeof m=="string"?o==="body"||o==="textarea"&&m===""||Sn(i,m):(typeof m=="number"||typeof m=="bigint")&&o!=="body"&&Sn(i,""+m);break;case"className":Rt(i,"class",m);break;case"tabIndex":Rt(i,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":Rt(i,u,m);break;case"style":Fn(i,m,S);break;case"data":if(o!=="object"){Rt(i,"data",m);break}case"src":case"href":if(m===""&&(o!=="a"||u!=="href")){i.removeAttribute(u);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){i.removeAttribute(u);break}m=Si(""+m),i.setAttribute(u,m);break;case"action":case"formAction":if(typeof m=="function"){i.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(u==="formAction"?(o!=="input"&&Ft(i,o,"name",x.name,x,null),Ft(i,o,"formEncType",x.formEncType,x,null),Ft(i,o,"formMethod",x.formMethod,x,null),Ft(i,o,"formTarget",x.formTarget,x,null)):(Ft(i,o,"encType",x.encType,x,null),Ft(i,o,"method",x.method,x,null),Ft(i,o,"target",x.target,x,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){i.removeAttribute(u);break}m=Si(""+m),i.setAttribute(u,m);break;case"onClick":m!=null&&(i.onclick=qc);break;case"onScroll":m!=null&&xt("scroll",i);break;case"onScrollEnd":m!=null&&xt("scrollend",i);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(u=m.__html,u!=null){if(x.children!=null)throw Error(s(60));i.innerHTML=u}}break;case"multiple":i.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":i.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){i.removeAttribute("xlink:href");break}u=Si(""+m),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?i.setAttribute(u,""+m):i.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?i.setAttribute(u,""):i.removeAttribute(u);break;case"capture":case"download":m===!0?i.setAttribute(u,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?i.setAttribute(u,m):i.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?i.setAttribute(u,m):i.removeAttribute(u);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?i.removeAttribute(u):i.setAttribute(u,m);break;case"popover":xt("beforetoggle",i),xt("toggle",i),at(i,"popover",m);break;case"xlinkActuate":vt(i,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":vt(i,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":vt(i,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":vt(i,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":vt(i,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":vt(i,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":vt(i,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":vt(i,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":vt(i,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":at(i,"is",m);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=ma.get(u)||u,at(i,u,m))}}function lh(i,o,u,m,x,S){switch(u){case"style":Fn(i,m,S);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(u=m.__html,u!=null){if(x.children!=null)throw Error(s(60));i.innerHTML=u}}break;case"children":typeof m=="string"?Sn(i,m):(typeof m=="number"||typeof m=="bigint")&&Sn(i,""+m);break;case"onScroll":m!=null&&xt("scroll",i);break;case"onScrollEnd":m!=null&&xt("scrollend",i);break;case"onClick":m!=null&&(i.onclick=qc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ua.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(x=u.endsWith("Capture"),o=u.slice(2,x?u.length-7:void 0),S=i[ze]||null,S=S!=null?S[u]:null,typeof S=="function"&&i.removeEventListener(o,S,x),typeof m=="function")){typeof S!="function"&&S!==null&&(u in i?i[u]=null:i.hasAttribute(u)&&i.removeAttribute(u)),i.addEventListener(o,m,x);break e}u in i?i[u]=m:m===!0?i.setAttribute(u,""):at(i,u,m)}}}function Is(i,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":xt("error",i),xt("load",i);var m=!1,x=!1,S;for(S in u)if(u.hasOwnProperty(S)){var D=u[S];if(D!=null)switch(S){case"src":m=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:Ft(i,o,S,D,u,null)}}x&&Ft(i,o,"srcSet",u.srcSet,u,null),m&&Ft(i,o,"src",u.src,u,null);return;case"input":xt("invalid",i);var U=S=D=x=null,Q=null,me=null;for(m in u)if(u.hasOwnProperty(m)){var Se=u[m];if(Se!=null)switch(m){case"name":x=Se;break;case"type":D=Se;break;case"checked":Q=Se;break;case"defaultChecked":me=Se;break;case"value":S=Se;break;case"defaultValue":U=Se;break;case"children":case"dangerouslySetInnerHTML":if(Se!=null)throw Error(s(137,o));break;default:Ft(i,o,m,Se,u,null)}}Jn(i,S,U,Q,me,D,x,!1),Ir(i);return;case"select":xt("invalid",i),m=D=S=null;for(x in u)if(u.hasOwnProperty(x)&&(U=u[x],U!=null))switch(x){case"value":S=U;break;case"defaultValue":D=U;break;case"multiple":m=U;default:Ft(i,o,x,U,u,null)}o=S,u=D,i.multiple=!!m,o!=null?ds(i,!!m,o,!1):u!=null&&ds(i,!!m,u,!0);return;case"textarea":xt("invalid",i),S=x=m=null;for(D in u)if(u.hasOwnProperty(D)&&(U=u[D],U!=null))switch(D){case"value":m=U;break;case"defaultValue":x=U;break;case"children":S=U;break;case"dangerouslySetInnerHTML":if(U!=null)throw Error(s(91));break;default:Ft(i,o,D,U,u,null)}Un(i,m,x,S),Ir(i);return;case"option":for(Q in u)if(u.hasOwnProperty(Q)&&(m=u[Q],m!=null))switch(Q){case"selected":i.selected=m&&typeof m!="function"&&typeof m!="symbol";break;default:Ft(i,o,Q,m,u,null)}return;case"dialog":xt("beforetoggle",i),xt("toggle",i),xt("cancel",i),xt("close",i);break;case"iframe":case"object":xt("load",i);break;case"video":case"audio":for(m=0;m<tl.length;m++)xt(tl[m],i);break;case"image":xt("error",i),xt("load",i);break;case"details":xt("toggle",i);break;case"embed":case"source":case"link":xt("error",i),xt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(me in u)if(u.hasOwnProperty(me)&&(m=u[me],m!=null))switch(me){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:Ft(i,o,me,m,u,null)}return;default:if(ha(o)){for(Se in u)u.hasOwnProperty(Se)&&(m=u[Se],m!==void 0&&lh(i,o,Se,m,u,void 0));return}}for(U in u)u.hasOwnProperty(U)&&(m=u[U],m!=null&&Ft(i,o,U,m,u,null))}function IC(i,o,u,m){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,S=null,D=null,U=null,Q=null,me=null,Se=null;for(xe in u){var Ce=u[xe];if(u.hasOwnProperty(xe)&&Ce!=null)switch(xe){case"checked":break;case"value":break;case"defaultValue":Q=Ce;default:m.hasOwnProperty(xe)||Ft(i,o,xe,null,m,Ce)}}for(var ye in m){var xe=m[ye];if(Ce=u[ye],m.hasOwnProperty(ye)&&(xe!=null||Ce!=null))switch(ye){case"type":S=xe;break;case"name":x=xe;break;case"checked":me=xe;break;case"defaultChecked":Se=xe;break;case"value":D=xe;break;case"defaultValue":U=xe;break;case"children":case"dangerouslySetInnerHTML":if(xe!=null)throw Error(s(137,o));break;default:xe!==Ce&&Ft(i,o,ye,xe,m,Ce)}}Nr(i,D,U,Q,me,Se,S,x);return;case"select":xe=D=U=ye=null;for(S in u)if(Q=u[S],u.hasOwnProperty(S)&&Q!=null)switch(S){case"value":break;case"multiple":xe=Q;default:m.hasOwnProperty(S)||Ft(i,o,S,null,m,Q)}for(x in m)if(S=m[x],Q=u[x],m.hasOwnProperty(x)&&(S!=null||Q!=null))switch(x){case"value":ye=S;break;case"defaultValue":U=S;break;case"multiple":D=S;default:S!==Q&&Ft(i,o,x,S,m,Q)}o=U,u=D,m=xe,ye!=null?ds(i,!!u,ye,!1):!!m!=!!u&&(o!=null?ds(i,!!u,o,!0):ds(i,!!u,u?[]:"",!1));return;case"textarea":xe=ye=null;for(U in u)if(x=u[U],u.hasOwnProperty(U)&&x!=null&&!m.hasOwnProperty(U))switch(U){case"value":break;case"children":break;default:Ft(i,o,U,null,m,x)}for(D in m)if(x=m[D],S=u[D],m.hasOwnProperty(D)&&(x!=null||S!=null))switch(D){case"value":ye=x;break;case"defaultValue":xe=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(s(91));break;default:x!==S&&Ft(i,o,D,x,m,S)}bn(i,ye,xe);return;case"option":for(var it in u)if(ye=u[it],u.hasOwnProperty(it)&&ye!=null&&!m.hasOwnProperty(it))switch(it){case"selected":i.selected=!1;break;default:Ft(i,o,it,null,m,ye)}for(Q in m)if(ye=m[Q],xe=u[Q],m.hasOwnProperty(Q)&&ye!==xe&&(ye!=null||xe!=null))switch(Q){case"selected":i.selected=ye&&typeof ye!="function"&&typeof ye!="symbol";break;default:Ft(i,o,Q,ye,m,xe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var st in u)ye=u[st],u.hasOwnProperty(st)&&ye!=null&&!m.hasOwnProperty(st)&&Ft(i,o,st,null,m,ye);for(me in m)if(ye=m[me],xe=u[me],m.hasOwnProperty(me)&&ye!==xe&&(ye!=null||xe!=null))switch(me){case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(s(137,o));break;default:Ft(i,o,me,ye,m,xe)}return;default:if(ha(o)){for(var Bt in u)ye=u[Bt],u.hasOwnProperty(Bt)&&ye!==void 0&&!m.hasOwnProperty(Bt)&&lh(i,o,Bt,void 0,m,ye);for(Se in m)ye=m[Se],xe=u[Se],!m.hasOwnProperty(Se)||ye===xe||ye===void 0&&xe===void 0||lh(i,o,Se,ye,m,xe);return}}for(var re in u)ye=u[re],u.hasOwnProperty(re)&&ye!=null&&!m.hasOwnProperty(re)&&Ft(i,o,re,null,m,ye);for(Ce in m)ye=m[Ce],xe=u[Ce],!m.hasOwnProperty(Ce)||ye===xe||ye==null&&xe==null||Ft(i,o,Ce,ye,m,xe)}var ch=null,uh=null;function Xc(i){return i.nodeType===9?i:i.ownerDocument}function Mx(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function jx(i,o){if(i===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&o==="foreignObject"?0:i}function dh(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var fh=null;function NC(){var i=window.event;return i&&i.type==="popstate"?i===fh?!1:(fh=i,!0):(fh=null,!1)}var Ux=typeof setTimeout=="function"?setTimeout:void 0,kC=typeof clearTimeout=="function"?clearTimeout:void 0,Fx=typeof Promise=="function"?Promise:void 0,PC=typeof queueMicrotask=="function"?queueMicrotask:typeof Fx<"u"?function(i){return Fx.resolve(null).then(i).catch(OC)}:Ux;function OC(i){setTimeout(function(){throw i})}function dr(i){return i==="head"}function Bx(i,o){var u=o,m=0,x=0;do{var S=u.nextSibling;if(i.removeChild(u),S&&S.nodeType===8)if(u=S.data,u==="/$"){if(0<m&&8>m){u=m;var D=i.ownerDocument;if(u&1&&nl(D.documentElement),u&2&&nl(D.body),u&4)for(u=D.head,nl(u),D=u.firstChild;D;){var U=D.nextSibling,Q=D.nodeName;D[At]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&D.rel.toLowerCase()==="stylesheet"||u.removeChild(D),D=U}}if(x===0){i.removeChild(S),dl(o);return}x--}else u==="$"||u==="$?"||u==="$!"?x++:m=u.charCodeAt(0)-48;else m=0;u=S}while(u);dl(o)}function hh(i){var o=i.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":hh(u),Xs(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}i.removeChild(u)}}function MC(i,o,u,m){for(;i.nodeType===1;){var x=u;if(i.nodeName.toLowerCase()!==o.toLowerCase()){if(!m&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(m){if(!i[At])switch(o){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(S=i.getAttribute("rel"),S==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(S!==x.rel||i.getAttribute("href")!==(x.href==null||x.href===""?null:x.href)||i.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||i.getAttribute("title")!==(x.title==null?null:x.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(S=i.getAttribute("src"),(S!==(x.src==null?null:x.src)||i.getAttribute("type")!==(x.type==null?null:x.type)||i.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&S&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(o==="input"&&i.type==="hidden"){var S=x.name==null?null:""+x.name;if(x.type==="hidden"&&i.getAttribute("name")===S)return i}else return i;if(i=Hn(i.nextSibling),i===null)break}return null}function jC(i,o,u){if(o==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!u||(i=Hn(i.nextSibling),i===null))return null;return i}function mh(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function UC(i,o){var u=i.ownerDocument;if(i.data!=="$?"||u.readyState==="complete")o();else{var m=function(){o(),u.removeEventListener("DOMContentLoaded",m)};u.addEventListener("DOMContentLoaded",m),i._reactRetry=m}}function Hn(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return i}var gh=null;function $x(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var u=i.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return i;o--}else u==="/$"&&o++}i=i.previousSibling}return null}function Vx(i,o,u){switch(o=Xc(u),i){case"html":if(i=o.documentElement,!i)throw Error(s(452));return i;case"head":if(i=o.head,!i)throw Error(s(453));return i;case"body":if(i=o.body,!i)throw Error(s(454));return i;default:throw Error(s(451))}}function nl(i){for(var o=i.attributes;o.length;)i.removeAttributeNode(o[0]);Xs(i)}var wn=new Map,Gx=new Set;function Wc(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Oi=F.d;F.d={f:FC,r:BC,D:$C,C:VC,L:GC,m:HC,X:zC,S:KC,M:YC};function FC(){var i=Oi.f(),o=$c();return i||o}function BC(i){var o=js(i);o!==null&&o.tag===5&&o.type==="form"?cy(o):Oi.r(i)}var Va=typeof document>"u"?null:document;function Hx(i,o,u){var m=Va;if(m&&typeof o=="string"&&o){var x=ct(o);x='link[rel="'+i+'"][href="'+x+'"]',typeof u=="string"&&(x+='[crossorigin="'+u+'"]'),Gx.has(x)||(Gx.add(x),i={rel:i,crossOrigin:u,href:o},m.querySelector(x)===null&&(o=m.createElement("link"),Is(o,"link",i),Vt(o),m.head.appendChild(o)))}}function $C(i){Oi.D(i),Hx("dns-prefetch",i,null)}function VC(i,o){Oi.C(i,o),Hx("preconnect",i,o)}function GC(i,o,u){Oi.L(i,o,u);var m=Va;if(m&&i&&o){var x='link[rel="preload"][as="'+ct(o)+'"]';o==="image"&&u&&u.imageSrcSet?(x+='[imagesrcset="'+ct(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(x+='[imagesizes="'+ct(u.imageSizes)+'"]')):x+='[href="'+ct(i)+'"]';var S=x;switch(o){case"style":S=Ga(i);break;case"script":S=Ha(i)}wn.has(S)||(i=h({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:i,as:o},u),wn.set(S,i),m.querySelector(x)!==null||o==="style"&&m.querySelector(il(S))||o==="script"&&m.querySelector(rl(S))||(o=m.createElement("link"),Is(o,"link",i),Vt(o),m.head.appendChild(o)))}}function HC(i,o){Oi.m(i,o);var u=Va;if(u&&i){var m=o&&typeof o.as=="string"?o.as:"script",x='link[rel="modulepreload"][as="'+ct(m)+'"][href="'+ct(i)+'"]',S=x;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=Ha(i)}if(!wn.has(S)&&(i=h({rel:"modulepreload",href:i},o),wn.set(S,i),u.querySelector(x)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(rl(S)))return}m=u.createElement("link"),Is(m,"link",i),Vt(m),u.head.appendChild(m)}}}function KC(i,o,u){Oi.S(i,o,u);var m=Va;if(m&&i){var x=Et(m).hoistableStyles,S=Ga(i);o=o||"default";var D=x.get(S);if(!D){var U={loading:0,preload:null};if(D=m.querySelector(il(S)))U.loading=5;else{i=h({rel:"stylesheet",href:i,"data-precedence":o},u),(u=wn.get(S))&&ph(i,u);var Q=D=m.createElement("link");Vt(Q),Is(Q,"link",i),Q._p=new Promise(function(me,Se){Q.onload=me,Q.onerror=Se}),Q.addEventListener("load",function(){U.loading|=1}),Q.addEventListener("error",function(){U.loading|=2}),U.loading|=4,Qc(D,o,m)}D={type:"stylesheet",instance:D,count:1,state:U},x.set(S,D)}}}function zC(i,o){Oi.X(i,o);var u=Va;if(u&&i){var m=Et(u).hoistableScripts,x=Ha(i),S=m.get(x);S||(S=u.querySelector(rl(x)),S||(i=h({src:i,async:!0},o),(o=wn.get(x))&&yh(i,o),S=u.createElement("script"),Vt(S),Is(S,"link",i),u.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},m.set(x,S))}}function YC(i,o){Oi.M(i,o);var u=Va;if(u&&i){var m=Et(u).hoistableScripts,x=Ha(i),S=m.get(x);S||(S=u.querySelector(rl(x)),S||(i=h({src:i,async:!0,type:"module"},o),(o=wn.get(x))&&yh(i,o),S=u.createElement("script"),Vt(S),Is(S,"link",i),u.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},m.set(x,S))}}function Kx(i,o,u,m){var x=(x=de.current)?Wc(x):null;if(!x)throw Error(s(446));switch(i){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=Ga(u.href),u=Et(x).hoistableStyles,m=u.get(o),m||(m={type:"style",instance:null,count:0,state:null},u.set(o,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){i=Ga(u.href);var S=Et(x).hoistableStyles,D=S.get(i);if(D||(x=x.ownerDocument||x,D={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(i,D),(S=x.querySelector(il(i)))&&!S._p&&(D.instance=S,D.state.loading=5),wn.has(i)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},wn.set(i,u),S||qC(x,i,u,D.state))),o&&m===null)throw Error(s(528,""));return D}if(o&&m!==null)throw Error(s(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Ha(u),u=Et(x).hoistableScripts,m=u.get(o),m||(m={type:"script",instance:null,count:0,state:null},u.set(o,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,i))}}function Ga(i){return'href="'+ct(i)+'"'}function il(i){return'link[rel="stylesheet"]['+i+"]"}function zx(i){return h({},i,{"data-precedence":i.precedence,precedence:null})}function qC(i,o,u,m){i.querySelector('link[rel="preload"][as="style"]['+o+"]")?m.loading=1:(o=i.createElement("link"),m.preload=o,o.addEventListener("load",function(){return m.loading|=1}),o.addEventListener("error",function(){return m.loading|=2}),Is(o,"link",u),Vt(o),i.head.appendChild(o))}function Ha(i){return'[src="'+ct(i)+'"]'}function rl(i){return"script[async]"+i}function Yx(i,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var m=i.querySelector('style[data-href~="'+ct(u.href)+'"]');if(m)return o.instance=m,Vt(m),m;var x=h({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return m=(i.ownerDocument||i).createElement("style"),Vt(m),Is(m,"style",x),Qc(m,u.precedence,i),o.instance=m;case"stylesheet":x=Ga(u.href);var S=i.querySelector(il(x));if(S)return o.state.loading|=4,o.instance=S,Vt(S),S;m=zx(u),(x=wn.get(x))&&ph(m,x),S=(i.ownerDocument||i).createElement("link"),Vt(S);var D=S;return D._p=new Promise(function(U,Q){D.onload=U,D.onerror=Q}),Is(S,"link",m),o.state.loading|=4,Qc(S,u.precedence,i),o.instance=S;case"script":return S=Ha(u.src),(x=i.querySelector(rl(S)))?(o.instance=x,Vt(x),x):(m=u,(x=wn.get(S))&&(m=h({},u),yh(m,x)),i=i.ownerDocument||i,x=i.createElement("script"),Vt(x),Is(x,"link",m),i.head.appendChild(x),o.instance=x);case"void":return null;default:throw Error(s(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(m=o.instance,o.state.loading|=4,Qc(m,u.precedence,i));return o.instance}function Qc(i,o,u){for(var m=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=m.length?m[m.length-1]:null,S=x,D=0;D<m.length;D++){var U=m[D];if(U.dataset.precedence===o)S=U;else if(S!==x)break}S?S.parentNode.insertBefore(i,S.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(i,o.firstChild))}function ph(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.title==null&&(i.title=o.title)}function yh(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.integrity==null&&(i.integrity=o.integrity)}var Zc=null;function qx(i,o,u){if(Zc===null){var m=new Map,x=Zc=new Map;x.set(u,m)}else x=Zc,m=x.get(u),m||(m=new Map,x.set(u,m));if(m.has(i))return m;for(m.set(i,null),u=u.getElementsByTagName(i),x=0;x<u.length;x++){var S=u[x];if(!(S[At]||S[je]||i==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var D=S.getAttribute(o)||"";D=i+D;var U=m.get(D);U?U.push(S):m.set(D,[S])}}return m}function Xx(i,o,u){i=i.ownerDocument||i,i.head.insertBefore(u,o==="title"?i.querySelector("head > title"):null)}function XC(i,o,u){if(u===1||o.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return i=o.disabled,typeof o.precedence=="string"&&i==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function Wx(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var al=null;function WC(){}function QC(i,o,u){if(al===null)throw Error(s(475));var m=al;if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var x=Ga(u.href),S=i.querySelector(il(x));if(S){i=S._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(m.count++,m=Jc.bind(m),i.then(m,m)),o.state.loading|=4,o.instance=S,Vt(S);return}S=i.ownerDocument||i,u=zx(u),(x=wn.get(x))&&ph(u,x),S=S.createElement("link"),Vt(S);var D=S;D._p=new Promise(function(U,Q){D.onload=U,D.onerror=Q}),Is(S,"link",u),o.instance=S}m.stylesheets===null&&(m.stylesheets=new Map),m.stylesheets.set(o,i),(i=o.state.preload)&&(o.state.loading&3)===0&&(m.count++,o=Jc.bind(m),i.addEventListener("load",o),i.addEventListener("error",o))}}function ZC(){if(al===null)throw Error(s(475));var i=al;return i.stylesheets&&i.count===0&&xh(i,i.stylesheets),0<i.count?function(o){var u=setTimeout(function(){if(i.stylesheets&&xh(i,i.stylesheets),i.unsuspend){var m=i.unsuspend;i.unsuspend=null,m()}},6e4);return i.unsuspend=o,function(){i.unsuspend=null,clearTimeout(u)}}:null}function Jc(){if(this.count--,this.count===0){if(this.stylesheets)xh(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var eu=null;function xh(i,o){i.stylesheets=null,i.unsuspend!==null&&(i.count++,eu=new Map,o.forEach(JC,i),eu=null,Jc.call(i))}function JC(i,o){if(!(o.state.loading&4)){var u=eu.get(i);if(u)var m=u.get(null);else{u=new Map,eu.set(i,u);for(var x=i.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<x.length;S++){var D=x[S];(D.nodeName==="LINK"||D.getAttribute("media")!=="not all")&&(u.set(D.dataset.precedence,D),m=D)}m&&u.set(null,m)}x=o.instance,D=x.getAttribute("data-precedence"),S=u.get(D)||m,S===m&&u.set(null,x),u.set(D,x),this.count++,m=Jc.bind(this),x.addEventListener("load",m),x.addEventListener("error",m),S?S.parentNode.insertBefore(x,S.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(x,i.firstChild)),o.state.loading|=4}}var ol={$$typeof:C,Provider:null,Consumer:null,_currentValue:O,_currentValue2:O,_threadCount:0};function eL(i,o,u,m,x,S,D,U){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=xn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xn(0),this.hiddenUpdates=xn(null),this.identifierPrefix=m,this.onUncaughtError=x,this.onCaughtError=S,this.onRecoverableError=D,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=U,this.incompleteTransitions=new Map}function Qx(i,o,u,m,x,S,D,U,Q,me,Se,Ce){return i=new eL(i,o,u,D,U,Q,me,Ce),o=1,S===!0&&(o|=24),S=an(3,null,null,o),i.current=S,S.stateNode=i,o=Zd(),o.refCount++,i.pooledCache=o,o.refCount++,S.memoizedState={element:m,isDehydrated:u,cache:o},sf(S),i}function Zx(i){return i?(i=Sa,i):Sa}function Jx(i,o,u,m,x,S){x=Zx(x),m.context===null?m.context=x:m.pendingContext=x,m=Zi(o),m.payload={element:u},S=S===void 0?null:S,S!==null&&(m.callback=S),u=Ji(i,m,o),u!==null&&(dn(u,i,o),jo(u,i,o))}function ev(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var u=i.retryLane;i.retryLane=u!==0&&u<o?u:o}}function vh(i,o){ev(i,o),(i=i.alternate)&&ev(i,o)}function tv(i){if(i.tag===13){var o=ba(i,67108864);o!==null&&dn(o,i,67108864),vh(i,67108864)}}var tu=!0;function tL(i,o,u,m){var x=k.T;k.T=null;var S=F.p;try{F.p=2,bh(i,o,u,m)}finally{F.p=S,k.T=x}}function sL(i,o,u,m){var x=k.T;k.T=null;var S=F.p;try{F.p=8,bh(i,o,u,m)}finally{F.p=S,k.T=x}}function bh(i,o,u,m){if(tu){var x=Sh(m);if(x===null)oh(i,o,m,su,u),nv(i,m);else if(iL(x,i,o,u,m))m.stopPropagation();else if(nv(i,m),o&4&&-1<nL.indexOf(i)){for(;x!==null;){var S=js(x);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var D=Ms(S.pendingLanes);if(D!==0){var U=S;for(U.pendingLanes|=2,U.entangledLanes|=2;D;){var Q=1<<31-_t(D);U.entanglements[1]|=Q,D&=~Q}ii(S),(Nt&6)===0&&(Fc=te()+500,el(0))}}break;case 13:U=ba(S,2),U!==null&&dn(U,S,2),$c(),vh(S,2)}if(S=Sh(m),S===null&&oh(i,o,m,su,u),S===x)break;x=S}x!==null&&m.stopPropagation()}else oh(i,o,m,null,u)}}function Sh(i){return i=ga(i),Eh(i)}var su=null;function Eh(i){if(su=null,i=ws(i),i!==null){var o=a(i);if(o===null)i=null;else{var u=o.tag;if(u===13){if(i=l(o),i!==null)return i;i=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return su=i,null}function sv(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(be()){case Ie:return 2;case Ue:return 8;case Ke:case We:return 32;case ae:return 268435456;default:return 32}default:return 32}}var Th=!1,fr=null,hr=null,mr=null,ll=new Map,cl=new Map,gr=[],nL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function nv(i,o){switch(i){case"focusin":case"focusout":fr=null;break;case"dragenter":case"dragleave":hr=null;break;case"mouseover":case"mouseout":mr=null;break;case"pointerover":case"pointerout":ll.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":cl.delete(o.pointerId)}}function ul(i,o,u,m,x,S){return i===null||i.nativeEvent!==S?(i={blockedOn:o,domEventName:u,eventSystemFlags:m,nativeEvent:S,targetContainers:[x]},o!==null&&(o=js(o),o!==null&&tv(o)),i):(i.eventSystemFlags|=m,o=i.targetContainers,x!==null&&o.indexOf(x)===-1&&o.push(x),i)}function iL(i,o,u,m,x){switch(o){case"focusin":return fr=ul(fr,i,o,u,m,x),!0;case"dragenter":return hr=ul(hr,i,o,u,m,x),!0;case"mouseover":return mr=ul(mr,i,o,u,m,x),!0;case"pointerover":var S=x.pointerId;return ll.set(S,ul(ll.get(S)||null,i,o,u,m,x)),!0;case"gotpointercapture":return S=x.pointerId,cl.set(S,ul(cl.get(S)||null,i,o,u,m,x)),!0}return!1}function iv(i){var o=ws(i.target);if(o!==null){var u=a(o);if(u!==null){if(o=u.tag,o===13){if(o=l(u),o!==null){i.blockedOn=o,Re(i.priority,function(){if(u.tag===13){var m=un();m=qs(m);var x=ba(u,m);x!==null&&dn(x,u,m),vh(u,m)}});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){i.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}i.blockedOn=null}function nu(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var u=Sh(i.nativeEvent);if(u===null){u=i.nativeEvent;var m=new u.constructor(u.type,u);qi=m,u.target.dispatchEvent(m),qi=null}else return o=js(u),o!==null&&tv(o),i.blockedOn=u,!1;o.shift()}return!0}function rv(i,o,u){nu(i)&&u.delete(o)}function rL(){Th=!1,fr!==null&&nu(fr)&&(fr=null),hr!==null&&nu(hr)&&(hr=null),mr!==null&&nu(mr)&&(mr=null),ll.forEach(rv),cl.forEach(rv)}function iu(i,o){i.blockedOn===o&&(i.blockedOn=null,Th||(Th=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,rL)))}var ru=null;function av(i){ru!==i&&(ru=i,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){ru===i&&(ru=null);for(var o=0;o<i.length;o+=3){var u=i[o],m=i[o+1],x=i[o+2];if(typeof m!="function"){if(Eh(m||u)===null)continue;break}var S=js(u);S!==null&&(i.splice(o,3),o-=3,Ef(S,{pending:!0,data:x,method:u.method,action:m},m,x))}}))}function dl(i){function o(Q){return iu(Q,i)}fr!==null&&iu(fr,i),hr!==null&&iu(hr,i),mr!==null&&iu(mr,i),ll.forEach(o),cl.forEach(o);for(var u=0;u<gr.length;u++){var m=gr[u];m.blockedOn===i&&(m.blockedOn=null)}for(;0<gr.length&&(u=gr[0],u.blockedOn===null);)iv(u),u.blockedOn===null&&gr.shift();if(u=(i.ownerDocument||i).$$reactFormReplay,u!=null)for(m=0;m<u.length;m+=3){var x=u[m],S=u[m+1],D=x[ze]||null;if(typeof S=="function")D||av(u);else if(D){var U=null;if(S&&S.hasAttribute("formAction")){if(x=S,D=S[ze]||null)U=D.formAction;else if(Eh(x)!==null)continue}else U=D.action;typeof U=="function"?u[m+1]=U:(u.splice(m,3),m-=3),av(u)}}}function Ah(i){this._internalRoot=i}au.prototype.render=Ah.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(s(409));var u=o.current,m=un();Jx(u,m,i,o,null,null)},au.prototype.unmount=Ah.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;Jx(i.current,2,null,i,null,null),$c(),o[De]=null}};function au(i){this._internalRoot=i}au.prototype.unstable_scheduleHydration=function(i){if(i){var o=ne();i={blockedOn:null,target:i,priority:o};for(var u=0;u<gr.length&&o!==0&&o<gr[u].priority;u++);gr.splice(u,0,i),u===0&&iv(i)}};var ov=e.version;if(ov!=="19.1.1")throw Error(s(527,ov,"19.1.1"));F.findDOMNode=function(i){var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(s(188)):(i=Object.keys(i).join(","),Error(s(268,i)));return i=f(o),i=i!==null?d(i):null,i=i===null?null:i.stateNode,i};var aL={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ou=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ou.isDisabled&&ou.supportsFiber)try{Ae=ou.inject(aL),Me=ou}catch{}}return hl.createRoot=function(i,o){if(!r(i))throw Error(s(299));var u=!1,m="",x=Ty,S=Ay,D=_y,U=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onUncaughtError!==void 0&&(x=o.onUncaughtError),o.onCaughtError!==void 0&&(S=o.onCaughtError),o.onRecoverableError!==void 0&&(D=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(U=o.unstable_transitionCallbacks)),o=Qx(i,1,!1,null,null,u,m,x,S,D,U,null),i[De]=o.current,ah(i),new Ah(o)},hl.hydrateRoot=function(i,o,u){if(!r(i))throw Error(s(299));var m=!1,x="",S=Ty,D=Ay,U=_y,Q=null,me=null;return u!=null&&(u.unstable_strictMode===!0&&(m=!0),u.identifierPrefix!==void 0&&(x=u.identifierPrefix),u.onUncaughtError!==void 0&&(S=u.onUncaughtError),u.onCaughtError!==void 0&&(D=u.onCaughtError),u.onRecoverableError!==void 0&&(U=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(Q=u.unstable_transitionCallbacks),u.formState!==void 0&&(me=u.formState)),o=Qx(i,1,!0,o,u??null,m,x,S,D,U,Q,me),o.context=Zx(null),u=o.current,m=un(),m=qs(m),x=Zi(m),x.callback=null,Ji(u,x,m),u=m,o.current.lanes=u,ps(o,u),ii(o),i[De]=o.current,ah(i),new au(o)},hl.version="19.1.1",hl}var yv;function gL(){if(yv)return Lh.exports;yv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Lh.exports=mL(),Lh.exports}var pL=gL();/**
 * react-router v7.9.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var xv="popstate";function yL(n={}){function e(s,r){let{pathname:a,search:l,hash:c}=s.location;return wm("",{pathname:a,search:l,hash:c},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(s,r){return typeof r=="string"?r:Il(r)}return vL(e,t,null,n)}function Xt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function qn(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function xL(){return Math.random().toString(36).substring(2,10)}function vv(n,e){return{usr:n.state,key:n.key,idx:e}}function wm(n,e,t=null,s){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?ho(e):e,state:t,key:e&&e.key||s||xL()}}function Il({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function ho(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let s=n.indexOf("?");s>=0&&(e.search=n.substring(s),n=n.substring(0,s)),n&&(e.pathname=n)}return e}function vL(n,e,t,s={}){let{window:r=document.defaultView,v5Compat:a=!1}=s,l=r.history,c="POP",f=null,d=h();d==null&&(d=0,l.replaceState({...l.state,idx:d},""));function h(){return(l.state||{idx:null}).idx}function g(){c="POP";let E=h(),_=E==null?null:E-d;d=E,f&&f({action:c,location:T.location,delta:_})}function y(E,_){c="PUSH";let A=wm(T.location,E,_);d=h()+1;let C=vv(A,d),N=T.createHref(A);try{l.pushState(C,"",N)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;r.location.assign(N)}a&&f&&f({action:c,location:T.location,delta:1})}function v(E,_){c="REPLACE";let A=wm(T.location,E,_);d=h();let C=vv(A,d),N=T.createHref(A);l.replaceState(C,"",N),a&&f&&f({action:c,location:T.location,delta:0})}function b(E){return bL(E)}let T={get action(){return c},get location(){return n(r,l)},listen(E){if(f)throw new Error("A history only accepts one active listener");return r.addEventListener(xv,g),f=E,()=>{r.removeEventListener(xv,g),f=null}},createHref(E){return e(r,E)},createURL:b,encodeLocation(E){let _=b(E);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:y,replace:v,go(E){return l.go(E)}};return T}function bL(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Xt(t,"No window.location.(origin|href) available to create URL");let s=typeof n=="string"?n:Il(n);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function TE(n,e,t="/"){return SL(n,e,t,!1)}function SL(n,e,t,s){let r=typeof e=="string"?ho(e):e,a=$i(r.pathname||"/",t);if(a==null)return null;let l=AE(n);EL(l);let c=null;for(let f=0;c==null&&f<l.length;++f){let d=kL(a);c=IL(l[f],d,s)}return c}function AE(n,e=[],t=[],s="",r=!1){let a=(l,c,f=r,d)=>{let h={relativePath:d===void 0?l.path||"":d,caseSensitive:l.caseSensitive===!0,childrenIndex:c,route:l};if(h.relativePath.startsWith("/")){if(!h.relativePath.startsWith(s)&&f)return;Xt(h.relativePath.startsWith(s),`Absolute route path "${h.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(s.length)}let g=Bi([s,h.relativePath]),y=t.concat(h);l.children&&l.children.length>0&&(Xt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),AE(l.children,e,y,g,f)),!(l.path==null&&!l.index)&&e.push({path:g,score:RL(g,l.index),routesMeta:y})};return n.forEach((l,c)=>{if(l.path===""||!l.path?.includes("?"))a(l,c);else for(let f of _E(l.path))a(l,c,!0,f)}),e}function _E(n){let e=n.split("/");if(e.length===0)return[];let[t,...s]=e,r=t.endsWith("?"),a=t.replace(/\?$/,"");if(s.length===0)return r?[a,""]:[a];let l=_E(s.join("/")),c=[];return c.push(...l.map(f=>f===""?a:[a,f].join("/"))),r&&c.push(...l),c.map(f=>n.startsWith("/")&&f===""?"/":f)}function EL(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:DL(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var TL=/^:[\w-]+$/,AL=3,_L=2,CL=1,LL=10,wL=-2,bv=n=>n==="*";function RL(n,e){let t=n.split("/"),s=t.length;return t.some(bv)&&(s+=wL),e&&(s+=_L),t.filter(r=>!bv(r)).reduce((r,a)=>r+(TL.test(a)?AL:a===""?CL:LL),s)}function DL(n,e){return n.length===e.length&&n.slice(0,-1).every((s,r)=>s===e[r])?n[n.length-1]-e[e.length-1]:0}function IL(n,e,t=!1){let{routesMeta:s}=n,r={},a="/",l=[];for(let c=0;c<s.length;++c){let f=s[c],d=c===s.length-1,h=a==="/"?e:e.slice(a.length)||"/",g=zu({path:f.relativePath,caseSensitive:f.caseSensitive,end:d},h),y=f.route;if(!g&&d&&t&&!s[s.length-1].route.index&&(g=zu({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},h)),!g)return null;Object.assign(r,g.params),l.push({params:r,pathname:Bi([a,g.pathname]),pathnameBase:jL(Bi([a,g.pathnameBase])),route:y}),g.pathnameBase!=="/"&&(a=Bi([a,g.pathnameBase]))}return l}function zu(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,s]=NL(n.path,n.caseSensitive,n.end),r=e.match(t);if(!r)return null;let a=r[0],l=a.replace(/(.)\/+$/,"$1"),c=r.slice(1);return{params:s.reduce((d,{paramName:h,isOptional:g},y)=>{if(h==="*"){let b=c[y]||"";l=a.slice(0,a.length-b.length).replace(/(.)\/+$/,"$1")}const v=c[y];return g&&!v?d[h]=void 0:d[h]=(v||"").replace(/%2F/g,"/"),d},{}),pathname:a,pathnameBase:l,pattern:n}}function NL(n,e=!1,t=!0){qn(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let s=[],r="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,c,f)=>(s.push({paramName:c,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(s.push({paramName:"*"}),r+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":n!==""&&n!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),s]}function kL(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return qn(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function $i(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=n.charAt(t);return s&&s!=="/"?null:n.slice(t)||"/"}function PL(n,e="/"){let{pathname:t,search:s="",hash:r=""}=typeof n=="string"?ho(n):n;return{pathname:t?t.startsWith("/")?t:OL(t,e):e,search:UL(s),hash:FL(r)}}function OL(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function Ih(n,e,t,s){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function ML(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function _g(n){let e=ML(n);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function Cg(n,e,t,s=!1){let r;typeof n=="string"?r=ho(n):(r={...n},Xt(!r.pathname||!r.pathname.includes("?"),Ih("?","pathname","search",r)),Xt(!r.pathname||!r.pathname.includes("#"),Ih("#","pathname","hash",r)),Xt(!r.search||!r.search.includes("#"),Ih("#","search","hash",r)));let a=n===""||r.pathname==="",l=a?"/":r.pathname,c;if(l==null)c=t;else{let g=e.length-1;if(!s&&l.startsWith("..")){let y=l.split("/");for(;y[0]==="..";)y.shift(),g-=1;r.pathname=y.join("/")}c=g>=0?e[g]:"/"}let f=PL(r,c),d=l&&l!=="/"&&l.endsWith("/"),h=(a||l===".")&&t.endsWith("/");return!f.pathname.endsWith("/")&&(d||h)&&(f.pathname+="/"),f}var Bi=n=>n.join("/").replace(/\/\/+/g,"/"),jL=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),UL=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,FL=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function BL(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var CE=["POST","PUT","PATCH","DELETE"];new Set(CE);var $L=["GET",...CE];new Set($L);var mo=R.createContext(null);mo.displayName="DataRouter";var hd=R.createContext(null);hd.displayName="DataRouterState";R.createContext(!1);var LE=R.createContext({isTransitioning:!1});LE.displayName="ViewTransition";var VL=R.createContext(new Map);VL.displayName="Fetchers";var GL=R.createContext(null);GL.displayName="Await";var Xn=R.createContext(null);Xn.displayName="Navigation";var Yl=R.createContext(null);Yl.displayName="Location";var yi=R.createContext({outlet:null,matches:[],isDataRoute:!1});yi.displayName="Route";var Lg=R.createContext(null);Lg.displayName="RouteError";function HL(n,{relative:e}={}){Xt(go(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=R.useContext(Xn),{hash:r,pathname:a,search:l}=ql(n,{relative:e}),c=a;return t!=="/"&&(c=a==="/"?t:Bi([t,a])),s.createHref({pathname:c,search:l,hash:r})}function go(){return R.useContext(Yl)!=null}function kn(){return Xt(go(),"useLocation() may be used only in the context of a <Router> component."),R.useContext(Yl).location}var wE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function RE(n){R.useContext(Xn).static||R.useLayoutEffect(n)}function wr(){let{isDataRoute:n}=R.useContext(yi);return n?nw():KL()}function KL(){Xt(go(),"useNavigate() may be used only in the context of a <Router> component.");let n=R.useContext(mo),{basename:e,navigator:t}=R.useContext(Xn),{matches:s}=R.useContext(yi),{pathname:r}=kn(),a=JSON.stringify(_g(s)),l=R.useRef(!1);return RE(()=>{l.current=!0}),R.useCallback((f,d={})=>{if(qn(l.current,wE),!l.current)return;if(typeof f=="number"){t.go(f);return}let h=Cg(f,JSON.parse(a),r,d.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Bi([e,h.pathname])),(d.replace?t.replace:t.push)(h,d.state,d)},[e,t,a,r,n])}R.createContext(null);function ql(n,{relative:e}={}){let{matches:t}=R.useContext(yi),{pathname:s}=kn(),r=JSON.stringify(_g(t));return R.useMemo(()=>Cg(n,JSON.parse(r),s,e==="path"),[n,r,s,e])}function zL(n,e){return DE(n,e)}function DE(n,e,t,s,r){Xt(go(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=R.useContext(Xn),{matches:l}=R.useContext(yi),c=l[l.length-1],f=c?c.params:{},d=c?c.pathname:"/",h=c?c.pathnameBase:"/",g=c&&c.route;{let A=g&&g.path||"";IE(d,!g||A.endsWith("*")||A.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${A}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${A}"> to <Route path="${A==="/"?"*":`${A}/*`}">.`)}let y=kn(),v;if(e){let A=typeof e=="string"?ho(e):e;Xt(h==="/"||A.pathname?.startsWith(h),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${h}" but pathname "${A.pathname}" was given in the \`location\` prop.`),v=A}else v=y;let b=v.pathname||"/",T=b;if(h!=="/"){let A=h.replace(/^\//,"").split("/");T="/"+b.replace(/^\//,"").split("/").slice(A.length).join("/")}let E=TE(n,{pathname:T});qn(g||E!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),qn(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let _=QL(E&&E.map(A=>Object.assign({},A,{params:Object.assign({},f,A.params),pathname:Bi([h,a.encodeLocation?a.encodeLocation(A.pathname).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?h:Bi([h,a.encodeLocation?a.encodeLocation(A.pathnameBase).pathname:A.pathnameBase])})),l,t,s,r);return e&&_?R.createElement(Yl.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},_):_}function YL(){let n=sw(),e=BL(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:s},a={padding:"2px 4px",backgroundColor:s},l=null;return console.error("Error handled by React Router default ErrorBoundary:",n),l=R.createElement(R.Fragment,null,R.createElement("p",null," Hey developer "),R.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",R.createElement("code",{style:a},"ErrorBoundary")," or"," ",R.createElement("code",{style:a},"errorElement")," prop on your route.")),R.createElement(R.Fragment,null,R.createElement("h2",null,"Unexpected Application Error!"),R.createElement("h3",{style:{fontStyle:"italic"}},e),t?R.createElement("pre",{style:r},t):null,l)}var qL=R.createElement(YL,null),XL=class extends R.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.unstable_onError?this.props.unstable_onError(n,e):console.error("React Router caught the following error during render",n)}render(){return this.state.error!==void 0?R.createElement(yi.Provider,{value:this.props.routeContext},R.createElement(Lg.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function WL({routeContext:n,match:e,children:t}){let s=R.useContext(mo);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),R.createElement(yi.Provider,{value:n},t)}function QL(n,e=[],t=null,s=null,r=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,l=t?.errors;if(l!=null){let d=a.findIndex(h=>h.route.id&&l?.[h.route.id]!==void 0);Xt(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),a=a.slice(0,Math.min(a.length,d+1))}let c=!1,f=-1;if(t)for(let d=0;d<a.length;d++){let h=a[d];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(f=d),h.route.id){let{loaderData:g,errors:y}=t,v=h.route.loader&&!g.hasOwnProperty(h.route.id)&&(!y||y[h.route.id]===void 0);if(h.route.lazy||v){c=!0,f>=0?a=a.slice(0,f+1):a=[a[0]];break}}}return a.reduceRight((d,h,g)=>{let y,v=!1,b=null,T=null;t&&(y=l&&h.route.id?l[h.route.id]:void 0,b=h.route.errorElement||qL,c&&(f<0&&g===0?(IE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,T=null):f===g&&(v=!0,T=h.route.hydrateFallbackElement||null)));let E=e.concat(a.slice(0,g+1)),_=()=>{let A;return y?A=b:v?A=T:h.route.Component?A=R.createElement(h.route.Component,null):h.route.element?A=h.route.element:A=d,R.createElement(WL,{match:h,routeContext:{outlet:d,matches:E,isDataRoute:t!=null},children:A})};return t&&(h.route.ErrorBoundary||h.route.errorElement||g===0)?R.createElement(XL,{location:t.location,revalidation:t.revalidation,component:b,error:y,children:_(),routeContext:{outlet:null,matches:E,isDataRoute:!0},unstable_onError:s}):_()},null)}function wg(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ZL(n){let e=R.useContext(mo);return Xt(e,wg(n)),e}function JL(n){let e=R.useContext(hd);return Xt(e,wg(n)),e}function ew(n){let e=R.useContext(yi);return Xt(e,wg(n)),e}function Rg(n){let e=ew(n),t=e.matches[e.matches.length-1];return Xt(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function tw(){return Rg("useRouteId")}function sw(){let n=R.useContext(Lg),e=JL("useRouteError"),t=Rg("useRouteError");return n!==void 0?n:e.errors?.[t]}function nw(){let{router:n}=ZL("useNavigate"),e=Rg("useNavigate"),t=R.useRef(!1);return RE(()=>{t.current=!0}),R.useCallback(async(r,a={})=>{qn(t.current,wE),t.current&&(typeof r=="number"?n.navigate(r):await n.navigate(r,{fromRouteId:e,...a}))},[n,e])}var Sv={};function IE(n,e,t){!e&&!Sv[n]&&(Sv[n]=!0,qn(!1,t))}R.memo(iw);function iw({routes:n,future:e,state:t,unstable_onError:s}){return DE(n,void 0,t,s,e)}function Nh({to:n,replace:e,state:t,relative:s}){Xt(go(),"<Navigate> may be used only in the context of a <Router> component.");let{static:r}=R.useContext(Xn);qn(!r,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:a}=R.useContext(yi),{pathname:l}=kn(),c=wr(),f=Cg(n,_g(a),l,s==="path"),d=JSON.stringify(f);return R.useEffect(()=>{c(JSON.parse(d),{replace:e,state:t,relative:s})},[c,d,s,e,t]),null}function Bs(n){Xt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function rw({basename:n="/",children:e=null,location:t,navigationType:s="POP",navigator:r,static:a=!1}){Xt(!go(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=n.replace(/^\/*/,"/"),c=R.useMemo(()=>({basename:l,navigator:r,static:a,future:{}}),[l,r,a]);typeof t=="string"&&(t=ho(t));let{pathname:f="/",search:d="",hash:h="",state:g=null,key:y="default"}=t,v=R.useMemo(()=>{let b=$i(f,l);return b==null?null:{location:{pathname:b,search:d,hash:h,state:g,key:y},navigationType:s}},[l,f,d,h,g,y,s]);return qn(v!=null,`<Router basename="${l}"> is not able to match the URL "${f}${d}${h}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:R.createElement(Xn.Provider,{value:c},R.createElement(Yl.Provider,{children:e,value:v}))}function Ev({children:n,location:e}){return zL(Rm(n),e)}function Rm(n,e=[]){let t=[];return R.Children.forEach(n,(s,r)=>{if(!R.isValidElement(s))return;let a=[...e,r];if(s.type===R.Fragment){t.push.apply(t,Rm(s.props.children,a));return}Xt(s.type===Bs,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Xt(!s.props.index||!s.props.children,"An index route cannot have child routes.");let l={id:s.props.id||a.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(l.children=Rm(s.props.children,a)),t.push(l)}),t}var Iu="get",Nu="application/x-www-form-urlencoded";function md(n){return n!=null&&typeof n.tagName=="string"}function aw(n){return md(n)&&n.tagName.toLowerCase()==="button"}function ow(n){return md(n)&&n.tagName.toLowerCase()==="form"}function lw(n){return md(n)&&n.tagName.toLowerCase()==="input"}function cw(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function uw(n,e){return n.button===0&&(!e||e==="_self")&&!cw(n)}var lu=null;function dw(){if(lu===null)try{new FormData(document.createElement("form"),0),lu=!1}catch{lu=!0}return lu}var fw=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function kh(n){return n!=null&&!fw.has(n)?(qn(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nu}"`),null):n}function hw(n,e){let t,s,r,a,l;if(ow(n)){let c=n.getAttribute("action");s=c?$i(c,e):null,t=n.getAttribute("method")||Iu,r=kh(n.getAttribute("enctype"))||Nu,a=new FormData(n)}else if(aw(n)||lw(n)&&(n.type==="submit"||n.type==="image")){let c=n.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=n.getAttribute("formaction")||c.getAttribute("action");if(s=f?$i(f,e):null,t=n.getAttribute("formmethod")||c.getAttribute("method")||Iu,r=kh(n.getAttribute("formenctype"))||kh(c.getAttribute("enctype"))||Nu,a=new FormData(c,n),!dw()){let{name:d,type:h,value:g}=n;if(h==="image"){let y=d?`${d}.`:"";a.append(`${y}x`,"0"),a.append(`${y}y`,"0")}else d&&a.append(d,g)}}else{if(md(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Iu,s=null,r=Nu,l=n}return a&&r==="text/plain"&&(l=a,a=void 0),{action:s,method:t.toLowerCase(),encType:r,formData:a,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Dg(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function mw(n,e,t){let s=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return s.pathname==="/"?s.pathname=`_root.${t}`:e&&$i(s.pathname,e)==="/"?s.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:s.pathname=`${s.pathname.replace(/\/$/,"")}.${t}`,s}async function gw(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function pw(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function yw(n,e,t){let s=await Promise.all(n.map(async r=>{let a=e.routes[r.route.id];if(a){let l=await gw(a,t);return l.links?l.links():[]}return[]}));return Sw(s.flat(1).filter(pw).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function Tv(n,e,t,s,r,a){let l=(f,d)=>t[d]?f.route.id!==t[d].route.id:!0,c=(f,d)=>t[d].pathname!==f.pathname||t[d].route.path?.endsWith("*")&&t[d].params["*"]!==f.params["*"];return a==="assets"?e.filter((f,d)=>l(f,d)||c(f,d)):a==="data"?e.filter((f,d)=>{let h=s.routes[f.route.id];if(!h||!h.hasLoader)return!1;if(l(f,d)||c(f,d))return!0;if(f.route.shouldRevalidate){let g=f.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function xw(n,e,{includeHydrateFallback:t}={}){return vw(n.map(s=>{let r=e.routes[s.route.id];if(!r)return[];let a=[r.module];return r.clientActionModule&&(a=a.concat(r.clientActionModule)),r.clientLoaderModule&&(a=a.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(a=a.concat(r.hydrateFallbackModule)),r.imports&&(a=a.concat(r.imports)),a}).flat(1))}function vw(n){return[...new Set(n)]}function bw(n){let e={},t=Object.keys(n).sort();for(let s of t)e[s]=n[s];return e}function Sw(n,e){let t=new Set;return new Set(e),n.reduce((s,r)=>{let a=JSON.stringify(bw(r));return t.has(a)||(t.add(a),s.push({key:a,link:r})),s},[])}function NE(){let n=R.useContext(mo);return Dg(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function Ew(){let n=R.useContext(hd);return Dg(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Ig=R.createContext(void 0);Ig.displayName="FrameworkContext";function kE(){let n=R.useContext(Ig);return Dg(n,"You must render this element inside a <HydratedRouter> element"),n}function Tw(n,e){let t=R.useContext(Ig),[s,r]=R.useState(!1),[a,l]=R.useState(!1),{onFocus:c,onBlur:f,onMouseEnter:d,onMouseLeave:h,onTouchStart:g}=e,y=R.useRef(null);R.useEffect(()=>{if(n==="render"&&l(!0),n==="viewport"){let T=_=>{_.forEach(A=>{l(A.isIntersecting)})},E=new IntersectionObserver(T,{threshold:.5});return y.current&&E.observe(y.current),()=>{E.disconnect()}}},[n]),R.useEffect(()=>{if(s){let T=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(T)}}},[s]);let v=()=>{r(!0)},b=()=>{r(!1),l(!1)};return t?n!=="intent"?[a,y,{}]:[a,y,{onFocus:ml(c,v),onBlur:ml(f,b),onMouseEnter:ml(d,v),onMouseLeave:ml(h,b),onTouchStart:ml(g,v)}]:[!1,y,{}]}function ml(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function Aw({page:n,...e}){let{router:t}=NE(),s=R.useMemo(()=>TE(t.routes,n,t.basename),[t.routes,n,t.basename]);return s?R.createElement(Cw,{page:n,matches:s,...e}):null}function _w(n){let{manifest:e,routeModules:t}=kE(),[s,r]=R.useState([]);return R.useEffect(()=>{let a=!1;return yw(n,e,t).then(l=>{a||r(l)}),()=>{a=!0}},[n,e,t]),s}function Cw({page:n,matches:e,...t}){let s=kn(),{manifest:r,routeModules:a}=kE(),{basename:l}=NE(),{loaderData:c,matches:f}=Ew(),d=R.useMemo(()=>Tv(n,e,f,r,s,"data"),[n,e,f,r,s]),h=R.useMemo(()=>Tv(n,e,f,r,s,"assets"),[n,e,f,r,s]),g=R.useMemo(()=>{if(n===s.pathname+s.search+s.hash)return[];let b=new Set,T=!1;if(e.forEach(_=>{let A=r.routes[_.route.id];!A||!A.hasLoader||(!d.some(C=>C.route.id===_.route.id)&&_.route.id in c&&a[_.route.id]?.shouldRevalidate||A.hasClientLoader?T=!0:b.add(_.route.id))}),b.size===0)return[];let E=mw(n,l,"data");return T&&b.size>0&&E.searchParams.set("_routes",e.filter(_=>b.has(_.route.id)).map(_=>_.route.id).join(",")),[E.pathname+E.search]},[l,c,s,r,d,e,n,a]),y=R.useMemo(()=>xw(h,r),[h,r]),v=_w(h);return R.createElement(R.Fragment,null,g.map(b=>R.createElement("link",{key:b,rel:"prefetch",as:"fetch",href:b,...t})),y.map(b=>R.createElement("link",{key:b,rel:"modulepreload",href:b,...t})),v.map(({key:b,link:T})=>R.createElement("link",{key:b,nonce:t.nonce,...T})))}function Lw(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var PE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{PE&&(window.__reactRouterVersion="7.9.1")}catch{}function ww({basename:n,children:e,window:t}){let s=R.useRef();s.current==null&&(s.current=yL({window:t,v5Compat:!0}));let r=s.current,[a,l]=R.useState({action:r.action,location:r.location}),c=R.useCallback(f=>{R.startTransition(()=>l(f))},[l]);return R.useLayoutEffect(()=>r.listen(c),[r,c]),R.createElement(rw,{basename:n,children:e,location:a.location,navigationType:a.action,navigator:r})}var OE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ME=R.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:r,reloadDocument:a,replace:l,state:c,target:f,to:d,preventScrollReset:h,viewTransition:g,...y},v){let{basename:b}=R.useContext(Xn),T=typeof d=="string"&&OE.test(d),E,_=!1;if(typeof d=="string"&&T&&(E=d,PE))try{let K=new URL(window.location.href),V=d.startsWith("//")?new URL(K.protocol+d):new URL(d),$=$i(V.pathname,b);V.origin===K.origin&&$!=null?d=$+V.search+V.hash:_=!0}catch{qn(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let A=HL(d,{relative:r}),[C,N,w]=Tw(s,y),G=Nw(d,{replace:l,state:c,target:f,preventScrollReset:h,relative:r,viewTransition:g});function M(K){e&&e(K),K.defaultPrevented||G(K)}let B=R.createElement("a",{...y,...w,href:E||A,onClick:_||a?e:M,ref:Lw(v,N),target:f,"data-discover":!T&&t==="render"?"true":void 0});return C&&!T?R.createElement(R.Fragment,null,B,R.createElement(Aw,{page:A})):B});ME.displayName="Link";var Rw=R.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:r=!1,style:a,to:l,viewTransition:c,children:f,...d},h){let g=ql(l,{relative:d.relative}),y=kn(),v=R.useContext(hd),{navigator:b,basename:T}=R.useContext(Xn),E=v!=null&&jw(g)&&c===!0,_=b.encodeLocation?b.encodeLocation(g).pathname:g.pathname,A=y.pathname,C=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;t||(A=A.toLowerCase(),C=C?C.toLowerCase():null,_=_.toLowerCase()),C&&T&&(C=$i(C,T)||C);const N=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let w=A===_||!r&&A.startsWith(_)&&A.charAt(N)==="/",G=C!=null&&(C===_||!r&&C.startsWith(_)&&C.charAt(_.length)==="/"),M={isActive:w,isPending:G,isTransitioning:E},B=w?e:void 0,K;typeof s=="function"?K=s(M):K=[s,w?"active":null,G?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let V=typeof a=="function"?a(M):a;return R.createElement(ME,{...d,"aria-current":B,className:K,ref:h,style:V,to:l,viewTransition:c},typeof f=="function"?f(M):f)});Rw.displayName="NavLink";var Dw=R.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:r,state:a,method:l=Iu,action:c,onSubmit:f,relative:d,preventScrollReset:h,viewTransition:g,...y},v)=>{let b=Ow(),T=Mw(c,{relative:d}),E=l.toLowerCase()==="get"?"get":"post",_=typeof c=="string"&&OE.test(c),A=C=>{if(f&&f(C),C.defaultPrevented)return;C.preventDefault();let N=C.nativeEvent.submitter,w=N?.getAttribute("formmethod")||l;b(N||C.currentTarget,{fetcherKey:e,method:w,navigate:t,replace:r,state:a,relative:d,preventScrollReset:h,viewTransition:g})};return R.createElement("form",{ref:v,method:E,action:T,onSubmit:s?f:A,...y,"data-discover":!_&&n==="render"?"true":void 0})});Dw.displayName="Form";function Iw(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function jE(n){let e=R.useContext(mo);return Xt(e,Iw(n)),e}function Nw(n,{target:e,replace:t,state:s,preventScrollReset:r,relative:a,viewTransition:l}={}){let c=wr(),f=kn(),d=ql(n,{relative:a});return R.useCallback(h=>{if(uw(h,e)){h.preventDefault();let g=t!==void 0?t:Il(f)===Il(d);c(n,{replace:g,state:s,preventScrollReset:r,relative:a,viewTransition:l})}},[f,c,d,t,s,e,n,r,a,l])}var kw=0,Pw=()=>`__${String(++kw)}__`;function Ow(){let{router:n}=jE("useSubmit"),{basename:e}=R.useContext(Xn),t=tw();return R.useCallback(async(s,r={})=>{let{action:a,method:l,encType:c,formData:f,body:d}=hw(s,e);if(r.navigate===!1){let h=r.fetcherKey||Pw();await n.fetch(h,t,r.action||a,{preventScrollReset:r.preventScrollReset,formData:f,body:d,formMethod:r.method||l,formEncType:r.encType||c,flushSync:r.flushSync})}else await n.navigate(r.action||a,{preventScrollReset:r.preventScrollReset,formData:f,body:d,formMethod:r.method||l,formEncType:r.encType||c,replace:r.replace,state:r.state,fromRouteId:t,flushSync:r.flushSync,viewTransition:r.viewTransition})},[n,e,t])}function Mw(n,{relative:e}={}){let{basename:t}=R.useContext(Xn),s=R.useContext(yi);Xt(s,"useFormAction must be used inside a RouteContext");let[r]=s.matches.slice(-1),a={...ql(n||".",{relative:e})},l=kn();if(n==null){a.search=l.search;let c=new URLSearchParams(a.search),f=c.getAll("index");if(f.some(h=>h==="")){c.delete("index"),f.filter(g=>g).forEach(g=>c.append("index",g));let h=c.toString();a.search=h?`?${h}`:""}}return(!n||n===".")&&r.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(a.pathname=a.pathname==="/"?t:Bi([t,a.pathname])),Il(a)}function jw(n,{relative:e}={}){let t=R.useContext(LE);Xt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=jE("useViewTransitionState"),r=ql(n,{relative:e});if(!t.isTransitioning)return!1;let a=$i(t.currentLocation.pathname,s)||t.currentLocation.pathname,l=$i(t.nextLocation.pathname,s)||t.nextLocation.pathname;return zu(r.pathname,l)!=null||zu(r.pathname,a)!=null}var Ng=EE(),UE={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Av=ht.createContext&&ht.createContext(UE),Uw=["attr","size","title"];function Fw(n,e){if(n==null)return{};var t=Bw(n,e),s,r;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);for(r=0;r<a.length;r++)s=a[r],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(n,s)&&(t[s]=n[s])}return t}function Bw(n,e){if(n==null)return{};var t={};for(var s in n)if(Object.prototype.hasOwnProperty.call(n,s)){if(e.indexOf(s)>=0)continue;t[s]=n[s]}return t}function Yu(){return Yu=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},Yu.apply(this,arguments)}function _v(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,s)}return t}function qu(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_v(Object(t),!0).forEach(function(s){$w(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):_v(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function $w(n,e,t){return e=Vw(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Vw(n){var e=Gw(n,"string");return typeof e=="symbol"?e:e+""}function Gw(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function FE(n){return n&&n.map((e,t)=>ht.createElement(e.tag,qu({key:t},e.attr),FE(e.child)))}function Ki(n){return e=>ht.createElement(Hw,Yu({attr:qu({},n.attr)},e),FE(n.child))}function Hw(n){var e=t=>{var{attr:s,size:r,title:a}=n,l=Fw(n,Uw),c=r||t.size||"1em",f;return t.className&&(f=t.className),n.className&&(f=(f?f+" ":"")+n.className),ht.createElement("svg",Yu({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,s,l,{className:f,style:qu(qu({color:n.color||t.color},t.style),n.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),a&&ht.createElement("title",null,a),n.children)};return Av!==void 0?ht.createElement(Av.Consumer,null,t=>e(t)):e(UE)}function Dm(n){return Ki({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"},child:[]},{tag:"line",attr:{x1:"1",y1:"1",x2:"23",y2:"23"},child:[]}]})(n)}function Im(n){return Ki({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},child:[]},{tag:"circle",attr:{cx:"12",cy:"12",r:"3"},child:[]}]})(n)}const kg=R.createContext({});function Pg(n){const e=R.useRef(null);return e.current===null&&(e.current=n()),e.current}const Og=typeof window<"u",BE=Og?R.useLayoutEffect:R.useEffect,gd=R.createContext(null);function Mg(n,e){n.indexOf(e)===-1&&n.push(e)}function jg(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const Vi=(n,e,t)=>t>e?e:t<n?n:t;let Ug=()=>{};const Gi={},$E=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function VE(n){return typeof n=="object"&&n!==null}const GE=n=>/^0[^.\s]+$/u.test(n);function Fg(n){let e;return()=>(e===void 0&&(e=n()),e)}const In=n=>n,Kw=(n,e)=>t=>e(n(t)),Xl=(...n)=>n.reduce(Kw),Nl=(n,e,t)=>{const s=e-n;return s===0?1:(t-n)/s};class Bg{constructor(){this.subscriptions=[]}add(e){return Mg(this.subscriptions,e),()=>jg(this.subscriptions,e)}notify(e,t,s){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,t,s);else for(let a=0;a<r;a++){const l=this.subscriptions[a];l&&l(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const fi=n=>n*1e3,hi=n=>n/1e3;function HE(n,e){return e?n*(1e3/e):0}const KE=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,zw=1e-7,Yw=12;function qw(n,e,t,s,r){let a,l,c=0;do l=e+(t-e)/2,a=KE(l,s,r)-n,a>0?t=l:e=l;while(Math.abs(a)>zw&&++c<Yw);return l}function Wl(n,e,t,s){if(n===e&&t===s)return In;const r=a=>qw(a,0,1,n,t);return a=>a===0||a===1?a:KE(r(a),e,s)}const zE=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,YE=n=>e=>1-n(1-e),qE=Wl(.33,1.53,.69,.99),$g=YE(qE),XE=zE($g),WE=n=>(n*=2)<1?.5*$g(n):.5*(2-Math.pow(2,-10*(n-1))),Vg=n=>1-Math.sin(Math.acos(n)),QE=YE(Vg),ZE=zE(Vg),Xw=Wl(.42,0,1,1),Ww=Wl(0,0,.58,1),JE=Wl(.42,0,.58,1),Qw=n=>Array.isArray(n)&&typeof n[0]!="number",eT=n=>Array.isArray(n)&&typeof n[0]=="number",Zw={linear:In,easeIn:Xw,easeInOut:JE,easeOut:Ww,circIn:Vg,circInOut:ZE,circOut:QE,backIn:$g,backInOut:XE,backOut:qE,anticipate:WE},Jw=n=>typeof n=="string",Cv=n=>{if(eT(n)){Ug(n.length===4);const[e,t,s,r]=n;return Wl(e,t,s,r)}else if(Jw(n))return Zw[n];return n},cu=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function eR(n,e){let t=new Set,s=new Set,r=!1,a=!1;const l=new WeakSet;let c={delta:0,timestamp:0,isProcessing:!1};function f(h){l.has(h)&&(d.schedule(h),n()),h(c)}const d={schedule:(h,g=!1,y=!1)=>{const b=y&&r?t:s;return g&&l.add(h),b.has(h)||b.add(h),h},cancel:h=>{s.delete(h),l.delete(h)},process:h=>{if(c=h,r){a=!0;return}r=!0,[t,s]=[s,t],t.forEach(f),t.clear(),r=!1,a&&(a=!1,d.process(h))}};return d}const tR=40;function tT(n,e){let t=!1,s=!0;const r={delta:0,timestamp:0,isProcessing:!1},a=()=>t=!0,l=cu.reduce((C,N)=>(C[N]=eR(a),C),{}),{setup:c,read:f,resolveKeyframes:d,preUpdate:h,update:g,preRender:y,render:v,postRender:b}=l,T=()=>{const C=Gi.useManualTiming?r.timestamp:performance.now();t=!1,Gi.useManualTiming||(r.delta=s?1e3/60:Math.max(Math.min(C-r.timestamp,tR),1)),r.timestamp=C,r.isProcessing=!0,c.process(r),f.process(r),d.process(r),h.process(r),g.process(r),y.process(r),v.process(r),b.process(r),r.isProcessing=!1,t&&e&&(s=!1,n(T))},E=()=>{t=!0,s=!0,r.isProcessing||n(T)};return{schedule:cu.reduce((C,N)=>{const w=l[N];return C[N]=(G,M=!1,B=!1)=>(t||E(),w.schedule(G,M,B)),C},{}),cancel:C=>{for(let N=0;N<cu.length;N++)l[cu[N]].cancel(C)},state:r,steps:l}}const{schedule:qt,cancel:Tr,state:Ns,steps:Ph}=tT(typeof requestAnimationFrame<"u"?requestAnimationFrame:In,!0);let ku;function sR(){ku=void 0}const sn={now:()=>(ku===void 0&&sn.set(Ns.isProcessing||Gi.useManualTiming?Ns.timestamp:performance.now()),ku),set:n=>{ku=n,queueMicrotask(sR)}},sT=n=>e=>typeof e=="string"&&e.startsWith(n),Gg=sT("--"),nR=sT("var(--"),Hg=n=>nR(n)?iR.test(n.split("/*")[0].trim()):!1,iR=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,po={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},kl={...po,transform:n=>Vi(0,1,n)},uu={...po,default:1},El=n=>Math.round(n*1e5)/1e5,Kg=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function rR(n){return n==null}const aR=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,zg=(n,e)=>t=>!!(typeof t=="string"&&aR.test(t)&&t.startsWith(n)||e&&!rR(t)&&Object.prototype.hasOwnProperty.call(t,e)),nT=(n,e,t)=>s=>{if(typeof s!="string")return s;const[r,a,l,c]=s.match(Kg);return{[n]:parseFloat(r),[e]:parseFloat(a),[t]:parseFloat(l),alpha:c!==void 0?parseFloat(c):1}},oR=n=>Vi(0,255,n),Oh={...po,transform:n=>Math.round(oR(n))},ta={test:zg("rgb","red"),parse:nT("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:s=1})=>"rgba("+Oh.transform(n)+", "+Oh.transform(e)+", "+Oh.transform(t)+", "+El(kl.transform(s))+")"};function lR(n){let e="",t="",s="",r="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),s=n.substring(5,7),r=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),s=n.substring(3,4),r=n.substring(4,5),e+=e,t+=t,s+=s,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(s,16),alpha:r?parseInt(r,16)/255:1}}const Nm={test:zg("#"),parse:lR,transform:ta.transform},Ql=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),vr=Ql("deg"),mi=Ql("%"),rt=Ql("px"),cR=Ql("vh"),uR=Ql("vw"),Lv={...mi,parse:n=>mi.parse(n)/100,transform:n=>mi.transform(n*100)},Qa={test:zg("hsl","hue"),parse:nT("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:s=1})=>"hsla("+Math.round(n)+", "+mi.transform(El(e))+", "+mi.transform(El(t))+", "+El(kl.transform(s))+")"},ms={test:n=>ta.test(n)||Nm.test(n)||Qa.test(n),parse:n=>ta.test(n)?ta.parse(n):Qa.test(n)?Qa.parse(n):Nm.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?ta.transform(n):Qa.transform(n),getAnimatableNone:n=>{const e=ms.parse(n);return e.alpha=0,ms.transform(e)}},dR=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function fR(n){return isNaN(n)&&typeof n=="string"&&(n.match(Kg)?.length||0)+(n.match(dR)?.length||0)>0}const iT="number",rT="color",hR="var",mR="var(",wv="${}",gR=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Pl(n){const e=n.toString(),t=[],s={color:[],number:[],var:[]},r=[];let a=0;const c=e.replace(gR,f=>(ms.test(f)?(s.color.push(a),r.push(rT),t.push(ms.parse(f))):f.startsWith(mR)?(s.var.push(a),r.push(hR),t.push(f)):(s.number.push(a),r.push(iT),t.push(parseFloat(f))),++a,wv)).split(wv);return{values:t,split:c,indexes:s,types:r}}function aT(n){return Pl(n).values}function oT(n){const{split:e,types:t}=Pl(n),s=e.length;return r=>{let a="";for(let l=0;l<s;l++)if(a+=e[l],r[l]!==void 0){const c=t[l];c===iT?a+=El(r[l]):c===rT?a+=ms.transform(r[l]):a+=r[l]}return a}}const pR=n=>typeof n=="number"?0:ms.test(n)?ms.getAnimatableNone(n):n;function yR(n){const e=aT(n);return oT(n)(e.map(pR))}const Ar={test:fR,parse:aT,createTransformer:oT,getAnimatableNone:yR};function Mh(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function xR({hue:n,saturation:e,lightness:t,alpha:s}){n/=360,e/=100,t/=100;let r=0,a=0,l=0;if(!e)r=a=l=t;else{const c=t<.5?t*(1+e):t+e-t*e,f=2*t-c;r=Mh(f,c,n+1/3),a=Mh(f,c,n),l=Mh(f,c,n-1/3)}return{red:Math.round(r*255),green:Math.round(a*255),blue:Math.round(l*255),alpha:s}}function Xu(n,e){return t=>t>0?e:n}const es=(n,e,t)=>n+(e-n)*t,jh=(n,e,t)=>{const s=n*n,r=t*(e*e-s)+s;return r<0?0:Math.sqrt(r)},vR=[Nm,ta,Qa],bR=n=>vR.find(e=>e.test(n));function Rv(n){const e=bR(n);if(!e)return!1;let t=e.parse(n);return e===Qa&&(t=xR(t)),t}const Dv=(n,e)=>{const t=Rv(n),s=Rv(e);if(!t||!s)return Xu(n,e);const r={...t};return a=>(r.red=jh(t.red,s.red,a),r.green=jh(t.green,s.green,a),r.blue=jh(t.blue,s.blue,a),r.alpha=es(t.alpha,s.alpha,a),ta.transform(r))},km=new Set(["none","hidden"]);function SR(n,e){return km.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function ER(n,e){return t=>es(n,e,t)}function Yg(n){return typeof n=="number"?ER:typeof n=="string"?Hg(n)?Xu:ms.test(n)?Dv:_R:Array.isArray(n)?lT:typeof n=="object"?ms.test(n)?Dv:TR:Xu}function lT(n,e){const t=[...n],s=t.length,r=n.map((a,l)=>Yg(a)(a,e[l]));return a=>{for(let l=0;l<s;l++)t[l]=r[l](a);return t}}function TR(n,e){const t={...n,...e},s={};for(const r in t)n[r]!==void 0&&e[r]!==void 0&&(s[r]=Yg(n[r])(n[r],e[r]));return r=>{for(const a in s)t[a]=s[a](r);return t}}function AR(n,e){const t=[],s={color:0,var:0,number:0};for(let r=0;r<e.values.length;r++){const a=e.types[r],l=n.indexes[a][s[a]],c=n.values[l]??0;t[r]=c,s[a]++}return t}const _R=(n,e)=>{const t=Ar.createTransformer(e),s=Pl(n),r=Pl(e);return s.indexes.var.length===r.indexes.var.length&&s.indexes.color.length===r.indexes.color.length&&s.indexes.number.length>=r.indexes.number.length?km.has(n)&&!r.values.length||km.has(e)&&!s.values.length?SR(n,e):Xl(lT(AR(s,r),r.values),t):Xu(n,e)};function cT(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?es(n,e,t):Yg(n)(n,e)}const CR=n=>{const e=({timestamp:t})=>n(t);return{start:(t=!0)=>qt.update(e,t),stop:()=>Tr(e),now:()=>Ns.isProcessing?Ns.timestamp:sn.now()}},uT=(n,e,t=10)=>{let s="";const r=Math.max(Math.round(e/t),2);for(let a=0;a<r;a++)s+=Math.round(n(a/(r-1))*1e4)/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},Wu=2e4;function qg(n){let e=0;const t=50;let s=n.next(e);for(;!s.done&&e<Wu;)e+=t,s=n.next(e);return e>=Wu?1/0:e}function LR(n,e=100,t){const s=t({...n,keyframes:[0,e]}),r=Math.min(qg(s),Wu);return{type:"keyframes",ease:a=>s.next(r*a).value/e,duration:hi(r)}}const wR=5;function dT(n,e,t){const s=Math.max(e-wR,0);return HE(t-n(s),e-s)}const rs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Uh=.001;function RR({duration:n=rs.duration,bounce:e=rs.bounce,velocity:t=rs.velocity,mass:s=rs.mass}){let r,a,l=1-e;l=Vi(rs.minDamping,rs.maxDamping,l),n=Vi(rs.minDuration,rs.maxDuration,hi(n)),l<1?(r=d=>{const h=d*l,g=h*n,y=h-t,v=Pm(d,l),b=Math.exp(-g);return Uh-y/v*b},a=d=>{const g=d*l*n,y=g*t+t,v=Math.pow(l,2)*Math.pow(d,2)*n,b=Math.exp(-g),T=Pm(Math.pow(d,2),l);return(-r(d)+Uh>0?-1:1)*((y-v)*b)/T}):(r=d=>{const h=Math.exp(-d*n),g=(d-t)*n+1;return-Uh+h*g},a=d=>{const h=Math.exp(-d*n),g=(t-d)*(n*n);return h*g});const c=5/n,f=IR(r,a,c);if(n=fi(n),isNaN(f))return{stiffness:rs.stiffness,damping:rs.damping,duration:n};{const d=Math.pow(f,2)*s;return{stiffness:d,damping:l*2*Math.sqrt(s*d),duration:n}}}const DR=12;function IR(n,e,t){let s=t;for(let r=1;r<DR;r++)s=s-n(s)/e(s);return s}function Pm(n,e){return n*Math.sqrt(1-e*e)}const NR=["duration","bounce"],kR=["stiffness","damping","mass"];function Iv(n,e){return e.some(t=>n[t]!==void 0)}function PR(n){let e={velocity:rs.velocity,stiffness:rs.stiffness,damping:rs.damping,mass:rs.mass,isResolvedFromDuration:!1,...n};if(!Iv(n,kR)&&Iv(n,NR))if(n.visualDuration){const t=n.visualDuration,s=2*Math.PI/(t*1.2),r=s*s,a=2*Vi(.05,1,1-(n.bounce||0))*Math.sqrt(r);e={...e,mass:rs.mass,stiffness:r,damping:a}}else{const t=RR(n);e={...e,...t,mass:rs.mass},e.isResolvedFromDuration=!0}return e}function Qu(n=rs.visualDuration,e=rs.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:s,restDelta:r}=t;const a=t.keyframes[0],l=t.keyframes[t.keyframes.length-1],c={done:!1,value:a},{stiffness:f,damping:d,mass:h,duration:g,velocity:y,isResolvedFromDuration:v}=PR({...t,velocity:-hi(t.velocity||0)}),b=y||0,T=d/(2*Math.sqrt(f*h)),E=l-a,_=hi(Math.sqrt(f/h)),A=Math.abs(E)<5;s||(s=A?rs.restSpeed.granular:rs.restSpeed.default),r||(r=A?rs.restDelta.granular:rs.restDelta.default);let C;if(T<1){const w=Pm(_,T);C=G=>{const M=Math.exp(-T*_*G);return l-M*((b+T*_*E)/w*Math.sin(w*G)+E*Math.cos(w*G))}}else if(T===1)C=w=>l-Math.exp(-_*w)*(E+(b+_*E)*w);else{const w=_*Math.sqrt(T*T-1);C=G=>{const M=Math.exp(-T*_*G),B=Math.min(w*G,300);return l-M*((b+T*_*E)*Math.sinh(B)+w*E*Math.cosh(B))/w}}const N={calculatedDuration:v&&g||null,next:w=>{const G=C(w);if(v)c.done=w>=g;else{let M=w===0?b:0;T<1&&(M=w===0?fi(b):dT(C,w,G));const B=Math.abs(M)<=s,K=Math.abs(l-G)<=r;c.done=B&&K}return c.value=c.done?l:G,c},toString:()=>{const w=Math.min(qg(N),Wu),G=uT(M=>N.next(w*M).value,w,30);return w+"ms "+G},toTransition:()=>{}};return N}Qu.applyToOptions=n=>{const e=LR(n,100,Qu);return n.ease=e.ease,n.duration=fi(e.duration),n.type="keyframes",n};function Om({keyframes:n,velocity:e=0,power:t=.8,timeConstant:s=325,bounceDamping:r=10,bounceStiffness:a=500,modifyTarget:l,min:c,max:f,restDelta:d=.5,restSpeed:h}){const g=n[0],y={done:!1,value:g},v=B=>c!==void 0&&B<c||f!==void 0&&B>f,b=B=>c===void 0?f:f===void 0||Math.abs(c-B)<Math.abs(f-B)?c:f;let T=t*e;const E=g+T,_=l===void 0?E:l(E);_!==E&&(T=_-g);const A=B=>-T*Math.exp(-B/s),C=B=>_+A(B),N=B=>{const K=A(B),V=C(B);y.done=Math.abs(K)<=d,y.value=y.done?_:V};let w,G;const M=B=>{v(y.value)&&(w=B,G=Qu({keyframes:[y.value,b(y.value)],velocity:dT(C,B,y.value),damping:r,stiffness:a,restDelta:d,restSpeed:h}))};return M(0),{calculatedDuration:null,next:B=>{let K=!1;return!G&&w===void 0&&(K=!0,N(B),M(B)),w!==void 0&&B>=w?G.next(B-w):(!K&&N(B),y)}}}function OR(n,e,t){const s=[],r=t||Gi.mix||cT,a=n.length-1;for(let l=0;l<a;l++){let c=r(n[l],n[l+1]);if(e){const f=Array.isArray(e)?e[l]||In:e;c=Xl(f,c)}s.push(c)}return s}function MR(n,e,{clamp:t=!0,ease:s,mixer:r}={}){const a=n.length;if(Ug(a===e.length),a===1)return()=>e[0];if(a===2&&e[0]===e[1])return()=>e[1];const l=n[0]===n[1];n[0]>n[a-1]&&(n=[...n].reverse(),e=[...e].reverse());const c=OR(e,s,r),f=c.length,d=h=>{if(l&&h<n[0])return e[0];let g=0;if(f>1)for(;g<n.length-2&&!(h<n[g+1]);g++);const y=Nl(n[g],n[g+1],h);return c[g](y)};return t?h=>d(Vi(n[0],n[a-1],h)):d}function jR(n,e){const t=n[n.length-1];for(let s=1;s<=e;s++){const r=Nl(0,e,s);n.push(es(t,1,r))}}function UR(n){const e=[0];return jR(e,n.length-1),e}function FR(n,e){return n.map(t=>t*e)}function BR(n,e){return n.map(()=>e||JE).splice(0,n.length-1)}function Tl({duration:n=300,keyframes:e,times:t,ease:s="easeInOut"}){const r=Qw(s)?s.map(Cv):Cv(s),a={done:!1,value:e[0]},l=FR(t&&t.length===e.length?t:UR(e),n),c=MR(l,e,{ease:Array.isArray(r)?r:BR(e,r)});return{calculatedDuration:n,next:f=>(a.value=c(f),a.done=f>=n,a)}}const $R=n=>n!==null;function Xg(n,{repeat:e,repeatType:t="loop"},s,r=1){const a=n.filter($R),c=r<0||e&&t!=="loop"&&e%2===1?0:a.length-1;return!c||s===void 0?a[c]:s}const VR={decay:Om,inertia:Om,tween:Tl,keyframes:Tl,spring:Qu};function fT(n){typeof n.type=="string"&&(n.type=VR[n.type])}class Wg{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const GR=n=>n/100;class Qg extends Wg{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==sn.now()&&this.tick(sn.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;fT(e);const{type:t=Tl,repeat:s=0,repeatDelay:r=0,repeatType:a,velocity:l=0}=e;let{keyframes:c}=e;const f=t||Tl;f!==Tl&&typeof c[0]!="number"&&(this.mixKeyframes=Xl(GR,cT(c[0],c[1])),c=[0,100]);const d=f({...e,keyframes:c});a==="mirror"&&(this.mirroredGenerator=f({...e,keyframes:[...c].reverse(),velocity:-l})),d.calculatedDuration===null&&(d.calculatedDuration=qg(d));const{calculatedDuration:h}=d;this.calculatedDuration=h,this.resolvedDuration=h+r,this.totalDuration=this.resolvedDuration*(s+1)-r,this.generator=d}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:s,totalDuration:r,mixKeyframes:a,mirroredGenerator:l,resolvedDuration:c,calculatedDuration:f}=this;if(this.startTime===null)return s.next(0);const{delay:d=0,keyframes:h,repeat:g,repeatType:y,repeatDelay:v,type:b,onUpdate:T,finalKeyframe:E}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const _=this.currentTime-d*(this.playbackSpeed>=0?1:-1),A=this.playbackSpeed>=0?_<0:_>r;this.currentTime=Math.max(_,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let C=this.currentTime,N=s;if(g){const B=Math.min(this.currentTime,r)/c;let K=Math.floor(B),V=B%1;!V&&B>=1&&(V=1),V===1&&K--,K=Math.min(K,g+1),!!(K%2)&&(y==="reverse"?(V=1-V,v&&(V-=v/c)):y==="mirror"&&(N=l)),C=Vi(0,1,V)*c}const w=A?{done:!1,value:h[0]}:N.next(C);a&&(w.value=a(w.value));let{done:G}=w;!A&&f!==null&&(G=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const M=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&G);return M&&b!==Om&&(w.value=Xg(h,this.options,E,this.speed)),T&&T(w.value),M&&this.finish(),w}then(e,t){return this.finished.then(e,t)}get duration(){return hi(this.calculatedDuration)}get time(){return hi(this.currentTime)}set time(e){e=fi(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(sn.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=hi(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=CR,startTime:t}=this.options;this.driver||(this.driver=e(r=>this.tick(r))),this.options.onPlay?.();const s=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=s):this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime||(this.startTime=t??s),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(sn.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function HR(n){for(let e=1;e<n.length;e++)n[e]??(n[e]=n[e-1])}const sa=n=>n*180/Math.PI,Mm=n=>{const e=sa(Math.atan2(n[1],n[0]));return jm(e)},KR={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:Mm,rotateZ:Mm,skewX:n=>sa(Math.atan(n[1])),skewY:n=>sa(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},jm=n=>(n=n%360,n<0&&(n+=360),n),Nv=Mm,kv=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),Pv=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),zR={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:kv,scaleY:Pv,scale:n=>(kv(n)+Pv(n))/2,rotateX:n=>jm(sa(Math.atan2(n[6],n[5]))),rotateY:n=>jm(sa(Math.atan2(-n[2],n[0]))),rotateZ:Nv,rotate:Nv,skewX:n=>sa(Math.atan(n[4])),skewY:n=>sa(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function Um(n){return n.includes("scale")?1:0}function Fm(n,e){if(!n||n==="none")return Um(e);const t=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,r;if(t)s=zR,r=t;else{const c=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=KR,r=c}if(!r)return Um(e);const a=s[e],l=r[1].split(",").map(qR);return typeof a=="function"?a(l):l[a]}const YR=(n,e)=>{const{transform:t="none"}=getComputedStyle(n);return Fm(t,e)};function qR(n){return parseFloat(n.trim())}const yo=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],xo=new Set(yo),Ov=n=>n===po||n===rt,XR=new Set(["x","y","z"]),WR=yo.filter(n=>!XR.has(n));function QR(n){const e=[];return WR.forEach(t=>{const s=n.getValue(t);s!==void 0&&(e.push([t,s.get()]),s.set(t.startsWith("scale")?1:0))}),e}const na={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:(n,{transform:e})=>Fm(e,"x"),y:(n,{transform:e})=>Fm(e,"y")};na.translateX=na.x;na.translateY=na.y;const ia=new Set;let Bm=!1,$m=!1,Vm=!1;function hT(){if($m){const n=Array.from(ia).filter(s=>s.needsMeasurement),e=new Set(n.map(s=>s.element)),t=new Map;e.forEach(s=>{const r=QR(s);r.length&&(t.set(s,r),s.render())}),n.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const r=t.get(s);r&&r.forEach(([a,l])=>{s.getValue(a)?.set(l)})}),n.forEach(s=>s.measureEndState()),n.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}$m=!1,Bm=!1,ia.forEach(n=>n.complete(Vm)),ia.clear()}function mT(){ia.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&($m=!0)})}function ZR(){Vm=!0,mT(),hT(),Vm=!1}class Zg{constructor(e,t,s,r,a,l=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=r,this.element=a,this.isAsync=l}scheduleResolve(){this.state="scheduled",this.isAsync?(ia.add(this),Bm||(Bm=!0,qt.read(mT),qt.resolveKeyframes(hT))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:r}=this;if(e[0]===null){const a=r?.get(),l=e[e.length-1];if(a!==void 0)e[0]=a;else if(s&&t){const c=s.readValue(t,l);c!=null&&(e[0]=c)}e[0]===void 0&&(e[0]=l),r&&a===void 0&&r.set(e[0])}HR(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),ia.delete(this)}cancel(){this.state==="scheduled"&&(ia.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const JR=n=>n.startsWith("--");function eD(n,e,t){JR(e)?n.style.setProperty(e,t):n.style[e]=t}const tD=Fg(()=>window.ScrollTimeline!==void 0),sD={};function nD(n,e){const t=Fg(n);return()=>sD[e]??t()}const gT=nD(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),bl=([n,e,t,s])=>`cubic-bezier(${n}, ${e}, ${t}, ${s})`,Mv={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:bl([0,.65,.55,1]),circOut:bl([.55,0,1,.45]),backIn:bl([.31,.01,.66,-.59]),backOut:bl([.33,1.53,.69,.99])};function pT(n,e){if(n)return typeof n=="function"?gT()?uT(n,e):"ease-out":eT(n)?bl(n):Array.isArray(n)?n.map(t=>pT(t,e)||Mv.easeOut):Mv[n]}function iD(n,e,t,{delay:s=0,duration:r=300,repeat:a=0,repeatType:l="loop",ease:c="easeOut",times:f}={},d=void 0){const h={[e]:t};f&&(h.offset=f);const g=pT(c,r);Array.isArray(g)&&(h.easing=g);const y={delay:s,duration:r,easing:Array.isArray(g)?"linear":g,fill:"both",iterations:a+1,direction:l==="reverse"?"alternate":"normal"};return d&&(y.pseudoElement=d),n.animate(h,y)}function yT(n){return typeof n=="function"&&"applyToOptions"in n}function rD({type:n,...e}){return yT(n)&&gT()?n.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class aD extends Wg{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:s,keyframes:r,pseudoElement:a,allowFlatten:l=!1,finalKeyframe:c,onComplete:f}=e;this.isPseudoElement=!!a,this.allowFlatten=l,this.options=e,Ug(typeof e.type!="string");const d=rD(e);this.animation=iD(t,s,r,d,a),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!a){const h=Xg(r,this.options,c,this.speed);this.updateMotionValue?this.updateMotionValue(h):eD(t,s,h),this.animation.cancel()}f?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return hi(Number(e))}get time(){return hi(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=fi(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&tD()?(this.animation.timeline=e,In):t(this)}}const xT={anticipate:WE,backInOut:XE,circInOut:ZE};function oD(n){return n in xT}function lD(n){typeof n.ease=="string"&&oD(n.ease)&&(n.ease=xT[n.ease])}const jv=10;class cD extends aD{constructor(e){lD(e),fT(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:s,onComplete:r,element:a,...l}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const c=new Qg({...l,autoplay:!1}),f=fi(this.finishedTime??this.time);t.setWithVelocity(c.sample(f-jv).value,c.sample(f).value,jv),c.stop()}}const Uv=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Ar.test(n)||n==="0")&&!n.startsWith("url("));function uD(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function dD(n,e,t,s){const r=n[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const a=n[n.length-1],l=Uv(r,e),c=Uv(a,e);return!l||!c?!1:uD(n)||(t==="spring"||yT(t))&&s}function Gm(n){n.duration=0,n.type}const fD=new Set(["opacity","clipPath","filter","transform"]),hD=Fg(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function mD(n){const{motionValue:e,name:t,repeatDelay:s,repeatType:r,damping:a,type:l}=n;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:f,transformTemplate:d}=e.owner.getProps();return hD()&&t&&fD.has(t)&&(t!=="transform"||!d)&&!f&&!s&&r!=="mirror"&&a!==0&&l!=="inertia"}const gD=40;class pD extends Wg{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:r=0,repeatDelay:a=0,repeatType:l="loop",keyframes:c,name:f,motionValue:d,element:h,...g}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=sn.now();const y={autoplay:e,delay:t,type:s,repeat:r,repeatDelay:a,repeatType:l,name:f,motionValue:d,element:h,...g},v=h?.KeyframeResolver||Zg;this.keyframeResolver=new v(c,(b,T,E)=>this.onKeyframesResolved(b,T,y,!E),f,d,h),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,s,r){this.keyframeResolver=void 0;const{name:a,type:l,velocity:c,delay:f,isHandoff:d,onUpdate:h}=s;this.resolvedAt=sn.now(),dD(e,a,l,c)||((Gi.instantAnimations||!f)&&h?.(Xg(e,s,t)),e[0]=e[e.length-1],Gm(s),s.repeat=0);const y={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>gD?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...s,keyframes:e},v=!d&&mD(y)?new cD({...y,element:y.motionValue.owner.current}):new Qg(y);v.finished.then(()=>this.notifyFinished()).catch(In),this.pendingTimeline&&(this.stopTimeline=v.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=v}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),ZR()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const yD=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function xD(n){const e=yD.exec(n);if(!e)return[,];const[,t,s,r]=e;return[`--${t??s}`,r]}function vT(n,e,t=1){const[s,r]=xD(n);if(!s)return;const a=window.getComputedStyle(e).getPropertyValue(s);if(a){const l=a.trim();return $E(l)?parseFloat(l):l}return Hg(r)?vT(r,e,t+1):r}function Jg(n,e){return n?.[e]??n?.default??n}const bT=new Set(["width","height","top","left","right","bottom",...yo]),vD={test:n=>n==="auto",parse:n=>n},ST=n=>e=>e.test(n),ET=[po,rt,mi,vr,uR,cR,vD],Fv=n=>ET.find(ST(n));function bD(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||GE(n):!0}const SD=new Set(["brightness","contrast","saturate","opacity"]);function ED(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[s]=t.match(Kg)||[];if(!s)return n;const r=t.replace(s,"");let a=SD.has(e)?1:0;return s!==t&&(a*=100),e+"("+a+r+")"}const TD=/\b([a-z-]*)\(.*?\)/gu,Hm={...Ar,getAnimatableNone:n=>{const e=n.match(TD);return e?e.map(ED).join(" "):n}},Bv={...po,transform:Math.round},AD={rotate:vr,rotateX:vr,rotateY:vr,rotateZ:vr,scale:uu,scaleX:uu,scaleY:uu,scaleZ:uu,skew:vr,skewX:vr,skewY:vr,distance:rt,translateX:rt,translateY:rt,translateZ:rt,x:rt,y:rt,z:rt,perspective:rt,transformPerspective:rt,opacity:kl,originX:Lv,originY:Lv,originZ:rt},ep={borderWidth:rt,borderTopWidth:rt,borderRightWidth:rt,borderBottomWidth:rt,borderLeftWidth:rt,borderRadius:rt,radius:rt,borderTopLeftRadius:rt,borderTopRightRadius:rt,borderBottomRightRadius:rt,borderBottomLeftRadius:rt,width:rt,maxWidth:rt,height:rt,maxHeight:rt,top:rt,right:rt,bottom:rt,left:rt,padding:rt,paddingTop:rt,paddingRight:rt,paddingBottom:rt,paddingLeft:rt,margin:rt,marginTop:rt,marginRight:rt,marginBottom:rt,marginLeft:rt,backgroundPositionX:rt,backgroundPositionY:rt,...AD,zIndex:Bv,fillOpacity:kl,strokeOpacity:kl,numOctaves:Bv},_D={...ep,color:ms,backgroundColor:ms,outlineColor:ms,fill:ms,stroke:ms,borderColor:ms,borderTopColor:ms,borderRightColor:ms,borderBottomColor:ms,borderLeftColor:ms,filter:Hm,WebkitFilter:Hm},TT=n=>_D[n];function AT(n,e){let t=TT(n);return t!==Hm&&(t=Ar),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const CD=new Set(["auto","none","0"]);function LD(n,e,t){let s=0,r;for(;s<n.length&&!r;){const a=n[s];typeof a=="string"&&!CD.has(a)&&Pl(a).values.length&&(r=n[s]),s++}if(r&&t)for(const a of e)n[a]=AT(t,r)}class wD extends Zg{constructor(e,t,s,r,a){super(e,t,s,r,a,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let f=0;f<e.length;f++){let d=e[f];if(typeof d=="string"&&(d=d.trim(),Hg(d))){const h=vT(d,t.current);h!==void 0&&(e[f]=h),f===e.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!bT.has(s)||e.length!==2)return;const[r,a]=e,l=Fv(r),c=Fv(a);if(l!==c)if(Ov(l)&&Ov(c))for(let f=0;f<e.length;f++){const d=e[f];typeof d=="string"&&(e[f]=parseFloat(d))}else na[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let r=0;r<e.length;r++)(e[r]===null||bD(e[r]))&&s.push(r);s.length&&LD(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=na[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];r!==void 0&&e.getValue(s,r).jump(r,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const r=e.getValue(t);r&&r.jump(this.measuredOrigin,!1);const a=s.length-1,l=s[a];s[a]=na[t](e.measureViewportBox(),window.getComputedStyle(e.current)),l!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=l),this.removedTransforms?.length&&this.removedTransforms.forEach(([c,f])=>{e.getValue(c).set(f)}),this.resolveNoneKeyframes()}}function RD(n,e,t){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let s=document;const r=t?.[n]??s.querySelectorAll(n);return r?Array.from(r):[]}return Array.from(n)}const _T=(n,e)=>e&&typeof n=="number"?e.transform(n):n;function CT(n){return VE(n)&&"offsetHeight"in n}const $v=30,DD=n=>!isNaN(parseFloat(n));class ID{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=s=>{const r=sn.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=sn.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=DD(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Bg);const s=this.events[e].add(t);return e==="change"?()=>{s(),qt.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=sn.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>$v)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,$v);return HE(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function lo(n,e){return new ID(n,e)}const{schedule:tp}=tT(queueMicrotask,!1),zn={x:!1,y:!1};function LT(){return zn.x||zn.y}function ND(n){return n==="x"||n==="y"?zn[n]?null:(zn[n]=!0,()=>{zn[n]=!1}):zn.x||zn.y?null:(zn.x=zn.y=!0,()=>{zn.x=zn.y=!1})}function wT(n,e){const t=RD(n),s=new AbortController,r={passive:!0,...e,signal:s.signal};return[t,r,()=>s.abort()]}function Vv(n){return!(n.pointerType==="touch"||LT())}function kD(n,e,t={}){const[s,r,a]=wT(n,t),l=c=>{if(!Vv(c))return;const{target:f}=c,d=e(f,c);if(typeof d!="function"||!f)return;const h=g=>{Vv(g)&&(d(g),f.removeEventListener("pointerleave",h))};f.addEventListener("pointerleave",h,r)};return s.forEach(c=>{c.addEventListener("pointerenter",l,r)}),a}const RT=(n,e)=>e?n===e?!0:RT(n,e.parentElement):!1,sp=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,PD=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function OD(n){return PD.has(n.tagName)||n.tabIndex!==-1}const Pu=new WeakSet;function Gv(n){return e=>{e.key==="Enter"&&n(e)}}function Fh(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const MD=(n,e)=>{const t=n.currentTarget;if(!t)return;const s=Gv(()=>{if(Pu.has(t))return;Fh(t,"down");const r=Gv(()=>{Fh(t,"up")}),a=()=>Fh(t,"cancel");t.addEventListener("keyup",r,e),t.addEventListener("blur",a,e)});t.addEventListener("keydown",s,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",s),e)};function Hv(n){return sp(n)&&!LT()}function jD(n,e,t={}){const[s,r,a]=wT(n,t),l=c=>{const f=c.currentTarget;if(!Hv(c))return;Pu.add(f);const d=e(f,c),h=(v,b)=>{window.removeEventListener("pointerup",g),window.removeEventListener("pointercancel",y),Pu.has(f)&&Pu.delete(f),Hv(v)&&typeof d=="function"&&d(v,{success:b})},g=v=>{h(v,f===window||f===document||t.useGlobalTarget||RT(f,v.target))},y=v=>{h(v,!1)};window.addEventListener("pointerup",g,r),window.addEventListener("pointercancel",y,r)};return s.forEach(c=>{(t.useGlobalTarget?window:c).addEventListener("pointerdown",l,r),CT(c)&&(c.addEventListener("focus",d=>MD(d,r)),!OD(c)&&!c.hasAttribute("tabindex")&&(c.tabIndex=0))}),a}function DT(n){return VE(n)&&"ownerSVGElement"in n}function UD(n){return DT(n)&&n.tagName==="svg"}const $s=n=>!!(n&&n.getVelocity),FD=[...ET,ms,Ar],BD=n=>FD.find(ST(n)),np=R.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class $D extends R.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const s=t.offsetParent,r=CT(s)&&s.offsetWidth||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=r-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function VD({children:n,isPresent:e,anchorX:t,root:s}){const r=R.useId(),a=R.useRef(null),l=R.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=R.useContext(np);return R.useInsertionEffect(()=>{const{width:f,height:d,top:h,left:g,right:y}=l.current;if(e||!a.current||!f||!d)return;const v=t==="left"?`left: ${g}`:`right: ${y}`;a.current.dataset.motionPopId=r;const b=document.createElement("style");c&&(b.nonce=c);const T=s??document.head;return T.appendChild(b),b.sheet&&b.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${d}px !important;
            ${v}px !important;
            top: ${h}px !important;
          }
        `),()=>{T.contains(b)&&T.removeChild(b)}},[e]),p.jsx($D,{isPresent:e,childRef:a,sizeRef:l,children:R.cloneElement(n,{ref:a})})}const GD=({children:n,initial:e,isPresent:t,onExitComplete:s,custom:r,presenceAffectsLayout:a,mode:l,anchorX:c,root:f})=>{const d=Pg(HD),h=R.useId();let g=!0,y=R.useMemo(()=>(g=!1,{id:h,initial:e,isPresent:t,custom:r,onExitComplete:v=>{d.set(v,!0);for(const b of d.values())if(!b)return;s&&s()},register:v=>(d.set(v,!1),()=>d.delete(v))}),[t,d,s]);return a&&g&&(y={...y}),R.useMemo(()=>{d.forEach((v,b)=>d.set(b,!1))},[t]),R.useEffect(()=>{!t&&!d.size&&s&&s()},[t]),l==="popLayout"&&(n=p.jsx(VD,{isPresent:t,anchorX:c,root:f,children:n})),p.jsx(gd.Provider,{value:y,children:n})};function HD(){return new Map}function IT(n=!0){const e=R.useContext(gd);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:s,register:r}=e,a=R.useId();R.useEffect(()=>{if(n)return r(a)},[n]);const l=R.useCallback(()=>n&&s&&s(a),[a,s,n]);return!t&&s?[!1,l]:[!0]}const du=n=>n.key||"";function Kv(n){const e=[];return R.Children.forEach(n,t=>{R.isValidElement(t)&&e.push(t)}),e}const KD=({children:n,custom:e,initial:t=!0,onExitComplete:s,presenceAffectsLayout:r=!0,mode:a="sync",propagate:l=!1,anchorX:c="left",root:f})=>{const[d,h]=IT(l),g=R.useMemo(()=>Kv(n),[n]),y=l&&!d?[]:g.map(du),v=R.useRef(!0),b=R.useRef(g),T=Pg(()=>new Map),[E,_]=R.useState(g),[A,C]=R.useState(g);BE(()=>{v.current=!1,b.current=g;for(let G=0;G<A.length;G++){const M=du(A[G]);y.includes(M)?T.delete(M):T.get(M)!==!0&&T.set(M,!1)}},[A,y.length,y.join("-")]);const N=[];if(g!==E){let G=[...g];for(let M=0;M<A.length;M++){const B=A[M],K=du(B);y.includes(K)||(G.splice(M,0,B),N.push(B))}return a==="wait"&&N.length&&(G=N),C(Kv(G)),_(g),null}const{forceRender:w}=R.useContext(kg);return p.jsx(p.Fragment,{children:A.map(G=>{const M=du(G),B=l&&!d?!1:g===A||y.includes(M),K=()=>{if(T.has(M))T.set(M,!0);else return;let V=!0;T.forEach($=>{$||(V=!1)}),V&&(w?.(),C(b.current),l&&h?.(),s&&s())};return p.jsx(GD,{isPresent:B,initial:!v.current||t?void 0:!1,custom:e,presenceAffectsLayout:r,mode:a,root:f,onExitComplete:B?void 0:K,anchorX:c,children:G},M)})})},NT=R.createContext({strict:!1}),zv={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},co={};for(const n in zv)co[n]={isEnabled:e=>zv[n].some(t=>!!e[t])};function zD(n){for(const e in n)co[e]={...co[e],...n[e]}}const YD=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Zu(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||YD.has(n)}let kT=n=>!Zu(n);function qD(n){typeof n=="function"&&(kT=e=>e.startsWith("on")?!Zu(e):n(e))}try{qD(require("@emotion/is-prop-valid").default)}catch{}function XD(n,e,t){const s={};for(const r in n)r==="values"&&typeof n.values=="object"||(kT(r)||t===!0&&Zu(r)||!e&&!Zu(r)||n.draggable&&r.startsWith("onDrag"))&&(s[r]=n[r]);return s}const pd=R.createContext({});function yd(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function Ol(n){return typeof n=="string"||Array.isArray(n)}const ip=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],rp=["initial",...ip];function xd(n){return yd(n.animate)||rp.some(e=>Ol(n[e]))}function PT(n){return!!(xd(n)||n.variants)}function WD(n,e){if(xd(n)){const{initial:t,animate:s}=n;return{initial:t===!1||Ol(t)?t:void 0,animate:Ol(s)?s:void 0}}return n.inherit!==!1?e:{}}function QD(n){const{initial:e,animate:t}=WD(n,R.useContext(pd));return R.useMemo(()=>({initial:e,animate:t}),[Yv(e),Yv(t)])}function Yv(n){return Array.isArray(n)?n.join(" "):n}const Ml={};function ZD(n){for(const e in n)Ml[e]=n[e],Gg(e)&&(Ml[e].isCSSVariable=!0)}function OT(n,{layout:e,layoutId:t}){return xo.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!Ml[n]||n==="opacity")}const JD={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},eI=yo.length;function tI(n,e,t){let s="",r=!0;for(let a=0;a<eI;a++){const l=yo[a],c=n[l];if(c===void 0)continue;let f=!0;if(typeof c=="number"?f=c===(l.startsWith("scale")?1:0):f=parseFloat(c)===0,!f||t){const d=_T(c,ep[l]);if(!f){r=!1;const h=JD[l]||l;s+=`${h}(${d}) `}t&&(e[l]=d)}}return s=s.trim(),t?s=t(e,r?"":s):r&&(s="none"),s}function ap(n,e,t){const{style:s,vars:r,transformOrigin:a}=n;let l=!1,c=!1;for(const f in e){const d=e[f];if(xo.has(f)){l=!0;continue}else if(Gg(f)){r[f]=d;continue}else{const h=_T(d,ep[f]);f.startsWith("origin")?(c=!0,a[f]=h):s[f]=h}}if(e.transform||(l||t?s.transform=tI(e,n.transform,t):s.transform&&(s.transform="none")),c){const{originX:f="50%",originY:d="50%",originZ:h=0}=a;s.transformOrigin=`${f} ${d} ${h}`}}const op=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function MT(n,e,t){for(const s in e)!$s(e[s])&&!OT(s,t)&&(n[s]=e[s])}function sI({transformTemplate:n},e){return R.useMemo(()=>{const t=op();return ap(t,e,n),Object.assign({},t.vars,t.style)},[e])}function nI(n,e){const t=n.style||{},s={};return MT(s,t,n),Object.assign(s,sI(n,e)),s}function iI(n,e){const t={},s=nI(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=s,t}const rI={offset:"stroke-dashoffset",array:"stroke-dasharray"},aI={offset:"strokeDashoffset",array:"strokeDasharray"};function oI(n,e,t=1,s=0,r=!0){n.pathLength=1;const a=r?rI:aI;n[a.offset]=rt.transform(-s);const l=rt.transform(e),c=rt.transform(t);n[a.array]=`${l} ${c}`}function jT(n,{attrX:e,attrY:t,attrScale:s,pathLength:r,pathSpacing:a=1,pathOffset:l=0,...c},f,d,h){if(ap(n,c,d),f){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:g,style:y}=n;g.transform&&(y.transform=g.transform,delete g.transform),(y.transform||g.transformOrigin)&&(y.transformOrigin=g.transformOrigin??"50% 50%",delete g.transformOrigin),y.transform&&(y.transformBox=h?.transformBox??"fill-box",delete g.transformBox),e!==void 0&&(g.x=e),t!==void 0&&(g.y=t),s!==void 0&&(g.scale=s),r!==void 0&&oI(g,r,a,l,!1)}const UT=()=>({...op(),attrs:{}}),FT=n=>typeof n=="string"&&n.toLowerCase()==="svg";function lI(n,e,t,s){const r=R.useMemo(()=>{const a=UT();return jT(a,e,FT(s),n.transformTemplate,n.style),{...a.attrs,style:{...a.style}}},[e]);if(n.style){const a={};MT(a,n.style,n),r.style={...a,...r.style}}return r}const cI=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function lp(n){return typeof n!="string"||n.includes("-")?!1:!!(cI.indexOf(n)>-1||/[A-Z]/u.test(n))}function uI(n,e,t,{latestValues:s},r,a=!1){const c=(lp(n)?lI:iI)(e,s,r,n),f=XD(e,typeof n=="string",a),d=n!==R.Fragment?{...f,...c,ref:t}:{},{children:h}=e,g=R.useMemo(()=>$s(h)?h.get():h,[h]);return R.createElement(n,{...d,children:g})}function qv(n){const e=[{},{}];return n?.values.forEach((t,s)=>{e[0][s]=t.get(),e[1][s]=t.getVelocity()}),e}function cp(n,e,t,s){if(typeof e=="function"){const[r,a]=qv(s);e=e(t!==void 0?t:n.custom,r,a)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[r,a]=qv(s);e=e(t!==void 0?t:n.custom,r,a)}return e}function Ou(n){return $s(n)?n.get():n}function dI({scrapeMotionValuesFromProps:n,createRenderState:e},t,s,r){return{latestValues:fI(t,s,r,n),renderState:e()}}function fI(n,e,t,s){const r={},a=s(n,{});for(const y in a)r[y]=Ou(a[y]);let{initial:l,animate:c}=n;const f=xd(n),d=PT(n);e&&d&&!f&&n.inherit!==!1&&(l===void 0&&(l=e.initial),c===void 0&&(c=e.animate));let h=t?t.initial===!1:!1;h=h||l===!1;const g=h?c:l;if(g&&typeof g!="boolean"&&!yd(g)){const y=Array.isArray(g)?g:[g];for(let v=0;v<y.length;v++){const b=cp(n,y[v]);if(b){const{transitionEnd:T,transition:E,..._}=b;for(const A in _){let C=_[A];if(Array.isArray(C)){const N=h?C.length-1:0;C=C[N]}C!==null&&(r[A]=C)}for(const A in T)r[A]=T[A]}}}return r}const BT=n=>(e,t)=>{const s=R.useContext(pd),r=R.useContext(gd),a=()=>dI(n,e,s,r);return t?a():Pg(a)};function up(n,e,t){const{style:s}=n,r={};for(const a in s)($s(s[a])||e.style&&$s(e.style[a])||OT(a,n)||t?.getValue(a)?.liveStyle!==void 0)&&(r[a]=s[a]);return r}const hI=BT({scrapeMotionValuesFromProps:up,createRenderState:op});function $T(n,e,t){const s=up(n,e,t);for(const r in n)if($s(n[r])||$s(e[r])){const a=yo.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;s[a]=n[r]}return s}const mI=BT({scrapeMotionValuesFromProps:$T,createRenderState:UT}),gI=Symbol.for("motionComponentSymbol");function Za(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function pI(n,e,t){return R.useCallback(s=>{s&&n.onMount&&n.onMount(s),e&&(s?e.mount(s):e.unmount()),t&&(typeof t=="function"?t(s):Za(t)&&(t.current=s))},[e])}const dp=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),yI="framerAppearId",VT="data-"+dp(yI),GT=R.createContext({});function xI(n,e,t,s,r){const{visualElement:a}=R.useContext(pd),l=R.useContext(NT),c=R.useContext(gd),f=R.useContext(np).reducedMotion,d=R.useRef(null);s=s||l.renderer,!d.current&&s&&(d.current=s(n,{visualState:e,parent:a,props:t,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:f}));const h=d.current,g=R.useContext(GT);h&&!h.projection&&r&&(h.type==="html"||h.type==="svg")&&vI(d.current,t,r,g);const y=R.useRef(!1);R.useInsertionEffect(()=>{h&&y.current&&h.update(t,c)});const v=t[VT],b=R.useRef(!!v&&!window.MotionHandoffIsComplete?.(v)&&window.MotionHasOptimisedAnimation?.(v));return BE(()=>{h&&(y.current=!0,window.MotionIsMounted=!0,h.updateFeatures(),h.scheduleRenderMicrotask(),b.current&&h.animationState&&h.animationState.animateChanges())}),R.useEffect(()=>{h&&(!b.current&&h.animationState&&h.animationState.animateChanges(),b.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(v)}),b.current=!1),h.enteringChildren=void 0)}),h}function vI(n,e,t,s){const{layoutId:r,layout:a,drag:l,dragConstraints:c,layoutScroll:f,layoutRoot:d,layoutCrossfade:h}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:HT(n.parent)),n.projection.setOptions({layoutId:r,layout:a,alwaysMeasureLayout:!!l||c&&Za(c),visualElement:n,animationType:typeof a=="string"?a:"both",initialPromotionConfig:s,crossfade:h,layoutScroll:f,layoutRoot:d})}function HT(n){if(n)return n.options.allowProjection!==!1?n.projection:HT(n.parent)}function Bh(n,{forwardMotionProps:e=!1}={},t,s){t&&zD(t);const r=lp(n)?mI:hI;function a(c,f){let d;const h={...R.useContext(np),...c,layoutId:bI(c)},{isStatic:g}=h,y=QD(c),v=r(c,g);if(!g&&Og){SI();const b=EI(h);d=b.MeasureLayout,y.visualElement=xI(n,v,h,s,b.ProjectionNode)}return p.jsxs(pd.Provider,{value:y,children:[d&&y.visualElement?p.jsx(d,{visualElement:y.visualElement,...h}):null,uI(n,c,pI(v,y.visualElement,f),v,g,e)]})}a.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const l=R.forwardRef(a);return l[gI]=n,l}function bI({layoutId:n}){const e=R.useContext(kg).id;return e&&n!==void 0?e+"-"+n:n}function SI(n,e){R.useContext(NT).strict}function EI(n){const{drag:e,layout:t}=co;if(!e&&!t)return{};const s={...e,...t};return{MeasureLayout:e?.isEnabled(n)||t?.isEnabled(n)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}function TI(n,e){if(typeof Proxy>"u")return Bh;const t=new Map,s=(a,l)=>Bh(a,l,n,e),r=(a,l)=>s(a,l);return new Proxy(r,{get:(a,l)=>l==="create"?s:(t.has(l)||t.set(l,Bh(l,void 0,n,e)),t.get(l))})}function KT({top:n,left:e,right:t,bottom:s}){return{x:{min:e,max:t},y:{min:n,max:s}}}function AI({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function _I(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),s=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:s.y,right:s.x}}function $h(n){return n===void 0||n===1}function Km({scale:n,scaleX:e,scaleY:t}){return!$h(n)||!$h(e)||!$h(t)}function Jr(n){return Km(n)||zT(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function zT(n){return Xv(n.x)||Xv(n.y)}function Xv(n){return n&&n!=="0%"}function Ju(n,e,t){const s=n-t,r=e*s;return t+r}function Wv(n,e,t,s,r){return r!==void 0&&(n=Ju(n,r,s)),Ju(n,t,s)+e}function zm(n,e=0,t=1,s,r){n.min=Wv(n.min,e,t,s,r),n.max=Wv(n.max,e,t,s,r)}function YT(n,{x:e,y:t}){zm(n.x,e.translate,e.scale,e.originPoint),zm(n.y,t.translate,t.scale,t.originPoint)}const Qv=.999999999999,Zv=1.0000000000001;function CI(n,e,t,s=!1){const r=t.length;if(!r)return;e.x=e.y=1;let a,l;for(let c=0;c<r;c++){a=t[c],l=a.projectionDelta;const{visualElement:f}=a.options;f&&f.props.style&&f.props.style.display==="contents"||(s&&a.options.layoutScroll&&a.scroll&&a!==a.root&&eo(n,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),l&&(e.x*=l.x.scale,e.y*=l.y.scale,YT(n,l)),s&&Jr(a.latestValues)&&eo(n,a.latestValues))}e.x<Zv&&e.x>Qv&&(e.x=1),e.y<Zv&&e.y>Qv&&(e.y=1)}function Ja(n,e){n.min=n.min+e,n.max=n.max+e}function Jv(n,e,t,s,r=.5){const a=es(n.min,n.max,r);zm(n,e,t,a,s)}function eo(n,e){Jv(n.x,e.x,e.scaleX,e.scale,e.originX),Jv(n.y,e.y,e.scaleY,e.scale,e.originY)}function qT(n,e){return KT(_I(n.getBoundingClientRect(),e))}function LI(n,e,t){const s=qT(n,t),{scroll:r}=e;return r&&(Ja(s.x,r.offset.x),Ja(s.y,r.offset.y)),s}const eb=()=>({translate:0,scale:1,origin:0,originPoint:0}),to=()=>({x:eb(),y:eb()}),tb=()=>({min:0,max:0}),cs=()=>({x:tb(),y:tb()}),Ym={current:null},XT={current:!1};function wI(){if(XT.current=!0,!!Og)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>Ym.current=n.matches;n.addEventListener("change",e),e()}else Ym.current=!1}const RI=new WeakMap;function DI(n,e,t){for(const s in e){const r=e[s],a=t[s];if($s(r))n.addValue(s,r);else if($s(a))n.addValue(s,lo(r,{owner:n}));else if(a!==r)if(n.hasValue(s)){const l=n.getValue(s);l.liveStyle===!0?l.jump(r):l.hasAnimated||l.set(r)}else{const l=n.getStaticValue(s);n.addValue(s,lo(l!==void 0?l:r,{owner:n}))}}for(const s in t)e[s]===void 0&&n.removeValue(s);return e}const sb=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class II{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:r,blockInitialAnimation:a,visualState:l},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Zg,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const y=sn.now();this.renderScheduledAt<y&&(this.renderScheduledAt=y,qt.render(this.render,!1,!0))};const{latestValues:f,renderState:d}=l;this.latestValues=f,this.baseTarget={...f},this.initialValues=t.initial?{...f}:{},this.renderState=d,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=c,this.blockInitialAnimation=!!a,this.isControllingVariants=xd(t),this.isVariantNode=PT(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:h,...g}=this.scrapeMotionValuesFromProps(t,{},this);for(const y in g){const v=g[y];f[y]!==void 0&&$s(v)&&v.set(f[y])}}mount(e){this.current=e,RI.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,s)=>this.bindToMotionValue(s,t)),XT.current||wI(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Ym.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Tr(this.notifyUpdate),Tr(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=xo.has(e);s&&this.onBindTransform&&this.onBindTransform();const r=t.on("change",l=>{this.latestValues[e]=l,this.props.onUpdate&&qt.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{r(),a&&a(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in co){const t=co[e];if(!t)continue;const{isEnabled:s,Feature:r}=t;if(!this.features[e]&&r&&s(this.props)&&(this.features[e]=new r(this)),this.features[e]){const a=this.features[e];a.isMounted?a.update():(a.mount(),a.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):cs()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<sb.length;s++){const r=sb[s];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const a="on"+r,l=e[a];l&&(this.propEventSubscriptions[r]=this.on(r,l))}this.prevMotionValues=DI(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&t!==void 0&&(s=lo(t===null?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){let s=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return s!=null&&(typeof s=="string"&&($E(s)||GE(s))?s=parseFloat(s):!BD(s)&&Ar.test(t)&&(s=AT(e,t)),this.setBaseTarget(e,$s(s)?s.get():s)),$s(s)?s.get():s}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let s;if(typeof t=="string"||typeof t=="object"){const a=cp(this.props,t,this.presenceContext?.custom);a&&(s=a[e])}if(t&&s!==void 0)return s;const r=this.getBaseTargetFromProps(this.props,e);return r!==void 0&&!$s(r)?r:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new Bg),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){tp.render(this.render)}}class WT extends II{constructor(){super(...arguments),this.KeyframeResolver=wD}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;$s(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function QT(n,{style:e,vars:t},s,r){const a=n.style;let l;for(l in e)a[l]=e[l];r?.applyProjectionStyles(a,s);for(l in t)a.setProperty(l,t[l])}function NI(n){return window.getComputedStyle(n)}class kI extends WT{constructor(){super(...arguments),this.type="html",this.renderInstance=QT}readValueFromInstance(e,t){if(xo.has(t))return this.projection?.isProjecting?Um(t):YR(e,t);{const s=NI(e),r=(Gg(t)?s.getPropertyValue(t):s[t])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:t}){return qT(e,t)}build(e,t,s){ap(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return up(e,t,s)}}const ZT=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function PI(n,e,t,s){QT(n,e,void 0,s);for(const r in e.attrs)n.setAttribute(ZT.has(r)?r:dp(r),e.attrs[r])}class OI extends WT{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=cs}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(xo.has(t)){const s=TT(t);return s&&s.default||0}return t=ZT.has(t)?t:dp(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return $T(e,t,s)}build(e,t,s){jT(e,t,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,t,s,r){PI(e,t,s,r)}mount(e){this.isSVGTag=FT(e.tagName),super.mount(e)}}const MI=(n,e)=>lp(n)?new OI(e):new kI(e,{allowProjection:n!==R.Fragment});function no(n,e,t){const s=n.getProps();return cp(s,e,t!==void 0?t:s.custom,n)}const qm=n=>Array.isArray(n);function jI(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,lo(t))}function UI(n){return qm(n)?n[n.length-1]||0:n}function FI(n,e){const t=no(n,e);let{transitionEnd:s={},transition:r={},...a}=t||{};a={...a,...s};for(const l in a){const c=UI(a[l]);jI(n,l,c)}}function BI(n){return!!($s(n)&&n.add)}function Xm(n,e){const t=n.getValue("willChange");if(BI(t))return t.add(e);if(!t&&Gi.WillChange){const s=new Gi.WillChange("auto");n.addValue("willChange",s),s.add(e)}}function JT(n){return n.props[VT]}const $I=n=>n!==null;function VI(n,{repeat:e,repeatType:t="loop"},s){const r=n.filter($I),a=e&&t!=="loop"&&e%2===1?0:r.length-1;return r[a]}const GI={type:"spring",stiffness:500,damping:25,restSpeed:10},HI=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),KI={type:"keyframes",duration:.8},zI={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},YI=(n,{keyframes:e})=>e.length>2?KI:xo.has(n)?n.startsWith("scale")?HI(e[1]):GI:zI;function qI({when:n,delay:e,delayChildren:t,staggerChildren:s,staggerDirection:r,repeat:a,repeatType:l,repeatDelay:c,from:f,elapsed:d,...h}){return!!Object.keys(h).length}const fp=(n,e,t,s={},r,a)=>l=>{const c=Jg(s,n)||{},f=c.delay||s.delay||0;let{elapsed:d=0}=s;d=d-fi(f);const h={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...c,delay:-d,onUpdate:y=>{e.set(y),c.onUpdate&&c.onUpdate(y)},onComplete:()=>{l(),c.onComplete&&c.onComplete()},name:n,motionValue:e,element:a?void 0:r};qI(c)||Object.assign(h,YI(n,h)),h.duration&&(h.duration=fi(h.duration)),h.repeatDelay&&(h.repeatDelay=fi(h.repeatDelay)),h.from!==void 0&&(h.keyframes[0]=h.from);let g=!1;if((h.type===!1||h.duration===0&&!h.repeatDelay)&&(Gm(h),h.delay===0&&(g=!0)),(Gi.instantAnimations||Gi.skipAnimations)&&(g=!0,Gm(h),h.delay=0),h.allowFlatten=!c.type&&!c.ease,g&&!a&&e.get()!==void 0){const y=VI(h.keyframes,c);if(y!==void 0){qt.update(()=>{h.onUpdate(y),h.onComplete()});return}}return c.isSync?new Qg(h):new pD(h)};function XI({protectedKeys:n,needsAnimating:e},t){const s=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,s}function e1(n,e,{delay:t=0,transitionOverride:s,type:r}={}){let{transition:a=n.getDefaultTransition(),transitionEnd:l,...c}=e;s&&(a=s);const f=[],d=r&&n.animationState&&n.animationState.getState()[r];for(const h in c){const g=n.getValue(h,n.latestValues[h]??null),y=c[h];if(y===void 0||d&&XI(d,h))continue;const v={delay:t,...Jg(a||{},h)},b=g.get();if(b!==void 0&&!g.isAnimating&&!Array.isArray(y)&&y===b&&!v.velocity)continue;let T=!1;if(window.MotionHandoffAnimation){const _=JT(n);if(_){const A=window.MotionHandoffAnimation(_,h,qt);A!==null&&(v.startTime=A,T=!0)}}Xm(n,h),g.start(fp(h,g,y,n.shouldReduceMotion&&bT.has(h)?{type:!1}:v,n,T));const E=g.animation;E&&f.push(E)}return l&&Promise.all(f).then(()=>{qt.update(()=>{l&&FI(n,l)})}),f}function t1(n,e,t,s=0,r=1){const a=Array.from(n).sort((d,h)=>d.sortNodePosition(h)).indexOf(e),l=n.size,c=(l-1)*s;return typeof t=="function"?t(a,l):r===1?a*s:c-a*s}function Wm(n,e,t={}){const s=no(n,e,t.type==="exit"?n.presenceContext?.custom:void 0);let{transition:r=n.getDefaultTransition()||{}}=s||{};t.transitionOverride&&(r=t.transitionOverride);const a=s?()=>Promise.all(e1(n,s,t)):()=>Promise.resolve(),l=n.variantChildren&&n.variantChildren.size?(f=0)=>{const{delayChildren:d=0,staggerChildren:h,staggerDirection:g}=r;return WI(n,e,f,d,h,g,t)}:()=>Promise.resolve(),{when:c}=r;if(c){const[f,d]=c==="beforeChildren"?[a,l]:[l,a];return f().then(()=>d())}else return Promise.all([a(),l(t.delay)])}function WI(n,e,t=0,s=0,r=0,a=1,l){const c=[];for(const f of n.variantChildren)f.notify("AnimationStart",e),c.push(Wm(f,e,{...l,delay:t+(typeof s=="function"?0:s)+t1(n.variantChildren,f,s,r,a)}).then(()=>f.notify("AnimationComplete",e)));return Promise.all(c)}function QI(n,e,t={}){n.notify("AnimationStart",e);let s;if(Array.isArray(e)){const r=e.map(a=>Wm(n,a,t));s=Promise.all(r)}else if(typeof e=="string")s=Wm(n,e,t);else{const r=typeof e=="function"?no(n,e,t.custom):e;s=Promise.all(e1(n,r,t))}return s.then(()=>{n.notify("AnimationComplete",e)})}function s1(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let s=0;s<t;s++)if(e[s]!==n[s])return!1;return!0}const ZI=rp.length;function n1(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?n1(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<ZI;t++){const s=rp[t],r=n.props[s];(Ol(r)||r===!1)&&(e[s]=r)}return e}const JI=[...ip].reverse(),eN=ip.length;function tN(n){return e=>Promise.all(e.map(({animation:t,options:s})=>QI(n,t,s)))}function sN(n){let e=tN(n),t=nb(),s=!0;const r=f=>(d,h)=>{const g=no(n,h,f==="exit"?n.presenceContext?.custom:void 0);if(g){const{transition:y,transitionEnd:v,...b}=g;d={...d,...b,...v}}return d};function a(f){e=f(n)}function l(f){const{props:d}=n,h=n1(n.parent)||{},g=[],y=new Set;let v={},b=1/0;for(let E=0;E<eN;E++){const _=JI[E],A=t[_],C=d[_]!==void 0?d[_]:h[_],N=Ol(C),w=_===f?A.isActive:null;w===!1&&(b=E);let G=C===h[_]&&C!==d[_]&&N;if(G&&s&&n.manuallyAnimateOnMount&&(G=!1),A.protectedKeys={...v},!A.isActive&&w===null||!C&&!A.prevProp||yd(C)||typeof C=="boolean")continue;const M=nN(A.prevProp,C);let B=M||_===f&&A.isActive&&!G&&N||E>b&&N,K=!1;const V=Array.isArray(C)?C:[C];let $=V.reduce(r(_),{});w===!1&&($={});const{prevResolvedValues:ee={}}=A,he={...ee,...$},Z=F=>{B=!0,y.has(F)&&(K=!0,y.delete(F)),A.needsAnimating[F]=!0;const O=n.getValue(F);O&&(O.liveStyle=!1)};for(const F in he){const O=$[F],Y=ee[F];if(v.hasOwnProperty(F))continue;let I=!1;qm(O)&&qm(Y)?I=!s1(O,Y):I=O!==Y,I?O!=null?Z(F):y.add(F):O!==void 0&&y.has(F)?Z(F):A.protectedKeys[F]=!0}A.prevProp=C,A.prevResolvedValues=$,A.isActive&&(v={...v,...$}),s&&n.blockInitialAnimation&&(B=!1);const H=G&&M;B&&(!H||K)&&g.push(...V.map(F=>{const O={type:_};if(typeof F=="string"&&s&&!H&&n.manuallyAnimateOnMount&&n.parent){const{parent:Y}=n,I=no(Y,F);if(Y.enteringChildren&&I){const{delayChildren:j}=I.transition||{};O.delay=t1(Y.enteringChildren,n,j)}}return{animation:F,options:O}}))}if(y.size){const E={};if(typeof d.initial!="boolean"){const _=no(n,Array.isArray(d.initial)?d.initial[0]:d.initial);_&&_.transition&&(E.transition=_.transition)}y.forEach(_=>{const A=n.getBaseTarget(_),C=n.getValue(_);C&&(C.liveStyle=!0),E[_]=A??null}),g.push({animation:E})}let T=!!g.length;return s&&(d.initial===!1||d.initial===d.animate)&&!n.manuallyAnimateOnMount&&(T=!1),s=!1,T?e(g):Promise.resolve()}function c(f,d){if(t[f].isActive===d)return Promise.resolve();n.variantChildren?.forEach(g=>g.animationState?.setActive(f,d)),t[f].isActive=d;const h=l(f);for(const g in t)t[g].protectedKeys={};return h}return{animateChanges:l,setActive:c,setAnimateFunction:a,getState:()=>t,reset:()=>{t=nb(),s=!0}}}function nN(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!s1(e,n):!1}function Xr(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function nb(){return{animate:Xr(!0),whileInView:Xr(),whileHover:Xr(),whileTap:Xr(),whileDrag:Xr(),whileFocus:Xr(),exit:Xr()}}class Rr{constructor(e){this.isMounted=!1,this.node=e}update(){}}class iN extends Rr{constructor(e){super(e),e.animationState||(e.animationState=sN(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();yd(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let rN=0;class aN extends Rr{constructor(){super(...arguments),this.id=rN++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const oN={animation:{Feature:iN},exit:{Feature:aN}};function jl(n,e,t,s={passive:!0}){return n.addEventListener(e,t,s),()=>n.removeEventListener(e,t)}function Zl(n){return{point:{x:n.pageX,y:n.pageY}}}const lN=n=>e=>sp(e)&&n(e,Zl(e));function Al(n,e,t,s){return jl(n,e,lN(t),s)}const i1=1e-4,cN=1-i1,uN=1+i1,r1=.01,dN=0-r1,fN=0+r1;function Hs(n){return n.max-n.min}function hN(n,e,t){return Math.abs(n-e)<=t}function ib(n,e,t,s=.5){n.origin=s,n.originPoint=es(e.min,e.max,n.origin),n.scale=Hs(t)/Hs(e),n.translate=es(t.min,t.max,n.origin)-n.originPoint,(n.scale>=cN&&n.scale<=uN||isNaN(n.scale))&&(n.scale=1),(n.translate>=dN&&n.translate<=fN||isNaN(n.translate))&&(n.translate=0)}function _l(n,e,t,s){ib(n.x,e.x,t.x,s?s.originX:void 0),ib(n.y,e.y,t.y,s?s.originY:void 0)}function rb(n,e,t){n.min=t.min+e.min,n.max=n.min+Hs(e)}function mN(n,e,t){rb(n.x,e.x,t.x),rb(n.y,e.y,t.y)}function ab(n,e,t){n.min=e.min-t.min,n.max=n.min+Hs(e)}function Cl(n,e,t){ab(n.x,e.x,t.x),ab(n.y,e.y,t.y)}function Dn(n){return[n("x"),n("y")]}const a1=({current:n})=>n?n.ownerDocument.defaultView:null,ob=(n,e)=>Math.abs(n-e);function gN(n,e){const t=ob(n.x,e.x),s=ob(n.y,e.y);return Math.sqrt(t**2+s**2)}class o1{constructor(e,t,{transformPagePoint:s,contextWindow:r=window,dragSnapToOrigin:a=!1,distanceThreshold:l=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=Gh(this.lastMoveEventInfo,this.history),v=this.startEvent!==null,b=gN(y.offset,{x:0,y:0})>=this.distanceThreshold;if(!v&&!b)return;const{point:T}=y,{timestamp:E}=Ns;this.history.push({...T,timestamp:E});const{onStart:_,onMove:A}=this.handlers;v||(_&&_(this.lastMoveEvent,y),this.startEvent=this.lastMoveEvent),A&&A(this.lastMoveEvent,y)},this.handlePointerMove=(y,v)=>{this.lastMoveEvent=y,this.lastMoveEventInfo=Vh(v,this.transformPagePoint),qt.update(this.updatePoint,!0)},this.handlePointerUp=(y,v)=>{this.end();const{onEnd:b,onSessionEnd:T,resumeAnimation:E}=this.handlers;if(this.dragSnapToOrigin&&E&&E(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const _=Gh(y.type==="pointercancel"?this.lastMoveEventInfo:Vh(v,this.transformPagePoint),this.history);this.startEvent&&b&&b(y,_),T&&T(y,_)},!sp(e))return;this.dragSnapToOrigin=a,this.handlers=t,this.transformPagePoint=s,this.distanceThreshold=l,this.contextWindow=r||window;const c=Zl(e),f=Vh(c,this.transformPagePoint),{point:d}=f,{timestamp:h}=Ns;this.history=[{...d,timestamp:h}];const{onSessionStart:g}=t;g&&g(e,Gh(f,this.history)),this.removeListeners=Xl(Al(this.contextWindow,"pointermove",this.handlePointerMove),Al(this.contextWindow,"pointerup",this.handlePointerUp),Al(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Tr(this.updatePoint)}}function Vh(n,e){return e?{point:e(n.point)}:n}function lb(n,e){return{x:n.x-e.x,y:n.y-e.y}}function Gh({point:n},e){return{point:n,delta:lb(n,l1(e)),offset:lb(n,pN(e)),velocity:yN(e,.1)}}function pN(n){return n[0]}function l1(n){return n[n.length-1]}function yN(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,s=null;const r=l1(n);for(;t>=0&&(s=n[t],!(r.timestamp-s.timestamp>fi(e)));)t--;if(!s)return{x:0,y:0};const a=hi(r.timestamp-s.timestamp);if(a===0)return{x:0,y:0};const l={x:(r.x-s.x)/a,y:(r.y-s.y)/a};return l.x===1/0&&(l.x=0),l.y===1/0&&(l.y=0),l}function xN(n,{min:e,max:t},s){return e!==void 0&&n<e?n=s?es(e,n,s.min):Math.max(n,e):t!==void 0&&n>t&&(n=s?es(t,n,s.max):Math.min(n,t)),n}function cb(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function vN(n,{top:e,left:t,bottom:s,right:r}){return{x:cb(n.x,t,r),y:cb(n.y,e,s)}}function ub(n,e){let t=e.min-n.min,s=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,s]=[s,t]),{min:t,max:s}}function bN(n,e){return{x:ub(n.x,e.x),y:ub(n.y,e.y)}}function SN(n,e){let t=.5;const s=Hs(n),r=Hs(e);return r>s?t=Nl(e.min,e.max-s,n.min):s>r&&(t=Nl(n.min,n.max-r,e.min)),Vi(0,1,t)}function EN(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const Qm=.35;function TN(n=Qm){return n===!1?n=0:n===!0&&(n=Qm),{x:db(n,"left","right"),y:db(n,"top","bottom")}}function db(n,e,t){return{min:fb(n,e),max:fb(n,t)}}function fb(n,e){return typeof n=="number"?n:n[e]||0}const AN=new WeakMap;class _N{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=cs(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:s}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const a=g=>{const{dragSnapToOrigin:y}=this.getProps();y?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Zl(g).point)},l=(g,y)=>{const{drag:v,dragPropagation:b,onDragStart:T}=this.getProps();if(v&&!b&&(this.openDragLock&&this.openDragLock(),this.openDragLock=ND(v),!this.openDragLock))return;this.latestPointerEvent=g,this.latestPanInfo=y,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Dn(_=>{let A=this.getAxisMotionValue(_).get()||0;if(mi.test(A)){const{projection:C}=this.visualElement;if(C&&C.layout){const N=C.layout.layoutBox[_];N&&(A=Hs(N)*(parseFloat(A)/100))}}this.originPoint[_]=A}),T&&qt.postRender(()=>T(g,y)),Xm(this.visualElement,"transform");const{animationState:E}=this.visualElement;E&&E.setActive("whileDrag",!0)},c=(g,y)=>{this.latestPointerEvent=g,this.latestPanInfo=y;const{dragPropagation:v,dragDirectionLock:b,onDirectionLock:T,onDrag:E}=this.getProps();if(!v&&!this.openDragLock)return;const{offset:_}=y;if(b&&this.currentDirection===null){this.currentDirection=CN(_),this.currentDirection!==null&&T&&T(this.currentDirection);return}this.updateAxis("x",y.point,_),this.updateAxis("y",y.point,_),this.visualElement.render(),E&&E(g,y)},f=(g,y)=>{this.latestPointerEvent=g,this.latestPanInfo=y,this.stop(g,y),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>Dn(g=>this.getAnimationState(g)==="paused"&&this.getAxisMotionValue(g).animation?.play()),{dragSnapToOrigin:h}=this.getProps();this.panSession=new o1(e,{onSessionStart:a,onStart:l,onMove:c,onSessionEnd:f,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:h,distanceThreshold:s,contextWindow:a1(this.visualElement)})}stop(e,t){const s=e||this.latestPointerEvent,r=t||this.latestPanInfo,a=this.isDragging;if(this.cancel(),!a||!r||!s)return;const{velocity:l}=r;this.startAnimation(l);const{onDragEnd:c}=this.getProps();c&&qt.postRender(()=>c(s,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:r}=this.getProps();if(!s||!fu(e,r,this.currentDirection))return;const a=this.getAxisMotionValue(e);let l=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(l=xN(l,this.constraints[e],this.elastic[e])),a.set(l)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;e&&Za(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&s?this.constraints=vN(s.layoutBox,e):this.constraints=!1,this.elastic=TN(t),r!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Dn(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=EN(s.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Za(e))return!1;const s=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const a=LI(s,r.root,this.visualElement.getTransformPagePoint());let l=bN(r.layout.layoutBox,a);if(t){const c=t(AI(l));this.hasMutatedConstraints=!!c,c&&(l=KT(c))}return l}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:r,dragTransition:a,dragSnapToOrigin:l,onDragTransitionEnd:c}=this.getProps(),f=this.constraints||{},d=Dn(h=>{if(!fu(h,t,this.currentDirection))return;let g=f&&f[h]||{};l&&(g={min:0,max:0});const y=r?200:1e6,v=r?40:1e7,b={type:"inertia",velocity:s?e[h]:0,bounceStiffness:y,bounceDamping:v,timeConstant:750,restDelta:1,restSpeed:10,...a,...g};return this.startAxisValueAnimation(h,b)});return Promise.all(d).then(c)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return Xm(this.visualElement,e),s.start(fp(e,s,0,t,this.visualElement,!1))}stopAnimation(){Dn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Dn(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),r=s[t];return r||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){Dn(t=>{const{drag:s}=this.getProps();if(!fu(t,s,this.currentDirection))return;const{projection:r}=this.visualElement,a=this.getAxisMotionValue(t);if(r&&r.layout){const{min:l,max:c}=r.layout.layoutBox[t];a.set(e[t]-es(l,c,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!Za(t)||!s||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Dn(l=>{const c=this.getAxisMotionValue(l);if(c&&this.constraints!==!1){const f=c.get();r[l]=SN({min:f,max:f},this.constraints[l])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Dn(l=>{if(!fu(l,e,null))return;const c=this.getAxisMotionValue(l),{min:f,max:d}=this.constraints[l];c.set(es(f,d,r[l]))})}addListeners(){if(!this.visualElement.current)return;AN.set(this.visualElement,this);const e=this.visualElement.current,t=Al(e,"pointerdown",f=>{const{drag:d,dragListener:h=!0}=this.getProps();d&&h&&this.start(f)}),s=()=>{const{dragConstraints:f}=this.getProps();Za(f)&&f.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,a=r.addEventListener("measure",s);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),qt.read(s);const l=jl(window,"resize",()=>this.scalePositionWithinConstraints()),c=r.addEventListener("didUpdate",(({delta:f,hasLayoutChanged:d})=>{this.isDragging&&d&&(Dn(h=>{const g=this.getAxisMotionValue(h);g&&(this.originPoint[h]+=f[h].translate,g.set(g.get()+f[h].translate))}),this.visualElement.render())}));return()=>{l(),t(),a(),c&&c()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:r=!1,dragConstraints:a=!1,dragElastic:l=Qm,dragMomentum:c=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:r,dragConstraints:a,dragElastic:l,dragMomentum:c}}}function fu(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function CN(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class LN extends Rr{constructor(e){super(e),this.removeGroupControls=In,this.removeListeners=In,this.controls=new _N(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||In}unmount(){this.removeGroupControls(),this.removeListeners()}}const hb=n=>(e,t)=>{n&&qt.postRender(()=>n(e,t))};class wN extends Rr{constructor(){super(...arguments),this.removePointerDownListener=In}onPointerDown(e){this.session=new o1(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:a1(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:r}=this.node.getProps();return{onSessionStart:hb(e),onStart:hb(t),onMove:s,onEnd:(a,l)=>{delete this.session,r&&qt.postRender(()=>r(a,l))}}}mount(){this.removePointerDownListener=Al(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Mu={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function mb(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const gl={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(rt.test(n))n=parseFloat(n);else return n;const t=mb(n,e.target.x),s=mb(n,e.target.y);return`${t}% ${s}%`}},RN={correct:(n,{treeScale:e,projectionDelta:t})=>{const s=n,r=Ar.parse(n);if(r.length>5)return s;const a=Ar.createTransformer(n),l=typeof r[0]!="number"?1:0,c=t.x.scale*e.x,f=t.y.scale*e.y;r[0+l]/=c,r[1+l]/=f;const d=es(c,f,.5);return typeof r[2+l]=="number"&&(r[2+l]/=d),typeof r[3+l]=="number"&&(r[3+l]/=d),a(r)}};let Hh=!1;class DN extends R.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:r}=this.props,{projection:a}=e;ZD(IN),a&&(t.group&&t.group.add(a),s&&s.register&&r&&s.register(a),Hh&&a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions({...a.options,onExitComplete:()=>this.safeToRemove()})),Mu.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:r,isPresent:a}=this.props,{projection:l}=s;return l&&(l.isPresent=a,Hh=!0,r||e.layoutDependency!==t||t===void 0||e.isPresent!==a?l.willUpdate():this.safeToRemove(),e.isPresent!==a&&(a?l.promote():l.relegate()||qt.postRender(()=>{const c=l.getStack();(!c||!c.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),tp.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:r}=e;Hh=!0,r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),s&&s.deregister&&s.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function c1(n){const[e,t]=IT(),s=R.useContext(kg);return p.jsx(DN,{...n,layoutGroup:s,switchLayoutGroup:R.useContext(GT),isPresent:e,safeToRemove:t})}const IN={borderRadius:{...gl,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:gl,borderTopRightRadius:gl,borderBottomLeftRadius:gl,borderBottomRightRadius:gl,boxShadow:RN};function NN(n,e,t){const s=$s(n)?n:lo(n);return s.start(fp("",s,e,t)),s.animation}const kN=(n,e)=>n.depth-e.depth;class PN{constructor(){this.children=[],this.isDirty=!1}add(e){Mg(this.children,e),this.isDirty=!0}remove(e){jg(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(kN),this.isDirty=!1,this.children.forEach(e)}}function ON(n,e){const t=sn.now(),s=({timestamp:r})=>{const a=r-t;a>=e&&(Tr(s),n(a-e))};return qt.setup(s,!0),()=>Tr(s)}const u1=["TopLeft","TopRight","BottomLeft","BottomRight"],MN=u1.length,gb=n=>typeof n=="string"?parseFloat(n):n,pb=n=>typeof n=="number"||rt.test(n);function jN(n,e,t,s,r,a){r?(n.opacity=es(0,t.opacity??1,UN(s)),n.opacityExit=es(e.opacity??1,0,FN(s))):a&&(n.opacity=es(e.opacity??1,t.opacity??1,s));for(let l=0;l<MN;l++){const c=`border${u1[l]}Radius`;let f=yb(e,c),d=yb(t,c);if(f===void 0&&d===void 0)continue;f||(f=0),d||(d=0),f===0||d===0||pb(f)===pb(d)?(n[c]=Math.max(es(gb(f),gb(d),s),0),(mi.test(d)||mi.test(f))&&(n[c]+="%")):n[c]=d}(e.rotate||t.rotate)&&(n.rotate=es(e.rotate||0,t.rotate||0,s))}function yb(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const UN=d1(0,.5,QE),FN=d1(.5,.95,In);function d1(n,e,t){return s=>s<n?0:s>e?1:t(Nl(n,e,s))}function xb(n,e){n.min=e.min,n.max=e.max}function Rn(n,e){xb(n.x,e.x),xb(n.y,e.y)}function vb(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function bb(n,e,t,s,r){return n-=e,n=Ju(n,1/t,s),r!==void 0&&(n=Ju(n,1/r,s)),n}function BN(n,e=0,t=1,s=.5,r,a=n,l=n){if(mi.test(e)&&(e=parseFloat(e),e=es(l.min,l.max,e/100)-l.min),typeof e!="number")return;let c=es(a.min,a.max,s);n===a&&(c-=e),n.min=bb(n.min,e,t,c,r),n.max=bb(n.max,e,t,c,r)}function Sb(n,e,[t,s,r],a,l){BN(n,e[t],e[s],e[r],e.scale,a,l)}const $N=["x","scaleX","originX"],VN=["y","scaleY","originY"];function Eb(n,e,t,s){Sb(n.x,e,$N,t?t.x:void 0,s?s.x:void 0),Sb(n.y,e,VN,t?t.y:void 0,s?s.y:void 0)}function Tb(n){return n.translate===0&&n.scale===1}function f1(n){return Tb(n.x)&&Tb(n.y)}function Ab(n,e){return n.min===e.min&&n.max===e.max}function GN(n,e){return Ab(n.x,e.x)&&Ab(n.y,e.y)}function _b(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function h1(n,e){return _b(n.x,e.x)&&_b(n.y,e.y)}function Cb(n){return Hs(n.x)/Hs(n.y)}function Lb(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class HN{constructor(){this.members=[]}add(e){Mg(this.members,e),e.scheduleRender()}remove(e){if(jg(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(r=>e===r);if(t===0)return!1;let s;for(let r=t;r>=0;r--){const a=this.members[r];if(a.isPresent!==!1){s=a;break}}return s?(this.promote(s),!0):!1}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function KN(n,e,t){let s="";const r=n.x.translate/e.x,a=n.y.translate/e.y,l=t?.z||0;if((r||a||l)&&(s=`translate3d(${r}px, ${a}px, ${l}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:d,rotate:h,rotateX:g,rotateY:y,skewX:v,skewY:b}=t;d&&(s=`perspective(${d}px) ${s}`),h&&(s+=`rotate(${h}deg) `),g&&(s+=`rotateX(${g}deg) `),y&&(s+=`rotateY(${y}deg) `),v&&(s+=`skewX(${v}deg) `),b&&(s+=`skewY(${b}deg) `)}const c=n.x.scale*e.x,f=n.y.scale*e.y;return(c!==1||f!==1)&&(s+=`scale(${c}, ${f})`),s||"none"}const Kh=["","X","Y","Z"],zN=1e3;let YN=0;function zh(n,e,t,s){const{latestValues:r}=e;r[n]&&(t[n]=r[n],e.setStaticValue(n,0),s&&(s[n]=0))}function m1(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=JT(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:r,layoutId:a}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",qt,!(r||a))}const{parent:s}=n;s&&!s.hasCheckedOptimisedAppear&&m1(s)}function g1({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:s,resetTransform:r}){return class{constructor(l={},c=e?.()){this.id=YN++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(WN),this.nodes.forEach(e2),this.nodes.forEach(t2),this.nodes.forEach(QN)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=l,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let f=0;f<this.path.length;f++)this.path[f].shouldResetTransform=!0;this.root===this&&(this.nodes=new PN)}addEventListener(l,c){return this.eventHandlers.has(l)||this.eventHandlers.set(l,new Bg),this.eventHandlers.get(l).add(c)}notifyListeners(l,...c){const f=this.eventHandlers.get(l);f&&f.notify(...c)}hasListeners(l){return this.eventHandlers.has(l)}mount(l){if(this.instance)return;this.isSVG=DT(l)&&!UD(l),this.instance=l;const{layoutId:c,layout:f,visualElement:d}=this.options;if(d&&!d.current&&d.mount(l),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(f||c)&&(this.isLayoutDirty=!0),n){let h,g=0;const y=()=>this.root.updateBlockedByResize=!1;qt.read(()=>{g=window.innerWidth}),n(l,()=>{const v=window.innerWidth;v!==g&&(g=v,this.root.updateBlockedByResize=!0,h&&h(),h=ON(y,250),Mu.hasAnimatedSinceResize&&(Mu.hasAnimatedSinceResize=!1,this.nodes.forEach(Db)))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&d&&(c||f)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:g,hasRelativeLayoutChanged:y,layout:v})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const b=this.options.transition||d.getDefaultTransition()||a2,{onLayoutAnimationStart:T,onLayoutAnimationComplete:E}=d.getProps(),_=!this.targetLayout||!h1(this.targetLayout,v),A=!g&&y;if(this.options.layoutRoot||this.resumeFrom||A||g&&(_||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const C={...Jg(b,"layout"),onPlay:T,onComplete:E};(d.shouldReduceMotion||this.options.layoutRoot)&&(C.delay=0,C.type=!1),this.startAnimation(C),this.setAnimationOrigin(h,A)}else g||Db(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=v})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const l=this.getStack();l&&l.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Tr(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(s2),this.animationId++)}getTransformTemplate(){const{visualElement:l}=this.options;return l&&l.getProps().transformTemplate}willUpdate(l=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&m1(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let h=0;h<this.path.length;h++){const g=this.path[h];g.shouldResetTransform=!0,g.updateScroll("snapshot"),g.options.layoutRoot&&g.willUpdate(!1)}const{layoutId:c,layout:f}=this.options;if(c===void 0&&!f)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),l&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(wb);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Rb);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(JN),this.nodes.forEach(qN),this.nodes.forEach(XN)):this.nodes.forEach(Rb),this.clearAllSnapshots();const c=sn.now();Ns.delta=Vi(0,1e3/60,c-Ns.timestamp),Ns.timestamp=c,Ns.isProcessing=!0,Ph.update.process(Ns),Ph.preRender.process(Ns),Ph.render.process(Ns),Ns.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,tp.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(ZN),this.sharedNodes.forEach(n2)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,qt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){qt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Hs(this.snapshot.measuredBox.x)&&!Hs(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let f=0;f<this.path.length;f++)this.path[f].updateScroll();const l=this.layout;this.layout=this.measure(!1),this.layoutCorrected=cs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:c}=this.options;c&&c.notify("LayoutMeasure",this.layout.layoutBox,l?l.layoutBox:void 0)}updateScroll(l="measure"){let c=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===l&&(c=!1),c&&this.instance){const f=s(this.instance);this.scroll={animationId:this.root.animationId,phase:l,isRoot:f,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:f}}}resetTransform(){if(!r)return;const l=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,c=this.projectionDelta&&!f1(this.projectionDelta),f=this.getTransformTemplate(),d=f?f(this.latestValues,""):void 0,h=d!==this.prevTransformTemplateValue;l&&this.instance&&(c||Jr(this.latestValues)||h)&&(r(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(l=!0){const c=this.measurePageBox();let f=this.removeElementScroll(c);return l&&(f=this.removeTransform(f)),o2(f),{animationId:this.root.animationId,measuredBox:c,layoutBox:f,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:l}=this.options;if(!l)return cs();const c=l.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(l2))){const{scroll:d}=this.root;d&&(Ja(c.x,d.offset.x),Ja(c.y,d.offset.y))}return c}removeElementScroll(l){const c=cs();if(Rn(c,l),this.scroll?.wasRoot)return c;for(let f=0;f<this.path.length;f++){const d=this.path[f],{scroll:h,options:g}=d;d!==this.root&&h&&g.layoutScroll&&(h.wasRoot&&Rn(c,l),Ja(c.x,h.offset.x),Ja(c.y,h.offset.y))}return c}applyTransform(l,c=!1){const f=cs();Rn(f,l);for(let d=0;d<this.path.length;d++){const h=this.path[d];!c&&h.options.layoutScroll&&h.scroll&&h!==h.root&&eo(f,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),Jr(h.latestValues)&&eo(f,h.latestValues)}return Jr(this.latestValues)&&eo(f,this.latestValues),f}removeTransform(l){const c=cs();Rn(c,l);for(let f=0;f<this.path.length;f++){const d=this.path[f];if(!d.instance||!Jr(d.latestValues))continue;Km(d.latestValues)&&d.updateSnapshot();const h=cs(),g=d.measurePageBox();Rn(h,g),Eb(c,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,h)}return Jr(this.latestValues)&&Eb(c,this.latestValues),c}setTargetDelta(l){this.targetDelta=l,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(l){this.options={...this.options,...l,crossfade:l.crossfade!==void 0?l.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ns.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(l=!1){const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const f=!!this.resumingFrom||this!==c;if(!(l||f&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:h,layoutId:g}=this.options;if(!(!this.layout||!(h||g))){if(this.resolvedRelativeTargetAt=Ns.timestamp,!this.targetDelta&&!this.relativeTarget){const y=this.getClosestProjectingParent();y&&y.layout&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=cs(),this.relativeTargetOrigin=cs(),Cl(this.relativeTargetOrigin,this.layout.layoutBox,y.layout.layoutBox),Rn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=cs(),this.targetWithTransforms=cs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),mN(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Rn(this.target,this.layout.layoutBox),YT(this.target,this.targetDelta)):Rn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const y=this.getClosestProjectingParent();y&&!!y.resumingFrom==!!this.resumingFrom&&!y.options.layoutScroll&&y.target&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=cs(),this.relativeTargetOrigin=cs(),Cl(this.relativeTargetOrigin,this.target,y.target),Rn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||Km(this.parent.latestValues)||zT(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const l=this.getLead(),c=!!this.resumingFrom||this!==l;let f=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(f=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(f=!1),this.resolvedRelativeTargetAt===Ns.timestamp&&(f=!1),f)return;const{layout:d,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||h))return;Rn(this.layoutCorrected,this.layout.layoutBox);const g=this.treeScale.x,y=this.treeScale.y;CI(this.layoutCorrected,this.treeScale,this.path,c),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox,l.targetWithTransforms=cs());const{target:v}=l;if(!v){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(vb(this.prevProjectionDelta.x,this.projectionDelta.x),vb(this.prevProjectionDelta.y,this.projectionDelta.y)),_l(this.projectionDelta,this.layoutCorrected,v,this.latestValues),(this.treeScale.x!==g||this.treeScale.y!==y||!Lb(this.projectionDelta.x,this.prevProjectionDelta.x)||!Lb(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",v))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(l=!0){if(this.options.visualElement?.scheduleRender(),l){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=to(),this.projectionDelta=to(),this.projectionDeltaWithTransform=to()}setAnimationOrigin(l,c=!1){const f=this.snapshot,d=f?f.latestValues:{},h={...this.latestValues},g=to();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!c;const y=cs(),v=f?f.source:void 0,b=this.layout?this.layout.source:void 0,T=v!==b,E=this.getStack(),_=!E||E.members.length<=1,A=!!(T&&!_&&this.options.crossfade===!0&&!this.path.some(r2));this.animationProgress=0;let C;this.mixTargetDelta=N=>{const w=N/1e3;Ib(g.x,l.x,w),Ib(g.y,l.y,w),this.setTargetDelta(g),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Cl(y,this.layout.layoutBox,this.relativeParent.layout.layoutBox),i2(this.relativeTarget,this.relativeTargetOrigin,y,w),C&&GN(this.relativeTarget,C)&&(this.isProjectionDirty=!1),C||(C=cs()),Rn(C,this.relativeTarget)),T&&(this.animationValues=h,jN(h,d,this.latestValues,w,A,_)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=w},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(l){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Tr(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=qt.update(()=>{Mu.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=lo(0)),this.currentAnimation=NN(this.motionValue,[0,1e3],{...l,velocity:0,isSync:!0,onUpdate:c=>{this.mixTargetDelta(c),l.onUpdate&&l.onUpdate(c)},onStop:()=>{},onComplete:()=>{l.onComplete&&l.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const l=this.getStack();l&&l.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(zN),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const l=this.getLead();let{targetWithTransforms:c,target:f,layout:d,latestValues:h}=l;if(!(!c||!f||!d)){if(this!==l&&this.layout&&d&&p1(this.options.animationType,this.layout.layoutBox,d.layoutBox)){f=this.target||cs();const g=Hs(this.layout.layoutBox.x);f.x.min=l.target.x.min,f.x.max=f.x.min+g;const y=Hs(this.layout.layoutBox.y);f.y.min=l.target.y.min,f.y.max=f.y.min+y}Rn(c,f),eo(c,h),_l(this.projectionDeltaWithTransform,this.layoutCorrected,c,h)}}registerSharedNode(l,c){this.sharedNodes.has(l)||this.sharedNodes.set(l,new HN),this.sharedNodes.get(l).add(c);const d=c.options.initialPromotionConfig;c.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(c):void 0})}isLead(){const l=this.getStack();return l?l.lead===this:!0}getLead(){const{layoutId:l}=this.options;return l?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:l}=this.options;return l?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:l}=this.options;if(l)return this.root.sharedNodes.get(l)}promote({needsReset:l,transition:c,preserveFollowOpacity:f}={}){const d=this.getStack();d&&d.promote(this,f),l&&(this.projectionDelta=void 0,this.needsReset=!0),c&&this.setOptions({transition:c})}relegate(){const l=this.getStack();return l?l.relegate(this):!1}resetSkewAndRotation(){const{visualElement:l}=this.options;if(!l)return;let c=!1;const{latestValues:f}=l;if((f.z||f.rotate||f.rotateX||f.rotateY||f.rotateZ||f.skewX||f.skewY)&&(c=!0),!c)return;const d={};f.z&&zh("z",l,d,this.animationValues);for(let h=0;h<Kh.length;h++)zh(`rotate${Kh[h]}`,l,d,this.animationValues),zh(`skew${Kh[h]}`,l,d,this.animationValues);l.render();for(const h in d)l.setStaticValue(h,d[h]),this.animationValues&&(this.animationValues[h]=d[h]);l.scheduleRender()}applyProjectionStyles(l,c){if(!this.instance||this.isSVG)return;if(!this.isVisible){l.visibility="hidden";return}const f=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,l.visibility="",l.opacity="",l.pointerEvents=Ou(c?.pointerEvents)||"",l.transform=f?f(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(l.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,l.pointerEvents=Ou(c?.pointerEvents)||""),this.hasProjected&&!Jr(this.latestValues)&&(l.transform=f?f({},""):"none",this.hasProjected=!1);return}l.visibility="";const h=d.animationValues||d.latestValues;this.applyTransformsToTarget();let g=KN(this.projectionDeltaWithTransform,this.treeScale,h);f&&(g=f(h,g)),l.transform=g;const{x:y,y:v}=this.projectionDelta;l.transformOrigin=`${y.origin*100}% ${v.origin*100}% 0`,d.animationValues?l.opacity=d===this?h.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:l.opacity=d===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const b in Ml){if(h[b]===void 0)continue;const{correct:T,applyTo:E,isCSSVariable:_}=Ml[b],A=g==="none"?h[b]:T(h[b],d);if(E){const C=E.length;for(let N=0;N<C;N++)l[E[N]]=A}else _?this.options.visualElement.renderState.vars[b]=A:l[b]=A}this.options.layoutId&&(l.pointerEvents=d===this?Ou(c?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(l=>l.currentAnimation?.stop()),this.root.nodes.forEach(wb),this.root.sharedNodes.clear()}}}function qN(n){n.updateLayout()}function XN(n){const e=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&e&&n.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:s}=n.layout,{animationType:r}=n.options,a=e.source!==n.layout.source;r==="size"?Dn(h=>{const g=a?e.measuredBox[h]:e.layoutBox[h],y=Hs(g);g.min=t[h].min,g.max=g.min+y}):p1(r,e.layoutBox,t)&&Dn(h=>{const g=a?e.measuredBox[h]:e.layoutBox[h],y=Hs(t[h]);g.max=g.min+y,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[h].max=n.relativeTarget[h].min+y)});const l=to();_l(l,t,e.layoutBox);const c=to();a?_l(c,n.applyTransform(s,!0),e.measuredBox):_l(c,t,e.layoutBox);const f=!f1(l);let d=!1;if(!n.resumeFrom){const h=n.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:g,layout:y}=h;if(g&&y){const v=cs();Cl(v,e.layoutBox,g.layoutBox);const b=cs();Cl(b,t,y.layoutBox),h1(v,b)||(d=!0),h.options.layoutRoot&&(n.relativeTarget=b,n.relativeTargetOrigin=v,n.relativeParent=h)}}}n.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:c,layoutDelta:l,hasLayoutChanged:f,hasRelativeLayoutChanged:d})}else if(n.isLead()){const{onExitComplete:t}=n.options;t&&t()}n.options.transition=void 0}function WN(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function QN(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function ZN(n){n.clearSnapshot()}function wb(n){n.clearMeasurements()}function Rb(n){n.isLayoutDirty=!1}function JN(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function Db(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function e2(n){n.resolveTargetDelta()}function t2(n){n.calcProjection()}function s2(n){n.resetSkewAndRotation()}function n2(n){n.removeLeadSnapshot()}function Ib(n,e,t){n.translate=es(e.translate,0,t),n.scale=es(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function Nb(n,e,t,s){n.min=es(e.min,t.min,s),n.max=es(e.max,t.max,s)}function i2(n,e,t,s){Nb(n.x,e.x,t.x,s),Nb(n.y,e.y,t.y,s)}function r2(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const a2={duration:.45,ease:[.4,0,.1,1]},kb=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),Pb=kb("applewebkit/")&&!kb("chrome/")?Math.round:In;function Ob(n){n.min=Pb(n.min),n.max=Pb(n.max)}function o2(n){Ob(n.x),Ob(n.y)}function p1(n,e,t){return n==="position"||n==="preserve-aspect"&&!hN(Cb(e),Cb(t),.2)}function l2(n){return n!==n.root&&n.scroll?.wasRoot}const c2=g1({attachResizeListener:(n,e)=>jl(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Yh={current:void 0},y1=g1({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!Yh.current){const n=new c2({});n.mount(window),n.setOptions({layoutScroll:!0}),Yh.current=n}return Yh.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),u2={pan:{Feature:wN},drag:{Feature:LN,ProjectionNode:y1,MeasureLayout:c1}};function Mb(n,e,t){const{props:s}=n;n.animationState&&s.whileHover&&n.animationState.setActive("whileHover",t==="Start");const r="onHover"+t,a=s[r];a&&qt.postRender(()=>a(e,Zl(e)))}class d2 extends Rr{mount(){const{current:e}=this.node;e&&(this.unmount=kD(e,(t,s)=>(Mb(this.node,s,"Start"),r=>Mb(this.node,r,"End"))))}unmount(){}}class f2 extends Rr{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Xl(jl(this.node.current,"focus",()=>this.onFocus()),jl(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function jb(n,e,t){const{props:s}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&s.whileTap&&n.animationState.setActive("whileTap",t==="Start");const r="onTap"+(t==="End"?"":t),a=s[r];a&&qt.postRender(()=>a(e,Zl(e)))}class h2 extends Rr{mount(){const{current:e}=this.node;e&&(this.unmount=jD(e,(t,s)=>(jb(this.node,s,"Start"),(r,{success:a})=>jb(this.node,r,a?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Zm=new WeakMap,qh=new WeakMap,m2=n=>{const e=Zm.get(n.target);e&&e(n)},g2=n=>{n.forEach(m2)};function p2({root:n,...e}){const t=n||document;qh.has(t)||qh.set(t,{});const s=qh.get(t),r=JSON.stringify(e);return s[r]||(s[r]=new IntersectionObserver(g2,{root:n,...e})),s[r]}function y2(n,e,t){const s=p2(e);return Zm.set(n,t),s.observe(n),()=>{Zm.delete(n),s.unobserve(n)}}const x2={some:0,all:1};class v2 extends Rr{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:r="some",once:a}=e,l={root:t?t.current:void 0,rootMargin:s,threshold:typeof r=="number"?r:x2[r]},c=f=>{const{isIntersecting:d}=f;if(this.isInView===d||(this.isInView=d,a&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:h,onViewportLeave:g}=this.node.getProps(),y=d?h:g;y&&y(f)};return y2(this.node.current,l,c)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(b2(e,t))&&this.startObserver()}unmount(){}}function b2({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const S2={inView:{Feature:v2},tap:{Feature:h2},focus:{Feature:f2},hover:{Feature:d2}},E2={layout:{ProjectionNode:y1,MeasureLayout:c1}},T2={...oN,...S2,...u2,...E2},Jm=TI(T2,MI),A2=6003;function _2(){return(typeof window<"u"?window.location.origin:"").includes(":4173")?`http://localhost:${A2}`:""}const x1=_2();async function C2(n){if((n.headers.get("content-type")||"").includes("application/json"))return n.json();const t=await n.text();try{return JSON.parse(t)}catch{return{message:t}}}async function L2(n,e){const t=new AbortController,s=setTimeout(()=>t.abort(),3e4);try{const r=await fetch(`${x1}${n}`,{credentials:"include",...e,signal:t.signal}),a=await C2(r);if(!r.ok){const l=a?.message||a?.error||`HTTP ${r.status}`;throw new Error(l)}return a}finally{clearTimeout(s)}}async function v1(n,e){return L2(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async function Ot(n,e=[]){await v1("/api/procedure",{name:n,args:e})}async function Qe(n,e=[]){return(await v1("/api/functionrows",{name:n,args:e})).rows}async function w2(n,e){const t=await fetch(`${x1}/api/upload-user-photos?username=${encodeURIComponent(n)}`,{method:"POST",body:e,credentials:"include"});if(!t.ok){const s=await t.text().catch(()=>"");throw new Error(s||`Upload failed (${t.status})`)}}const R2=()=>p.jsx(Jm.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 flex items-center justify-center bg-white z-50",children:p.jsx(Jm.div,{className:"w-16 h-16 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin",initial:{scale:.8},animate:{scale:[.8,1.2,.8]},transition:{repeat:1/0,duration:1.2}})}),D2=()=>{const[n,e]=R.useState(""),[t,s]=R.useState(""),[r,a]=R.useState(!1),[l,c]=R.useState(!1),[f,d]=R.useState(!1),[h,g]=R.useState(""),[y,v]=R.useState(!1),[b,T]=R.useState(!1),E=wr();R.useEffect(()=>{const A=localStorage.getItem("isLoggedIn")==="true",C=localStorage.getItem("isSuperAdmin")==="true";A?C?E("/station",{replace:!0}):E("/station",{replace:!0}):d(!0)},[E]);const _=async A=>{A.preventDefault(),v(!0),g("");try{const C=await Qe("public.fn_login_check",[n,t]);if(C&&C.length>0){const N=n==="super_admin";localStorage.setItem("isLoggedIn","true"),localStorage.setItem("isSuperAdmin",N?"true":"false"),localStorage.setItem("username",n),l?localStorage.setItem("rememberMe","true"):localStorage.removeItem("rememberMe"),window.dispatchEvent(new Event("storage")),T(!0),setTimeout(()=>{N?E("/station",{replace:!0}):E("/station",{replace:!0})},600)}else g("Invalid username or password."),v(!1)}catch(C){g(C instanceof Error?C.message:"Login error. Please try again."),v(!1)}};return f?p.jsxs("div",{className:"relative min-h-screen w-full flex items-center justify-end font-sans",children:[p.jsx("style",{children:`
        input[type="password"]::-ms-reveal,
        input[type="password"]::-ms-clear { display: none; }
        input::-ms-reveal, input::-ms-clear { display: none; }
      `}),p.jsx(KD,{children:b&&p.jsx(R2,{})}),p.jsx("img",{src:"/bgfinal3.jpg",alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center z-0"}),p.jsxs("div",{className:`\r
          relative z-30 w-full max-w-[550px] mx-6 md:mx-12 p-10\r
          rounded-[26px] bg-white/10 backdrop-blur-2xl border border-white/30\r
          shadow-[0_20px_60px_rgba(0,0,0,0.25)]\r
        `,style:{backgroundImage:"linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05))"},children:[p.jsx(Jm.div,{initial:{x:"-120%"},animate:{x:"130%"},transition:{repeat:1/0,duration:5,ease:"easeInOut"},className:"pointer-events-none absolute top-0 -skew-x-12 w-1/3 h-full bg-gradient-to-r from-transparent via-white/15 to-transparent"}),p.jsxs("div",{className:"mb-6 text-center",children:[p.jsx("div",{className:"w-20 h-20 mx-auto mb-3 rounded-full overflow-hidden shadow-sm border border-white/70 bg-white/80",children:p.jsx("img",{src:"/trimmed_logo.png",alt:"Logo",className:"object-contain w-full h-full p-1"})}),p.jsx("h2",{className:"text-[28px] font-extrabold text-gray-900 tracking-tight",children:"Welcome to I-Grid"})]}),h&&p.jsx("div",{className:"text-red-600 text-sm text-center mb-4",children:h}),p.jsxs("form",{onSubmit:_,className:"space-y-5",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),p.jsx("input",{id:"username",type:"text",value:n,onChange:A=>{e(A.target.value),g("")},placeholder:"Enter your username",autoComplete:"username",className:"w-full h-12 px-4 rounded-xl border border-white/40 bg-white/50 text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),p.jsxs("div",{className:"relative",children:[p.jsx("input",{id:"password",type:r?"text":"password",value:t,onChange:A=>{s(A.target.value),g("")},placeholder:"Enter your password",autoComplete:"current-password",className:"w-full h-12 px-4 pr-12 rounded-xl border border-white/40 bg-white/50 text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-cyan-500 appearance-none"}),p.jsx("button",{type:"button",onClick:()=>a(!r),className:"absolute inset-y-0 right-3 flex items-center text-gray-600 hover:text-gray-800","aria-label":r?"Hide password":"Show password",children:r?p.jsx(Dm,{size:18}):p.jsx(Im,{size:18})})]})]}),p.jsx("div",{className:"flex items-center justify-between gap-4",children:p.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[p.jsx("input",{type:"checkbox",checked:l,onChange:()=>c(!l),className:"w-4 h-4 accent-cyan-600"}),p.jsx("span",{className:"text-sm text-gray-700 leading-none",children:"Remember Me"})]})}),p.jsx("button",{type:"submit",className:"w-full h-12 rounded-xl bg-gradient-to-r from-cyan-600 to-cyan-700 text-white font-semibold text-sm shadow-lg hover:shadow-xl transition",disabled:y||b,children:y?"Logging in...":"Log In"})]}),p.jsxs("div",{className:"text-xs text-center text-gray-500 mt-6",children:[" ",new Date().getFullYear()," ",p.jsx("a",{href:"https://thingsi.ai",className:"underline hover:text-cyan-700",children:"thingsi.ai"})]})]})]}):null},Ub="/assets/cctv-Cy_Qr6A4.png";function Fb(n){return Ki({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M120,16V8a8,8,0,0,1,16,0v8a8,8,0,0,1-16,0Zm80,32a8,8,0,0,0,5.66-2.34l8-8a8,8,0,0,0-11.32-11.32l-8,8A8,8,0,0,0,200,48ZM50.34,45.66A8,8,0,0,0,61.66,34.34l-8-8A8,8,0,0,0,42.34,37.66ZM232,176v24a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V176a16,16,0,0,1,16-16V128a88,88,0,0,1,88.67-88c48.15.36,87.33,40.29,87.33,89v31A16,16,0,0,1,232,176ZM134.68,87.89C153.67,91.08,168,108.32,168,128a8,8,0,0,0,16,0c0-27.4-20.07-51.43-46.68-55.89a8,8,0,1,0-2.64,15.78ZM216,200V176H40v24H216Z"},child:[]}]})(n)}const Be=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},I2=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=N2},N2=Number.MAX_SAFE_INTEGER||9007199254740991;let Xe=(function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n})({}),ue=(function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n})({}),L=(function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n})({});var pt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},He={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Ka{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class k2{constructor(e,t,s,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ka(e),this.fast_=new Ka(t),this.defaultTTFB_=r,this.ttfb_=new Ka(e)}update(e,t){const{slow_:s,fast_:r,ttfb_:a}=this;s.halfLife!==e&&(this.slow_=new Ka(e,s.getEstimate(),s.getTotalWeight())),r.halfLife!==t&&(this.fast_=new Ka(t,r.getEstimate(),r.getTotalWeight())),a.halfLife!==e&&(this.ttfb_=new Ka(e,a.getEstimate(),a.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,r=e/1e3,a=s/r;this.fast_.sample(r,a),this.slow_.sample(r,a)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function P2(n,e,t){return(e=M2(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function $t(){return $t=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},$t.apply(null,arguments)}function Bb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,s)}return t}function Pt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Bb(Object(t),!0).forEach(function(s){P2(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Bb(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function O2(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function M2(n){var e=O2(n,"string");return typeof e=="symbol"?e:e+""}class Pn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Sr,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const Sr=function(){},j2={trace:Sr,debug:Sr,log:Sr,warn:Sr,info:Sr,error:Sr};function eg(){return $t({},j2)}function U2(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):Sr}function $b(n,e,t){return e[n]?e[n].bind(e):U2(n,t)}const tg=eg();function F2(n,e,t){const s=eg();if(typeof console=="object"&&n===!0||typeof n=="object"){const r=["debug","log","info","warn","error"];r.forEach(a=>{s[a]=$b(a,n,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.13`)}catch{return eg()}r.forEach(a=>{tg[a]=$b(a,n)})}else $t(tg,s);return s}const Mt=tg;function _r(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function B2(n){return typeof self<"u"&&n===self.ManagedMediaSource}function b1(n,e){const t=Object.keys(n),s=Object.keys(e),r=t.length,a=s.length;return!r||!a||r===a&&!t.some(l=>s.indexOf(l)===-1)}function pn(n,e=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(n);if(e){const h=d.indexOf("\0");return h!==-1?d.substring(0,h):d}return d.replace(/\0/g,"")}const t=n.length;let s,r,a,l="",c=0;for(;c<t;){if(s=n[c++],s===0&&e)return l;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(s);break;case 12:case 13:r=n[c++],l+=String.fromCharCode((s&31)<<6|r&63);break;case 14:r=n[c++],a=n[c++],l+=String.fromCharCode((s&15)<<12|(r&63)<<6|(a&63)<<0);break}}return l}function Gs(n){let e="";for(let t=0;t<n.length;t++){let s=n[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function S1(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function $2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Xh={exports:{}},Vb;function V2(){return Vb||(Vb=1,(function(n,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(f,d,h){if(h=h||{},f=f.trim(),d=d.trim(),!d){if(!h.alwaysNormalize)return f;var g=c.parseURL(f);if(!g)throw new Error("Error trying to parse base URL.");return g.path=c.normalizePath(g.path),c.buildURLFromParts(g)}var y=c.parseURL(d);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return h.alwaysNormalize?(y.path=c.normalizePath(y.path),c.buildURLFromParts(y)):d;var v=c.parseURL(f);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var b=r.exec(v.path);v.netLoc=b[1],v.path=b[2]}v.netLoc&&!v.path&&(v.path="/");var T={scheme:v.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(T.netLoc=v.netLoc,y.path[0]!=="/"))if(!y.path)T.path=v.path,y.params||(T.params=v.params,y.query||(T.query=v.query));else{var E=v.path,_=E.substring(0,E.lastIndexOf("/")+1)+y.path;T.path=c.normalizePath(_)}return T.path===null&&(T.path=h.alwaysNormalize?c.normalizePath(y.path):y.path),c.buildURLFromParts(T)},parseURL:function(f){var d=s.exec(f);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(f){for(f=f.split("").reverse().join("").replace(a,"");f.length!==(f=f.replace(l,"")).length;);return f.split("").reverse().join("")},buildURLFromParts:function(f){return f.scheme+f.netLoc+f.path+f.params+f.query+f.fragment}};n.exports=c})()})(Xh)),Xh.exports}var hp=V2();class mp{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ht={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class E1{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,H2(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let r;s.length===1?r=t?.byteRangeEndOffset||0:r=parseInt(s[1]),this._byteRange=[r,parseInt(s[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ht.AUDIO]:null,[Ht.VIDEO]:null,[Ht.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new mp),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=hp.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ht.AUDIO]=null,e[Ht.VIDEO]=null,e[Ht.AUDIOVIDEO]=null}}function gs(n){return n.sn!=="initSegment"}class Wh extends E1{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Be(e)&&Be(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const r=this._decryptdata=t[s[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Be(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),r=s.length;if(r>1||r===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Be(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return gs(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const r=t[e];r&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,r,a,l=!1){const{elementaryStreams:c}=this,f=c[e];if(!f){c[e]={startPTS:t,endPTS:s,startDTS:r,endDTS:a,partial:l};return}f.startPTS=Math.min(f.startPTS,t),f.endPTS=Math.max(f.endPTS,s),f.startDTS=Math.min(f.startDTS,r),f.endDTS=Math.max(f.endDTS,a)}}class G2 extends E1{constructor(e,t,s,r,a){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const l=e.enumeratedString("BYTERANGE");l&&this.setByteRange(l,a),a&&(this.fragOffset=a.fragOffset+a.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function T1(n,e){const t=Object.getPrototypeOf(n);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||T1(t,e)}}function H2(n,e){const t=T1(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const Gb=Math.pow(2,32)-1,K2=[].push,A1={video:1,audio:2,id3:3,text:4};function Ss(n){return String.fromCharCode.apply(null,n)}function _1(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function ot(n,e){const t=C1(n,e);return t<0?4294967296+t:t}function Hb(n,e){let t=ot(n,e);return t*=Math.pow(2,32),t+=ot(n,e+4),t}function C1(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function z2(n){const e=n.byteLength;for(let t=0;t<e;){const s=ot(n,t);if(s>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=s>1?t+s:e}return!1}function ft(n,e){const t=[];if(!e.length)return t;const s=n.byteLength;for(let r=0;r<s;){const a=ot(n,r),l=Ss(n.subarray(r+4,r+8)),c=a>1?r+a:s;if(l===e[0])if(e.length===1)t.push(n.subarray(r+8,c));else{const f=ft(n.subarray(r+8,c),e.slice(1));f.length&&K2.apply(t,f)}r=c}return t}function Y2(n){const e=[],t=n[0];let s=8;const r=ot(n,s);s+=4;let a=0,l=0;t===0?(a=ot(n,s),l=ot(n,s+4),s+=8):(a=Hb(n,s),l=Hb(n,s+8),s+=16),s+=2;let c=n.length+l;const f=_1(n,s);s+=2;for(let d=0;d<f;d++){let h=s;const g=ot(n,h);h+=4;const y=g&2147483647;if((g&2147483648)>>>31===1)return Mt.warn("SIDX has hierarchical references (not supported)"),null;const b=ot(n,h);h+=4,e.push({referenceSize:y,subsegmentDuration:b,info:{duration:b/r,start:c,end:c+y-1}}),c+=y,h+=4,s=h}return{earliestPresentationTime:a,timescale:r,version:t,referencesCount:f,references:e}}function L1(n){const e=[],t=ft(n,["moov","trak"]);for(let r=0;r<t.length;r++){const a=t[r],l=ft(a,["tkhd"])[0];if(l){let c=l[0];const f=ot(l,c===0?12:20),d=ft(a,["mdia","mdhd"])[0];if(d){c=d[0];const h=ot(d,c===0?12:20),g=ft(a,["mdia","hdlr"])[0];if(g){const y=Ss(g.subarray(8,12)),v={soun:Ht.AUDIO,vide:Ht.VIDEO}[y],b=ft(a,["mdia","minf","stbl","stsd"])[0],T=q2(b);v?(e[f]={timescale:h,type:v,stsd:T},e[v]=Pt({timescale:h,id:f},T)):e[f]={timescale:h,type:y,stsd:T}}}}}return ft(n,["moov","mvex","trex"]).forEach(r=>{const a=ot(r,4),l=e[a];l&&(l.default={duration:ot(r,12),flags:ot(r,20)})}),e}function q2(n){const e=n.subarray(8),t=e.subarray(86),s=Ss(e.subarray(4,8));let r=s,a;const l=s==="enca"||s==="encv";if(l){const d=ft(e,[s])[0].subarray(s==="enca"?28:78);ft(d,["sinf"]).forEach(g=>{const y=ft(g,["schm"])[0];if(y){const v=Ss(y.subarray(4,8));if(v==="cbcs"||v==="cenc"){const b=ft(g,["frma"])[0];b&&(r=Ss(b))}}})}const c=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const f=ft(t,["avcC"])[0];f&&f.length>3&&(r+="."+mu(f[1])+mu(f[2])+mu(f[3]),a=hu(c==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const f=ft(e,[s])[0],d=ft(f.subarray(28),["esds"])[0];if(d&&d.length>7){let h=4;if(d[h++]!==3)break;h=Qh(d,h),h+=2;const g=d[h++];if(g&128&&(h+=2),g&64&&(h+=d[h++]),d[h++]!==4)break;h=Qh(d,h);const y=d[h++];if(y===64)r+="."+mu(y);else break;if(h+=12,d[h++]!==5)break;h=Qh(d,h);const v=d[h++];let b=(v&248)>>3;b===31&&(b+=1+((v&7)<<3)+((d[h]&224)>>5)),r+="."+b}break}case"hvc1":case"hev1":{const f=ft(t,["hvcC"])[0];if(f&&f.length>12){const d=f[1],h=["","A","B","C"][d>>6],g=d&31,y=ot(f,2),v=(d&32)>>5?"H":"L",b=f[12],T=f.subarray(6,12);r+="."+h+g,r+="."+X2(y).toString(16).toUpperCase(),r+="."+v+b;let E="";for(let _=T.length;_--;){const A=T[_];(A||E)&&(E="."+A.toString(16).toUpperCase()+E)}r+=E}a=hu(c=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=hu(r,t)||r;break}case"vp09":{const f=ft(t,["vpcC"])[0];if(f&&f.length>6){const d=f[4],h=f[5],g=f[6]>>4&15;r+="."+oi(d)+"."+oi(h)+"."+oi(g)}break}case"av01":{const f=ft(t,["av1C"])[0];if(f&&f.length>2){const d=f[1]>>>5,h=f[1]&31,g=f[2]>>>7?"H":"M",y=(f[2]&64)>>6,v=(f[2]&32)>>5,b=d===2&&y?v?12:10:y?10:8,T=(f[2]&16)>>4,E=(f[2]&8)>>3,_=(f[2]&4)>>2,A=f[2]&3;r+="."+d+"."+oi(h)+g+"."+oi(b)+"."+T+"."+E+_+A+"."+oi(1)+"."+oi(1)+"."+oi(1)+"."+0,a=hu("dav1",t)}break}}return{codec:r,encrypted:l,supplemental:a}}function hu(n,e){const t=ft(e,["dvvC"]),s=t.length?t[0]:ft(e,["dvcC"])[0];if(s){const r=s[2]>>1&127,a=s[2]<<5&32|s[3]>>3&31;return n+"."+oi(r)+"."+oi(a)}}function X2(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function Qh(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function mu(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function oi(n){return(n<10?"0":"")+n}function W2(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&w1(n,(s,r)=>{const a=s.subarray(8,24);a.some(l=>l!==0)||(Mt.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Gs(a)} -> ${Gs(t)}`),s.set(t,8))})}function Q2(n){const e=[];return w1(n,t=>e.push(t.subarray(8,24))),e}function w1(n,e){ft(n,["moov","trak"]).forEach(s=>{const r=ft(s,["mdia","minf","stbl","stsd"])[0];if(!r)return;const a=r.subarray(8);let l=ft(a,["enca"]);const c=l.length>0;c||(l=ft(a,["encv"])),l.forEach(f=>{const d=c?f.subarray(28):f.subarray(78);ft(d,["sinf"]).forEach(g=>{const y=R1(g);y&&e(y,c)})})})}function R1(n){const e=ft(n,["schm"])[0];if(e){const t=Ss(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=ft(n,["schi","tenc"])[0];if(s)return s}}}function Z2(n,e,t){const s={},r=ft(n,["moof","traf"]);for(let a=0;a<r.length;a++){const l=r[a],c=ft(l,["tfhd"])[0],f=ot(c,4),d=e[f];if(!d)continue;s[f]||(s[f]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const h=s[f],g=ft(l,["tfdt"])[0];if(g){const C=g[0];let N=ot(g,4);C===1&&(N===Gb?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(N*=Gb+1,N+=ot(g,8))),Be(N)&&(!Be(h.start)||N<h.start)&&(h.start=N)}const y=d.default,v=ot(c,0)|y?.flags;let b=y?.duration||0;v&8&&(v&2?b=ot(c,12):b=ot(c,8));const T=ft(l,["trun"]);let E=h.start||0,_=0,A=b;for(let C=0;C<T.length;C++){const N=T[C],w=ot(N,4),G=h.sampleCount;h.sampleCount+=w;const M=N[3]&1,B=N[3]&4,K=N[2]&1,V=N[2]&2,$=N[2]&4,ee=N[2]&8;let he=8,Z=w;for(M&&(he+=4),B&&w&&(!(N[he+1]&1)&&h.keyFrameIndex===void 0&&(h.keyFrameIndex=G),he+=4,K?(A=ot(N,he),he+=4):A=b,V&&(he+=4),ee&&(he+=4),E+=A,_+=A,Z--);Z--;)K?(A=ot(N,he),he+=4):A=b,V&&(he+=4),$&&(N[he+1]&1||h.keyFrameIndex===void 0&&(h.keyFrameIndex=h.sampleCount-(Z+1),h.keyFrameStart=E),he+=4),ee&&(he+=4),E+=A,_+=A;!_&&b&&(_+=b*w)}h.duration+=_}if(!Object.keys(s).some(a=>s[a].duration)){let a=1/0,l=0;const c=ft(n,["sidx"]);for(let f=0;f<c.length;f++){const d=Y2(c[f]);if(d!=null&&d.references){a=Math.min(a,d.earliestPresentationTime/d.timescale);const h=d.references.reduce((g,y)=>g+y.info.duration||0,0);l=Math.max(l,h+d.earliestPresentationTime/d.timescale)}}l&&Be(l)&&Object.keys(s).forEach(f=>{s[f].duration||(s[f].duration=l*s[f].timescale-s[f].start)})}return s}function J2(n){const e={valid:null,remainder:null},t=ft(n,["moof"]);if(t.length<2)return e.remainder=n,e;const s=t[t.length-1];return e.valid=n.slice(0,s.byteOffset-8),e.remainder=n.slice(s.byteOffset-8),e}function Nn(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Kb(n,e){const t=[],s=e.samples,r=e.timescale,a=e.id;let l=!1;return ft(s,["moof"]).map(f=>{const d=f.byteOffset-8;ft(f,["traf"]).map(g=>{const y=ft(g,["tfdt"]).map(v=>{const b=v[0];let T=ot(v,4);return b===1&&(T*=Math.pow(2,32),T+=ot(v,8)),T/r})[0];return y!==void 0&&(n=y),ft(g,["tfhd"]).map(v=>{const b=ot(v,4),T=ot(v,0)&16777215,E=(T&1)!==0,_=(T&2)!==0,A=(T&8)!==0;let C=0;const N=(T&16)!==0;let w=0;const G=(T&32)!==0;let M=8;b===a&&(E&&(M+=8),_&&(M+=4),A&&(C=ot(v,M),M+=4),N&&(w=ot(v,M),M+=4),G&&(M+=4),e.type==="video"&&(l=vd(e.codec)),ft(g,["trun"]).map(B=>{const K=B[0],V=ot(B,0)&16777215,$=(V&1)!==0;let ee=0;const he=(V&4)!==0,Z=(V&256)!==0;let H=0;const k=(V&512)!==0;let F=0;const O=(V&1024)!==0,Y=(V&2048)!==0;let I=0;const j=ot(B,4);let z=8;$&&(ee=ot(B,z),z+=4),he&&(z+=4);let J=ee+d;for(let q=0;q<j;q++){if(Z?(H=ot(B,z),z+=4):H=C,k?(F=ot(B,z),z+=4):F=w,O&&(z+=4),Y&&(K===0?I=ot(B,z):I=C1(B,z),z+=4),e.type===Ht.VIDEO){let P=0;for(;P<F;){const de=ot(s,J);if(J+=4,ek(l,s[J])){const _e=s.subarray(J,J+de);gp(_e,l?2:1,n+I/r,t)}J+=de,P+=de+4}}n+=H/r}}))})})}),t}function vd(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function ek(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function gp(n,e,t,s){const r=D1(n);let a=0;a+=e;let l=0,c=0,f=0;for(;a<r.length;){l=0;do{if(a>=r.length)break;f=r[a++],l+=f}while(f===255);c=0;do{if(a>=r.length)break;f=r[a++],c+=f}while(f===255);const d=r.length-a;let h=a;if(c<d)a+=c;else if(c>d){Mt.error(`Malformed SEI payload. ${c} is too small, only ${d} bytes left to parse.`);break}if(l===4){if(r[h++]===181){const y=_1(r,h);if(h+=2,y===49){const v=ot(r,h);if(h+=4,v===1195456820){const b=r[h++];if(b===3){const T=r[h++],E=31&T,_=64&T,A=_?2+E*3:0,C=new Uint8Array(A);if(_){C[0]=T;for(let N=1;N<A;N++)C[N]=r[h++]}s.push({type:b,payloadType:l,pts:t,bytes:C})}}}}}else if(l===5&&c>16){const g=[];for(let b=0;b<16;b++){const T=r[h++].toString(16);g.push(T.length==1?"0"+T:T),(b===3||b===5||b===7||b===9)&&g.push("-")}const y=c-16,v=new Uint8Array(y);for(let b=0;b<y;b++)v[b]=r[h++];s.push({payloadType:l,pts:t,uuid:g.join(""),userData:pn(v),userDataBytes:v})}}}function D1(n){const e=n.byteLength,t=[];let s=1;for(;s<e-2;)n[s]===0&&n[s+1]===0&&n[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return n;const r=e-t.length,a=new Uint8Array(r);let l=0;for(s=0;s<r;l++,s++)l===t[0]&&(l++,t.shift()),a[s]=n[l];return a}function tk(n){const e=n[0];let t="",s="",r=0,a=0,l=0,c=0,f=0,d=0;if(e===0){for(;Ss(n.subarray(d,d+1))!=="\0";)t+=Ss(n.subarray(d,d+1)),d+=1;for(t+=Ss(n.subarray(d,d+1)),d+=1;Ss(n.subarray(d,d+1))!=="\0";)s+=Ss(n.subarray(d,d+1)),d+=1;s+=Ss(n.subarray(d,d+1)),d+=1,r=ot(n,12),a=ot(n,16),c=ot(n,20),f=ot(n,24),d=28}else if(e===1){d+=4,r=ot(n,d),d+=4;const g=ot(n,d);d+=4;const y=ot(n,d);for(d+=4,l=2**32*g+y,I2(l)||(l=Number.MAX_SAFE_INTEGER,Mt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=ot(n,d),d+=4,f=ot(n,d),d+=4;Ss(n.subarray(d,d+1))!=="\0";)t+=Ss(n.subarray(d,d+1)),d+=1;for(t+=Ss(n.subarray(d,d+1)),d+=1;Ss(n.subarray(d,d+1))!=="\0";)s+=Ss(n.subarray(d,d+1)),d+=1;s+=Ss(n.subarray(d,d+1)),d+=1}const h=n.subarray(d,n.byteLength);return{schemeIdUri:t,value:s,timeScale:r,presentationTime:l,presentationTimeDelta:a,eventDuration:c,id:f,payload:h}}function sk(n,...e){const t=e.length;let s=8,r=t;for(;r--;)s+=e[r].byteLength;const a=new Uint8Array(s);for(a[0]=s>>24&255,a[1]=s>>16&255,a[2]=s>>8&255,a[3]=s&255,a.set(n,4),r=0,s=8;r<t;r++)a.set(e[r],s),s+=e[r].byteLength;return a}function nk(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let s,r;s=0,r=new Uint8Array;let a;s>0?(a=new Uint8Array(4),e.length>0&&new DataView(a.buffer).setUint32(0,e.length,!1)):a=new Uint8Array;const l=new Uint8Array(4);return t.byteLength>0&&new DataView(l.buffer).setUint32(0,t.byteLength,!1),sk([112,115,115,104],new Uint8Array([s,0,0,0]),n,a,r,l,t)}function ik(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let s=0;for(;s+32<t;){const r=new DataView(n,s),a=rk(r);e.push(a),s+=a.size}}return e}function rk(n){const e=n.getUint32(0),t=n.byteOffset,s=n.byteLength;if(s<e)return{offset:t,size:s};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const a=n.getUint32(8)>>>24;if(a!==0&&a!==1)return{offset:t,size:e};const l=n.buffer,c=Gs(new Uint8Array(l,t+12,16));let f=null,d=null,h=0;if(a===0)h=28;else{const y=n.getUint32(28);if(!y||s<32+y*16)return{offset:t,size:e};f=[];for(let v=0;v<y;v++)f.push(new Uint8Array(l,t+32+v*16,16));h=32+y*16}if(!h)return{offset:t,size:e};const g=n.getUint32(h);return e-32<g?{offset:t,size:e}:(d=new Uint8Array(l,t+h+4,g),{version:a,systemId:c,kids:f,data:d,offset:t,size:e})}const I1=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),uo={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function pp(n,e){const t=uo[e];return!!t&&!!t[n.slice(0,4)]}function Ul(n,e,t=!0){return!n.split(",").some(s=>!yp(s,e,t))}function yp(n,e,t=!0){var s;const r=_r(t);return(s=r?.isTypeSupported(Fl(n,e)))!=null?s:!1}function Fl(n,e){return`${e}/mp4;codecs=${n}`}function zb(n){if(n){const e=n.substring(0,4);return uo.video[e]}return 2}function ed(n){const e=I1();return n.split(",").reduce((t,s)=>{const a=e&&vd(s)?9:uo.video[s];return a?(a*2+t)/(t?3:2):(uo.audio[s]+t)/(t?2:1)},0)}const Zh={};function ak(n,e=!0){if(Zh[n])return Zh[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let r=0;r<t.length;r++){var s;if(yp(t[r],"audio",e))return Zh[n]=t[r],t[r];if(t[r]==="mp3"&&(s=_r(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return n}const ok=/flac|opus|mp4a\.40\.34/i;function td(n,e=!0){return n.replace(ok,t=>ak(t.toLowerCase(),e))}function lk(n,e){const t=[];if(n){const s=n.split(",");for(let r=0;r<s.length;r++)pp(s[r],"video")||t.push(s[r])}return e&&t.push(e),t.join(",")}function ju(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(Yb(n,"audio")||Yb(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let s=t.length;s--;)if(t[s].substring(0,4)===n.substring(0,4))return t[s]}return t[0]}}return e||n}function Yb(n,e){return pp(n,e)&&yp(n,e)}function ck(n){const e=n.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function uk(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return n}function qb(n){const e=_r(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function sg(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const dk={supported:!0,powerEfficient:!0,smooth:!0},fk={supported:!1,smooth:!1,powerEfficient:!1},N1={supported:!0,configurations:[],decodingInfoResults:[dk]};function k1(n,e){return{supported:!1,configurations:e,decodingInfoResults:[fk],error:n}}function hk(n,e,t,s,r,a){const l=n.videoCodec,c=n.audioCodec?n.audioGroups:null,f=a?.audioCodec,d=a?.channels,h=d?parseInt(d):f?1/0:2;let g=null;if(c!=null&&c.length)try{c.length===1&&c[0]?g=e.groups[c[0]].channels:g=c.reduce((y,v)=>{if(v){const b=e.groups[v];if(!b)throw new Error(`Audio track group ${v} not found`);Object.keys(b.channels).forEach(T=>{y[T]=(y[T]||0)+b.channels[T]})}return y},{2:0})}catch{return!0}return l!==void 0&&(l.split(",").some(y=>vd(y))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(s,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(r,8e6))||!!g&&Be(h)&&Object.keys(g).some(y=>parseInt(y)>h)}function P1(n,e,t,s={}){const r=n.videoCodec;if(!r&&!n.audioCodec||!t)return Promise.resolve(N1);const a=[],l=mk(n),c=l.length,f=gk(n,e,c>0),d=f.length;for(let h=c||1*d||1;h--;){const g={type:"media-source"};if(c&&(g.video=l[h%c]),d){g.audio=f[h%d];const y=g.audio.bitrate;g.video&&y&&(g.video.bitrate-=y)}a.push(g)}if(r){const h=navigator.userAgent;if(r.split(",").some(g=>vd(g))&&I1())return Promise.resolve(k1(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${h})`),a))}return Promise.all(a.map(h=>{const g=yk(h);return s[g]||(s[g]=t.decodingInfo(h))})).then(h=>({supported:!h.some(g=>!g.supported),configurations:a,decodingInfoResults:h})).catch(h=>({supported:!1,configurations:a,decodingInfoResults:[],error:h}))}function mk(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),s=O1(n),r=n.width||640,a=n.height||480,l=n.frameRate||30,c=n.videoRange.toLowerCase();return t?t.map(f=>{const d={contentType:Fl(uk(f),"video"),width:r,height:a,bitrate:s,framerate:l};return c!=="sdr"&&(d.transferFunction=c),d}):[]}function gk(n,e,t){var s;const r=(s=n.audioCodec)==null?void 0:s.split(","),a=O1(n);return r&&n.audioGroups?n.audioGroups.reduce((l,c)=>{var f;const d=c?(f=e.groups[c])==null?void 0:f.tracks:null;return d?d.reduce((h,g)=>{if(g.groupId===c){const y=parseFloat(g.channels||"");r.forEach(v=>{const b={contentType:Fl(v,"audio"),bitrate:t?pk(v,a):a};y&&(b.channels=""+y),h.push(b)})}return h},l):l},[]):[]}function pk(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function O1(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function yk(n){let e="";const{audio:t,video:s}=n;if(s){const r=sg(s.contentType);e+=`${r}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const r=sg(t.contentType);e+=`${s?"_":""}${r}_c${t.channels}`}return e}const ng=["NONE","TYPE-0","TYPE-1",null];function xk(n){return ng.indexOf(n)>-1}const sd=["SDR","PQ","HLG"];function vk(n){return!!n&&sd.indexOf(n)>-1}var Uu={No:"",Yes:"YES",v2:"v2"};function Xb(n){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=n,r=s<e/2;return e&&r?t?Uu.v2:Uu.Yes:Uu.No}class Wb{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Bl{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Qb(this._audioGroups,e)}hasSubtitleGroup(e){return Qb(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Qb(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function bk(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function Sk(n,e){let t=!1,s=[];if(n&&(t=n!=="SDR",s=[n]),e){s=e.allowedVideoRanges||sd.slice(0);const r=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&bk(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const Ek=n=>{const e=new WeakSet;return(t,s)=>{if(n&&(s=n(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},Kt=(n,e)=>JSON.stringify(n,Ek(e));function Tk(n,e,t,s,r){const a=Object.keys(n),l=s?.channels,c=s?.audioCodec,f=r?.videoCodec,d=l&&parseInt(l)===2;let h=!1,g=!1,y=1/0,v=1/0,b=1/0,T=1/0,E=0,_=[];const{preferHDR:A,allowedVideoRanges:C}=Sk(e,r);for(let B=a.length;B--;){const K=n[a[B]];h||(h=K.channels[2]>0),y=Math.min(y,K.minHeight),v=Math.min(v,K.minFramerate),b=Math.min(b,K.minBitrate),C.filter($=>K.videoRanges[$]>0).length>0&&(g=!0)}y=Be(y)?y:0,v=Be(v)?v:0;const N=Math.max(1080,y),w=Math.max(30,v);b=Be(b)?b:t,t=Math.max(b,t),g||(e=void 0);const G=a.length>1;return{codecSet:a.reduce((B,K)=>{const V=n[K];if(K===B)return B;if(_=g?C.filter($=>V.videoRanges[$]>0):[],G){if(V.minBitrate>t)return ri(K,`min bitrate of ${V.minBitrate} > current estimate of ${t}`),B;if(!V.hasDefaultAudio)return ri(K,"no renditions with default or auto-select sound found"),B;if(c&&K.indexOf(c.substring(0,4))%5!==0)return ri(K,`audio codec preference "${c}" not found`),B;if(l&&!d){if(!V.channels[l])return ri(K,`no renditions with ${l} channel sound found (channels options: ${Object.keys(V.channels)})`),B}else if((!c||d)&&h&&V.channels[2]===0)return ri(K,"no renditions with stereo sound found"),B;if(V.minHeight>N)return ri(K,`min resolution of ${V.minHeight} > maximum of ${N}`),B;if(V.minFramerate>w)return ri(K,`min framerate of ${V.minFramerate} > maximum of ${w}`),B;if(!_.some($=>V.videoRanges[$]>0))return ri(K,`no variants with VIDEO-RANGE of ${Kt(_)} found`),B;if(f&&K.indexOf(f.substring(0,4))%5!==0)return ri(K,`video codec preference "${f}" not found`),B;if(V.maxScore<E)return ri(K,`max score of ${V.maxScore} < selected max of ${E}`),B}return B&&(ed(K)>=ed(B)||V.fragmentError>n[B].fragmentError)?B:(T=V.minIndex,E=V.maxScore,K)},void 0),videoRanges:_,preferHDR:A,minFramerate:v,minBitrate:b,minIndex:T}}function ri(n,e){Mt.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function M1(n){return n.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const r=t.channels||"2";return s.channels[r]=(s.channels[r]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Ak(n,e,t,s){return n.slice(t,s+1).reduce((r,a,l)=>{if(!a.codecSet)return r;const c=a.audioGroups;let f=r[a.codecSet];f||(r[a.codecSet]=f={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:l,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),f.minBitrate=Math.min(f.minBitrate,a.bitrate);const d=Math.min(a.height,a.width);return f.minHeight=Math.min(f.minHeight,d),f.minFramerate=Math.min(f.minFramerate,a.frameRate),f.minIndex=Math.min(f.minIndex,l),f.maxScore=Math.max(f.maxScore,a.score),f.fragmentError+=a.fragmentError,f.videoRanges[a.videoRange]=(f.videoRanges[a.videoRange]||0)+1,c&&c.forEach(h=>{if(!h)return;const g=e.groups[h];g&&(f.hasDefaultAudio=f.hasDefaultAudio||e.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(g.channels).forEach(y=>{f.channels[y]=(f.channels[y]||0)+g.channels[y]}))}),r},{})}function Zb(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:s,channels:r,audioCodec:a}=n;return{lang:e,assocLang:t,characteristics:s,channels:r,audioCodec:a}}function ui(n,e,t){if("attrs"in n){const s=e.indexOf(n);if(s!==-1)return s}for(let s=0;s<e.length;s++){const r=e[s];if(ra(n,r,t))return s}return-1}function ra(n,e,t){const{groupId:s,name:r,lang:a,assocLang:l,default:c}=n,f=n.forced;return(s===void 0||e.groupId===s)&&(r===void 0||e.name===r)&&(a===void 0||_k(a,e.lang))&&(a===void 0||e.assocLang===l)&&(c===void 0||e.default===c)&&(f===void 0||e.forced===f)&&(!("characteristics"in n)||Ck(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function _k(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function Ck(n,e=""){const t=n.split(","),s=e.split(",");return t.length===s.length&&!t.some(r=>s.indexOf(r)===-1)}function ea(n,e){const{audioCodec:t,channels:s}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function Lk(n,e,t,s,r){const a=e[s],c=e.reduce((y,v,b)=>{const T=v.uri;return(y[T]||(y[T]=[])).push(b),y},{})[a.uri];c.length>1&&(s=Math.max.apply(Math,c));const f=a.videoRange,d=a.frameRate,h=a.codecSet.substring(0,4),g=Jb(e,s,y=>{if(y.videoRange!==f||y.frameRate!==d||y.codecSet.substring(0,4)!==h)return!1;const v=y.audioGroups,b=t.filter(T=>!v||v.indexOf(T.groupId)!==-1);return ui(n,b,r)>-1});return g>-1?g:Jb(e,s,y=>{const v=y.audioGroups,b=t.filter(T=>!v||v.indexOf(T.groupId)!==-1);return ui(n,b,r)>-1})}function Jb(n,e,t){for(let s=e;s>-1;s--)if(t(n[s]))return s;for(let s=e+1;s<n.length;s++)if(t(n[s]))return s;return-1}function nd(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class wk extends Pn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:r,partCurrent:a,hls:l}=this,{autoLevelEnabled:c,media:f}=l;if(!r||!f)return;const d=performance.now(),h=a?a.stats:r.stats,g=a?a.duration:r.duration,y=d-h.loading.start,v=l.minAutoLevel,b=r.level,T=this._nextAutoLevel;if(h.aborted||h.loaded&&h.loaded===h.total||b<=v){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const E=T>-1&&T!==b,_=!!t||E;if(!_&&(f.paused||!f.playbackRate||!f.readyState))return;const A=l.mainForwardBufferInfo;if(!_&&A===null)return;const C=this.bwEstimator.getEstimateTTFB(),N=Math.abs(f.playbackRate);if(y<=Math.max(C,1e3*(g/(N*2))))return;const w=A?A.len/N:0,G=h.loading.first?h.loading.first-h.loading.start:-1,M=h.loaded&&G>-1,B=this.getBwEstimate(),K=l.levels,V=K[b],$=Math.max(h.loaded,Math.round(g*(r.bitrate||V.averageBitrate)/8));let ee=M?y-G:y;ee<1&&M&&(ee=Math.min(y,h.loaded*8/B));const he=M?h.loaded*1e3/ee:0,Z=C/1e3,H=he?($-h.loaded)/he:$*8/B+Z;if(H<=w)return;const k=he?he*8:B,F=((s=t?.details||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,O=this.hls.config.abrBandWidthUpFactor;let Y=Number.POSITIVE_INFINITY,I;for(I=b-1;I>v;I--){const q=K[I].maxBitrate,P=!K[I].details||F;if(Y=this.getTimeToLoadFrag(Z,k,g*q,P),Y<Math.min(w,g+Z))break}if(Y>=H||Y>g*10)return;M?this.bwEstimator.sample(y-Math.min(C,G),h.loaded):this.bwEstimator.sampleTTFB(y);const j=K[I].maxBitrate;this.getBwEstimate()*O>j&&this.resetEstimator(j);const z=this.findBestLevel(j,v,I,0,w,1,1);z>-1&&(I=z),this.warn(`Fragment ${r.sn}${a?" part "+a.index:""} of level ${b} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${w.toFixed(3)} s
      Estimated load time for current fragment: ${H.toFixed(3)} s
      Estimated load time for down switch fragment: ${Y.toFixed(3)} s
      TTFB estimate: ${G|0} ms
      Current BW estimate: ${Be(B)?B|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${I} @ ${j|0} bps`),l.nextLoadLevel=l.nextAutoLevel=I,this.clearTimer();const J=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===I&&I>0){const q=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${I>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${q.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,I>v){let P=this.findBestLevel(this.hls.levels[v].bitrate,v,I,0,q,1,1);P===-1&&(P=v),this.hls.nextLoadLevel=this.hls.nextAutoLevel=P,this.resetEstimator(this.hls.levels[P].bitrate)}}};E||H>Y*2?J():this.timer=self.setInterval(J,Y*1e3),l.trigger(L.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:a,stats:h})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new k2(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(L.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var r;this.fragCurrent=s,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case ue.BUFFER_ADD_CODEC_ERROR:case ue.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ue.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:r,partCurrent:a}=this;if(s&&r&&s.sn===r.sn&&s.level===r.level){const l=performance.now(),c=a?a.stats:s.stats,f=l-c.loading.start,d=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&d>-1){const g=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(f-Math.min(g,d),c.loaded)}else this.bwEstimator.sampleTTFB(f)}break}}}getTimeToLoadFrag(e,t,s,r){const a=e+s/t,l=r?e+this.lastLevelLoadSec:0;return a+l}onLevelLoaded(e,t){const s=this.hls.config,{loading:r}=t.stats,a=r.end-r.first;Be(a)&&(this.lastLevelLoadSec=a/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const r=s?s.stats:t.stats;if(t.type===He.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const a=s?s.duration:t.duration,l=this.hls.levels[t.level],c=(l.loaded?l.loaded.bytes:0)+r.loaded,f=(l.loaded?l.loaded.duration:0)+a;l.loaded={bytes:c,duration:f},l.realBitrate=Math.round(8*c/f)}if(t.bitrateTest){const a={stats:r,frag:t,part:s,id:t.type};this.onFragBuffered(L.FRAG_BUFFERED,a),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:r}=t,a=r!=null&&r.stats.loaded?r.stats:s.stats;if(a.aborted||this.ignoreFragment(s))return;const l=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,a.loaded),a.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==He.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,a=this.findBestLevel(s,t,e,0,r,1,1);if(a>-1)return a;const l=this.hls.firstLevel,c=Math.min(Math.max(l,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const a=s&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const l=this.hls.levels;if(l.length>Math.max(e,a)&&l[e].loadError<=l[a].loadError)return e}return this._nextAutoLevel=a,this.nextAutoLevelKey=this.getAutoLevelKey(),a}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:r,config:a,minAutoLevel:l}=s,c=t?t.duration:e?e.duration:0,f=this.getBwEstimate(),d=this.getStarvationDelay();let h=a.abrBandWidthFactor,g=a.abrBandWidthUpFactor;if(d){const E=this.findBestLevel(f,l,r,d,0,h,g);if(E>=0)return this.rebufferNotice=-1,E}let y=c?Math.min(c,a.maxStarvationDelay):a.maxStarvationDelay;if(!d){const E=this.bitrateTestDelay;E&&(y=(c?Math.min(c,a.maxLoadingDelay):a.maxLoadingDelay)-E,this.info(`bitrate test took ${Math.round(1e3*E)}ms, set first fragment max fetchDuration to ${Math.round(1e3*y)} ms`),h=g=1)}const v=this.findBestLevel(f,l,r,d,y,h,g);if(this.rebufferNotice!==v&&(this.rebufferNotice=v,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${v}`)),v>-1)return v;const b=s.levels[l],T=s.loadLevelObj;return T&&b?.bitrate<T.bitrate?l:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,r,a,l,c){var f;const d=r+a,h=this.lastLoadedFragLevel,g=h===-1?this.hls.firstLevel:h,{fragCurrent:y,partCurrent:v}=this,{levels:b,allAudioTracks:T,loadLevel:E,config:_}=this.hls;if(b.length===1)return 0;const A=b[g],C=!!((f=this.hls.latestLevelDetails)!=null&&f.live),N=E===-1||h===-1;let w,G="SDR",M=A?.frameRate||0;const{audioPreference:B,videoPreference:K}=_,V=this.audioTracksByGroup||(this.audioTracksByGroup=M1(T));let $=-1;if(N){if(this.firstSelection!==-1)return this.firstSelection;const k=this.codecTiers||(this.codecTiers=Ak(b,V,t,s)),F=Tk(k,G,e,B,K),{codecSet:O,videoRanges:Y,minFramerate:I,minBitrate:j,minIndex:z,preferHDR:J}=F;$=z,w=O,G=J?Y[Y.length-1]:Y[0],M=I,e=Math.max(e,j),this.log(`picked start tier ${Kt(F)}`)}else w=A?.codecSet,G=A?.videoRange;const ee=v?v.duration:y?y.duration:0,he=this.bwEstimator.getEstimateTTFB()/1e3,Z=[];for(let k=s;k>=t;k--){var H;const F=b[k],O=k>g;if(!F)continue;if(_.useMediaCapabilities&&!F.supportedResult&&!F.supportedPromise){const P=navigator.mediaCapabilities;typeof P?.decodingInfo=="function"&&hk(F,V,G,M,e,B)?(F.supportedPromise=P1(F,V,P,this.supportedCache),F.supportedPromise.then(de=>{if(!this.hls)return;F.supportedResult=de;const _e=this.hls.levels,Le=_e.indexOf(F);de.error?this.warn(`MediaCapabilities decodingInfo error: "${de.error}" for level ${Le} ${Kt(de)}`):de.supported?de.decodingInfoResults.some(Fe=>Fe.smooth===!1||Fe.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Le} not smooth or powerEfficient: ${Kt(de)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Le} ${Kt(de)}`),Le>-1&&_e.length>1&&(this.log(`Removing unsupported level ${Le}`),this.hls.removeLevel(Le),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(de=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${de}`)})):F.supportedResult=N1}if((w&&F.codecSet!==w||G&&F.videoRange!==G||O&&M>F.frameRate||!O&&M>0&&M<F.frameRate||(H=F.supportedResult)!=null&&(H=H.decodingInfoResults)!=null&&H.some(P=>P.smooth===!1))&&(!N||k!==$)){Z.push(k);continue}const Y=F.details,I=(v?Y?.partTarget:Y?.averagetargetduration)||ee;let j;O?j=c*e:j=l*e;const z=ee&&r>=ee*2&&a===0?F.averageBitrate:F.maxBitrate,J=this.getTimeToLoadFrag(he,j,z*I,Y===void 0);if(j>=z&&(k===h||F.loadError===0&&F.fragmentError===0)&&(J<=he||!Be(J)||C&&!this.bitrateTestDelay||J<d)){const P=this.forcedAutoLevel;return k!==E&&(P===-1||P!==E)&&(Z.length&&this.trace(`Skipped level(s) ${Z.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${b[Z[0]].codecs}" ${b[Z[0]].videoRange}; not compatible with "${w}" ${G}`),this.info(`switch candidate:${g}->${k} adjustedbw(${Math.round(j)})-bitrate=${Math.round(j-z)} ttfb:${he.toFixed(1)} avgDuration:${I.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${J.toFixed(1)} firstSelection:${N} codecSet:${F.codecSet} videoRange:${F.videoRange} hls.loadLevel:${E}`)),N&&(this.firstSelection=k),k}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const j1={search:function(n,e){let t=0,s=n.length-1,r=null,a=null;for(;t<=s;){r=(t+s)/2|0,a=n[r];const l=e(a);if(l>0)t=r+1;else if(l<0)s=r-1;else return a}return null}};function Rk(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!Be(e))return null;const s=n[0].programDateTime;if(e<(s||0))return null;const r=n[n.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let a=0;a<n.length;++a){const l=n[a];if(Ik(e,t,l))return l}return null}function la(n,e,t=0,s=0,r=.005){let a=null;if(n){a=e[1+n.sn-e[0].sn]||null;const c=n.endDTS-t;c>0&&c<15e-7&&(t+=15e-7),a&&n.level!==a.level&&a.end<=n.end&&(a=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(a=e[0]);if(a&&((!n||n.level===a.level)&&eS(t,s,a)===0||Dk(a,n,Math.min(r,s))))return a;const l=j1.search(e,eS.bind(null,t,s));return l&&(l!==n||!a)?l:a}function Dk(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((r,a)=>(a[0]==="INF"&&(r+=parseFloat(a[1])),r),t);return n.start<=s}return!1}function eS(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=n?1:t.start-s>n&&t.start?-1:0}function Ik(n,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>n}function U1(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let s=n.fragments;const{fragmentHint:r}=n;r&&(s=s.concat(r));let a;return j1.search(s,l=>l.cc<e?1:l.cc>e?-1:(a=l,l.end<=t?1:l.start>t?-1:0)),a||null}return null}function id(n){switch(n.details){case ue.FRAG_LOAD_TIMEOUT:case ue.KEY_LOAD_TIMEOUT:case ue.LEVEL_LOAD_TIMEOUT:case ue.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function F1(n){return n.details.startsWith("key")}function B1(n){return F1(n)&&!!n.frag&&!n.frag.decryptdata}function tS(n,e){const t=id(e);return n.default[`${t?"timeout":"error"}Retry`]}function xp(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function sS(n){return Pt(Pt({},n),{errorRetry:null,timeoutRetry:null})}function rd(n,e,t,s){if(!n)return!1;const r=s?.code,a=e<n.maxNumRetry&&(Nk(r)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,s,a):a}function Nk(n){return ig(n)||!!n&&(n<400||n>499)}function ig(n){return n===0&&navigator.onLine===!1}var ks={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},hn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class kk extends Pn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.ERROR,this.onError,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.ERROR,this.onError,this),e.off(L.ERROR,this.onErrorOut,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===He.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(l=>r.indexOf(l.groupId)>=0).some(l=>{var c;return(c=l.details)==null?void 0:c.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const r=this.hls,a=t.context;switch(t.details){case ue.FRAG_LOAD_ERROR:case ue.FRAG_LOAD_TIMEOUT:case ue.KEY_LOAD_ERROR:case ue.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case ue.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=io();return}case ue.FRAG_GAP:case ue.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ks.SendAlternateToPenaltyBox;return}case ue.LEVEL_EMPTY_ERROR:case ue.LEVEL_PARSING_ERROR:{var l;const f=t.parent===He.MAIN?t.level:r.loadLevel;t.details===ue.LEVEL_EMPTY_ERROR&&((l=t.context)!=null&&(l=l.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,f):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,f))}return;case ue.LEVEL_LOAD_ERROR:case ue.LEVEL_LOAD_TIMEOUT:typeof a?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level));return;case ue.AUDIO_TRACK_LOAD_ERROR:case ue.AUDIO_TRACK_LOAD_TIMEOUT:case ue.SUBTITLE_LOAD_ERROR:case ue.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const f=r.loadLevelObj;if(f&&(a.type===pt.AUDIO_TRACK&&f.hasAudioGroup(a.groupId)||a.type===pt.SUBTITLE_TRACK&&f.hasSubtitleGroup(a.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=ks.SendAlternateToPenaltyBox,t.errorAction.flags=hn.MoveAllAlternatesMatchingHost;return}}return;case ue.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:ks.SendAlternateToPenaltyBox,flags:hn.MoveAllAlternatesMatchingHDCP};return;case ue.KEY_SYSTEM_SESSION_UPDATE_FAILED:case ue.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case ue.KEY_SYSTEM_NO_SESSION:t.errorAction={action:ks.SendAlternateToPenaltyBox,flags:hn.MoveAllAlternatesMatchingKey};return;case ue.BUFFER_ADD_CODEC_ERROR:case ue.REMUX_ALLOC_ERROR:case ue.BUFFER_APPEND_ERROR:if(!t.errorAction){var c;t.errorAction=this.getLevelSwitchAction(t,(c=t.level)!=null?c:r.loadLevel)}return;case ue.INTERNAL_EXCEPTION:case ue.BUFFER_APPENDING_ERROR:case ue.BUFFER_FULL_ERROR:case ue.LEVEL_SWITCH_ERROR:case ue.BUFFER_STALLED_ERROR:case ue.BUFFER_SEEK_OVER_HOLE:case ue.BUFFER_NUDGE_ON_STALL:t.errorAction=io();return}t.type===Xe.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=io())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,r=tS(s.config.playlistLoadPolicy,e),a=this.playlistError++;if(rd(r,a,id(e),e.response))return{action:ks.RetryRequest,flags:hn.None,retryConfig:r,retryCount:a};const c=this.getLevelSwitchAction(e,t);return r&&(c.retryConfig=r,c.retryCount=a),c}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),r=t.levels[s],{fragLoadPolicy:a,keyLoadPolicy:l}=t.config,c=tS(F1(e)?l:a,e),f=t.levels.reduce((h,g)=>h+g.fragmentError,0);if(r&&(e.details!==ue.FRAG_GAP&&r.fragmentError++,!B1(e)&&rd(c,f,id(e),e.response)))return{action:ks.RetryRequest,flags:hn.None,retryConfig:c,retryCount:f};const d=this.getLevelSwitchAction(e,s);return c&&(d.retryConfig=c,d.retryCount=f),d}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const r=this.hls.levels[t];if(r){var a,l;const d=e.details;r.loadError++,d===ue.BUFFER_APPEND_ERROR&&r.fragmentError++;let h=-1;const{levels:g,loadLevel:y,minAutoLevel:v,maxAutoLevel:b}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const T=(a=e.frag)==null?void 0:a.type,_=(T===He.AUDIO&&d===ue.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===ue.BUFFER_ADD_CODEC_ERROR||d===ue.BUFFER_APPEND_ERROR))&&g.some(({audioCodec:G})=>r.audioCodec!==G),C=e.sourceBufferName==="video"&&(d===ue.BUFFER_ADD_CODEC_ERROR||d===ue.BUFFER_APPEND_ERROR)&&g.some(({codecSet:G,audioCodec:M})=>r.codecSet!==G&&r.audioCodec===M),{type:N,groupId:w}=(l=e.context)!=null?l:{};for(let G=g.length;G--;){const M=(G+y)%g.length;if(M!==y&&M>=v&&M<=b&&g[M].loadError===0){var c,f;const B=g[M];if(d===ue.FRAG_GAP&&T===He.MAIN&&e.frag){const K=g[M].details;if(K){const V=la(e.frag,K.fragments,e.frag.start);if(V!=null&&V.gap)continue}}else{if(N===pt.AUDIO_TRACK&&B.hasAudioGroup(w)||N===pt.SUBTITLE_TRACK&&B.hasSubtitleGroup(w))continue;if(T===He.AUDIO&&(c=r.audioGroups)!=null&&c.some(K=>B.hasAudioGroup(K))||T===He.SUBTITLE&&(f=r.subtitleGroups)!=null&&f.some(K=>B.hasSubtitleGroup(K))||_&&r.audioCodec===B.audioCodec||C&&r.codecSet===B.codecSet||!_&&r.codecSet!==B.codecSet)continue}h=M;break}}if(h>-1&&s.loadLevel!==h)return e.levelRetry=!0,this.playlistError=0,{action:ks.SendAlternateToPenaltyBox,flags:hn.None,nextAutoLevel:h}}return{action:ks.SendAlternateToPenaltyBox,flags:hn.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case ks.DoNothing:break;case ks.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==ue.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:r}=s,a=s.nextAutoLevel;switch(r){case hn.None:this.switchLevel(e,a);break;case hn.MoveAllAlternatesMatchingHDCP:{const f=this.getVariantLevelIndex(e.frag),d=t.levels[f],h=d?.attrs["HDCP-LEVEL"];if(s.hdcpLevel=h,h==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(h){t.maxHdcpLevel=ng[ng.indexOf(h)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case hn.MoveAllAlternatesMatchingKey:{const f=e.decryptdata;if(f){const d=this.hls.levels,h=d.length;for(let y=h;y--;)if(this.variantHasKey(d[y],f)){var l,c;this.log(`Banned key found in level ${y} (${d[y].bitrate}bps) or audio group "${(l=d[y].audioGroups)==null?void 0:l.join(",")}" (${(c=e.frag)==null?void 0:c.type} fragment) ${Gs(f.keyId||[])}`),d[y].fragmentError++,d[y].loadError++,this.log(`Removing level ${y} with key error (${e.error})`),this.hls.removeLevel(y)}const g=e.frag;if(this.hls.levels.length<h)s.resolved=!0;else if(g&&g.type!==He.MAIN){const y=g.decryptdata;y&&!f.matches(y)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===ue.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=sg(e.mimeType),r=this.hls.levels;for(let a=r.length;a--;)r[a][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${a} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(a))}}}function io(n){const e={action:ks.DoNothing,flags:hn.None};return n&&(e.resolved=!0),e}var Es={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Pk{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let r=s.length;r--;){const a=s[r];if(!a)break;if(a.start<=e&&e<=a.end&&a.loaded)return a}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:r}=this,a=Object.keys(r);for(let l=a.length;l--;){const c=r[a[l]];if(c?.body.type===t&&(!s||c.buffered)){const f=c.body;if(f.start<=e&&e<=f.end)return f}}return null}detectEvictedFragments(e,t,s,r,a){this.timeRanges&&(this.timeRanges[e]=t);const l=r?.fragment.sn||-1;Object.keys(this.fragments).forEach(c=>{const f=this.fragments[c];if(!f||l>=f.body.sn)return;if(!f.buffered&&(!f.loaded||a)){f.body.type===s&&this.removeFragment(f.body);return}const d=f.range[e];if(d){if(d.time.length===0){this.removeFragment(f.body);return}d.time.some(h=>{const g=!this.isTimeBuffered(h.startPTS,h.endPTS,t);return g&&this.removeFragment(f.body),g})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,r=za(s),a=this.fragments[r];if(!a||a.buffered&&s.gap)return;const l=!s.relurl;Object.keys(t).forEach(c=>{const f=s.elementaryStreams[c];if(!f)return;const d=t[c],h=l||f.partial===!0;a.range[c]=this.getBufferedTimes(s,e.part,h,d)}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=s.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),gu(a)||this.removeParts(s.sn-1,s.type)):this.removeFragment(a.body)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=nS(s,r=>r.fragment.sn>=e))}fragBuffered(e,t){const s=za(e);let r=this.fragments[s];!r&&t&&(r=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,s,r){const a={time:[],partial:s},l=e.start,c=e.end,f=e.minEndPTS||c,d=e.maxStartPTS||l;for(let h=0;h<r.length;h++){const g=r.start(h)-this.bufferPadding,y=r.end(h)+this.bufferPadding;if(d>=g&&f<=y){a.time.push({startPTS:Math.max(l,r.start(h)),endPTS:Math.min(c,r.end(h))});break}else if(l<y&&c>g){const v=Math.max(l,r.start(h)),b=Math.min(c,r.end(h));b>v&&(a.partial=!0,a.time.push({startPTS:v,endPTS:b}))}else if(c<=g)break}return a}getPartialFragment(e){let t=null,s,r,a,l=0;const{bufferPadding:c,fragments:f}=this;return Object.keys(f).forEach(d=>{const h=f[d];h&&gu(h)&&(r=h.body.start-c,a=h.body.end+c,e>=r&&e<=a&&(s=Math.min(e-r,a-e),l<=s&&(t=h.body,l=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||gu(t))}getState(e){const t=za(e),s=this.fragments[t];return s?s.buffered?gu(s)?Es.PARTIAL:Es.OK:Es.APPENDING:Es.NOT_LOADED}isTimeBuffered(e,t,s){let r,a;for(let l=0;l<s.length;l++){if(r=s.start(l)-this.bufferPadding,a=s.end(l)+this.bufferPadding,e>=r&&t<=a)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,r=t.part?null:t,a=za(s);this.fragments[a]={body:s,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:r,timeRanges:a,type:l}=t;if(s.sn==="initSegment")return;const c=s.type;if(r){let d=this.activePartLists[c];d||(this.activePartLists[c]=d=[]),d.push(r)}this.timeRanges=a;const f=a[l];this.detectEvictedFragments(l,f,c,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=za(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let r=s.length;r--;){const a=t[s[r]];if(a?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,r,a){r&&!this.hasGaps||Object.keys(this.fragments).forEach(l=>{const c=this.fragments[l];if(!c)return;const f=c.body;f.type!==s||r&&!f.gap||f.start<t&&f.end>e&&(c.buffered||a)&&this.removeFragment(f)})}removeFragment(e){const t=za(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const r=e.sn;this.activePartLists[e.type]=nS(s,a=>a.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function gu(n){var e,t,s;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(s=n.range.audiovideo)!=null&&s.partial)}function za(n){return`${n.type}_${n.level}_${n.sn}`}function nS(n,e){return n.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var Cr={cbc:0,ctr:1};class Ok{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case Cr.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Cr.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Mk(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class jk{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let r=0;r<4;r++)s[r]=t.getUint32(r*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,r=s[0],a=s[1],l=s[2],c=s[3],f=this.invSubMix,d=f[0],h=f[1],g=f[2],y=f[3],v=new Uint32Array(256);let b=0,T=0,E=0;for(E=0;E<256;E++)E<128?v[E]=E<<1:v[E]=E<<1^283;for(E=0;E<256;E++){let _=T^T<<1^T<<2^T<<3^T<<4;_=_>>>8^_&255^99,e[b]=_,t[_]=b;const A=v[b],C=v[A],N=v[C];let w=v[_]*257^_*16843008;r[b]=w<<24|w>>>8,a[b]=w<<16|w>>>16,l[b]=w<<8|w>>>24,c[b]=w,w=N*16843009^C*65537^A*257^b*16843008,d[_]=w<<24|w>>>8,h[_]=w<<16|w>>>16,g[_]=w<<8|w>>>24,y[_]=w,b?(b=A^v[v[v[N^A]]],T^=v[v[T]]):b=T=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,r=0;for(;r<t.length&&s;)s=t[r]===this.key[r],r++;if(s)return;this.key=t;const a=this.keySize=t.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);const l=this.ksRows=(a+6+1)*4;let c,f;const d=this.keySchedule=new Uint32Array(l),h=this.invKeySchedule=new Uint32Array(l),g=this.sBox,y=this.rcon,v=this.invSubMix,b=v[0],T=v[1],E=v[2],_=v[3];let A,C;for(c=0;c<l;c++){if(c<a){A=d[c]=t[c];continue}C=A,c%a===0?(C=C<<8|C>>>24,C=g[C>>>24]<<24|g[C>>>16&255]<<16|g[C>>>8&255]<<8|g[C&255],C^=y[c/a|0]<<24):a>6&&c%a===4&&(C=g[C>>>24]<<24|g[C>>>16&255]<<16|g[C>>>8&255]<<8|g[C&255]),d[c]=A=(d[c-a]^C)>>>0}for(f=0;f<l;f++)c=l-f,f&3?C=d[c]:C=d[c-4],f<4||c<=4?h[f]=C:h[f]=b[g[C>>>24]]^T[g[C>>>16&255]]^E[g[C>>>8&255]]^_[g[C&255]],h[f]=h[f]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const r=this.keySize+6,a=this.invKeySchedule,l=this.invSBox,c=this.invSubMix,f=c[0],d=c[1],h=c[2],g=c[3],y=this.uint8ArrayToUint32Array_(s);let v=y[0],b=y[1],T=y[2],E=y[3];const _=new Int32Array(e),A=new Int32Array(_.length);let C,N,w,G,M,B,K,V,$,ee,he,Z,H,k;const F=this.networkToHostOrderSwap;for(;t<_.length;){for($=F(_[t]),ee=F(_[t+1]),he=F(_[t+2]),Z=F(_[t+3]),M=$^a[0],B=Z^a[1],K=he^a[2],V=ee^a[3],H=4,k=1;k<r;k++)C=f[M>>>24]^d[B>>16&255]^h[K>>8&255]^g[V&255]^a[H],N=f[B>>>24]^d[K>>16&255]^h[V>>8&255]^g[M&255]^a[H+1],w=f[K>>>24]^d[V>>16&255]^h[M>>8&255]^g[B&255]^a[H+2],G=f[V>>>24]^d[M>>16&255]^h[B>>8&255]^g[K&255]^a[H+3],M=C,B=N,K=w,V=G,H=H+4;C=l[M>>>24]<<24^l[B>>16&255]<<16^l[K>>8&255]<<8^l[V&255]^a[H],N=l[B>>>24]<<24^l[K>>16&255]<<16^l[V>>8&255]<<8^l[M&255]^a[H+1],w=l[K>>>24]<<24^l[V>>16&255]<<16^l[M>>8&255]<<8^l[B&255]^a[H+2],G=l[V>>>24]<<24^l[M>>16&255]<<16^l[B>>8&255]<<8^l[K&255]^a[H+3],A[t]=F(C^v),A[t+1]=F(G^b),A[t+2]=F(w^T),A[t+3]=F(N^E),v=$,b=ee,T=he,E=Z,t=t+4}return A.buffer}}class Uk{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=Fk(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function Fk(n){switch(n){case Cr.cbc:return"AES-CBC";case Cr.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const Bk=16;class vp{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Mk(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,r){return this.useSoftware?new Promise((a,l)=>{const c=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(c,t,s,r);const f=this.flush();f?a(f.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,r)}softwareDecrypt(e,t,s,r){const{currentIV:a,currentResult:l,remainderData:c}=this;if(r!==Cr.cbc||t.byteLength!==16)return Mt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(e=Nn(c,e),this.remainderData=null);const f=this.getValidChunk(e);if(!f.length)return null;a&&(s=a);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new jk),d.expandKey(t);const h=l;return this.currentResult=d.decrypt(f.buffer,0,s),this.currentIV=f.slice(-16).buffer,h||null}webCryptoDecrypt(e,t,s,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,r));this.key=t,this.fastAesKey=new Uk(this.subtle,t,r)}return this.fastAesKey.expandKey().then(a=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Ok(this.subtle,new Uint8Array(s),r).decrypt(e.buffer,a)):Promise.reject(new Error("web crypto not initialized"))).catch(a=>(Mt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${a.name}: ${a.message}`),this.onWebCryptoError(e,t,s,r)))}onWebCryptoError(e,t,s,r){const a=this.enableSoftwareAES;if(a){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,r);const l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(a?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%Bk;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(Mt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const iS=Math.pow(2,17);class $k{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new Ui({type:Xe.NETWORK_ERROR,details:ue.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,a=r.fLoader,l=r.loader;return new Promise((c,f)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(b=>b[0]==="GAP")){f(aS(e));return}else e.gap=!1;const d=this.loader=a?new a(r):new l(r),h=rS(e);e.loader=d;const g=sS(r.fragLoadPolicy.default),y={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:iS};e.stats=d.stats;const v={onSuccess:(b,T,E,_)=>{this.resetLoader(e,d);let A=b.data;E.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(A.slice(0,16)),A=A.slice(16)),c({frag:e,part:null,payload:A,networkDetails:_})},onError:(b,T,E,_)=>{this.resetLoader(e,d),f(new Ui({type:Xe.NETWORK_ERROR,details:ue.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Pt({url:s,data:void 0},b),error:new Error(`HTTP Error ${b.code} ${b.text}`),networkDetails:E,stats:_}))},onAbort:(b,T,E)=>{this.resetLoader(e,d),f(new Ui({type:Xe.NETWORK_ERROR,details:ue.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:E,stats:b}))},onTimeout:(b,T,E)=>{this.resetLoader(e,d),f(new Ui({type:Xe.NETWORK_ERROR,details:ue.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:E,stats:b}))}};t&&(v.onProgress=(b,T,E,_)=>t({frag:e,part:null,payload:E,networkDetails:_})),d.load(h,y,v)})}loadPart(e,t,s){this.abort();const r=this.config,a=r.fLoader,l=r.loader;return new Promise((c,f)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){f(aS(e,t));return}const d=this.loader=a?new a(r):new l(r),h=rS(e,t);e.loader=d;const g=sS(r.fragLoadPolicy.default),y={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:iS};t.stats=d.stats,d.load(h,y,{onSuccess:(v,b,T,E)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const _={frag:e,part:t,payload:v.data,networkDetails:E};s(_),c(_)},onError:(v,b,T,E)=>{this.resetLoader(e,d),f(new Ui({type:Xe.NETWORK_ERROR,details:ue.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Pt({url:h.url,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:T,stats:E}))},onAbort:(v,b,T)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),f(new Ui({type:Xe.NETWORK_ERROR,details:ue.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:T,stats:v}))},onTimeout:(v,b,T)=>{this.resetLoader(e,d),f(new Ui({type:Xe.NETWORK_ERROR,details:ue.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:T,stats:v}))}})})}updateStatsFromPart(e,t){const s=e.stats,r=t.stats,a=r.total;if(s.loaded+=r.loaded,a){const f=Math.round(e.duration/t.duration),d=Math.min(Math.round(s.loaded/a),f),g=(f-d)*Math.round(s.loaded/d);s.total=s.loaded+g}else s.total=Math.max(s.loaded,s.total);const l=s.loading,c=r.loading;l.start?l.first+=c.first-c.start:(l.start=c.start,l.first=c.first),l.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function rS(n,e=null){const t=e||n,s={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,a=t.byteRangeEndOffset;if(Be(r)&&Be(a)){var l;let c=r,f=a;if(n.sn==="initSegment"&&Vk((l=n.decryptdata)==null?void 0:l.method)){const d=a-r;d%16&&(f=a+(16-d%16)),r!==0&&(s.resetIV=!0,c=r-16)}s.rangeStart=c,s.rangeEnd=f}return s}function aS(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),s={type:Xe.MEDIA_ERROR,details:ue.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(s.part=e),(e||n).stats.aborted=!0,new Ui(s)}function Vk(n){return n==="AES-128"||n==="AES-256"}class Ui extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class $1 extends Pn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class bp{constructor(e,t,s,r=0,a=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=pu(),this.buffering={audio:pu(),video:pu(),audiovideo:pu()},this.level=e,this.sn=t,this.id=s,this.size=r,this.part=a,this.partial=l}}function pu(){return{start:0,executeStart:0,executeEnd:0,end:0}}const oS={length:0,start:()=>0,end:()=>0};class lt{static isBuffered(e,t){if(e){const s=lt.getBuffered(e);for(let r=s.length;r--;)if(t>=s.start(r)&&t<=s.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=lt.getBuffered(e);return lt.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const r=lt.bufferedRanges(e);if(r.length)return lt.bufferedInfo(r,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((h,g)=>h.start-g.start||g.end-h.end);let r=-1,a=[];if(s)for(let h=0;h<e.length;h++){t>=e[h].start&&t<=e[h].end&&(r=h);const g=a.length;if(g){const y=a[g-1].end;e[h].start-y<s?e[h].end>y&&(a[g-1].end=e[h].end):a.push(e[h])}else a.push(e[h])}else a=e;let l=0,c,f=t,d=t;for(let h=0;h<a.length;h++){const g=a[h].start,y=a[h].end;if(r===-1&&t>=g&&t<=y&&(r=h),t+s>=g&&t<y)f=g,d=y,l=d-t;else if(t+s<g){c=g;break}}return{len:l,start:f||0,end:d||0,nextStart:c,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||oS}catch(t){return Mt.log("failed to get media.buffered",t),oS}}}const V1=/\{\$([a-zA-Z0-9-_]+)\}/g;function lS(n){return V1.test(n)}function rg(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(V1,s=>{const r=s.substring(2,s.length-1),a=t?.[r];return a===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),s):a})}return e}function cS(n,e,t){let s=n.variableList;s||(n.variableList=s={});let r,a;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const l=new self.URL(t).searchParams;if(l.has(r))a=l.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(l){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${l.message}`))}}else r=e.NAME,a=e.VALUE;r in s?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=a||""}function Gk(n,e,t){const s=e.IMPORT;if(t&&s in t){let r=n.variableList;r||(n.variableList=r={}),r[s]=t[s]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const Hk=/^(\d+)x(\d+)$/,uS=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Zt{constructor(e,t){typeof e=="string"&&(e=Zt.parseAttrList(e,t)),$t(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)s[r]=parseInt(t.slice(r*2,r*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((r,a)=>(r[a.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Hk.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const r={};for(uS.lastIndex=0;(s=uS.exec(e))!==null;){const l=s[1].trim();let c=s[2];const f=c.indexOf('"')===0&&c.lastIndexOf('"')===c.length-1;let d=!1;if(f)c=c.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(f||d))c=rg(t,c);else if(!d&&!f)switch(l){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Mt.warn(`${e}: attribute ${l} is missing quotes`)}r[l]=c}return r}}const Kk="com.apple.hls.interstitial";function zk(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function Yk(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class G1{constructor(e,t,s=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(r=t?.tagOrder)!=null?r:s,t){const a=t.attr;for(const l in a)if(Object.prototype.hasOwnProperty.call(e,l)&&e[l]!==a[l]){Mt.warn(`DATERANGE tag attribute: "${l}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=l;break}e=$t(new Zt({}),a,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const a=t?.endDate||new Date(this.attr["END-DATE"]);Be(a.getTime())&&(this._endDate=a)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Mt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Be(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Kk}get isValid(){return!!this.id&&!this._badValueForSameId&&Be(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const qk=10;class Xk{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?Be(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||qk}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function ad(n,e){return n.length===e.length?!n.some((t,s)=>t!==e[s]):!1}function dS(n,e){return!n&&!e?!0:!n||!e?!1:ad(n,e)}function ro(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function Sp(n){switch(n){case"AES-128":case"AES-256":return Cr.cbc;case"AES-256-CTR":return Cr.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function Ep(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function ag(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function Wk(n){const e=ag(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function H1(n){const e=function(s,r,a){const l=s[r];s[r]=s[a],s[a]=l};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function K1(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),r=s[s.length-1].split(",");if(r.length===2){const a=r[0]==="base64",l=r[1];a?(s.splice(-1,1),t=Ep(l)):t=Wk(l)}}return t}const od=typeof self<"u"?self:void 0;var Jt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ps={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Fu(n){switch(n){case Ps.FAIRPLAY:return Jt.FAIRPLAY;case Ps.PLAYREADY:return Jt.PLAYREADY;case Ps.WIDEVINE:return Jt.WIDEVINE;case Ps.CLEARKEY:return Jt.CLEARKEY}}function Jh(n){switch(n){case Jt.FAIRPLAY:return Ps.FAIRPLAY;case Jt.PLAYREADY:return Ps.PLAYREADY;case Jt.WIDEVINE:return Ps.WIDEVINE;case Jt.CLEARKEY:return Ps.CLEARKEY}}function Sl(n){const{drmSystems:e,widevineLicenseUrl:t}=n,s=e?[Jt.FAIRPLAY,Jt.WIDEVINE,Jt.PLAYREADY,Jt.CLEARKEY].filter(r=>!!e[r]):[];return!s[Jt.WIDEVINE]&&t&&s.push(Jt.WIDEVINE),s}const z1=(function(n){return od!=null&&(n=od.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Qk(n,e,t,s){let r;switch(n){case Jt.FAIRPLAY:r=["cenc","sinf"];break;case Jt.WIDEVINE:case Jt.PLAYREADY:r=["cenc"];break;case Jt.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return Zk(r,e,t,s)}function Zk(n,e,t,s){return[{initDataTypes:n,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(a=>({contentType:`audio/mp4; codecs=${a}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(a=>({contentType:`video/mp4; codecs=${a}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function Jk(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function Y1(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),l=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(l){const c=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(c){const f=Ep(c).subarray(0,16);return H1(f),f}}return null}let yu={};class aa{static clearKeyUriToKeyIdMap(){yu={}}static setKeyIdForUri(e,t){yu[e]=t}constructor(e,t,s,r=[1],a=null,l){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=r,this.iv=a,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ro(e),l!=null&&l.startsWith("0x")&&(this.keyId=new Uint8Array(S1(l)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&ad(e.keyFormatVersions,this.keyFormatVersions)&&dS(e.iv,this.iv)&&dS(e.keyId,this.keyId)}isSupported(){if(this.method){if(ro(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ps.FAIRPLAY:case Ps.WIDEVINE:case Ps.PLAYREADY:case Ps.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(ro(this.method)){let a=this.iv;return a||(typeof e!="number"&&(Mt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),a=tP(e)),new aa(this.method,this.uri,"identity",this.keyFormatVersions,a)}if(this.keyId){const a=yu[this.uri];if(a&&!ad(this.keyId,a)&&aa.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=K1(this.uri);if(s)switch(this.keyFormat){case Ps.WIDEVINE:if(this.pssh=s,!this.keyId){const a=ik(s.buffer);if(a.length){var r;const l=a[0];this.keyId=(r=l.kids)!=null&&r.length?l.kids[0]:null}}this.keyId||(this.keyId=fS(t));break;case Ps.PLAYREADY:{const a=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=nk(a,null,s),this.keyId=Y1(s);break}default:{let a=s.subarray(0,16);if(a.length!==16){const l=new Uint8Array(16);l.set(a,16-a.length),a=l}this.keyId=a;break}}if(!this.keyId||this.keyId.byteLength!==16){let a;a=eP(t),a||(a=fS(t),a||(a=yu[this.uri])),a&&(this.keyId=a,aa.setKeyIdForUri(this.uri,a))}return this}}function eP(n){const e=n?.[Ps.WIDEVINE];return e?e.keyId:null}function fS(n){const e=n?.[Ps.PLAYREADY];if(e){const t=K1(e.uri);if(t)return Y1(t)}return null}function tP(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const hS=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,mS=/#EXT-X-MEDIA:(.*)/g,sP=/^#EXT(?:INF|-X-TARGETDURATION):/m,em=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),nP=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class di{static findGroup(e,t){for(let s=0;s<e.length;s++){const r=e[s];if(r.id===t)return r}}static resolve(e,t){return hp.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return sP.test(e)}static parseMasterPlaylist(e,t){const s=lS(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},a=[];if(hS.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let l;for(;(l=hS.exec(e))!=null;)if(l[1]){var c;const d=new Zt(l[1],r),h=rg(r,l[2]),g={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:di.resolve(h,t)},y=d.decimalResolution("RESOLUTION");y&&(g.width=y.width,g.height=y.height),yS(d.CODECS,g);const v=d["SUPPLEMENTAL-CODECS"];v&&(g.supplemental={},yS(v,g.supplemental)),(c=g.unknownCodecs)!=null&&c.length||a.push(g),r.levels.push(g)}else if(l[3]){const d=l[3],h=l[4];switch(d){case"SESSION-DATA":{const g=new Zt(h,r),y=g["DATA-ID"];y&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[y]=g);break}case"SESSION-KEY":{const g=gS(h,t,r);g.encrypted&&g.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(g)):Mt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${h}"`);break}case"DEFINE":{{const g=new Zt(h,r);cS(r,g,t)}break}case"CONTENT-STEERING":{const g=new Zt(h,r);r.contentSteering={uri:di.resolve(g["SERVER-URI"],t),pathwayId:g["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=pS(h);break}}}const f=a.length>0&&a.length<r.levels.length;return r.levels=f?a:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,s){let r;const a={},l=s.levels,c={AUDIO:l.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:l.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let f=0;for(mS.lastIndex=0;(r=mS.exec(e))!==null;){const d=new Zt(r[1],s),h=d.TYPE;if(h){const g=c[h],y=a[h]||[];a[h]=y;const v=d.LANGUAGE,b=d["ASSOC-LANGUAGE"],T=d.CHANNELS,E=d.CHARACTERISTICS,_=d["INSTREAM-ID"],A={attrs:d,bitrate:0,id:f++,groupId:d["GROUP-ID"]||"",name:d.NAME||v||"",type:h,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:v,url:d.URI?di.resolve(d.URI,t):""};if(b&&(A.assocLang=b),T&&(A.channels=T),E&&(A.characteristics=E),_&&(A.instreamId=_),g!=null&&g.length){const C=di.findGroup(g,A.groupId)||g[0];xS(A,C,"audioCodec"),xS(A,C,"textCodec")}y.push(A)}}return a}static parseLevelPlaylist(e,t,s,r,a,l){var c;const f={url:t},d=new Xk(t),h=d.fragments,g=[];let y=null,v=0,b=0,T=0,E=0,_=0,A=null,C=new Wh(r,f),N,w,G,M=-1,B=!1,K=null,V;if(em.lastIndex=0,d.m3u8=e,d.hasVariableRefs=lS(e),((c=em.exec(e))==null?void 0:c[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(N=em.exec(e))!==null;){B&&(B=!1,C=new Wh(r,f),C.playlistOffset=T,C.setStart(T),C.sn=v,C.cc=E,_&&(C.bitrate=_),C.level=s,y&&(C.initSegment=y,y.rawProgramDateTime&&(C.rawProgramDateTime=y.rawProgramDateTime,y.rawProgramDateTime=null),K&&(C.setByteRange(K),K=null)));const Z=N[1];if(Z){C.duration=parseFloat(Z);const H=(" "+N[2]).slice(1);C.title=H||null,C.tagList.push(H?["INF",Z,H]:["INF",Z])}else if(N[3]){if(Be(C.duration)){C.playlistOffset=T,C.setStart(T),G&&bS(C,G,d),C.sn=v,C.level=s,C.cc=E,h.push(C);const H=(" "+N[3]).slice(1);C.relurl=rg(d,H),og(C,A,g),A=C,T+=C.duration,v++,b=0,B=!0}}else{if(N=N[0].match(nP),!N){Mt.warn("No matches on slow regex match for level playlist!");continue}for(w=1;w<N.length&&N[w]===void 0;w++);const H=(" "+N[w]).slice(1),k=(" "+N[w+1]).slice(1),F=N[w+2]?(" "+N[w+2]).slice(1):null;switch(H){case"BYTERANGE":A?C.setByteRange(k,A):C.setByteRange(k);break;case"PROGRAM-DATE-TIME":C.rawProgramDateTime=k,C.tagList.push(["PROGRAM-DATE-TIME",k]),M===-1&&(M=h.length);break;case"PLAYLIST-TYPE":d.type&&Mi(d,H,N),d.type=k.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?Mi(d,H,N):h.length>0&&SS(d,H,N),v=d.startSN=parseInt(k);break;case"SKIP":{d.skippedSegments&&Mi(d,H,N);const O=new Zt(k,d),Y=O.decimalInteger("SKIPPED-SEGMENTS");if(Be(Y)){d.skippedSegments+=Y;for(let j=Y;j--;)h.push(null);v+=Y}const I=O.enumeratedString("RECENTLY-REMOVED-DATERANGES");I&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(I.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&Mi(d,H,N),d.targetduration=Math.max(parseInt(k),1);break;case"VERSION":d.version!==null&&Mi(d,H,N),d.version=parseInt(k);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||Mi(d,H,N),d.live=!1;break;case"#":(k||F)&&C.tagList.push(F?[k,F]:[k]);break;case"DISCONTINUITY":E++,C.tagList.push(["DIS"]);break;case"GAP":C.gap=!0,C.tagList.push([H]);break;case"BITRATE":C.tagList.push([H,k]),_=parseInt(k)*1e3,Be(_)?C.bitrate=_:_=0;break;case"DATERANGE":{const O=new Zt(k,d),Y=new G1(O,d.dateRanges[O.ID],d.dateRangeTagCount);d.dateRangeTagCount++,Y.isValid||d.skippedSegments?d.dateRanges[Y.id]=Y:Mt.warn(`Ignoring invalid DATERANGE tag: "${k}"`),C.tagList.push(["EXT-X-DATERANGE",k]);break}case"DEFINE":{{const O=new Zt(k,d);"IMPORT"in O?Gk(d,O,l):cS(d,O,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?Mi(d,H,N):h.length>0&&SS(d,H,N),d.startCC=E=parseInt(k);break;case"KEY":{const O=gS(k,t,d);if(O.isSupported()){if(O.method==="NONE"){G=void 0;break}G||(G={});const Y=G[O.keyFormat];Y!=null&&Y.matches(O)||(Y&&(G=$t({},G)),G[O.keyFormat]=O)}else Mt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${k}"`);break}case"START":d.startTimeOffset=pS(k);break;case"MAP":{const O=new Zt(k,d);if(C.duration){const Y=new Wh(r,f);vS(Y,O,s,G),y=Y,C.initSegment=y,y.rawProgramDateTime&&!C.rawProgramDateTime&&(C.rawProgramDateTime=y.rawProgramDateTime)}else{const Y=C.byteRangeEndOffset;if(Y){const I=C.byteRangeStartOffset;K=`${Y-I}@${I}`}else K=null;vS(C,O,s,G),y=C,B=!0}y.cc=E;break}case"SERVER-CONTROL":{V&&Mi(d,H,N),V=new Zt(k),d.canBlockReload=V.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=V.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&V.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=V.optionalFloat("PART-HOLD-BACK",0),d.holdBack=V.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&Mi(d,H,N);const O=new Zt(k);d.partTarget=O.decimalFloatingPoint("PART-TARGET");break}case"PART":{let O=d.partList;O||(O=d.partList=[]);const Y=b>0?O[O.length-1]:void 0,I=b++,j=new Zt(k,d),z=new G2(j,C,f,I,Y);O.push(z),C.duration+=z.duration;break}case"PRELOAD-HINT":{const O=new Zt(k,d);d.preloadHint=O;break}case"RENDITION-REPORT":{const O=new Zt(k,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(O);break}default:Mt.warn(`line parsed but not handled: ${N}`);break}}}A&&!A.relurl?(h.pop(),T-=A.duration,d.partList&&(d.fragmentHint=A)):d.partList&&(og(C,A,g),C.cc=E,d.fragmentHint=C,G&&bS(C,G,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const $=h.length,ee=h[0],he=h[$-1];if(T+=d.skippedSegments*d.targetduration,T>0&&$&&he){d.averagetargetduration=T/$;const Z=he.sn;d.endSN=Z!=="initSegment"?Z:0,d.live||(he.endList=!0),M>0&&(rP(h,M),ee&&g.unshift(ee))}return d.fragmentHint&&(T+=d.fragmentHint.duration),d.totalduration=T,g.length&&d.dateRangeTagCount&&ee&&q1(g,d),d.endCC=E,d}}function q1(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const c=e.fragments[e.fragments.length-1];n.push(c),t++}else return;const s=n[t-1],r=e.live?1/0:e.totalduration,a=Object.keys(e.dateRanges);for(let c=a.length;c--;){const f=e.dateRanges[a[c]],d=f.startDate.getTime();f.tagAnchor=s.ref;for(let h=t;h--;){var l;if(((l=n[h])==null?void 0:l.sn)<e.startSN)break;const g=iP(e,d,n,h,r);if(g!==-1){f.tagAnchor=e.fragments[g].ref;break}}}}function iP(n,e,t,s,r){const a=t[s];if(a){const c=a.programDateTime;if(e>=c||s===0){var l;const f=(((l=t[s+1])==null?void 0:l.start)||r)-a.start;if(e<=c+f*1e3){const d=t[s].sn-n.startSN;if(d<0)return-1;const h=n.fragments;if(h.length>t.length){const y=(t[s+1]||h[h.length-1]).sn-n.startSN;for(let v=y;v>d;v--){const b=h[v].programDateTime;if(e>=b&&e<b+h[v].duration*1e3)return v}}return d}}}return-1}function gS(n,e,t){var s,r;const a=new Zt(n,t),l=(s=a.METHOD)!=null?s:"",c=a.URI,f=a.hexadecimalInteger("IV"),d=a.KEYFORMATVERSIONS,h=(r=a.KEYFORMAT)!=null?r:"identity";c&&a.IV&&!f&&Mt.error(`Invalid IV: ${a.IV}`);const g=c?di.resolve(c,e):"",y=(d||"1").split("/").map(Number).filter(Number.isFinite);return new aa(l,g,h,y,f,a.KEYID)}function pS(n){const t=new Zt(n).decimalFloatingPoint("TIME-OFFSET");return Be(t)?t:null}function yS(n,e){let t=(n||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const r=t.filter(a=>pp(a,s));r.length&&(e[`${s}Codec`]=r.map(a=>a.split("/")[0]).join(","),t=t.filter(a=>r.indexOf(a)===-1))}),e.unknownCodecs=t}function xS(n,e,t){const s=e[t];s&&(n[t]=s)}function rP(n,e){let t=n[e];for(let s=e;s--;){const r=n[s];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function og(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function vS(n,e,t,s){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",s&&(n.levelkeys=s),n.initSegment=null}function bS(n,e,t){n.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&s.push(n)}function Mi(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function SS(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function tm(n,e){const t=e.startPTS;if(Be(t)){let s=0,r;e.sn>n.sn?(s=t-n.start,r=n):(s=n.start-t,r=e),r.duration!==s&&r.setDuration(s)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function X1(n,e,t,s,r,a,l){s-t<=0&&(l.warn("Fragment should have a positive duration",e),s=t+e.duration,a=r+e.duration);let f=t,d=s;const h=e.startPTS,g=e.endPTS;if(Be(h)){const _=Math.abs(h-t);n&&_>n.totalduration?l.warn(`media timestamps and playlist times differ by ${_}s for level ${e.level} ${n.url}`):Be(e.deltaPTS)?e.deltaPTS=Math.max(_,e.deltaPTS):e.deltaPTS=_,f=Math.max(t,h),t=Math.min(t,h),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,d=Math.min(s,g),s=Math.max(s,g),a=e.endDTS!==void 0?Math.max(a,e.endDTS):a}const y=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=f,e.startDTS=r,e.endPTS=s,e.minEndPTS=d,e.endDTS=a;const v=e.sn;if(!n||v<n.startSN||v>n.endSN)return 0;let b;const T=v-n.startSN,E=n.fragments;for(E[T]=e,b=T;b>0;b--)tm(E[b],E[b-1]);for(b=T;b<E.length-1;b++)tm(E[b],E[b+1]);return n.fragmentHint&&tm(E[E.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,y}function aP(n,e,t){if(n===e)return;let s=null;const r=n.fragments;for(let h=r.length-1;h>=0;h--){const g=r[h].initSegment;if(g){s=g;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let a;cP(n,e,(h,g,y,v)=>{if((!e.startCC||e.skippedSegments)&&g.cc!==h.cc){const b=h.cc-g.cc;for(let T=y;T<v.length;T++)v[T].cc+=b;e.endCC=v[v.length-1].cc}Be(h.startPTS)&&Be(h.endPTS)&&(g.setStart(g.startPTS=h.startPTS),g.startDTS=h.startDTS,g.maxStartPTS=h.maxStartPTS,g.endPTS=h.endPTS,g.endDTS=h.endDTS,g.minEndPTS=h.minEndPTS,g.setDuration(h.endPTS-h.startPTS),g.duration&&(a=g),e.PTSKnown=e.alignedSliding=!0),h.hasStreams&&(g.elementaryStreams=h.elementaryStreams),g.loader=h.loader,h.hasStats&&(g.stats=h.stats),h.initSegment&&(g.initSegment=h.initSegment,s=h.initSegment)});const l=e.fragments,c=e.fragmentHint?l.concat(e.fragmentHint):l;if(s&&c.forEach(h=>{var g;h&&(!h.initSegment||h.initSegment.relurl===((g=s)==null?void 0:g.relurl))&&(h.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=l.some(h=>!h),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=e.skippedSegments;h--;)l.shift();e.startSN=l[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=oP(n.dateRanges,e,t));const h=n.fragments.filter(g=>g.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let g=1;g<c.length;g++)c[g].programDateTime===null&&og(c[g],c[g-1],h);q1(h,e)}e.endCC=l[l.length-1].cc}if(!e.startCC){var f;const h=Z1(n,e.startSN-1);e.startCC=(f=h?.cc)!=null?f:l[0].cc}lP(n.partList,e.partList,(h,g)=>{g.elementaryStreams=h.elementaryStreams,g.stats=h.stats}),a?X1(e,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS,t):W1(n,e),l.length&&(e.totalduration=e.edge-l[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const h=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=h),e.driftEndTime=d,e.driftEnd=h}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function oP(n,e,t){const{dateRanges:s,recentlyRemovedDateranges:r}=e,a=$t({},n);r&&r.forEach(f=>{delete a[f]});const c=Object.keys(a).length;return c?(Object.keys(s).forEach(f=>{const d=a[f],h=new G1(s[f].attr,d);h.isValid?(a[f]=h,d||(h.tagOrder+=c)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Kt(s[f].attr)}"`)}),a):s}function lP(n,e,t){if(n&&e){let s=0;for(let r=0,a=n.length;r<=a;r++){const l=n[r],c=e[r+s];l&&c&&l.index===c.index&&l.fragment.sn===c.fragment.sn?t(l,c):s--}}}function cP(n,e,t){const s=e.skippedSegments,r=Math.max(n.startSN,e.startSN)-e.startSN,a=(n.fragmentHint?1:0)+(s?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,l=e.startSN-n.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,f=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let d=r;d<=a;d++){const h=f[l+d];let g=c[d];if(s&&!g&&h&&(g=e.fragments[d]=h),h&&g){t(h,g,d,c);const y=h.relurl,v=g.relurl;if(y&&uP(y,v)){e.playlistParsingError=ES(`media sequence mismatch ${g.sn}:`,n,e,h,g);return}else if(h.cc!==g.cc){e.playlistParsingError=ES(`discontinuity sequence mismatch (${h.cc}!=${g.cc})`,n,e,h,g);return}}}}function ES(n,e,t,s,r){return new Error(`${n} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function W1(n,e,t=!0){const s=e.startSN+e.skippedSegments-n.startSN,r=n.fragments,a=s>=0;let l=0;if(a&&s<r.length)l=r[s].start;else if(a&&e.startSN===n.endSN+1)l=n.fragmentEnd;else if(a&&t)l=n.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)l=n.fragmentStart;else return;lg(e,l)}function lg(n,e){if(e){const t=n.fragments;for(let s=n.skippedSegments;s<t.length;s++)t[s].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function Q1(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const s=n.fragments;if(s.length&&t*4>e){const a=s[s.length-1].duration*1e3;a<t&&(t=a)}}else t/=2;return Math.round(t)}function Z1(n,e,t){if(!n)return null;let s=n.fragments[e-n.startSN];return s||(s=n.fragmentHint,s&&s.sn===e)?s:e<n.startSN&&t&&t.sn===e?t:null}function TS(n,e,t){return n?J1(n.partList,e,t):null}function J1(n,e,t){if(n)for(let s=n.length;s--;){const r=n[s];if(r.index===t&&r.fragment.sn===e)return r}return null}function eA(n){n.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function uP(n,e){return n!==e&&e?AS(n)!==AS(e):!1}function AS(n){return n.replace(/\?[^?]*$/,"")}function Ll(n,e){for(let s=0,r=n.length;s<r;s++){var t;if(((t=n[s])==null?void 0:t.cc)===e)return n[s]}return null}function dP(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function _S(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function tA(n,e){const t=e.fragments;for(let s=0,r=t.length;s<r;s++)_S(t[s],n);e.fragmentHint&&_S(e.fragmentHint,n),e.alignedSliding=!0}function fP(n,e){n&&(sA(e,n),e.alignedSliding||ld(e,n),!e.alignedSliding&&!e.skippedSegments&&W1(n,e,!1))}function sA(n,e){if(!dP(e,n))return;const t=Math.min(e.endCC,n.endCC),s=Ll(e.fragments,t),r=Ll(n.fragments,t);if(!s||!r)return;Mt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const a=s.start-r.start;tA(a,n)}function ld(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,s=e.fragments;if(!t.length||!s.length)return;let r,a;const l=Math.min(e.endCC,n.endCC);e.startCC<l&&n.startCC<l&&(r=Ll(s,l),a=Ll(t,l)),(!r||!a)&&(r=s[Math.floor(s.length/2)],a=Ll(t,r.cc)||t[Math.floor(t.length/2)]);const c=r.programDateTime,f=a.programDateTime;if(!c||!f)return;const d=(f-c)/1e3-(a.start-r.start);tA(d,n)}function Ks(n,e,t){nn(n,e,t),n.addEventListener(e,t)}function nn(n,e,t){n.removeEventListener(e,t)}const hP={toString:function(n){let e="";const t=n.length;for(let s=0;s<t;s++)e+=`[${n.start(s).toFixed(3)}-${n.end(s).toFixed(3)}]`;return e}},Ee={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Tp extends $1{constructor(e,t,s,r,a){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Ee.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:l,fragCurrent:c,media:f,mediaBuffer:d,state:h}=this,g=f?f.currentTime:0,y=lt.bufferInfo(d||f,g,l.maxBufferHole),v=!y.len;if(this.log(`Media seeking to ${Be(g)?g.toFixed(3):g}, state: ${h}, ${v?"out of":"in"} buffer`),this.state===Ee.ENDED)this.resetLoadingState();else if(c){const b=l.maxFragLookUpTolerance,T=c.start-b,E=c.start+c.duration+b;if(v||E<y.start||T>y.end){const _=g>E;(g<T||_)&&(_&&c.loader&&(this.log(`Cancelling fragment load for seek (sn: ${c.sn})`),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(f){this.fragmentTracker.removeFragmentsInRange(g,1/0,this.playlistType,!0);const b=this.lastCurrentTime;if(g>b&&(this.lastCurrentTime=g),!this.loadingParts){const T=Math.max(y.end,g),E=this.shouldLoadParts(this.getLevelDetails(),T);E&&(this.log(`LL-Part loading ON after seeking to ${g.toFixed(2)} with buffer @${T.toFixed(2)}`),this.loadingParts=E)}}this.hls.hasEnoughToStart||(this.log(`Setting ${v?"startPosition":"nextLoadPosition"} to ${g} for seek without enough to start`),this.nextLoadPosition=g,v&&(this.startPosition=g)),v&&this.state===Ee.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=a,this.hls=e,this.fragmentLoader=new $k(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new vp(e.config)}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Ee.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Ee.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,r=this.config.timelineOffset||0;if(s<=r)return!1;const a=e.buffered;this.config.maxBufferHole&&a&&a.length>1&&(e=lt.bufferedInfo(a,e.start,0));const l=e.nextStart;if(l&&l>r&&l<t.edge||this.media.currentTime<e.start)return!1;const f=t.partList;if(f!=null&&f.length){const h=f[f.length-1];return lt.isBuffered(this.media,h.start+h.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;Ks(s,"seeking",this.onMediaSeeking),Ks(s,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===Ee.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),nn(r,"seeking",this.onMediaSeeking),nn(r,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Ee.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const r=a=>{const l=a.frag;if(this.fragContextChanged(l)){this.warn(`${l.type} sn: ${l.sn}${a.part?" part: "+a.part.index:""} of ${this.fragInfo(l,!1,a.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(l);return}l.stats.chunkCount++,this._handleFragmentLoadProgress(a)};this._doFragLoad(e,t,s,r).then(a=>{if(!a)return;const l=this.state,c=a.frag;if(this.fragContextChanged(c)){(l===Ee.FRAG_LOADING||!this.fragCurrent&&l===Ee.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=Ee.IDLE);return}"payload"in a&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(L.FRAG_LOADED,a)),this._handleFragmentLoadComplete(a)}).catch(a=>{this.state===Ee.STOPPED||this.state===Ee.ERROR||(this.warn(`Frag error: ${a?.message||a}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===Es.APPENDING){const a=e.type,l=this.getFwdBufferInfo(this.mediaBuffer,a),c=Math.max(e.duration,l?l.len:this.config.maxBufferLength),f=this.backtrackFragment;((f?e.sn-f.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===Es.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:s};this.hls.trigger(L.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const r=s?.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:r}=this,{frag:a,payload:l}=s,c=a.decryptdata;if(l&&l.byteLength>0&&c!=null&&c.key&&c.iv&&ro(c.method)){const f=self.performance.now();return this.decrypter.decrypt(new Uint8Array(l),c.key.buffer,c.iv.buffer,Sp(c.method)).catch(d=>{throw r.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:a}),d}).then(d=>{const h=self.performance.now();return r.trigger(L.FRAG_DECRYPTED,{frag:a,payload:d,stats:{tstart:f,tdecrypt:h}}),s.payload=d,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===Ee.STOPPED||this.state===Ee.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==Ee.STOPPED&&(this.state=Ee.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,r;const a=e.tracks;if(a&&!t.encrypted&&((s=a.audio)!=null&&s.encrypted||(r=a.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const l=this.media,c=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${l?"attached mediaKeys: "+l.mediaKeys:"detached"})`);return this.warn(c.message),!l||l.mediaKeys?!1:(this.hls.trigger(L.ERROR,{type:Xe.KEY_SYSTEM_ERROR,details:ue.KEY_SYSTEM_NO_KEYS,fatal:!1,error:c,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?hP.toString(lt.getBuffered(s)):"(detached)"})`),gs(e)){var r;if(e.type!==He.SUBTITLE){const l=e.elementaryStreams;if(!Object.keys(l).some(c=>!!l[c])){this.state=Ee.IDLE;return}}const a=(r=this.levels)==null?void 0:r[e.level];a!=null&&a.fragmentError&&(this.log(`Resetting level fragment error count of ${a.fragmentError} on frag buffered`),a.fragmentError=0)}this.state=Ee.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:r,partsLoaded:a}=e,l=!a||a.length===0||a.some(f=>!f),c=new bp(s.level,s.sn,s.stats.chunkCount+1,0,r?r.index:-1,!l);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,r){var a;this.fragCurrent=e;const l=t.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let c=null;if(e.encrypted&&!((a=e.decryptdata)!=null&&a.key)){if(this.log(`Loading key for ${e.sn} of [${l.startSN}-${l.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Ee.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(y=>{if(!this.fragContextChanged(y.frag))return this.hls.trigger(L.KEY_LOADED,y),this.state===Ee.KEY_LOADING&&(this.state=Ee.IDLE),y}),this.hls.trigger(L.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(c=this.keyLoader.loadClear(e,l.encryptedFragments,this.startFragRequested),c&&this.log("[eme] blocking frag load until media-keys acquired"));const f=this.fragPrevious;if(gs(e)&&(!f||e.sn!==f.sn)){const y=this.shouldLoadParts(t.details,e.end);y!==this.loadingParts&&(this.log(`LL-Part loading ${y?"ON":"OFF"} loading sn ${f?.sn}->${e.sn}`),this.loadingParts=y)}if(s=Math.max(e.start,s||0),this.loadingParts&&gs(e)){const y=l.partList;if(y&&r){s>l.fragmentEnd&&l.fragmentHint&&(e=l.fragmentHint);const v=this.getNextPart(y,e,s);if(v>-1){const b=y[v];e=this.fragCurrent=b.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${b.index} (${v}/${y.length-1}) of ${this.fragInfo(e,!1,b)}) cc: ${e.cc} [${l.startSN}-${l.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=b.start+b.duration,this.state=Ee.FRAG_LOADING;let T;return c?T=c.then(E=>!E||this.fragContextChanged(E.frag)?null:this.doFragPartsLoad(e,b,t,r)).catch(E=>this.handleFragLoadError(E)):T=this.doFragPartsLoad(e,b,t,r).catch(E=>this.handleFragLoadError(E)),this.hls.trigger(L.FRAG_LOADING,{frag:e,part:b,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):T}else if(!e.url||this.loadedEndOfParts(y,s))return Promise.resolve(null)}}if(gs(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=l.partList)==null?void 0:d.filter(y=>y.loaded).map(y=>`[${y.start}-${y.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+l.startSN+"-"+l.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),Be(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Ee.FRAG_LOADING;const h=this.config.progressive;let g;return h&&c?g=c.then(y=>!y||this.fragContextChanged(y.frag)?null:this.fragmentLoader.load(e,r)).catch(y=>this.handleFragLoadError(y)):g=Promise.all([this.fragmentLoader.load(e,h?r:void 0),c]).then(([y])=>(!h&&r&&r(y),y)).catch(y=>this.handleFragLoadError(y)),this.hls.trigger(L.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g}doFragPartsLoad(e,t,s,r){return new Promise((a,l)=>{var c;const f=[],d=(c=s.details)==null?void 0:c.partList,h=g=>{this.fragmentLoader.loadPart(e,g,r).then(y=>{f[g.index]=y;const v=y.part;this.hls.trigger(L.FRAG_LOADED,y);const b=TS(s.details,e.sn,g.index+1)||J1(d,e.sn,g.index+1);if(b)h(b);else return a({frag:e,part:v,partsLoaded:f})}).catch(l)};h(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===ue.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Xe.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(L.ERROR,t)}else this.hls.trigger(L.ERROR,{type:Xe.OTHER_ERROR,details:ue.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Ee.PARSING){!this.fragCurrent&&this.state!==Ee.STOPPED&&this.state!==Ee.ERROR&&(this.state=Ee.IDLE);return}const{frag:s,part:r,level:a}=t,l=self.performance.now();s.stats.parsing.end=l,r&&(r.stats.parsing.end=l);const c=this.getLevelDetails(),d=c&&s.sn>c.endSN||this.shouldLoadParts(c,s.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(s,r,a,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const a=e.partList[0];if(a.fragment.type===He.SUBTITLE)return!1;const l=a.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=l){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>a.start-a.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:r,sn:a,part:l}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${a} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const c=t[r],f=c.details,d=l>-1?TS(f,a,l):null,h=d?d.fragment:Z1(f,a,s);return h?(s&&s!==h&&(h.stats=s.stats),{frag:h,part:d,level:c}):null}bufferFragmentData(e,t,s,r,a){if(this.state!==Ee.PARSING)return;const{data1:l,data2:c}=e;let f=l;if(c&&(f=Nn(l,c)),!f.length)return;const d=this.initPTS[t.cc],h=d?-d.baseTime/d.timescale:void 0,g={type:e.type,frag:t,part:s,chunkMeta:r,offset:h,parent:t.type,data:f};if(this.hls.trigger(L.BUFFER_APPENDING,g),e.dropped&&e.independent&&!s){if(a)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!lt.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,r=lt.bufferInfo(t,s,0),a=e.duration,l=Math.min(this.config.maxFragLookUpTolerance*2,a*.25),c=Math.max(Math.min(e.start-l,r.end-l),s+l);e.start-c>l&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){var s;const r=this.getLoadPosition();if(!Be(r))return null;const l=this.lastCurrentTime>r||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,l)}getFwdBufferInfoAtPos(e,t,s,r){const a=lt.bufferInfo(e,t,r);if(a.len===0&&a.nextStart!==void 0){const l=this.fragmentTracker.getBufferedFrag(t,s);if(l&&(a.nextStart<=l.end||l.gap)){const c=Math.max(Math.min(a.nextStart,l.end)-t,r);return lt.bufferInfo(e,t,c)}}return a}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,r=Math.max(Math.min(e-t,s.maxBufferLength),t),a=Math.max(e-t*3,s.maxMaxBufferLength/2,r);return a>=r?(s.maxMaxBufferLength=a,this.warn(`Reduce max buffer length to ${a}s`),!0):!1}getAppendedFrag(e,t=He.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,r=s.length;if(!r)return null;const{config:a}=this,l=s[0].start,c=a.lowLatencyMode&&!!t.partList;let f=null;if(t.live){const g=a.initialLiveManifestSize;if(r<g)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${g})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<l){var d;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),f=this.getInitialLiveFragment(t);const y=this.hls.startPosition,v=this.hls.liveSyncPosition,b=f?(y!==-1&&y>=l?y:v)||f.start:e;this.log(`Setting startPosition to ${b} to match start frag at live edge. mainStart: ${y} liveSyncPosition: ${v} frag.start: ${(d=f)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=b}}else e<=l&&(f=s[0]);if(!f){const g=this.loadingParts?t.partEnd:t.fragmentEnd;f=this.getFragmentAtPosition(e,g,t)}let h=this.filterReplacedPrimary(f,t);if(!h&&f){const g=f.sn-t.startSN;h=this.filterReplacedPrimary(s[g+1]||null,t)}return this.mapToInitFragWhenRequired(h)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===Es.OK||s===Es.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,r,a){let l=null;if(e.gap&&(l=this.getNextFragment(this.nextLoadPosition,t),l&&!l.gap&&s.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,r,0);if(c!==null&&s.len+c.len>=a){const f=l.sn;return this.loopSn!==f&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${f}`),this.loopSn=f),null}}return this.loopSn=void 0,l}get primaryPrefetch(){if(CS(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(CS(this.config)&&e.type!==He.SUBTITLE){const s=this.hls.interstitialsManager,r=s?.bufferingItem;if(r){const l=r.event;if(l){if(l.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&t?.live===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const a=s?.playerQueue;if(a)for(let l=a.length;l--;){const c=a[l].interstitial;if(c.appendInPlace&&e.start>=c.startTime&&e.end<=c.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let r=-1,a=!1,l=!0;for(let c=0,f=e.length;c<f;c++){const d=e[c];if(l=l&&!d.independent,r>-1&&s<d.start)break;const h=d.loaded;h?r=-1:(a||(d.independent||l)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${d.start}`),r=c),a=h}return r}loadedEndOfParts(e,t){let s;for(let r=e.length;r--;){if(s=e[r],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let r=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),r=Rk(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const a=s.sn+1;if(a>=e.startSN&&a<=e.endSN){const l=t[a-e.startSN];s.cc===l.cc&&(r=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=U1(e,s.cc,s.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const a=this.hls.liveSyncPosition;a!==null&&(r=this.getFragmentAtPosition(a,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,s){const{config:r}=this;let{fragPrevious:a}=this,{fragments:l,endSN:c}=s;const{fragmentHint:f}=s,{maxFragLookUpTolerance:d}=r,h=s.partList,g=!!(this.loadingParts&&h!=null&&h.length&&f);g&&!this.bitrateTest&&h[h.length-1].fragment.sn===f.sn&&(l=l.concat(f),c=f.sn);let y;if(e<t){var v;const T=e<this.lastCurrentTime||e>t-d||(v=this.media)!=null&&v.paused||!this.startFragRequested?0:d;y=la(a,l,e,T)}else y=l[l.length-1];if(y){const b=y.sn-s.startSN,T=this.fragmentTracker.getState(y);if((T===Es.OK||T===Es.PARTIAL&&y.gap)&&(a=y),a&&y.sn===a.sn&&(!g||h[0].fragment.sn>y.sn||!s.live)&&y.level===a.level){const _=l[b+1];y.sn<c&&this.fragmentTracker.getState(_)!==Es.OK?y=_:y=null}}return y}alignPlaylists(e,t,s){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const a=e.fragmentStart,l=!t,c=e.alignedSliding&&Be(a);if(l||!c&&!a){fP(s,e);const f=e.fragmentStart;return this.log(`Live playlist sliding: ${f.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),f}return a}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const r=this.timelineOffset;if(s===-1){const a=this.startTimeOffset!==null,l=a?this.startTimeOffset:e.startTimeOffset;l!==null&&Be(l)?(s=t+l,l<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${l} found in ${a?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+r}this.nextLoadPosition=s+r}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&gs(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==Ee.FRAG_LOADING_WAITING_RETRY)&&(this.state=Ee.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const _=this.getCurrentContext(t.chunkMeta);_&&(t.frag=_.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var a;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(a=this.fragCurrent)==null?void 0:a.url}`);return}const l=t.details===ue.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(r,!0);const c=t.errorAction;if(!c){this.state=Ee.ERROR;return}const{action:f,flags:d,retryCount:h=0,retryConfig:g}=c,y=!!g,v=y&&f===ks.RetryRequest,b=y&&!c.resolved&&d===hn.MoveAllAlternatesMatchingHost,T=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!v&&b&&gs(r)&&!r.endList&&T&&!B1(t))this.resetFragmentErrors(e),this.treatAsGap(r),c.resolved=!0;else if((v||b)&&h<g.maxNumRetry){var E;const _=ig((E=t.response)==null?void 0:E.code),A=xp(g,h);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+A,this.state=Ee.FRAG_LOADING_WAITING_RETRY,c.resolved=!0,_){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${h+1}/${g.maxNumRetry} in ${A}ms`)}else if(g)if(this.resetFragmentErrors(e),h<g.maxNumRetry)!l&&f!==ks.RemoveAlternatePermanently&&(c.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${h})`);return}else f===ks.SendAlternateToPenaltyBox?this.state=Ee.WAITING_LEVEL:this.state=Ee.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!ig(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=Ee.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===Ee.PARSING||this.state===Ee.PARSED){const t=e.frag,s=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,s),a=r&&r.len>.5;a&&this.reduceMaxBufferLength(r.len,t?.duration||10);const l=!a;return l&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),l}return!1}resetFragmentErrors(e){e===He.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Ee.STOPPED&&(this.state=Ee.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const r=lt.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,s),this.state===Ee.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Ee.STOPPED&&(this.state=Ee.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,r){const a=s.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((f,d)=>{const h=e.elementaryStreams[d];if(h){const g=h.endPTS-h.startPTS;if(g<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${g})`),f||!1;const y=r?0:X1(a,e,h.startPTS,h.endPTS,h.startDTS,h.endDTS,this);return this.hls.trigger(L.LEVEL_PTS_UPDATED,{details:a,level:s,drift:y,type:d,frag:e,start:h.startPTS,end:h.endPTS}),!0}return f},!1)){var c;if(s.fragmentError===0&&this.treatAsGap(e,s),((c=this.transmuxer)==null?void 0:c.error)===null){const f=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(f.message),this.hls.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.FRAG_PARSING_ERROR,fatal:!1,error:f,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=Ee.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(L.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===He.MAIN?"level":"track"}fragInfo(e,t=!0,s){var r,a;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((r=t&&!s?e.startPTS:(s||e).start)!=null?r:NaN).toFixed(3)}-${((a=t&&!s?e.endPTS:(s||e).end)!=null?a:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function CS(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class nA{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=mP(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function mP(n,e){const t=new Uint8Array(e);let s=0;for(let r=0;r<n.length;r++){const a=n[r];t.set(a,s),s+=a.length}return t}var sm={exports:{}},LS;function gP(){return LS||(LS=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function r(f,d,h){this.fn=f,this.context=d,this.once=h||!1}function a(f,d,h,g,y){if(typeof h!="function")throw new TypeError("The listener must be a function");var v=new r(h,g||f,y),b=t?t+d:d;return f._events[b]?f._events[b].fn?f._events[b]=[f._events[b],v]:f._events[b].push(v):(f._events[b]=v,f._eventsCount++),f}function l(f,d){--f._eventsCount===0?f._events=new s:delete f._events[d]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var d=[],h,g;if(this._eventsCount===0)return d;for(g in h=this._events)e.call(h,g)&&d.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(h)):d},c.prototype.listeners=function(d){var h=t?t+d:d,g=this._events[h];if(!g)return[];if(g.fn)return[g.fn];for(var y=0,v=g.length,b=new Array(v);y<v;y++)b[y]=g[y].fn;return b},c.prototype.listenerCount=function(d){var h=t?t+d:d,g=this._events[h];return g?g.fn?1:g.length:0},c.prototype.emit=function(d,h,g,y,v,b){var T=t?t+d:d;if(!this._events[T])return!1;var E=this._events[T],_=arguments.length,A,C;if(E.fn){switch(E.once&&this.removeListener(d,E.fn,void 0,!0),_){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,h),!0;case 3:return E.fn.call(E.context,h,g),!0;case 4:return E.fn.call(E.context,h,g,y),!0;case 5:return E.fn.call(E.context,h,g,y,v),!0;case 6:return E.fn.call(E.context,h,g,y,v,b),!0}for(C=1,A=new Array(_-1);C<_;C++)A[C-1]=arguments[C];E.fn.apply(E.context,A)}else{var N=E.length,w;for(C=0;C<N;C++)switch(E[C].once&&this.removeListener(d,E[C].fn,void 0,!0),_){case 1:E[C].fn.call(E[C].context);break;case 2:E[C].fn.call(E[C].context,h);break;case 3:E[C].fn.call(E[C].context,h,g);break;case 4:E[C].fn.call(E[C].context,h,g,y);break;default:if(!A)for(w=1,A=new Array(_-1);w<_;w++)A[w-1]=arguments[w];E[C].fn.apply(E[C].context,A)}}return!0},c.prototype.on=function(d,h,g){return a(this,d,h,g,!1)},c.prototype.once=function(d,h,g){return a(this,d,h,g,!0)},c.prototype.removeListener=function(d,h,g,y){var v=t?t+d:d;if(!this._events[v])return this;if(!h)return l(this,v),this;var b=this._events[v];if(b.fn)b.fn===h&&(!y||b.once)&&(!g||b.context===g)&&l(this,v);else{for(var T=0,E=[],_=b.length;T<_;T++)(b[T].fn!==h||y&&!b[T].once||g&&b[T].context!==g)&&E.push(b[T]);E.length?this._events[v]=E.length===1?E[0]:E:l(this,v)}return this},c.prototype.removeAllListeners=function(d){var h;return d?(h=t?t+d:d,this._events[h]&&l(this,h)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,n.exports=c})(sm)),sm.exports}var pP=gP(),Ap=$2(pP);const $l="1.6.13",fo={};function yP(){return typeof __HLS_WORKER_BUNDLE__=="function"}function xP(){const n=fo[$l];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return fo[$l]=r,r}function vP(n){const e=fo[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return fo[n]=r,r}function bP(n){const e=fo[n||$l];if(e&&e.clientCount--===1){const{worker:s,objectURL:r}=e;delete fo[n||$l],r&&self.URL.revokeObjectURL(r),s.terminate()}}function iA(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function _p(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function bd(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function Vl(n,e){const t=e;let s=0;for(;_p(n,e);){s+=10;const r=bd(n,e+6);s+=r,iA(n,e+10)&&(s+=10),e+=s}if(s>0)return n.subarray(t,t+s)}function SP(n,e,t,s){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=e[t+2],l=a>>2&15;if(l>12){const v=new Error(`invalid ADTS sampling index:${l}`);n.emit(L.ERROR,L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.FRAG_PARSING_ERROR,fatal:!0,error:v,reason:v.message});return}const c=(a>>6&3)+1,f=e[t+3]>>6&3|(a&1)<<2,d="mp4a.40."+c,h=r[l];let g=l;(c===5||c===29)&&(g-=3);const y=[c<<3|(g&14)>>1,(g&1)<<7|f<<3];return Mt.log(`manifest codec:${s}, parsed codec:${d}, channels:${f}, rate:${h} (ADTS object type:${c} sampling index:${l})`),{config:y,samplerate:h,channelCount:f,codec:d,parsedCodec:d,manifestCodec:s}}function rA(n,e){return n[e]===255&&(n[e+1]&246)===240}function aA(n,e){return n[e+1]&1?7:9}function Cp(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function EP(n,e){return e+5<n.length}function cd(n,e){return e+1<n.length&&rA(n,e)}function TP(n,e){return EP(n,e)&&rA(n,e)&&Cp(n,e)<=n.length-e}function AP(n,e){if(cd(n,e)){const t=aA(n,e);if(e+t>=n.length)return!1;const s=Cp(n,e);if(s<=t)return!1;const r=e+s;return r===n.length||cd(n,r)}return!1}function oA(n,e,t,s,r){if(!n.samplerate){const a=SP(e,t,s,r);if(!a)return;$t(n,a)}}function lA(n){return 1024*9e4/n}function _P(n,e){const t=aA(n,e);if(e+t<=n.length){const s=Cp(n,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function cA(n,e,t,s,r){const a=lA(n.samplerate),l=s+r*a,c=_P(e,t);let f;if(c){const{frameLength:g,headerLength:y}=c,v=y+g,b=Math.max(0,t+v-e.length);b?(f=new Uint8Array(v-y),f.set(e.subarray(t+y,e.length),0)):f=e.subarray(t+y,t+v);const T={unit:f,pts:l};return b||n.samples.push(T),{sample:T,length:v,missing:b}}const d=e.length-t;return f=new Uint8Array(d),f.set(e.subarray(t,e.length),0),{sample:{unit:f,pts:l},length:d,missing:-1}}function CP(n,e){return _p(n,e)&&bd(n,e+6)+10<=n.length-e}function LP(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function nm(n,e=0,t=1/0){return wP(n,e,t,Uint8Array)}function wP(n,e,t,s){const r=RP(n);let a=1;"BYTES_PER_ELEMENT"in s&&(a=s.BYTES_PER_ELEMENT);const l=DP(n)?n.byteOffset:0,c=(l+n.byteLength)/a,f=(l+e)/a,d=Math.floor(Math.max(0,Math.min(f,c))),h=Math.floor(Math.min(d+Math.max(t,0),c));return new s(r,d,h-d)}function RP(n){return n instanceof ArrayBuffer?n:n.buffer}function DP(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function IP(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=n.data.subarray(1).indexOf(0);if(s===-1)return;const r=pn(nm(n.data,1,s)),a=n.data[2+s],l=n.data.subarray(3+s).indexOf(0);if(l===-1)return;const c=pn(nm(n.data,3+s,l));let f;return r==="-->"?f=pn(nm(n.data,4+s+l)):f=LP(n.data.subarray(4+s+l)),e.mimeType=r,e.pictureType=a,e.description=c,e.data=f,e}function NP(n){if(n.size<2)return;const e=pn(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function kP(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const s=pn(n.data.subarray(t),!0);t+=s.length+1;const r=pn(n.data.subarray(t));return{key:n.type,info:s,data:r}}const e=pn(n.data.subarray(1));return{key:n.type,info:"",data:e}}function PP(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const s=pn(n.data.subarray(t),!0);t+=s.length+1;const r=pn(n.data.subarray(t));return{key:n.type,info:s,data:r}}const e=pn(n.data);return{key:n.type,info:"",data:e}}function OP(n){return n.type==="PRIV"?NP(n):n.type[0]==="W"?PP(n):n.type==="APIC"?IP(n):kP(n)}function MP(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=bd(n,4),s=10;return{type:e,size:t,data:n.subarray(s,s+t)}}const xu=10,jP=10;function uA(n){let e=0;const t=[];for(;_p(n,e);){const s=bd(n,e+6);n[e+5]>>6&1&&(e+=xu),e+=xu;const r=e+s;for(;e+jP<r;){const a=MP(n.subarray(e)),l=OP(a);l&&t.push(l),e+=a.size+xu}iA(n,e)&&(e+=xu)}return t}function dA(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function UP(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function Lp(n){const e=uA(n);for(let t=0;t<e.length;t++){const s=e[t];if(dA(s))return UP(s)}}let gn=(function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n})({});function li(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class wp{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=Nn(this.cachedData,e),this.cachedData=null);let s=Vl(e,0),r=s?s.length:0,a;const l=this._audioTrack,c=this._id3Track,f=s?Lp(s):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&Be(f))&&(this.basePTS=FP(f,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:gn.audioId3,duration:Number.POSITIVE_INFINITY});r<d;){if(this.canParse(e,r)){const h=this.appendFrame(l,e,r);h?(this.frameIndex++,this.lastPTS=h.sample.pts,r+=h.length,a=r):r=d}else CP(e,r)?(s=Vl(e,r),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:gn.audioId3,duration:Number.POSITIVE_INFINITY}),r+=s.length,a=r):r++;if(r===d&&a!==d){const h=e.slice(a);this.cachedData?this.cachedData=Nn(this.cachedData,h):this.cachedData=h}}return{audioTrack:l,videoTrack:li(),id3Track:c,textTrack:li()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:li(),id3Track:this._id3Track,textTrack:li()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const FP=(n,e,t)=>{if(Be(n))return n*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let vu=null;const BP=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],$P=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],VP=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],GP=[0,1,1,4];function fA(n,e,t,s,r){if(t+24>e.length)return;const a=hA(e,t);if(a&&t+a.frameLength<=e.length){const l=a.samplesPerFrame*9e4/a.sampleRate,c=s+r*l,f={unit:e.subarray(t,t+a.frameLength),pts:c,dts:c};return n.config=[],n.channelCount=a.channelCount,n.samplerate=a.sampleRate,n.samples.push(f),{sample:f,length:a.frameLength,missing:0}}}function hA(n,e){const t=n[e+1]>>3&3,s=n[e+1]>>1&3,r=n[e+2]>>4&15,a=n[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&a!==3){const l=n[e+2]>>1&1,c=n[e+3]>>6,f=t===3?3-s:s===3?3:4,d=BP[f*14+r-1]*1e3,g=$P[(t===3?0:t===2?1:2)*3+a],y=c===3?1:2,v=VP[t][s],b=GP[s],T=v*8*b,E=Math.floor(v*d/g+l)*b;if(vu===null){const C=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);vu=C?parseInt(C[1]):0}return!!vu&&vu<=87&&s===2&&d>=224e3&&c===0&&(n[e+3]=n[e+3]|128),{sampleRate:g,channelCount:y,frameLength:E,samplesPerFrame:T}}}function Rp(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function mA(n,e){return e+1<n.length&&Rp(n,e)}function HP(n,e){return Rp(n,e)&&4<=n.length-e}function gA(n,e){if(e+1<n.length&&Rp(n,e)){const s=hA(n,e);let r=4;s!=null&&s.frameLength&&(r=s.frameLength);const a=e+r;return a===n.length||mA(n,a)}return!1}class KP extends wp{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Vl(e,0);let r=s?.length||0;if(gA(e,r))return!1;for(let a=e.length;r<a;r++)if(AP(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return TP(e,t)}appendFrame(e,t,s){oA(e,this.observer,t,s,e.manifestCodec);const r=cA(e,t,s,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const pA=(n,e)=>{let t=0,s=5;e+=s;const r=new Uint32Array(1),a=new Uint32Array(1),l=new Uint8Array(1);for(;s>0;){l[0]=n[e];const c=Math.min(s,8),f=8-c;a[0]=4278190080>>>24+f<<f,r[0]=(l[0]&a[0])>>f,t=t?t<<c|r[0]:r[0],e+=1,s-=c}return t};class zP extends wp{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const r=yA(e,t,s,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=Vl(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&Lp(t)!==void 0&&pA(e,s)<16}}function yA(n,e,t,s,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const a=e[t+4]>>6;if(a>=3)return-1;const c=[48e3,44100,32e3][a],f=e[t+4]&63,h=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][f*3+a]*2;if(t+h>e.length)return-1;const g=e[t+6]>>5;let y=0;g===2?y+=2:(g&1&&g!==1&&(y+=2),g&4&&(y+=2));const v=(e[t+6]<<8|e[t+7])>>12-y&1,T=[2,1,2,3,3,4,4,5][g]+v,E=e[t+5]>>3,_=e[t+5]&7,A=new Uint8Array([a<<6|E<<1|_>>2,(_&3)<<6|g<<3|v<<2|f>>4,f<<4&224]),C=1536/c*9e4,N=s+r*C,w=e.subarray(t,t+h);return n.config=A,n.channelCount=T,n.samplerate=c,n.samples.push({unit:w,pts:N}),h}class YP extends wp{resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Vl(e,0);let s=t?.length||0;if(t&&e[s]===11&&e[s+1]===119&&Lp(t)!==void 0&&pA(e,s)<=16)return!1;for(let r=e.length;s<r;s++)if(gA(e,s))return Mt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return HP(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return fA(e,t,s,this.basePTS,this.frameIndex)}}const qP=/\/emsg[-/]ID3/i;class XP{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,r){const a=this.videoTrack=li("video",1),l=this.audioTrack=li("audio",1),c=this.txtTrack=li("text",1);if(this.id3Track=li("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const f=L1(e);if(f.video){const{id:d,timescale:h,codec:g,supplemental:y}=f.video;a.id=d,a.timescale=c.timescale=h,a.codec=g,a.supplemental=y}if(f.audio){const{id:d,timescale:h,codec:g}=f.audio;l.id=d,l.timescale=h,l.codec=g}c.id=A1.text,a.sampleDuration=0,a.duration=l.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return z2(e)}demux(e,t){this.timeOffset=t;let s=e;const r=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=Nn(this.remainderData,e));const c=J2(s);this.remainderData=c.remainder,r.samples=c.valid||new Uint8Array}else r.samples=s;const l=this.extractID3Track(r,t);return a.samples=Kb(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return s.samples=Kb(e,t),{videoTrack:t,audioTrack:li(),id3Track:r,textTrack:li()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const r=ft(e.samples,["emsg"]);r&&r.forEach(a=>{const l=tk(a);if(qP.test(l.schemeIdUri)){const c=wS(l,t);let f=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;f<=.001&&(f=Number.POSITIVE_INFINITY);const d=l.payload;s.samples.push({data:d,len:d.byteLength,dts:c,pts:c,type:gn.emsg,duration:f})}else if(this.config.enableEmsgKLVMetadata&&l.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=wS(l,t);s.samples.push({data:l.payload,len:l.payload.byteLength,dts:c,pts:c,type:gn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function wS(n,e){return Be(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class WP{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new vp(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Cr.cbc)}decryptAacSample(e,t,s){const r=e[t].unit;if(r.length<=16)return;const a=r.subarray(16,r.length-r.length%16),l=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(l).then(c=>{const f=new Uint8Array(c);r.set(f,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let r=0;for(let a=32;a<e.length-16;a+=160,r+=16)s.set(e.subarray(a,a+16),r);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let r=0;for(let a=32;a<e.length-16;a+=160,r+=16)e.set(s.subarray(r,r+16),a);return e}decryptAvcSample(e,t,s,r,a){const l=D1(a.data),c=this.getAvcEncryptedData(l);this.decryptBuffer(c.buffer).then(f=>{a.data=this.getAvcDecryptedUnit(l,f),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,r)}).catch(r)}decryptAvcSamples(e,t,s,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){r();return}const a=e[t].units;for(;!(s>=a.length);s++){const l=a[s];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(e,t,s,r,l),!this.decrypter.isSync()))return}}}}class xA{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,r;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const a=s.units;r=a[a.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,r=s.length;if(r){const a=s[r-1];e.pts=a.pts,e.dts=a.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const r=t.byteLength;let a=e.naluState||0;const l=a,c=[];let f=0,d,h,g,y=-1,v=0;for(a===-1&&(y=0,v=this.getNALuType(t,0),a=0,f=1);f<r;){if(d=t[f++],!a){a=d?0:1;continue}if(a===1){a=d?0:2;continue}if(!d)a=3;else if(d===1){if(h=f-a-1,y>=0){const b={data:t.subarray(y,h),type:v};c.push(b)}else{const b=this.getLastNalUnit(e.samples);b&&(l&&f<=4-l&&b.state&&(b.data=b.data.subarray(0,b.data.byteLength-l)),h>0&&(b.data=Nn(b.data,t.subarray(0,h)),b.state=0))}f<r?(g=this.getNALuType(t,f),y=f,v=g,a=0):a=-1}else a=0}if(y>=0&&a>=0){const b={data:t.subarray(y,r),type:v,state:a};c.push(b)}if(c.length===0){const b=this.getLastNalUnit(e.samples);b&&(b.data=Nn(b.data,t))}return e.naluState=a,c}}class wl{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,r=new Uint8Array(4),a=Math.min(4,t);if(a===0)throw new Error("no bytes available");r.set(e.subarray(s,s+a)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=a*8,this.bytesAvailable-=a}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&Mt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class QP extends xA{parsePES(e,t,s,r){const a=this.parseNALu(e,s.data,r);let l=this.VideoSample,c,f=!1;s.data=null,l&&a.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.forEach(d=>{var h,g;switch(d.type){case 1:{let T=!1;c=!0;const E=d.data;if(f&&E.length>4){const _=this.readSliceType(E);(_===2||_===4||_===7||_===9)&&(T=!0)}if(T){var y;(y=l)!=null&&y.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.frame=!0,l.key=T;break}case 5:c=!0,(h=l)!=null&&h.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 6:{c=!0,gp(d.data,1,s.pts,t.samples);break}case 7:{var v,b;c=!0,f=!0;const T=d.data,E=this.readSPS(T);if(!e.sps||e.width!==E.width||e.height!==E.height||((v=e.pixelRatio)==null?void 0:v[0])!==E.pixelRatio[0]||((b=e.pixelRatio)==null?void 0:b[1])!==E.pixelRatio[1]){e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.sps=[T];const _=T.subarray(1,4);let A="avc1.";for(let C=0;C<3;C++){let N=_[C].toString(16);N.length<2&&(N="0"+N),A+=N}e.codec=A}break}case 8:c=!0,e.pps=[d.data];break;case 9:c=!0,e.audFound=!0,(g=l)!=null&&g.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:c=!0;break;default:c=!1;break}l&&c&&l.units.push(d)}),r&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new wl(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,r=8,a;for(let l=0;l<e;l++)r!==0&&(a=t.readEG(),r=(s+a+256)%256),s=r===0?s:r}readSPS(e){const t=new wl(e);let s=0,r=0,a=0,l=0,c,f,d;const h=t.readUByte.bind(t),g=t.readBits.bind(t),y=t.readUEG.bind(t),v=t.readBoolean.bind(t),b=t.skipBits.bind(t),T=t.skipEG.bind(t),E=t.skipUEG.bind(t),_=this.skipScalingList.bind(this);h();const A=h();if(g(5),b(3),h(),E(),A===100||A===110||A===122||A===244||A===44||A===83||A===86||A===118||A===128){const B=y();if(B===3&&b(1),E(),E(),b(1),v())for(f=B!==3?8:12,d=0;d<f;d++)v()&&(d<6?_(16,t):_(64,t))}E();const C=y();if(C===0)y();else if(C===1)for(b(1),T(),T(),c=y(),d=0;d<c;d++)T();E(),b(1);const N=y(),w=y(),G=g(1);G===0&&b(1),b(1),v()&&(s=y(),r=y(),a=y(),l=y());let M=[1,1];if(v()&&v())switch(h()){case 1:M=[1,1];break;case 2:M=[12,11];break;case 3:M=[10,11];break;case 4:M=[16,11];break;case 5:M=[40,33];break;case 6:M=[24,11];break;case 7:M=[20,11];break;case 8:M=[32,11];break;case 9:M=[80,33];break;case 10:M=[18,11];break;case 11:M=[15,11];break;case 12:M=[64,33];break;case 13:M=[160,99];break;case 14:M=[4,3];break;case 15:M=[3,2];break;case 16:M=[2,1];break;case 255:{M=[h()<<8|h(),h()<<8|h()];break}}return{width:Math.ceil((N+1)*16-s*2-r*2),height:(2-G)*(w+1)*16-(G?2:4)*(a+l),pixelRatio:M}}}class ZP extends xA{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,r){const a=this.parseNALu(e,s.data,r);let l=this.VideoSample,c,f=!1;s.data=null,l&&a.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.forEach(d=>{var h,g;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),l.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,f){var y;(y=l)!=null&&y.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 19:case 20:c=!0,(h=l)!=null&&h.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 39:c=!0,gp(d.data,2,s.pts,t.samples);break;case 32:c=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=$t(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(c=!0,f=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const v=this.readSPS(d.data);e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.codec=v.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const b in v.params)e.params[b]=v.params[b]}this.pushParameterSet(e.sps,d.data,e.vps),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0;break;case 34:if(c=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const v=this.readPPS(d.data);for(const b in v)e.params[b]=v[b]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:c=!0,e.audFound=!0,(g=l)!=null&&g.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:c=!1;break}l&&c&&l.units.push(d)}),r&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[s]=e[r],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new wl(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:r}}readSPS(e){const t=new wl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const r=t.readBits(2),a=t.readBoolean(),l=t.readBits(5),c=t.readUByte(),f=t.readUByte(),d=t.readUByte(),h=t.readUByte(),g=t.readUByte(),y=t.readUByte(),v=t.readUByte(),b=t.readUByte(),T=t.readUByte(),E=t.readUByte(),_=t.readUByte(),A=[],C=[];for(let W=0;W<s;W++)A.push(t.readBoolean()),C.push(t.readBoolean());if(s>0)for(let W=s;W<8;W++)t.readBits(2);for(let W=0;W<s;W++)A[W]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),C[W]&&t.readUByte();t.readUEG();const N=t.readUEG();N==3&&t.skipBits(1);const w=t.readUEG(),G=t.readUEG(),M=t.readBoolean();let B=0,K=0,V=0,$=0;M&&(B+=t.readUEG(),K+=t.readUEG(),V+=t.readUEG(),$+=t.readUEG());const ee=t.readUEG(),he=t.readUEG(),Z=t.readUEG(),H=t.readBoolean();for(let W=H?0:s;W<=s;W++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let te=0;te<4;te++)for(let be=0;be<(te===3?2:6);be++)if(!t.readBoolean())t.readUEG();else{const Ue=Math.min(64,1<<4+(te<<1));te>1&&t.readEG();for(let Ke=0;Ke<Ue;Ke++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const O=t.readUEG();let Y=0;for(let W=0;W<O;W++){let te=!1;if(W!==0&&(te=t.readBoolean()),te){W===O&&t.readUEG(),t.readBoolean(),t.readUEG();let be=0;for(let Ie=0;Ie<=Y;Ie++){const Ue=t.readBoolean();let Ke=!1;Ue||(Ke=t.readBoolean()),(Ue||Ke)&&be++}Y=be}else{const be=t.readUEG(),Ie=t.readUEG();Y=be+Ie;for(let Ue=0;Ue<be;Ue++)t.readUEG(),t.readBoolean();for(let Ue=0;Ue<Ie;Ue++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const W=t.readUEG();for(let te=0;te<W;te++){for(let be=0;be<Z+4;be++)t.readBits(1);t.readBits(1)}}let j=0,z=1,J=1,q=!0,P=1,de=0;t.readBoolean(),t.readBoolean();let _e=!1;if(t.readBoolean()){if(t.readBoolean()){const We=t.readUByte(),ae=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],ie=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];We>0&&We<16?(z=ae[We-1],J=ie[We-1]):We===255&&(z=t.readBits(16),J=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),_e=t.readBoolean(),_e&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(P=t.readBits(32),de=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const ie=t.readBoolean(),we=t.readBoolean();let Ae=!1;(ie||we)&&(Ae=t.readBoolean(),Ae&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ae&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Me=0;Me<=s;Me++){q=t.readBoolean();const mt=q||t.readBoolean();let _t=!1;mt?t.readEG():_t=t.readBoolean();const jt=_t?1:t.readUEG()+1;if(ie)for(let ts=0;ts<jt;ts++)t.readUEG(),t.readUEG(),Ae&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(we)for(let ts=0;ts<jt;ts++)t.readUEG(),t.readUEG(),Ae&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),j=t.readUEG())}let Fe=w,$e=G;if(M){let W=1,te=1;N===1?W=te=2:N==2&&(W=2),Fe=w-W*K-W*B,$e=G-te*$-te*V}const pe=r?["A","B","C"][r]:"",Ne=c<<24|f<<16|d<<8|h;let Ve=0;for(let W=0;W<32;W++)Ve=(Ve|(Ne>>W&1)<<31-W)>>>0;let Ge=Ve.toString(16);return l===1&&Ge==="2"&&(Ge="6"),{codecString:`hvc1.${pe}${l}.${Ge}.${a?"H":"L"}${_}.B0`,params:{general_tier_flag:a,general_profile_idc:l,general_profile_space:r,general_profile_compatibility_flags:[c,f,d,h],general_constraint_indicator_flags:[g,y,v,b,T,E],general_level_idc:_,bit_depth:ee+8,bit_depth_luma_minus8:ee,bit_depth_chroma_minus8:he,min_spatial_segmentation_idc:j,chroma_format_idc:N,frame_rate:{fixed:q,fps:de/P}},width:Fe,height:$e,pixelRatio:[z,J]}}readPPS(e){const t=new wl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),a=t.readBoolean();let l=1;return a&&r?l=0:a?l=3:r&&(l=2),{parallelismType:l}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ls=188;class Er{constructor(e,t,s,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=r,this.videoParser=null}static probe(e,t){const s=Er.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(Ls*5,t-Ls)+1,r=0;for(;r<s;){let a=!1,l=-1,c=0;for(let f=r;f<t;f+=Ls)if(e[f]===71&&(t-f===Ls||e[f+Ls]===71)){if(c++,l===-1&&(l=f,l!==0&&(s=Math.min(l+Ls*99,e.length-Ls)+1)),a||(a=cg(e,f)===0),a&&c>1&&(l===0&&c>2||f+Ls>s))return l}else{if(c)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:A1[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Er.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Er.createTrack("audio",r),this._id3Track=Er.createTrack("id3"),this._txtTrack=Er.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,r=!1){s||(this.sampleAes=null);let a;const l=this._videoTrack,c=this._audioTrack,f=this._id3Track,d=this._txtTrack;let h=l.pid,g=l.pesData,y=c.pid,v=f.pid,b=c.pesData,T=f.pesData,E=null,_=this.pmtParsed,A=this._pmtId,C=e.length;if(this.remainderData&&(e=Nn(this.remainderData,e),C=e.length,this.remainderData=null),C<Ls&&!r)return this.remainderData=e,{audioTrack:c,videoTrack:l,id3Track:f,textTrack:d};const N=Math.max(0,Er.syncOffset(e));C-=(C-N)%Ls,C<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,C,e.buffer.byteLength-C));let w=0;for(let M=N;M<C;M+=Ls)if(e[M]===71){const B=!!(e[M+1]&64),K=cg(e,M),V=(e[M+3]&48)>>4;let $;if(V>1){if($=M+5+e[M+4],$===M+Ls)continue}else $=M+4;switch(K){case h:B&&(g&&(a=Ya(g,this.logger))&&(this.readyVideoParser(l.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(l,d,a,!1)),g={data:[],size:0}),g&&(g.data.push(e.subarray($,M+Ls)),g.size+=M+Ls-$);break;case y:if(B){if(b&&(a=Ya(b,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,a);break;case"mp3":this.parseMPEGPES(c,a);break;case"ac3":this.parseAC3PES(c,a);break}b={data:[],size:0}}b&&(b.data.push(e.subarray($,M+Ls)),b.size+=M+Ls-$);break;case v:B&&(T&&(a=Ya(T,this.logger))&&this.parseID3PES(f,a),T={data:[],size:0}),T&&(T.data.push(e.subarray($,M+Ls)),T.size+=M+Ls-$);break;case 0:B&&($+=e[$]+1),A=this._pmtId=JP(e,$);break;case A:{B&&($+=e[$]+1);const ee=eO(e,$,this.typeSupported,s,this.observer,this.logger);h=ee.videoPid,h>0&&(l.pid=h,l.segmentCodec=ee.segmentVideoCodec),y=ee.audioPid,y>0&&(c.pid=y,c.segmentCodec=ee.segmentAudioCodec),v=ee.id3Pid,v>0&&(f.pid=v),E!==null&&!_&&(this.logger.warn(`MPEG-TS PMT found at ${M} after unknown PID '${E}'. Backtracking to sync byte @${N} to parse all TS packets.`),E=null,M=N-188),_=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=K;break}}else w++;w>0&&ug(this.observer,new Error(`Found ${w} TS packet/s that do not start with 0x47`),void 0,this.logger),l.pesData=g,c.pesData=b,f.pesData=T;const G={audioTrack:c,videoTrack:l,id3Track:f,textTrack:d};return r&&this.extractRemainingSamples(G),G}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:r,textTrack:a}=e,l=s.pesData,c=t.pesData,f=r.pesData;let d;if(l&&(d=Ya(l,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,a,d,!0),s.pesData=null)):s.pesData=l,c&&(d=Ya(c,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;f&&(d=Ya(f,this.logger))?(this.parseID3PES(r,d),r.pesData=null):r.pesData=f}demuxSampleAes(e,t,s){const r=this.demux(e,s,!0,!this.config.progressive),a=this.sampleAes=new WP(this.observer,this.config,t);return this.decrypt(r,a)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new QP:e==="hevc"&&(this.videoParser=new ZP))}decrypt(e,t){return new Promise(s=>{const{audioTrack:r,videoTrack:a}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{a.samples?t.decryptAvcSamples(a.samples,0,0,()=>{s(e)}):s(e)}):a.samples&&t.decryptAvcSamples(a.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const r=this.aacOverFlow;let a=t.data;if(r){this.aacOverFlow=null;const g=r.missing,y=r.sample.unit.byteLength;if(g===-1)a=Nn(r.sample.unit,a);else{const v=y-g;r.sample.unit.set(a.subarray(0,g),v),e.samples.push(r.sample),s=r.missing}}let l,c;for(l=s,c=a.length;l<c-1&&!cd(a,l);l++);if(l!==s){let g;const y=l<c-1;if(y?g=`AAC PES did not start with ADTS header,offset:${l}`:g="No ADTS header found in AAC PES",ug(this.observer,new Error(g),y,this.logger),!y)return}oA(e,this.observer,a,l,this.audioCodec);let f;if(t.pts!==void 0)f=t.pts;else if(r){const g=lA(e.samplerate);f=r.sample.pts+g}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,h;for(;l<c;)if(h=cA(e,a,l,f,d),l+=h.length,h.missing){this.aacOverFlow=h;break}else for(d++;l<c-1&&!cd(a,l);l++);}parseMPEGPES(e,t){const s=t.data,r=s.length;let a=0,l=0;const c=t.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<r;)if(mA(s,l)){const f=fA(e,s,l,c,a);if(f)l+=f.length,a++;else break}else l++}parseAC3PES(e,t){{const s=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const a=s.length;let l=0,c=0,f;for(;c<a&&(f=yA(e,s,c,r,l++))>0;)c+=f}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=$t({},t,{type:this._videoTrack?gn.emsg:gn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function cg(n,e){return((n[e+1]&31)<<8)+n[e+2]}function JP(n,e){return(n[e+10]&31)<<8|n[e+11]}function eO(n,e,t,s,r,a){const l={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(n[e+1]&15)<<8|n[e+2],f=e+3+c-4,d=(n[e+10]&15)<<8|n[e+11];for(e+=12+d;e<f;){const h=cg(n,e),g=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!s){im("ADTS AAC",a);break}case 15:l.audioPid===-1&&(l.audioPid=h);break;case 21:l.id3Pid===-1&&(l.id3Pid=h);break;case 219:if(!s){im("H.264",a);break}case 27:l.videoPid===-1&&(l.videoPid=h);break;case 3:case 4:!t.mpeg&&!t.mp3?a.log("MPEG audio found, not supported in this browser"):l.audioPid===-1&&(l.audioPid=h,l.segmentAudioCodec="mp3");break;case 193:if(!s){im("AC-3",a);break}case 129:t.ac3?l.audioPid===-1&&(l.audioPid=h,l.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(l.audioPid===-1&&g>0){let y=e+5,v=g;for(;v>2;){switch(n[y]){case 106:t.ac3!==!0?a.log("AC-3 audio found, not supported in this browser for now"):(l.audioPid=h,l.segmentAudioCodec="ac3");break}const T=n[y+1]+2;y+=T,v-=T}}break;case 194:case 135:return ug(r,new Error("Unsupported EC-3 in M2TS found"),void 0,a),l;case 36:l.videoPid===-1&&(l.videoPid=h,l.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"));break}e+=g+5}return l}function ug(n,e,t,s){s.warn(`parsing error: ${e.message}`),n.emit(L.ERROR,L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function im(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Ya(n,e){let t=0,s,r,a,l,c;const f=n.data;if(!n||n.size===0)return null;for(;f[0].length<19&&f.length>1;)f[0]=Nn(f[0],f[1]),f.splice(1,1);if(s=f[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(r=(s[4]<<8)+s[5],r&&r>n.size-6)return null;const h=s[7];h&192&&(l=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,h&64?(c=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,l-c>60*9e4&&(e.warn(`${Math.round((l-c)/9e4)}s delta between PTS and DTS, align them`),l=c)):c=l),a=s[8];let g=a+9;if(n.size<=g)return null;n.size-=g;const y=new Uint8Array(n.size);for(let v=0,b=f.length;v<b;v++){s=f[v];let T=s.byteLength;if(g)if(g>T){g-=T;continue}else s=s.subarray(g),T-=g,g=0;y.set(s,t),t+=T}return r&&(r-=a+3),{data:y,pts:l,dts:c,len:r}}return null}class tO{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const yr=Math.pow(2,32)-1;class oe{static init(){oe.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in oe.types)oe.types.hasOwnProperty(e)&&(oe.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);oe.HDLR_TYPES={video:t,audio:s};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);oe.STTS=oe.STSC=oe.STCO=a,oe.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),oe.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),oe.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),oe.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const l=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),f=new Uint8Array([0,0,0,1]);oe.FTYP=oe.box(oe.types.ftyp,l,f,l,c),oe.DINF=oe.box(oe.types.dinf,oe.box(oe.types.dref,r))}static box(e,...t){let s=8,r=t.length;const a=r;for(;r--;)s+=t[r].byteLength;const l=new Uint8Array(s);for(l[0]=s>>24&255,l[1]=s>>16&255,l[2]=s>>8&255,l[3]=s&255,l.set(e,4),r=0,s=8;r<a;r++)l.set(t[r],s),s+=t[r].byteLength;return l}static hdlr(e){return oe.box(oe.types.hdlr,oe.HDLR_TYPES[e])}static mdat(e){return oe.box(oe.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(yr+1)),r=Math.floor(t%(yr+1));return oe.box(oe.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return oe.box(oe.types.mdia,oe.mdhd(e.timescale||0,e.duration||0),oe.hdlr(e.type),oe.minf(e))}static mfhd(e){return oe.box(oe.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?oe.box(oe.types.minf,oe.box(oe.types.smhd,oe.SMHD),oe.DINF,oe.stbl(e)):oe.box(oe.types.minf,oe.box(oe.types.vmhd,oe.VMHD),oe.DINF,oe.stbl(e))}static moof(e,t,s){return oe.box(oe.types.moof,oe.mfhd(e),oe.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=oe.trak(e[t]);return oe.box.apply(null,[oe.types.moov,oe.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(oe.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=oe.trex(e[t]);return oe.box.apply(null,[oe.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(yr+1)),r=Math.floor(t%(yr+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return oe.box(oe.types.mvhd,a)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let r,a;for(r=0;r<t.length;r++)a=t[r].flags,s[r+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return oe.box(oe.types.sdtp,s)}static stbl(e){return oe.box(oe.types.stbl,oe.stsd(e),oe.box(oe.types.stts,oe.STTS),oe.box(oe.types.stsc,oe.STSC),oe.box(oe.types.stsz,oe.STSZ),oe.box(oe.types.stco,oe.STCO))}static avc1(e){let t=[],s=[],r,a,l;for(r=0;r<e.sps.length;r++)a=e.sps[r],l=a.byteLength,t.push(l>>>8&255),t.push(l&255),t=t.concat(Array.prototype.slice.call(a));for(r=0;r<e.pps.length;r++)a=e.pps[r],l=a.byteLength,s.push(l>>>8&255),s.push(l&255),s=s.concat(Array.prototype.slice.call(a));const c=oe.box(oe.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),f=e.width,d=e.height,h=e.pixelRatio[0],g=e.pixelRatio[1];return oe.box(oe.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,oe.box(oe.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),oe.box(oe.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,g>>24,g>>16&255,g>>8&255,g&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return oe.box(oe.types.mp4a,oe.audioStsd(e),oe.box(oe.types.esds,oe.esds(e)))}static mp3(e){return oe.box(oe.types[".mp3"],oe.audioStsd(e))}static ac3(e){return oe.box(oe.types["ac-3"],oe.audioStsd(e),oe.box(oe.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return oe.box(oe.types.stsd,oe.STSD,oe.mp4a(e));if(t==="ac3"&&e.config)return oe.box(oe.types.stsd,oe.STSD,oe.ac3(e));if(t==="mp3"&&e.codec==="mp3")return oe.box(oe.types.stsd,oe.STSD,oe.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return oe.box(oe.types.stsd,oe.STSD,oe.avc1(e));if(t==="hevc"&&e.vps)return oe.box(oe.types.stsd,oe.STSD,oe.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),r=e.width||0,a=e.height||0,l=Math.floor(s/(yr+1)),c=Math.floor(s%(yr+1));return oe.box(oe.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,a>>8&255,a&255,0,0]))}static traf(e,t){const s=oe.sdtp(e),r=e.id,a=Math.floor(t/(yr+1)),l=Math.floor(t%(yr+1));return oe.box(oe.types.traf,oe.box(oe.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),oe.box(oe.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,l>>24,l>>16&255,l>>8&255,l&255])),oe.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,oe.box(oe.types.trak,oe.tkhd(e),oe.mdia(e))}static trex(e){const t=e.id;return oe.box(oe.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],r=s.length,a=12+16*r,l=new Uint8Array(a);let c,f,d,h,g,y;for(t+=8+a,l.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<r;c++)f=s[c],d=f.duration,h=f.size,g=f.flags,y=f.cts,l.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,g.isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,g.degradPrio&61440,g.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*c);return oe.box(oe.types.trun,l)}static initSegment(e){oe.types||oe.init();const t=oe.moov(e);return Nn(oe.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],r=4,a=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let l=a.length;for(let b=0;b<s.length;b+=1){l+=3;for(let T=0;T<s[b].length;T+=1)l+=2+s[b][T].length}const c=new Uint8Array(l);c.set(a,0),l=a.length;const f=s.length-1;for(let b=0;b<s.length;b+=1){c.set(new Uint8Array([32+b|(b===f?128:0),0,s[b].length]),l),l+=3;for(let T=0;T<s[b].length;T+=1)c.set(new Uint8Array([s[b][T].length>>8,s[b][T].length&255]),l),l+=2,c.set(s[b][T],l),l+=s[b][T].length}const d=oe.box(oe.types.hvcC,c),h=e.width,g=e.height,y=e.pixelRatio[0],v=e.pixelRatio[1];return oe.box(oe.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,g>>8&255,g&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,oe.box(oe.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),oe.box(oe.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,y&255,v>>24,v>>16&255,v>>8&255,v&255])))}}oe.types=void 0;oe.HDLR_TYPES=void 0;oe.STTS=void 0;oe.STSC=void 0;oe.STCO=void 0;oe.STSZ=void 0;oe.VMHD=void 0;oe.SMHD=void 0;oe.STSD=void 0;oe.FTYP=void 0;oe.DINF=void 0;const vA=9e4;function Dp(n,e,t=1,s=!1){const r=n*e*t;return s?Math.round(r):r}function sO(n,e,t=1,s=!1){return Dp(n,e,1/t,s)}function pl(n,e=!1){return Dp(n,1e3,1/vA,e)}function nO(n,e=1){return Dp(n,vA,1/e)}function RS(n){const{baseTime:e,timescale:t,trackId:s}=n;return`${e/t} (${e}/${t}) trackId: ${s}`}const iO=10*1e3,rO=1024,aO=1152,oO=1536;let qa=null,rm=null;function DS(n,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class Bu extends Pn{constructor(e,t,s,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,qa===null){const l=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);qa=l?parseInt(l[1]):0}if(rm===null){const a=navigator.userAgent.match(/Safari\/(\d+)/i);rm=a?parseInt(a[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&RS(t)} > ${e&&RS(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,r=e.reduce((a,l)=>{let c=l.pts,f=c-a;return f<-4294967296&&(t=!0,c=mn(c,s),f=c-a),f>0?a:c},s);return t&&this.debug("PTS rollover detected"),r}remux(e,t,s,r,a,l,c,f){let d,h,g,y,v,b,T=a,E=a;const _=e.pid>-1,A=t.pid>-1,C=t.samples.length,N=e.samples.length>0,w=c&&C>0||C>1;if((!_||N)&&(!A||w)||this.ISGenerated||c){if(this.ISGenerated){var M,B,K,V;const Z=this.videoTrackConfig;(Z&&(t.width!==Z.width||t.height!==Z.height||((M=t.pixelRatio)==null?void 0:M[0])!==((B=Z.pixelRatio)==null?void 0:B[0])||((K=t.pixelRatio)==null?void 0:K[1])!==((V=Z.pixelRatio)==null?void 0:V[1]))||!Z&&w||this.nextAudioTs===null&&N)&&this.resetInitSegment()}this.ISGenerated||(g=this.generateIS(e,t,a,l));const $=this.isVideoContiguous;let ee=-1,he;if(w&&(ee=lO(t.samples),!$&&this.config.forceKeyFrameOnDiscontinuity))if(b=!0,ee>0){this.warn(`Dropped ${ee} out of ${C} video samples due to a missing keyframe`);const Z=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(ee),t.dropped+=ee,E+=(t.samples[0].pts-Z)/t.inputTimeScale,he=E}else ee===-1&&(this.warn(`No keyframe found out of ${C} video samples`),b=!1);if(this.ISGenerated){if(N&&w){const Z=this.getVideoStartPts(t.samples),k=(mn(e.samples[0].pts,Z)-Z)/t.inputTimeScale;T+=Math.max(0,k),E+=Math.max(0,-k)}if(N){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),g=this.generateIS(e,t,a,l)),h=this.remuxAudio(e,T,this.isAudioContiguous,l,A||w||f===He.AUDIO?E:void 0),w){const Z=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),g=this.generateIS(e,t,a,l)),d=this.remuxVideo(t,E,$,Z)}}else w&&(d=this.remuxVideo(t,E,$,0));d&&(d.firstKeyFrame=ee,d.independent=ee!==-1,d.firstKeyFramePTS=he)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(v=bA(s,a,this._initPTS,this._initDTS)),r.samples.length&&(y=SA(r,a,this._initPTS))),{audio:h,video:d,initSegment:g,independent:b,text:y,id3:v}}computeInitPts(e,t,s,r){const a=Math.round(s*t);let l=mn(e,a);if(l<a+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(a-l)/t} ${r}`);l<a+t;)l+=8589934592;return l-a}generateIS(e,t,s,r){const a=e.samples,l=t.samples,c=this.typeSupported,f={},d=this._initPTS;let h=!d||r,g="audio/mp4",y,v,b,T=-1;if(h&&(y=v=1/0),e.config&&a.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(g="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}f.audio={id:"audio",container:g,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):oe.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(T=e.id,b=e.inputTimeScale,!d||b!==d.timescale?y=v=this.computeInitPts(a[0].pts,b,s,"audio"):h=!1)}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:oe.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(T=t.id,b=t.inputTimeScale,!d||b!==d.timescale){const E=this.getVideoStartPts(l),_=mn(l[0].dts,E),A=this.computeInitPts(_,b,s,"video"),C=this.computeInitPts(E,b,s,"video");v=Math.min(v,A),y=Math.min(y,C)}else h=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,h?(d&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${s} ${y/b} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${y/b} (${y}/${b}) trackId: ${T}`),this._initPTS={baseTime:y,timescale:b,trackId:T},this._initDTS={baseTime:v,timescale:b,trackId:T}):y=b=void 0,{tracks:f,initPTS:y,timescale:b,trackId:T}}remuxVideo(e,t,s,r){const a=e.inputTimeScale,l=e.samples,c=[],f=l.length,d=this._initPTS,h=d.baseTime*a/d.timescale;let g=this.nextVideoTs,y=8,v=this.videoSampleDuration,b,T,E=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,A=!1;if(!s||g===null){const j=h+t*a,z=l[0].pts-mn(l[0].dts,l[0].pts);qa&&g!==null&&Math.abs(j-z-(g+h))<15e3?s=!0:g=j-z-h}const C=g+h;for(let j=0;j<f;j++){const z=l[j];z.pts=mn(z.pts,C),z.dts=mn(z.dts,C),z.dts<l[j>0?j-1:j].dts&&(A=!0)}A&&l.sort(function(j,z){const J=j.dts-z.dts,q=j.pts-z.pts;return J||q}),b=l[0].dts,T=l[l.length-1].dts;const N=T-b,w=N?Math.round(N/(f-1)):v||e.inputTimeScale/30;if(s){const j=b-C,z=j>w,J=j<-1;if((z||J)&&(z?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${pl(j,!0)} ms (${j}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${pl(-j,!0)} ms (${j}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!J||C>=l[0].pts||qa)){b=C;const q=l[0].pts-j;if(z)l[0].dts=b,l[0].pts=q;else{let P=!0;for(let de=0;de<l.length&&!(l[de].dts>q&&P);de++){const _e=l[de].pts;if(l[de].dts-=j,l[de].pts-=j,de<l.length-1){const Le=l[de+1].pts,Fe=l[de].pts,$e=Le<=Fe,pe=Le<=_e;P=$e==pe}}}this.log(`Video: Initial PTS/DTS adjusted: ${pl(q,!0)}/${pl(b,!0)}, delta: ${pl(j,!0)} ms`)}}b=Math.max(0,b);let G=0,M=0,B=b;for(let j=0;j<f;j++){const z=l[j],J=z.units,q=J.length;let P=0;for(let de=0;de<q;de++)P+=J[de].data.length;M+=P,G+=q,z.length=P,z.dts<B?(z.dts=B,B+=w/4|0||1):B=z.dts,E=Math.min(z.pts,E),_=Math.max(z.pts,_)}T=l[f-1].dts;const K=M+4*G+8;let V;try{V=new Uint8Array(K)}catch(j){this.observer.emit(L.ERROR,L.ERROR,{type:Xe.MUX_ERROR,details:ue.REMUX_ALLOC_ERROR,fatal:!1,error:j,bytes:K,reason:`fail allocating video mdat ${K}`});return}const $=new DataView(V.buffer);$.setUint32(0,K),V.set(oe.types.mdat,4);let ee=!1,he=Number.POSITIVE_INFINITY,Z=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY;for(let j=0;j<f;j++){const z=l[j],J=z.units;let q=0;for(let _e=0,Le=J.length;_e<Le;_e++){const Fe=J[_e],$e=Fe.data,pe=Fe.data.byteLength;$.setUint32(y,pe),y+=4,V.set($e,y),y+=pe,q+=4+pe}let P;if(j<f-1)v=l[j+1].dts-z.dts,P=l[j+1].pts-z.pts;else{const _e=this.config,Le=j>0?z.dts-l[j-1].dts:w;if(P=j>0?z.pts-l[j-1].pts:w,_e.stretchShortVideoTrack&&this.nextAudioTs!==null){const Fe=Math.floor(_e.maxBufferHole*a),$e=(r?E+r*a:this.nextAudioTs+h)-z.pts;$e>Fe?(v=$e-Le,v<0?v=Le:ee=!0,this.log(`It is approximately ${$e/90} ms to the next segment; using duration ${v/90} ms for the last video frame.`)):v=Le}else v=Le}const de=Math.round(z.pts-z.dts);he=Math.min(he,v),H=Math.max(H,v),Z=Math.min(Z,P),k=Math.max(k,P),c.push(DS(z.key,v,q,de))}if(c.length){if(qa){if(qa<70){const j=c[0].flags;j.dependsOn=2,j.isNonSync=0}}else if(rm&&k-Z<H-he&&w/H<.025&&c[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let j=b;for(let z=0,J=c.length;z<J;z++){const q=j+c[z].duration,P=j+c[z].cts;if(z<J-1){const de=q+c[z+1].cts;c[z].duration=de-P}else c[z].duration=z?c[z-1].duration:w;c[z].cts=0,j=q}}}v=ee||!v?w:v;const F=T+v;this.nextVideoTs=g=F-h,this.videoSampleDuration=v,this.isVideoContiguous=!0;const I={data1:oe.moof(e.sequenceNumber++,b,$t(e,{samples:c})),data2:V,startPTS:(E-h)/a,endPTS:(_+v-h)/a,startDTS:(b-h)/a,endDTS:g/a,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,I}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return aO;case"ac3":return oO;default:return rO}}remuxAudio(e,t,s,r,a){const l=e.inputTimeScale,c=e.samplerate?e.samplerate:l,f=l/c,d=this.getSamplesPerFrame(e),h=d*f,g=this._initPTS,y=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,v=[],b=a!==void 0;let T=e.samples,E=y?0:8,_=this.nextAudioTs||-1;const A=g.baseTime*l/g.timescale,C=A+t*l;if(this.isAudioContiguous=s=s||T.length&&_>0&&(r&&Math.abs(C-(_+A))<9e3||Math.abs(mn(T[0].pts,C)-(_+A))<20*h),T.forEach(function(k){k.pts=mn(k.pts,C)}),!s||_<0){const k=T.length;if(T=T.filter(F=>F.pts>=0),k!==T.length&&this.warn(`Removed ${T.length-k} of ${k} samples (initPTS ${A} / ${l})`),!T.length)return;a===0?_=0:r&&!b?_=Math.max(0,C-A):_=T[0].pts-A}if(e.segmentCodec==="aac"){const k=this.config.maxAudioFramesDrift;for(let F=0,O=_+A;F<T.length;F++){const Y=T[F],I=Y.pts,j=I-O,z=Math.abs(1e3*j/l);if(j<=-k*h&&b)F===0&&(this.warn(`Audio frame @ ${(I/l).toFixed(3)}s overlaps marker by ${Math.round(1e3*j/l)} ms.`),this.nextAudioTs=_=I-A,O=I);else if(j>=k*h&&z<iO&&b){let J=Math.round(j/h);for(O=I-J*h;O<0&&J&&h;)J--,O+=h;F===0&&(this.nextAudioTs=_=O-A),this.warn(`Injecting ${J} audio frames @ ${((O-A)/l).toFixed(3)}s due to ${Math.round(1e3*j/l)} ms gap.`);for(let q=0;q<J;q++){let P=tO.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);P||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),P=Y.unit.subarray()),T.splice(F,0,{unit:P,pts:O}),O+=h,F++}}Y.pts=O,O+=h}}let N=null,w=null,G,M=0,B=T.length;for(;B--;)M+=T[B].unit.byteLength;for(let k=0,F=T.length;k<F;k++){const O=T[k],Y=O.unit;let I=O.pts;if(w!==null){const z=v[k-1];z.duration=Math.round((I-w)/f)}else if(s&&e.segmentCodec==="aac"&&(I=_+A),N=I,M>0){M+=E;try{G=new Uint8Array(M)}catch(z){this.observer.emit(L.ERROR,L.ERROR,{type:Xe.MUX_ERROR,details:ue.REMUX_ALLOC_ERROR,fatal:!1,error:z,bytes:M,reason:`fail allocating audio mdat ${M}`});return}y||(new DataView(G.buffer).setUint32(0,M),G.set(oe.types.mdat,4))}else return;G.set(Y,E);const j=Y.byteLength;E+=j,v.push(DS(!0,d,j,0)),w=I}const K=v.length;if(!K)return;const V=v[v.length-1];_=w-A,this.nextAudioTs=_+f*V.duration;const $=y?new Uint8Array(0):oe.moof(e.sequenceNumber++,N/f,$t({},e,{samples:v}));e.samples=[];const ee=(N-A)/l,he=_/l,H={data1:$,data2:G,startPTS:ee,endPTS:he,startDTS:ee,endDTS:he,type:"audio",hasAudio:!0,hasVideo:!1,nb:K};return this.isAudioContiguous=!0,H}}function mn(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function lO(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function bA(n,e,t,s){const r=n.samples.length;if(!r)return;const a=n.inputTimeScale;for(let c=0;c<r;c++){const f=n.samples[c];f.pts=mn(f.pts-t.baseTime*a/t.timescale,e*a)/a,f.dts=mn(f.dts-s.baseTime*a/s.timescale,e*a)/a}const l=n.samples;return n.samples=[],{samples:l}}function SA(n,e,t){const s=n.samples.length;if(!s)return;const r=n.inputTimeScale;for(let l=0;l<s;l++){const c=n.samples[l];c.pts=mn(c.pts-t.baseTime*r/t.timescale,e*r)/r}n.samples.sort((l,c)=>l.pts-c.pts);const a=n.samples;return n.samples=[],{samples:a}}class cO extends Pn{constructor(e,t,s,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,r){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:a,video:l}=this.initData=L1(e);if(t)W2(e,t);else{const f=a||l;f!=null&&f.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${f.codec}")!`)}a&&(s=IS(a,Ht.AUDIO,this)),l&&(r=IS(l,Ht.VIDEO,this));const c={};a&&l?c.audiovideo={container:"video/mp4",codec:s+","+r,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:a?c.audio={container:"audio/mp4",codec:s,encrypted:a.encrypted,initSegment:e,id:"audio"}:l?c.video={container:"video/mp4",codec:r,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=c}remux(e,t,s,r,a,l){var c,f;let{initPTS:d,lastEndTime:h}=this;const g={audio:void 0,video:void 0,text:r,id3:s,initSegment:void 0};Be(h)||(h=this.lastEndTime=a||0);const y=t.samples;if(!y.length)return g;const v={initPTS:void 0,timescale:void 0,trackId:void 0};let b=this.initData;if((c=b)!=null&&c.length||(this.generateInitSegment(y),b=this.initData),!((f=b)!=null&&f.length))return this.warn("Failed to generate initSegment."),g;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);const T=Z2(y,b,this),E=b.audio?T[b.audio.id]:null,_=b.video?T[b.video.id]:null,A=bu(_,1/0),C=bu(E,1/0),N=bu(_,0,!0),w=bu(E,0,!0);let G=a,M=0;const B=E&&(!_||!d&&C<A||d&&d.trackId===b.audio.id),K=B?E:_;if(K){const O=K.timescale,Y=K.start-a*O,I=B?b.audio.id:b.video.id;G=K.start/O,M=B?w-C:N-A,(l||!d)&&(uO(d,G,a,M)||O!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${l?"":"~"}${a} ${Y/O} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${a} offset: ${G-a} (${Y}/${O}) trackId: ${I}`),d=null,v.initPTS=Y,v.timescale=O,v.trackId=I)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${a}`);d?(v.initPTS=d.baseTime,v.timescale=d.timescale,v.trackId=d.trackId):((!v.timescale||v.trackId===void 0||v.initPTS===void 0)&&(this.warn("Could not set initPTS"),v.initPTS=G,v.timescale=1,v.trackId=-1),this.initPTS=d={baseTime:v.initPTS,timescale:v.timescale,trackId:v.trackId});const V=G-d.baseTime/d.timescale,$=V+M;M>0?this.lastEndTime=$:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const ee=!!b.audio,he=!!b.video;let Z="";ee&&(Z+="audio"),he&&(Z+="video");const H=(b.audio?b.audio.encrypted:!1)||(b.video?b.video.encrypted:!1),k={data1:y,startPTS:V,startDTS:V,endPTS:$,endDTS:$,type:Z,hasAudio:ee,hasVideo:he,nb:1,dropped:0,encrypted:H};g.audio=ee&&!he?k:void 0,g.video=he?k:void 0;const F=_?.sampleCount;if(F){const O=_.keyFrameIndex,Y=O!==-1;k.nb=F,k.dropped=O===0||this.isVideoContiguous?0:Y?O:F,k.independent=Y,k.firstKeyFrame=O,Y&&_.keyFrameStart&&(k.firstKeyFramePTS=(_.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(g.independent=Y),this.isVideoContiguous||(this.isVideoContiguous=Y),k.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${O}/${F} dropped: ${k.dropped} start: ${k.firstKeyFramePTS||"NA"}`)}return g.initSegment=v,g.id3=bA(s,a,d,d),r.samples.length&&(g.text=SA(r,a,d)),g}}function bu(n,e,t=!1){return n?.start!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function uO(n,e,t,s){if(n===null)return!0;const r=Math.max(s,1),a=e-n.baseTime/n.timescale;return Math.abs(a-t)>r}function IS(n,e,t){const s=n.codec;return s&&s.length>4?s:e===Ht.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?td(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let Fi;try{Fi=self.performance.now.bind(self.performance)}catch{Fi=Date.now}const $u=[{demux:XP,remux:cO},{demux:Er,remux:Bu},{demux:KP,remux:Bu},{demux:YP,remux:Bu}];$u.splice(2,0,{demux:zP,remux:Bu});class NS{constructor(e,t,s,r,a,l){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=a,this.logger=l}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,r){const a=s.transmuxing;a.executeStart=Fi();let l=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:f}=this;r&&(this.currentTransmuxState=r);const{contiguous:d,discontinuity:h,trackSwitch:g,accurateTimeOffset:y,timeOffset:v,initSegmentChange:b}=r||c,{audioCodec:T,videoCodec:E,defaultInitPts:_,duration:A,initSegmentData:C}=f,N=dO(l,t);if(N&&ro(N.method)){const B=this.getDecrypter(),K=Sp(N.method);if(B.isSync()){let V=B.softwareDecrypt(l,N.key.buffer,N.iv.buffer,K);if(s.part>-1){const ee=B.flush();V=ee&&ee.buffer}if(!V)return a.executeEnd=Fi(),am(s);l=new Uint8Array(V)}else return this.asyncResult=!0,this.decryptionPromise=B.webCryptoDecrypt(l,N.key.buffer,N.iv.buffer,K).then(V=>{const $=this.push(V,null,s);return this.decryptionPromise=null,$}),this.decryptionPromise}const w=this.needsProbing(h,g);if(w){const B=this.configureTransmuxer(l);if(B)return this.logger.warn(`[transmuxer] ${B.message}`),this.observer.emit(L.ERROR,L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.FRAG_PARSING_ERROR,fatal:!1,error:B,reason:B.message}),a.executeEnd=Fi(),am(s)}(h||g||b||w)&&this.resetInitSegment(C,T,E,A,t),(h||b||w)&&this.resetInitialTimestamp(_),d||this.resetContiguity();const G=this.transmux(l,N,v,y,s);this.asyncResult=Gl(G);const M=this.currentTransmuxState;return M.contiguous=!0,M.discontinuity=!1,M.trackSwitch=!1,a.executeEnd=Fi(),G}flush(e){const t=e.transmuxing;t.executeStart=Fi();const{decrypter:s,currentTransmuxState:r,decryptionPromise:a}=this;if(a)return this.asyncResult=!0,a.then(()=>this.flush(e));const l=[],{timeOffset:c}=r;if(s){const g=s.flush();g&&l.push(this.push(g.buffer,null,e))}const{demuxer:f,remuxer:d}=this;if(!f||!d){t.executeEnd=Fi();const g=[am(e)];return this.asyncResult?Promise.resolve(g):g}const h=f.flush(c);return Gl(h)?(this.asyncResult=!0,h.then(g=>(this.flushRemux(l,g,e),l))):(this.flushRemux(l,h,e),this.asyncResult?Promise.resolve(l):l)}flushRemux(e,t,s){const{audioTrack:r,videoTrack:a,id3Track:l,textTrack:c}=t,{accurateTimeOffset:f,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===He.MAIN?"level":"track"} ${s.level}`);const h=this.remuxer.remux(r,a,l,c,d,f,!0,this.id);e.push({remuxResult:h,chunkMeta:s}),s.transmuxing.executeEnd=Fi()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,r,a){const{demuxer:l,remuxer:c}=this;!l||!c||(l.resetInitSegment(e,t,s,r),c.resetInitSegment(e,t,s,a))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,r,a){let l;return t&&t.method==="SAMPLE-AES"?l=this.transmuxSampleAes(e,t,s,r,a):l=this.transmuxUnencrypted(e,s,r,a),l}transmuxUnencrypted(e,t,s,r){const{audioTrack:a,videoTrack:l,id3Track:c,textTrack:f}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(a,l,c,f,t,s,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,s,r,a){return this.demuxer.demuxSampleAes(e,t,s).then(l=>({remuxResult:this.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,s,r,!1,this.id),chunkMeta:a}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:r}=this;let a;for(let g=0,y=$u.length;g<y;g++){var l;if((l=$u[g].demux)!=null&&l.probe(e,this.logger)){a=$u[g];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,f=this.remuxer,d=a.remux,h=a.demux;(!f||!(f instanceof d))&&(this.remuxer=new d(s,t,r,this.logger)),(!c||!(c instanceof h))&&(this.demuxer=new h(s,t,r,this.logger),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new vp(this.config)),e}}function dO(n,e){let t=null;return n.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const am=n=>({remuxResult:{},chunkMeta:n});function Gl(n){return"then"in n&&n.then instanceof Function}class fO{constructor(e,t,s,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=r,this.defaultInitPts=a||null}}class hO{constructor(e,t,s,r,a,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=r,this.timeOffset=a,this.initSegmentChange=l}}let kS=0;class EA{constructor(e,t,s,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=kS++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=f=>{const d=f.data,h=this.hls;if(!(!h||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var g;const y=(g=this.workerContext)==null?void 0:g.objectURL;y&&self.URL.revokeObjectURL(y);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{h.logger[d.data.logType]&&h.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,h.trigger(d.event,d.data);break}}},this.onWorkerError=f=>{if(!this.hls)return;const d=new Error(`${f.message}  (${f.filename}:${f.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(L.ERROR,{type:Xe.OTHER_ERROR,details:ue.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const a=e.config;this.hls=e,this.id=t,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=s,this.onFlush=r;const l=(f,d)=>{d=d||{},d.frag=this.frag||void 0,f===L.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(f,d)};this.observer=new Ap,this.observer.on(L.FRAG_DECRYPTED,l),this.observer.on(L.ERROR,l);const c=qb(a.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const f=this.hls.logger;if(a.workerPath||yP()){try{a.workerPath?(f.log(`loading Web Worker ${a.workerPath} for "${t}"`),this.workerContext=vP(a.workerPath)):(f.log(`injecting Web Worker for "${t}"`),this.workerContext=xP());const{worker:h}=this.workerContext;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:Kt(a)})}catch(h){f.warn(`Error setting up "${t}" Web Worker, fallback to inline`,h),this.terminateWorker(),this.error=null,this.transmuxer=new NS(this.observer,c,a,"",t,e.logger)}return}}this.transmuxer=new NS(this.observer,c,a,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=kS++;const t=this.hls.config,s=qb(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Kt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),bP(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,r,a,l,c,f,d,h){var g,y;d.transmuxing.start=self.performance.now();const{instanceNo:v,transmuxer:b}=this,T=l?l.start:a.start,E=a.decryptdata,_=this.frag,A=!(_&&a.cc===_.cc),C=!(_&&d.level===_.level),N=_?d.sn-_.sn:-1,w=this.part?d.part-this.part.index:-1,G=N===0&&d.id>1&&d.id===_?.stats.chunkCount,M=!C&&(N===1||N===0&&(w===1||G&&w<=0)),B=self.performance.now();(C||N||a.stats.parsing.start===0)&&(a.stats.parsing.start=B),l&&(w||!M)&&(l.stats.parsing.start=B);const K=!(_&&((g=a.initSegment)==null?void 0:g.url)===((y=_.initSegment)==null?void 0:y.url)),V=new hO(A,M,f,C,T,K);if(!M||A||K){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${a.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===He.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${A}
        trackSwitch: ${C}
        contiguous: ${M}
        accurateTimeOffset: ${f}
        timeOffset: ${T}
        initSegmentChange: ${K}`);const $=new fO(s,r,t,c,h);this.configureTransmuxer($)}if(this.frag=a,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:v,cmd:"demux",data:e,decryptdata:E,chunkMeta:d,state:V},e instanceof ArrayBuffer?[e]:[]);else if(b){const $=b.push(e,E,d,V);Gl($)?$.then(ee=>{this.handleTransmuxComplete(ee)}).catch(ee=>{this.transmuxerError(ee,d,"transmuxer-interface push error")}):this.handleTransmuxComplete($)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const r=s.flush(e);Gl(r)?r.then(a=>{this.handleFlushResult(a,e)}).catch(a=>{this.transmuxerError(a,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const PS=100;class mO extends Tp{constructor(e,t,s){super(e,t,s,"audio-stream-controller",He.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:r,timescale:a,trackId:l}){if(s===He.MAIN){const c=t.cc,f=this.fragCurrent;if(this.initPTS[c]={baseTime:r,timescale:a,trackId:l},this.log(`InitPTS for cc: ${c} found from main: ${r/a} (${r}/${a}) trackId: ${l}`),this.mainAnchor=t,this.state===Ee.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==c)&&this.syncWithAnchor(t,d?.frag)}else!this.hls.hasEnoughToStart&&f&&f.cc!==c?(f.abortRequests(),this.syncWithAnchor(t,f)):this.state===Ee.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const r=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&r?.cc===t.cc)return;const a=(r||e).cc,l=this.getLevelDetails(),c=this.getLoadPosition(),f=U1(l,a,c);f&&(this.log(`Syncing with main frag at ${f.start} cc ${f.cc}`),this.startFragRequested=!1,this.nextLoadPosition=f.start,this.resetLoadingState(),this.state===Ee.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=Ee.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(PS),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=Ee.IDLE):this.state=Ee.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case Ee.IDLE:this.doTickIdle();break;case Ee.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e?.[t],r=s?.details;if(r&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(r))break;this.state=Ee.WAITING_INIT_PTS}break}case Ee.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case Ee.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:r,complete:a}=e,l=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=Ee.FRAG_LOADING;const c=r.flush().buffer,f={frag:t,part:s,payload:c,networkDetails:null};this._handleFragmentLoadProgress(f),a&&super._handleFragmentLoadComplete(f)}else l&&l.cc!==e.frag.cc&&this.syncWithAnchor(l,e.frag)}else this.state=Ee.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:r,trackId:a}=this,l=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!l.startFragPrefetch)||!(s!=null&&s[a]))return;const c=s[a],f=c.details;if(!f||this.waitForLive(c)||this.waitForCdnTuneIn(f)){this.state=Ee.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,Ht.AUDIO,He.AUDIO));const h=this.getFwdBufferInfo(d,He.AUDIO);if(h===null)return;if(!this.switchingTrack&&this._streamEnded(h,f)){t.trigger(L.BUFFER_EOS,{type:"audio"}),this.state=Ee.ENDED;return}const g=h.len,y=t.maxBufferLength,v=f.fragments,b=v[0].start,T=this.getLoadPosition(),E=this.flushing?T:h.end;if(this.switchingTrack&&r){const C=T;f.PTSKnown&&C<b&&(h.end>b||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=b+.05)}if(g>=y&&!this.switchingTrack&&E<v[v.length-1].start)return;let _=this.getNextFragment(E,f);if(_&&this.isLoopLoading(_,E)&&(_=this.getNextFragmentLoopLoading(_,f,h,He.MAIN,y)),!_){this.bufferFlushed=!0;return}let A=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&A&&gs(_)&&!_.endList&&(!f.live||!this.loadingParts&&E<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(A)===Es.OK&&(this.mainFragLoading=A=null),A&&gs(A))){if(_.start>A.end){const N=this.fragmentTracker.getFragAtPos(E,He.MAIN);N&&N.end>A.end&&(A=N,this.mainFragLoading={frag:N,targetBufferTime:null})}if(_.start>A.end)return}this.loadFragment(_,c,E)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new Bl(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==Ee.STOPPED&&(this.setInterval(PS),this.state=Ee.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(L.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:r}=this,{details:a,id:l,groupId:c,track:f}=t;if(!r){this.warn(`Audio tracks reset while loading track ${l} "${f.name}" of "${c}"`);return}const d=this.mainDetails;if(!d||a.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==Ee.STOPPED&&(this.state=Ee.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${l} "${f.name}" of "${c}" loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`);const h=r[l];let g=0;if(a.live||(s=h.details)!=null&&s.live){if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;if(h.details){var y;g=this.alignPlaylists(a,h.details,(y=this.levelLastLoaded)==null?void 0:y.details)}a.alignedSliding||(sA(a,d),a.alignedSliding||ld(a,d),g=a.fragmentStart)}h.details=a,this.levelLastLoaded=h,this.startFragRequested||this.setStartPosition(d,g),this.hls.trigger(L.AUDIO_TRACK_UPDATED,{details:a,id:l,groupId:t.groupId}),this.state===Ee.WAITING_TRACK&&!this.waitForCdnTuneIn(a)&&(this.state=Ee.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:r,payload:a}=e,{config:l,trackId:c,levels:f}=this;if(!f){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const d=f[c];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const h=d.details;if(!h){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const g=l.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let y=this.transmuxer;y||(y=this.transmuxer=new EA(this.hls,He.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const v=this.initPTS[s.cc],b=(t=s.initSegment)==null?void 0:t.data;if(v!==void 0){const E=r?r.index:-1,_=E!==-1,A=new bp(s.level,s.sn,s.stats.chunkCount,a.byteLength,E,_);y.push(a,b,g,"",s,r,h.totalduration,!1,A,v)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${h.startSN} ,${h.endSN}],track ${c}`);const{cache:T}=this.waitingData=this.waitingData||{frag:s,part:r,cache:new nA,complete:!1};T.push(new Uint8Array(a)),this.state!==Ee.STOPPED&&(this.state=Ee.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===He.MAIN&&gs(t.frag)&&(this.mainFragLoading=t,this.state===Ee.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:r}=t;if(s.type!==He.AUDIO){!this.audioOnly&&s.type===He.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(gs(s)){this.fragPrevious=s;const a=this.switchingTrack;a&&(this.bufferedTrack=a,this.switchingTrack=null,this.hls.trigger(L.AUDIO_TRACK_SWITCHED,Pt({},a)))}this.fragBufferedComplete(s,r),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=Ee.ERROR;return}switch(t.details){case ue.FRAG_GAP:case ue.FRAG_PARSING_ERROR:case ue.FRAG_DECRYPT_ERROR:case ue.FRAG_LOAD_ERROR:case ue.FRAG_LOAD_TIMEOUT:case ue.KEY_LOAD_ERROR:case ue.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(He.AUDIO,t);break;case ue.AUDIO_TRACK_LOAD_ERROR:case ue.AUDIO_TRACK_LOAD_TIMEOUT:case ue.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Ee.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===pt.AUDIO_TRACK&&(this.state=Ee.IDLE);break;case ue.BUFFER_ADD_CODEC_ERROR:case ue.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case ue.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ue.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ht.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ht.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Ee.ENDED&&(this.state=Ee.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,He.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:r}=this,{remuxResult:a,chunkMeta:l}=e,c=this.getCurrentContext(l);if(!c){this.resetWhenMissingContext(l);return}const{frag:f,part:d,level:h}=c,{details:g}=h,{audio:y,text:v,id3:b,initSegment:T}=a;if(this.fragContextChanged(f)||!g){this.fragmentTracker.removeFragment(f);return}if(this.state=Ee.PARSING,this.switchingTrack&&y&&this.completeAudioSwitch(this.switchingTrack),T!=null&&T.tracks){const E=f.initSegment||f;if(this.unhandledEncryptionError(T,f))return;this._bufferInitSegment(h,T.tracks,E,l),r.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:s,tracks:T.tracks})}if(y){const{startPTS:E,endPTS:_,startDTS:A,endDTS:C}=y;d&&(d.elementaryStreams[Ht.AUDIO]={startPTS:E,endPTS:_,startDTS:A,endDTS:C}),f.setElementaryStreamInfo(Ht.AUDIO,E,_,A,C),this.bufferFragmentData(y,f,d,l)}if(b!=null&&(t=b.samples)!=null&&t.length){const E=$t({id:s,frag:f,details:g},b);r.trigger(L.FRAG_PARSING_METADATA,E)}if(v){const E=$t({id:s,frag:f,details:g},v);r.trigger(L.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(e,t,s,r){if(this.state!==Ee.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const a=t.audio;a.id=He.AUDIO;const l=e.audioCodec;this.log(`Init audio buffer, container:${a.container}, codecs[level/parsed]=[${l}/${a.codec}]`),l&&l.split(",").length===1&&(a.levelCodec=l),this.hls.trigger(L.BUFFER_CODECS,t);const c=a.initSegment;if(c!=null&&c.byteLength){const f={type:"audio",frag:s,part:null,chunkMeta:r,parent:s.type,data:c};this.hls.trigger(L.BUFFER_APPENDING,f)}this.tickImmediate()}loadFragment(e,t,s){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===Es.NOT_LOADED||r===Es.PARTIAL){var a;if(!gs(e))this._loadInitSegment(e,t);else if((a=t.details)!=null&&a.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Ee.WAITING_INIT_PTS;const l=this.mainDetails;l&&l.fragmentStart!==t.details.fragmentStart&&ld(t.details,l)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:r,characteristics:a,audioCodec:l,channels:c}=this.bufferedTrack;ra({name:t,lang:s,assocLang:r,characteristics:a,audioCodec:l,channels:c},e,ea)||(nd(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(L.AUDIO_TRACK_SWITCHED,Pt({},e))}}class Ip extends Pn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const r=t?.renditionReports;if(r){let a=-1;for(let l=0;l<r.length;l++){const c=r[l];let f;try{f=new self.URL(c.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),f=c.URI||""}if(f===e){a=l;break}else f===e.substring(0,f.length)&&(a=l)}if(a!==-1){const l=r[a],c=parseInt(l["LAST-MSN"])||t.lastPartSn;let f=parseInt(l["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const h=Math.min(t.age-t.partTarget,t.targetduration);f>=0&&h>t.partTarget&&(f+=1)}const d=s&&Xb(s);return new Wb(c,f>=0?f:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:r,stats:a}=t,l=self.performance.now(),c=a.loading.first?Math.max(0,l-a.loading.first):0;r.advancedDateTime=Date.now()-c;const f=this.hls.config.timelineOffset;if(f!==r.appliedTimelineOffset){const h=Math.max(f||0,0);r.appliedTimelineOffset=h,r.fragments.forEach(g=>{g.setStart(g.playlistOffset+h)})}if(r.live||s!=null&&s.live){const h="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(s),s&&r.fragments.length>0){aP(s,r,this);const A=r.playlistParsingError;if(A){this.warn(A);const C=this.hls;if(!C.config.ignorePlaylistParsingErrors){var d;const{networkDetails:N}=t;C.trigger(L.ERROR,{type:Xe.NETWORK_ERROR,details:ue.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:A,reason:A.message,level:t.level||void 0,parent:(d=r.fragments[0])==null?void 0:d.type,networkDetails:N,stats:a});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=a.loading.start);const g=this.hls.mainForwardBufferInfo,y=g?g.end-g.len:0,v=(r.edge-y)*1e3,b=Q1(r,v);if(r.requestScheduled+b<l?r.requestScheduled=l:r.requestScheduled+=b,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let T,E,_;if(r.canBlockReload&&r.endSN&&r.advanced){const A=this.hls.config.lowLatencyMode,C=r.lastPartSn,N=r.endSN,w=r.lastPartIndex,G=w!==-1,M=C===N;G?M?(E=N+1,_=A?0:w):(E=C,_=A?w+1:r.maxPartIndex):E=N+1;const B=r.age,K=B+r.ageHeader;let V=Math.min(K-r.partTarget,r.targetduration*1.5);if(V>0){if(K>r.targetduration*3)this.log(`Playlist last advanced ${B.toFixed(2)}s ago. Omitting segment and part directives.`),E=void 0,_=void 0;else if(s!=null&&s.tuneInGoal&&K-r.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${V} with playlist age: ${r.age}`),V=0;else{const $=Math.floor(V/r.targetduration);if(E+=$,_!==void 0){const ee=Math.round(V%r.targetduration/r.partTarget);_+=ee}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${B.toFixed(2)}s goal: ${V} skip sn ${$} to part ${_}`)}r.tuneInGoal=V}if(T=this.getDeliveryDirectives(r,t.deliveryDirectives,E,_),A||!M){r.requestScheduled=l,this.loadingPlaylist(h,T);return}}else(r.canBlockReload||r.canSkipUntil)&&(T=this.getDeliveryDirectives(r,t.deliveryDirectives,E,_));T&&E!==void 0&&r.canBlockReload&&(r.requestScheduled=a.loading.first+Math.max(b-c*2,b/2)),this.scheduleLoading(h,T,r)}else this.clearTimer()}scheduleLoading(e,t,s){const r=s||e.details;if(!r){this.loadingPlaylist(e,t);return}const a=self.performance.now(),l=r.requestScheduled;if(a>=l){this.loadingPlaylist(e,t);return}const c=l-a;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),c)}getDeliveryDirectives(e,t,s,r){let a=Xb(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,r=t.part,a=Uu.No),new Wb(s,r,a)}checkRetry(e){const t=e.details,s=id(e),r=e.errorAction,{action:a,retryCount:l=0,retryConfig:c}=r||{},f=!!r&&!!c&&(a===ks.RetryRequest||!r.resolved&&a===ks.SendAlternateToPenaltyBox);if(f){var d;if(l>=c.maxNumRetry)return!1;if(s&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const h=xp(c,l);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),h),this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${t}" in ${h}ms`)}e.levelRetry=!0,r.resolved=!0}return f}}function TA(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Hl(n[t].attrs,e[t].attrs))return!1;return!0}function Hl(n,e,t){const s=n["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>n[r]!==e[r])}function dg(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class gO extends Ip{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:r,details:a}=t,l=this.tracksInGroup[s];if(!l||l.groupId!==r){this.warn(`Audio track with id:${s} and group:${r} not found in active group ${l?.groupId}`);return}const c=l.details;l.details=t.details,this.log(`Audio track ${s} "${l.name}" lang:${l.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,r=this.groupIds;let a=this.currentTrack;if(!s||r?.length!==s?.length||s!=null&&s.some(c=>r?.indexOf(c)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(y=>!s||s.indexOf(y.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(y=>y.default)&&(this.selectDefaultTrack=!1),c.forEach((y,v)=>{y.id=v});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const f=this.hls.config.audioPreference;if(!a&&f){const y=ui(f,c,ea);if(y>-1)a=c[y];else{const v=ui(f,this.tracks);a=this.tracks[v]}}let d=this.findTrackId(a);d===-1&&a&&(d=this.findTrackId(null));const h={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${s?.join(",")}`),this.hls.trigger(L.AUDIO_TRACKS_UPDATED,h);const g=this.trackId;if(d!==-1&&g===-1)this.setAudioTrack(d);else if(c.length&&g===-1){var l;const y=new Error(`No audio track selected for current audio group-ID(s): ${(l=this.groupIds)==null?void 0:l.join(",")} track count: ${c.length}`);this.warn(y.message),this.hls.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:y})}}}onError(e,t){t.fatal||!t.context||t.context.type===pt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const r=this.currentTrack;if(r&&ra(e,r,ea))return r;const a=ui(e,this.tracksInGroup,ea);if(a>-1){const l=this.tracksInGroup[a];return this.setAudioTrack(a),l}else if(r){let l=t.loadLevel;l===-1&&(l=t.firstAutoLevel);const c=Lk(e,t.levels,s,l,ea);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const l=ui(e,s);if(l>-1)return s[l]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e],a=r.details&&!r.details.live;if(e===this.trackId&&r===s&&a||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(L.AUDIO_TRACK_SWITCHING,Pt({},r)),a))return;const l=this.switchParams(r.url,s?.details,r.details);this.loadPlaylist(l)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const r=t[s];if(!(this.selectDefaultTrack&&!r.default)&&(!e||ra(e,r,ea)))return s}if(e){const{name:s,lang:r,assocLang:a,characteristics:l,audioCodec:c,channels:f}=e;for(let d=0;d<t.length;d++){const h=t[d];if(ra({name:s,lang:r,assocLang:a,characteristics:l,audioCodec:c,channels:f},h,ea))return d}for(let d=0;d<t.length;d++){const h=t[d];if(Hl(e.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const h=t[d];if(Hl(e.attrs,h.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&nd(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,t),l=e.details,c=l?.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${a}`),this.hls.trigger(L.AUDIO_TRACK_LOADING,{url:a,id:s,groupId:r,deliveryDirectives:t||null,track:e})}}class pO{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(a){var s;if(r.onError(a),this.queues===null||this.tracks===null)return;const l=(s=this.tracks[e])==null?void 0:s.buffer;l!=null&&l.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],r=s?.buffer;return r?`SourceBuffer${r.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const OS=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,AA="HlsJsTrackRemovedError";class yO extends Error{constructor(e){super(e),this.name=AA}}class xO extends Pn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:r,mediaSource:a}=this;s&&this.log("Media source opened"),!(!r||!a)&&(a.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(L.MEDIA_ATTACHED,{media:r,mediaSource:a}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:r}=this;s!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=B2(_r(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.BUFFER_EOS,this.onBufferEos,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.FRAG_PARSED,this.onFragParsed,this),e.on(L.FRAG_CHANGED,this.onFragChanged,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_EOS,this.onBufferEos,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.FRAG_PARSED,this.onFragParsed,this),e.off(L.FRAG_CHANGED,this.onFragChanged,this),e.off(L.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const a=this.isUpdating();a||this.operationQueue.removeBlockers();const l=this.isQueued();(a||l)&&this.warn(`Transfering MediaSource with${l?" operations in queue":""}${a?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?$t(s,r.tracks):this.sourceBuffers.forEach(a=>{const[l]=a;l&&(s[l]=$t({},this.tracks[l]),this.removeBuffer(l)),a[0]=a[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const r=_r(this.appendSource);if(r){const a=!!t.mediaSource;(a||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const l=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(l),a)this._objectUrl=s.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{s.removeAttribute("src");const f=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||f&&l instanceof f,MS(s),vO(s,c),s.load()}catch{s.src=c}else s.src=c}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,r=t.tracks,a=r?Object.keys(r):null,l=a?a.length:0,c=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&a&&l){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Kt(s,(f,d)=>f==="initSegment"?void 0:d)};
transfer tracks: ${Kt(r,(f,d)=>f==="initSegment"?void 0:d)}}`),!b1(r,s)){t.mediaSource=null,t.tracks=void 0;const f=e.currentTime,d=this.details,h=Math.max(f,d?.fragments[0].start||0);if(h-f>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${f} -> ${h}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(s)}") start time: ${h} currentTime: ${f}`),this.onMediaDetaching(L.MEDIA_DETACHING,{}),this.onMediaAttaching(L.MEDIA_ATTACHING,t),e.currentTime=h;return}this.transferData=void 0,a.forEach(f=>{const d=f,h=r[d];if(h){const g=h.buffer;if(g){const y=this.fragmentTracker,v=h.id;if(y.hasFragments(v)||y.hasParts(v)){const E=lt.getBuffered(g);y.detectEvictedFragments(d,E,v,null,!0)}const b=om(d),T=[d,g];this.sourceBuffers[b]=T,g.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,h)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:a,_objectUrl:l}=this;if(a){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=a.readyState==="open";try{const f=a.sourceBuffers;for(let d=f.length;d--;)c&&f[d].abort(),a.removeSourceBuffer(f[d]);c&&a.endOfStream()}catch(f){this.warn(`onMediaDetaching: ${f.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.removeEventListener("startstreaming",this._onStartStreaming),a.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),s||(l&&self.URL.revokeObjectURL(l),this.mediaSrc===l?(r.removeAttribute("src"),this.appendSource&&MS(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(L.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(a){this.warn(`onBufferReset ${e}`,a)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[om(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new pO(this.tracks)}onBufferCodecs(e,t){var s;const r=this.tracks,a=Object.keys(t);this.log(`BUFFER_CODECS: "${a}" (current SB count ${this.sourceBufferCount})`);const l="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),c=!l&&this.sourceBufferCount&&this.media&&a.some(f=>!r[f]);if(l||c){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${a}" SourceBuffers`);return}a.forEach(f=>{var d,h;const g=t[f],{id:y,codec:v,levelCodec:b,container:T,metadata:E,supplemental:_}=g;let A=r[f];const C=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[f],N=C!=null&&C.buffer?C:A,w=N?.pendingCodec||N?.codec,G=N?.levelCodec;A||(A=r[f]={buffer:void 0,listeners:[],codec:v,supplemental:_,container:T,levelCodec:b,metadata:E,id:y});const M=ju(w,G),B=M?.replace(OS,"$1");let K=ju(v,b);const V=(h=K)==null?void 0:h.replace(OS,"$1");K&&M&&B!==V&&(f.slice(0,5)==="audio"&&(K=td(K,this.appendSource)),this.log(`switching codec ${w} to ${K}`),K!==(A.pendingCodec||A.codec)&&(A.pendingCodec=K),A.container=T,this.appendChangeType(f,T,K))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const r=`${t};codecs=${s}`,a={label:`change-type=${r}`,execute:()=>{const l=this.tracks[e];if(l){const c=l.buffer;c!=null&&c.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),c.changeType(r),l.codec=s,l.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn(`Failed to change ${e} SourceBuffer type`,l)}};this.append(a,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,r=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,He.MAIN))==null?void 0:t.gap)===!0)return;const l={label:"block-audio",execute:()=>{var c;const f=this.tracks.video;(this.lastVideoAppendEnd>r||f!=null&&f.buffer&&lt.isBuffered(f.buffer,r)||((c=this.fragmentTracker.getAppendedFrag(r,He.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:l,frag:e},this.append(l,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:r,type:a,parent:l,frag:c,part:f,chunkMeta:d,offset:h}=t,g=d.buffering[a],{sn:y,cc:v}=c,b=self.performance.now();g.start=b;const T=c.stats.buffering,E=f?f.stats.buffering:null;T.start===0&&(T.start=b),E&&E.start===0&&(E.start=b);const _=s.audio;let A=!1;a==="audio"&&_?.container==="audio/mpeg"&&(A=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const C=s.video,N=C?.buffer;if(N&&y!=="initSegment"){const M=f||c,B=this.blockedAudioAppend;if(a==="audio"&&l!=="main"&&!this.blockedAudioAppend&&!(C.ending||C.ended)){const V=M.start+M.duration*.05,$=N.buffered,ee=this.currentOp("video");!$.length&&!ee?this.blockAudio(M):!ee&&!lt.isBuffered(N,V)&&this.lastVideoAppendEnd<V&&this.blockAudio(M)}else if(a==="video"){const K=M.end;if(B){const V=B.frag.start;(K>V||K<this.lastVideoAppendEnd||lt.isBuffered(N,V))&&this.unblockAudio()}this.lastVideoAppendEnd=K}}const w=(f||c).start,G={label:`append-${a}`,execute:()=>{var M;g.executeStart=self.performance.now();const B=(M=this.tracks[a])==null?void 0:M.buffer;B&&(A?this.updateTimestampOffset(B,w,.1,a,y,v):h!==void 0&&Be(h)&&this.updateTimestampOffset(B,h,1e-6,a,y,v)),this.appendExecutor(r,a)},onStart:()=>{},onComplete:()=>{const M=self.performance.now();g.executeEnd=g.end=M,T.first===0&&(T.first=M),E&&E.first===0&&(E.first=M);const B={};this.sourceBuffers.forEach(([K,V])=>{K&&(B[K]=lt.getBuffered(V))}),this.appendErrors[a]=0,a==="audio"||a==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(L.BUFFER_APPENDED,{type:a,frag:c,part:f,chunkMeta:d,parent:c.type,timeRanges:B})},onError:M=>{var B;const K={type:Xe.MEDIA_ERROR,parent:c.type,details:ue.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:c,part:f,chunkMeta:d,error:M,err:M,fatal:!1},V=(B=this.media)==null?void 0:B.error;if(M.code===DOMException.QUOTA_EXCEEDED_ERR||M.name=="QuotaExceededError"||"quota"in M)K.details=ue.BUFFER_FULL_ERROR;else if(M.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!V)K.errorAction=io(!0);else if(M.name===AA&&this.sourceBufferCount===0)K.errorAction=io(!0);else{const $=++this.appendErrors[a];this.warn(`Failed ${$}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer (${V||"no media error"})`),($>=this.hls.config.appendErrorMaxRetry||V)&&(K.fatal=!0)}this.hls.trigger(L.ERROR,K)}};this.log(`queuing "${a}" append sn: ${y}${f?" p: "+f.index:""} of ${c.type===He.MAIN?"level":"track"} ${c.level} cc: ${v}`),this.append(G,a,this.isPending(this.tracks[a]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(L.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:s,startOffset:r,endOffset:a}=t;s?this.append(this.getFlushOp(s,r,a),s):this.sourceBuffers.forEach(([l])=>{l&&this.append(this.getFlushOp(l,r,a),l)})}onFragParsed(e,t){const{frag:s,part:r}=t,a=[],l=r?r.elementaryStreams:s.elementaryStreams;l[Ht.AUDIOVIDEO]?a.push("audiovideo"):(l[Ht.AUDIO]&&a.push("audio"),l[Ht.VIDEO]&&a.push("video"));const c=()=>{const f=self.performance.now();s.stats.buffering.end=f,r&&(r.stats.buffering.end=f);const d=r?r.stats:s.stats;this.hls.trigger(L.FRAG_BUFFERED,{frag:s,part:r,stats:d,id:s.type})};a.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(c,a).catch(f=>{this.warn(`Fragment buffered callback ${f}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([l])=>{if(l){const c=this.tracks[l];(!t.type||t.type===l)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${l} buffer reached EOS`)))}});const r=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([l])=>{var c;return l&&!((c=this.tracks[l])!=null&&c.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:l}=this;if(!l||l.readyState!=="open"){l&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${l.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),l.endOfStream(),this.hls.trigger(L.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(L.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===ue.BUFFER_APPEND_ERROR&&t.frag){var s;const r=(s=t.errorAction)==null?void 0:s.nextAutoLevel;Be(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const r=e.config,a=s.currentTime,l=t.levelTargetDuration,c=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(Be(c)&&c>=0){const d=Math.max(c,l),h=Math.floor(a/l)*l-d;this.flushBackBuffer(a,l,h)}const f=r.frontBufferFlushThreshold;if(Be(f)&&f>0){const d=Math.max(r.maxBufferLength,f),h=Math.max(d,l),g=Math.floor(a/l)*l+h;this.flushFrontBuffer(a,l,g)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([r,a])=>{if(a){const c=lt.getBuffered(a);if(c.length>0&&s>c.start(0)){var l;this.hls.trigger(L.BACK_BUFFER_REACHED,{bufferEnd:s});const f=this.tracks[r];if((l=this.details)!=null&&l.live)this.hls.trigger(L.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(f!=null&&f.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:r})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([r,a])=>{if(a){const l=lt.getBuffered(a),c=l.length;if(c<2)return;const f=l.start(c-1),d=l.end(c-1);if(s>f||e>=f&&e<=d)return;this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:f,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||s?.readyState!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),h=Math.max(d,r);return{duration:1/0,start:d,end:h}}return{duration:1/0}}const a=(e=this.overrides)==null?void 0:e.duration;if(a)return Be(a)?{duration:a}:null;const l=this.media.duration,c=Be(s.duration)?s.duration:0;return r>c&&r>l||!Be(l)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:s}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(Be(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${s}.`),r.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Kt(s)}`),this.tracksReady){var r;const a=(r=this.transferData)==null?void 0:r.tracks;a&&Object.keys(a).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const r=this.tracks[t];e[t]={buffer:s,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(L.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const a in e){const l=a,c=e[l];if(this.isPending(c)){const f=this.getTrackCodec(c,l),d=`${c.container};codecs=${f}`;c.codec=f,this.log(`creating sourceBuffer(${d})${this.currentOp(l)?" Queued":""} ${Kt(c)}`);try{const h=s.addSourceBuffer(d),g=om(l),y=[l,h];t[g]=y,c.buffer=h}catch(h){var r;this.error(`error while trying to add sourceBuffer: ${h.message}`),this.shiftAndExecuteNext(l),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[l],this.hls.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,sourceBufferName:l,mimeType:d,parent:c.id});return}this.trackSourceBuffer(l,c)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let r=e.codec;s&&(t==="video"||t==="audiovideo")&&Ul(s,"video")&&(r=lk(r,s));const a=ju(r,e.levelCodec);return a?t.slice(0,5)==="audio"?td(a,this.appendSource):a:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(a,l)=>{const c=l.removedRanges;c!=null&&c.length&&this.hls.trigger(L.BUFFER_FLUSHED,{type:a})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${r}`,t),this.hls.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const a=this.currentOp(e);a&&a.onError(r)}updateTimestampOffset(e,t,s,r,a,l){const c=t-e.timestampOffset;Math.abs(c)>=s&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${a} cc: ${l})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:r,mediaSource:a}=this,l=this.tracks[e],c=l?.buffer;if(!r||!a||!c){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const f=Be(r.duration)?r.duration:1/0,d=Be(a.duration)?a.duration:1/0,h=Math.max(0,t),g=Math.min(s,f,d);g>h&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${h},${g}] from the ${e} SourceBuffer`),c.remove(h,g)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],r=s?.buffer;if(!r)throw new yO(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,r=t.map(l=>this.appendBlocker(l));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(l=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const r=(s=this.tracks[t])==null?void 0:s.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const r=this.tracks[e];if(!r)return;const a=r.buffer;if(!a)return;const l=s.bind(this,e);r.listeners.push({event:t,listener:l}),a.addEventListener(t,l)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(r=>{s.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function MS(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function vO(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function om(n){return n==="audio"?1:0}class Np{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Be(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((r,a)=>this.isLevelAllowed(r)&&a<=e);return this.clientRect=null,Np.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const r=(c,f)=>f?c.width!==f.width||c.height!==f.height:!0;let a=e.length-1;const l=Math.max(t,s);for(let c=0;c<e.length;c+=1){const f=e[c];if((f.width>=l||f.height>=l)&&r(f,e[c+1])){a=c;break}}return a}}const bO={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},tn=bO,SO={HLS:"h"},EO=SO;class gi{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof gi?s:new gi(s))),this.value=e,this.params=t}}const TO="Dict";function AO(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function _O(n,e,t,s){return new Error(`failed to ${n} "${AO(e)}" as ${t}`,{cause:s})}function pi(n,e,t){return _O("serialize",n,e,t)}class _A{constructor(e){this.description=e}}const jS="Bare Item",CO="Boolean";function LO(n){if(typeof n!="boolean")throw pi(n,CO);return n?"?1":"?0"}function wO(n){return btoa(String.fromCharCode(...n))}const RO="Byte Sequence";function DO(n){if(ArrayBuffer.isView(n)===!1)throw pi(n,RO);return`:${wO(n)}:`}const IO="Integer";function NO(n){return n<-999999999999999||999999999999999<n}function CA(n){if(NO(n))throw pi(n,IO);return n.toString()}function kO(n){return`@${CA(n.getTime()/1e3)}`}function LA(n,e){if(n<0)return-LA(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const r=Math.floor(n*t);return(r%2===0?r:r+1)/t}else return Math.round(n*t)/t}const PO="Decimal";function OO(n){const e=LA(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw pi(n,PO);const t=e.toString();return t.includes(".")?t:`${t}.0`}const MO="String",jO=/[\x00-\x1f\x7f]+/;function UO(n){if(jO.test(n))throw pi(n,MO);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function FO(n){return n.description||n.toString().slice(7,-1)}const BO="Token";function US(n){const e=FO(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw pi(e,BO);return e}function fg(n){switch(typeof n){case"number":if(!Be(n))throw pi(n,jS);return Number.isInteger(n)?CA(n):OO(n);case"string":return UO(n);case"symbol":return US(n);case"boolean":return LO(n);case"object":if(n instanceof Date)return kO(n);if(n instanceof Uint8Array)return DO(n);if(n instanceof _A)return US(n);default:throw pi(n,jS)}}const $O="Key";function hg(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw pi(n,$O);return n}function kp(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${hg(e)}`:`;${hg(e)}=${fg(t)}`).join("")}function wA(n){return n instanceof gi?`${fg(n.value)}${kp(n.params)}`:fg(n)}function VO(n){return`(${n.value.map(wA).join(" ")})${kp(n.params)}`}function GO(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw pi(n,TO);const t=n instanceof Map?n.entries():Object.entries(n),s=e?.whitespace?" ":"";return Array.from(t).map(([r,a])=>{a instanceof gi||(a=new gi(a));let l=hg(r);return a.value===!0?l+=kp(a.params):(l+="=",Array.isArray(a.value)?l+=VO(a):l+=wA(a)),l}).join(`,${s}`)}function RA(n,e){return GO(n,e)}const ai="CMCD-Object",is="CMCD-Request",Wr="CMCD-Session",xr="CMCD-Status",HO={br:ai,ab:ai,d:ai,ot:ai,tb:ai,tpb:ai,lb:ai,tab:ai,lab:ai,url:ai,pb:is,bl:is,tbl:is,dl:is,ltc:is,mtp:is,nor:is,nrr:is,rc:is,sn:is,sta:is,su:is,ttfb:is,ttfbb:is,ttlb:is,cmsdd:is,cmsds:is,smrt:is,df:is,cs:is,ts:is,cid:Wr,pr:Wr,sf:Wr,sid:Wr,st:Wr,v:Wr,msd:Wr,bs:xr,bsd:xr,cdn:xr,rtp:xr,bg:xr,pt:xr,ec:xr,e:xr},KO={REQUEST:is};function zO(n){return Object.keys(n).reduce((e,t)=>{var s;return(s=n[t])===null||s===void 0||s.forEach(r=>e[r]=t),e},{})}function YO(n,e){const t={};if(!n)return t;const s=Object.keys(n),r=e?zO(e):{};return s.reduce((a,l)=>{var c;const f=HO[l]||r[l]||KO.REQUEST,d=(c=a[f])!==null&&c!==void 0?c:a[f]={};return d[l]=n[l],a},t)}function qO(n){return["ot","sf","st","e","sta"].includes(n)}function XO(n){return typeof n=="number"?Be(n):n!=null&&n!==""&&n!==!1}const DA="event";function WO(n,e){const t=new URL(n),s=new URL(e);if(t.origin!==s.origin)return n;const r=t.pathname.split("/").slice(1),a=s.pathname.split("/").slice(1,-1);for(;r[0]===a[0];)r.shift(),a.shift();for(;a.length;)a.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const Vu=n=>Math.round(n),mg=(n,e)=>Array.isArray(n)?n.map(t=>mg(t,e)):n instanceof gi&&typeof n.value=="string"?new gi(mg(n.value,e),n.params):(e.baseUrl&&(n=WO(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),Su=n=>Vu(n/100)*100,QO=(n,e)=>{let t=n;return e.version>=2&&(n instanceof gi&&typeof n.value=="string"?t=new gi([n]):typeof n=="string"&&(t=[n])),mg(t,e)},ZO={br:Vu,d:Vu,bl:Su,dl:Su,mtp:Su,nor:QO,rtp:Su,tb:Vu},IA="request",NA="response",Pp=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],JO=["e"],eM=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Sd(n){return eM.test(n)}function tM(n){return Pp.includes(n)||JO.includes(n)||Sd(n)}const kA=["d","dl","nor","ot","rtp","su"];function sM(n){return Pp.includes(n)||kA.includes(n)||Sd(n)}const nM=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function iM(n){return Pp.includes(n)||kA.includes(n)||nM.includes(n)||Sd(n)}const rM=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function aM(n){return rM.includes(n)||Sd(n)}const oM={[NA]:iM,[DA]:tM,[IA]:sM};function PA(n,e={}){const t={};if(n==null||typeof n!="object")return t;const s=e.version||n.v||1,r=e.reportingMode||IA,a=s===1?aM:oM[r];let l=Object.keys(n).filter(a);const c=e.filter;typeof c=="function"&&(l=l.filter(c));const f=r===NA||r===DA;f&&!l.includes("ts")&&l.push("ts"),s>1&&!l.includes("v")&&l.push("v");const d=$t({},ZO,e.formatters),h={version:s,reportingMode:r,baseUrl:e.baseUrl};return l.sort().forEach(g=>{let y=n[g];const v=d[g];if(typeof v=="function"&&(y=v(y,h)),g==="v"){if(s===1)return;y=s}g=="pr"&&y===1||(f&&g==="ts"&&!Be(y)&&(y=Date.now()),XO(y)&&(qO(g)&&typeof y=="string"&&(y=new _A(y)),t[g]=y))}),t}function lM(n,e={}){const t={};if(!n)return t;const s=PA(n,e),r=YO(s,e?.customHeaderMap);return Object.entries(r).reduce((a,[l,c])=>{const f=RA(c,{whitespace:!1});return f&&(a[l]=f),a},t)}function cM(n,e,t){return $t(n,lM(e,t))}const uM="CMCD";function dM(n,e={}){return n?RA(PA(n,e),{whitespace:!1}):""}function fM(n,e={}){if(!n)return"";const t=dM(n,e);return encodeURIComponent(t)}function hM(n,e={}){if(!n)return"";const t=fM(n,e);return`${uM}=${t}`}const FS=/CMCD=[^&#]+/;function mM(n,e,t){const s=hM(e,t);if(!s)return n;if(FS.test(n))return n.replace(FS,s);const r=n.includes("?")?"&":"?";return`${n}${r}${s}`}class gM{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:tn.MANIFEST,su:!this.initialized})}catch(a){this.hls.logger.warn("Could not generate manifest CMCD data.",a)}},this.applyFragmentData=r=>{try{const{frag:a,part:l}=r,c=this.hls.levels[a.level],f=this.getObjectType(a),d={d:(l||a).duration*1e3,ot:f};(f===tn.VIDEO||f===tn.AUDIO||f==tn.MUXED)&&(d.br=c.bitrate/1e3,d.tb=this.getTopBandwidth(f)/1e3,d.bl=this.getBufferLength(f));const h=l?this.getNextPart(l):this.getNextFrag(a);h!=null&&h.url&&h.url!==a.url&&(d.nor=h.url),this.apply(r,d)}catch(a){this.hls.logger.warn("Could not generate segment CMCD data.",a)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHED,this.onMediaDetached,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHED,this.onMediaDetached,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,r;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:EO.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){$t(t,this.createData());const s=t.ot===tn.INIT||t.ot===tn.VIDEO||t.ot===tn.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((l,c)=>(r.includes(c)&&(l[c]=t[c]),l),{}));const a={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),cM(e.headers,t,a)):e.url=mM(e.url,t,a)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const r=e.sn-s.startSN;return s.fragments[r+1]}}getNextPart(e){var t;const{index:s,fragment:r}=e,a=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(a){const{sn:l}=r;for(let c=a.length-1;c>=0;c--){const f=a[c];if(f.index===s&&f.fragment.sn===l)return a[c+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return tn.TIMED_TEXT;if(e.sn==="initSegment")return tn.INIT;if(t==="audio")return tn.AUDIO;if(t==="main")return this.hls.audioTracks.length?tn.VIDEO:tn.MUXED}getTopBandwidth(e){let t=0,s;const r=this.hls;if(e===tn.AUDIO)s=r.audioTracks;else{const a=r.maxAutoLevel,l=a>-1?a+1:r.levels.length;s=r.levels.slice(0,l)}return s.forEach(a=>{a.bitrate>t&&(t=a.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===tn.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:lt.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new s(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,l,c){t(a),this.loader.load(a,l,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new s(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,l,c){t(a),this.loader.load(a,l,c)}}}}const pM=3e5;class yM extends Pn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if(s?.action===ks.SendAlternateToPenaltyBox&&s.flags===hn.MoveAllAlternatesMatchingHost){const r=this.levels;let a=this._pathwayPriority,l=this.pathwayId;if(t.context){const{groupId:c,pathwayId:f,type:d}=t.context;c&&r?l=this.getPathwayForGroupId(c,d,l):f&&(l=f)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!a&&r&&(a=this.pathways()),a&&a.length>1&&(this.updatePathwayPriority(a),s.resolved=this.pathwayId!==l),t.details===ue.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${l} levels: ${r&&r.length} priorities: ${Kt(a)} penalized: ${Kt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,r=performance.now();Object.keys(s).forEach(a=>{r-s[a]>pM&&delete s[a]});for(let a=0;a<e.length;a++){const l=e[a];if(l in s)continue;if(l===this.pathwayId)return;const c=this.hls.nextLoadLevel,f=this.hls.levels[c];if(t=this.getLevelsForPathway(l),t.length>0){this.log(`Setting Pathway to "${l}"`),this.pathwayId=l,eA(t),this.hls.trigger(L.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[c];f&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==f.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==f.bitrate&&this.log(`Unstable Pathways change from bitrate ${f.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,s){const r=this.getLevelsForPathway(s).concat(this.levels||[]);for(let a=0;a<r.length;a++)if(t===pt.AUDIO_TRACK&&r[a].hasAudioGroup(e)||t===pt.SUBTITLE_TRACK&&r[a].hasSubtitleGroup(e))return r[a].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},r={};e.forEach(a=>{const{ID:l,"BASE-ID":c,"URI-REPLACEMENT":f}=a;if(t.some(h=>h.pathwayId===l))return;const d=this.getLevelsForPathway(c).map(h=>{const g=new Zt(h.attrs);g["PATHWAY-ID"]=l;const y=g.AUDIO&&`${g.AUDIO}_clone_${l}`,v=g.SUBTITLES&&`${g.SUBTITLES}_clone_${l}`;y&&(s[g.AUDIO]=y,g.AUDIO=y),v&&(r[g.SUBTITLES]=v,g.SUBTITLES=v);const b=OA(h.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",f),T=new Bl({attrs:g,audioCodec:h.audioCodec,bitrate:h.bitrate,height:h.height,name:h.name,url:b,videoCodec:h.videoCodec,width:h.width});if(h.audioGroups)for(let E=1;E<h.audioGroups.length;E++)T.addGroupId("audio",`${h.audioGroups[E]}_clone_${l}`);if(h.subtitleGroups)for(let E=1;E<h.subtitleGroups.length;E++)T.addGroupId("text",`${h.subtitleGroups[E]}_clone_${l}`);return T});t.push(...d),BS(this.audioTracks,s,f,l),BS(this.subtitleTracks,r,f,l)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const h=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+h)}const a={responseType:"json",url:r.href},l=t.steeringManifestLoadPolicy.default,c=l.errorRetry||l.timeoutRetry||{},f={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},d={onSuccess:(h,g,y,v)=>{this.log(`Loaded steering manifest: "${r}"`);const b=h.data;if(b?.VERSION!==1){this.log(`Steering VERSION ${b.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=b.TTL;const{"RELOAD-URI":T,"PATHWAY-CLONES":E,"PATHWAY-PRIORITY":_}=b;if(T)try{this.uri=new self.URL(T,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${T}`);return}this.scheduleRefresh(this.uri||y.url),E&&this.clonePathways(E);const A={steeringManifest:b,url:r.toString()};this.hls.trigger(L.STEERING_MANIFEST_LOADED,A),_&&this.updatePathwayPriority(_)},onError:(h,g,y,v)=>{if(this.log(`Error loading steering manifest: ${h.code} ${h.text} (${g.url})`),this.stopLoad(),h.code===410){this.enabled=!1,this.log(`Steering manifest ${g.url} no longer available`);return}let b=this.timeToLoad*1e3;if(h.code===429){const T=this.loader;if(typeof T?.getResponseHeader=="function"){const E=T.getResponseHeader("Retry-After");E&&(b=parseFloat(E)*1e3)}this.log(`Steering manifest ${g.url} rate limited`);return}this.scheduleRefresh(this.uri||g.url,b)},onTimeout:(h,g,y)=>{this.log(`Timeout loading steering manifest (${g.url})`),this.scheduleRefresh(this.uri||g.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(a,f,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const r=(s=this.hls)==null?void 0:s.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function BS(n,e,t,s){n&&Object.keys(e).forEach(r=>{const a=n.filter(l=>l.groupId===r).map(l=>{const c=$t({},l);return c.details=void 0,c.attrs=new Zt(c.attrs),c.url=c.attrs.URI=OA(l.url,l.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[r],c.attrs["PATHWAY-ID"]=s,c});n.push(...a)})}function OA(n,e,t,s){const{HOST:r,PARAMS:a,[t]:l}=s;let c;e&&(c=l?.[e],c&&(n=c));const f=new self.URL(n);return r&&!c&&(f.host=r),a&&Object.keys(a).sort().forEach(d=>{d&&f.searchParams.set(d,a[d])}),f.href}class ao extends Pn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=ao.CDMCleanupPromise?[ao.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:r}=t,a=`"${t.type}" event: init data type: "${s}"`;if(this.debug(a),r!==null){if(!this.keyFormatPromise){let l=Object.keys(this.keySystemAccessPromises);l.length||(l=Sl(this.config));const c=l.map(Jh).filter(f=>!!f);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(l=>{const c=Fu(l);if(s!=="sinf"||c!==Jt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${c}`);return}let f;try{const v=Ss(new Uint8Array(r)),b=Ep(JSON.parse(v).sinf),T=R1(b);if(!T)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");f=new Uint8Array(T.subarray(8,24))}catch(v){this.warn(`${a} Failed to parse sinf: ${v}`);return}const d=Gs(f),{keyIdToKeySessionPromise:h,mediaKeySessions:g}=this;let y=h[d];for(let v=0;v<g.length;v++){const b=g[v],T=b.decryptdata;if(!T.keyId)continue;const E=Gs(T.keyId);if(ad(f,T.keyId)||T.uri.replace(/-/g,"").indexOf(d)!==-1){if(y=h[E],!y)continue;if(T.pssh)break;delete h[E],T.pssh=new Uint8Array(r),T.keyId=f,y=h[d]=y.then(()=>this.generateRequestWithPreferredKeySession(b,s,r,"encrypted-event-key-match")),y.catch(_=>this.handleError(_));break}}y||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${g.length}.`))}).catch(l=>this.handleError(l))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(L.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,r=t?.[e];if(r)return r.licenseUrl;if(e===Jt.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t?.[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(l,c,f)=>!!l&&f.indexOf(l)===c,r=t.map(l=>l.audioCodec).filter(s),a=t.map(l=>l.videoCodec).filter(s);return r.length+a.length===0&&a.push("avc1.42e01e"),new Promise((l,c)=>{const f=d=>{const h=d.shift();this.getMediaKeysPromise(h,r,a).then(g=>l({keySystem:h,mediaKeys:g})).catch(g=>{d.length?f(d):g instanceof fn?c(g):c(new fn({type:Xe.KEY_SYSTEM_ERROR,details:ue.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})};f(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${s}`;return z1===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return s(e,t)}getMediaKeysPromise(e,t,s){var r;const a=Qk(e,t,s,this.config.drmSystemOptions||{});let l=this.keySystemAccessPromises[e],c=(r=l)==null?void 0:r.keySystemAccess;if(!c){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Kt(a)}`),c=this.requestMediaKeySystemAccess(e,a);const f=l=this.keySystemAccessPromises[e]={keySystemAccess:c};return c.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),c.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const h=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const g=f.mediaKeys=d.createMediaKeys().then(y=>(this.log(`Media-keys created for "${e}"`),f.hasMediaKeys=!0,h.then(v=>v?this.setMediaKeysServerCertificate(y,e,v):y)));return g.catch(y=>{this.error(`Failed to create media-keys for "${e}"}: ${y}`)}),g})}return c.then(()=>l.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Gs(e.keyId||[])} keyUri: ${e.uri}`);const r=s.createSession(),a={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),r=Eu(t),a="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(s,a,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Gs(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Jh(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const a=Jh(r);a?t(a):s(new Error(`Unable to find format for key-system "${r}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Sl(this.config),s=e.map(Fu).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const r=xM(e,t[s]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,s=Eu(t),r=this.bannedKeyIds[s];if(r||this.getKeyStatus(t)==="internal-error"){const c=$S(r||"internal-error",t);return this.handleError(c,e.frag),Promise.reject(c)}const a=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${a}`);const l=this.keyIdToKeySessionPromise[s];if(!l){const c=this.getKeySystemForKeyPromise(t).then(({keySystem:f,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${a}`),this.attemptSetMediaKeys(f,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:f,mediaKeys:d,decryptdata:t}))))).then(f=>{const d="cenc",h=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(f,d,h,"playlist-key")});return c.catch(f=>this.handleError(f,e.frag)),this.keyIdToKeySessionPromise[s]=c,c}return l.catch(c=>{if(c instanceof fn){const f=Pt({},c.data);this.getKeyStatus(t)==="internal-error"&&(f.decryptdata=t);const d=new fn(f,c.message);this.handleError(d,e.frag)}}),l}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof fn){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${Gs(s.keyId||[])})`:""}`),this.hls.trigger(L.ERROR,e.data)}else this.error(e.message),this.hls.trigger(L.ERROR,{type:Xe.KEY_SYSTEM_ERROR,details:ue.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Eu(e),s=this.keyIdToKeySessionPromise[t];if(!s){const r=Fu(e.keyFormat),a=r?[r]:Sl(this.config);return this.attemptKeySystemAccess(a)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=Sl(this.config)),e.length===0)throw new fn({type:Xe.KEY_SYSTEM_ERROR,details:ue.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Kt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(s).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(a=>s.indexOf(a)===-1)})}generateRequestWithPreferredKeySession(e,t,s,r){var a;const l=(a=this.config.drmSystems)==null||(a=a[e.keySystem])==null?void 0:a.generateRequest;if(l)try{const b=l.call(this.hls,t,s,e);if(!b)throw new Error("Invalid response from configured generateRequest filter");t=b.initDataType,s=b.initData?b.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(b){if(this.warn(b.message),this.hls&&this.hls.config.debug)throw b}if(s===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const c=Eu(e.decryptdata),f=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${c} URI: ${f} (init data type: ${t} length: ${s.byteLength})`);const d=new Ap,h=e._onmessage=b=>{const T=e.mediaKeysSession;if(!T){d.emit("error",new Error("invalid state"));return}const{messageType:E,message:_}=b;this.log(`"${E}" message event for session "${T.sessionId}" message size: ${_.byteLength}`),E==="license-request"||E==="license-renewal"?this.renewLicense(e,_).catch(A=>{d.eventNames().length?d.emit("error",A):this.handleError(A)}):E==="license-release"?e.keySystem===Jt.FAIRPLAY&&this.updateKeySession(e,ag("acknowledged")).then(()=>this.removeSession(e)).catch(A=>this.handleError(A)):this.warn(`unhandled media key message type "${E}"`)},g=(b,T)=>{T.keyStatus=b;let E;b.startsWith("usable")?d.emit("resolved"):b==="internal-error"||b==="output-restricted"||b==="output-downscaled"?E=$S(b,T.decryptdata):b==="expired"?E=new Error(`key expired (keyId: ${c})`):b==="released"?E=new Error("key released"):b==="status-pending"||this.warn(`unhandled key status change "${b}" (keyId: ${c})`),E&&(d.eventNames().length?d.emit("error",E):this.handleError(E))},y=e._onkeystatuseschange=b=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const E=this.getKeyStatuses(e);if(!Object.keys(E).some(N=>E[N]!=="status-pending"))return;if(E[c]==="expired"){this.log(`Expired key ${Kt(E)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let A=E[c];if(A)g(A,e);else{var C;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(C=e.keyStatusTimeouts)[c]||(C[c]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const w=this.getKeyStatus(e.decryptdata);if(w&&w!=="status-pending")return this.log(`No status for keyId ${c} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${w} from other session.`),g(w,e);this.log(`key status for ${c} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),A="internal-error",g(A,e)},1e3)),this.log(`No status for keyId ${c} (${Kt(E)}).`)}};Ks(e.mediaKeysSession,"message",h),Ks(e.mediaKeysSession,"keystatuseschange",y);const v=new Promise((b,T)=>{d.on("error",T),d.on("resolved",b)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${c} URI: ${f}`)}).catch(b=>{throw new fn({type:Xe.KEY_SYSTEM_ERROR,details:ue.KEY_SYSTEM_NO_SESSION,error:b,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${b}`)}).then(()=>v).catch(b=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw b}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,r)=>{if(typeof r=="string"&&typeof s=="object"){const c=r;r=s,s=c}const a="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);e.keySystem===Jt.PLAYREADY&&a.length===16&&H1(a);const l=Gs(a);s==="internal-error"&&(this.bannedKeyIds[l]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${l} key-session "${e.mediaKeysSession.sessionId}"`),t[l]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,r=new s(t),a=this.getServerCertificateUrl(e);return a?(this.log(`Fetching server certificate for "${e}"`),new Promise((l,c)=>{const f={responseType:"arraybuffer",url:a},d=t.certLoadPolicy.default,h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,v,b,T)=>{l(y.data)},onError:(y,v,b,T)=>{c(new fn({type:Xe.KEY_SYSTEM_ERROR,details:ue.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:b,response:Pt({url:f.url,data:void 0},y)},`"${e}" certificate request failed (${a}). Status: ${y.code} (${y.text})`))},onTimeout:(y,v,b)=>{c(new fn({type:Xe.KEY_SYSTEM_ERROR,details:ue.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:b,response:{url:f.url,data:void 0}},`"${e}" certificate request timed out (${a})`))},onAbort:(y,v,b)=>{c(new Error("aborted"))}};r.load(f,h,g)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((r,a)=>{e.setServerCertificate(s).then(l=>{this.log(`setServerCertificate ${l?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),r(e)}).catch(l=>{a(new fn({type:Xe.KEY_SYSTEM_ERROR,details:ue.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(r=>{throw new fn({type:Xe.KEY_SYSTEM_ERROR,details:ue.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(s,"application/xml"),a=r.querySelectorAll("HttpHeader");if(a.length>0){let h;for(let g=0,y=a.length;g<y;g++){var l,c;h=a[g];const v=(l=h.querySelector("name"))==null?void 0:l.textContent,b=(c=h.querySelector("value"))==null?void 0:c.textContent;v&&b&&e.setRequestHeader(v,b)}}const f=r.querySelector("Challenge"),d=f?.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return ag(atob(d))}setupLicenseXHR(e,t,s,r){const a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return a.call(this.hls,e,t,s,r)}).catch(l=>{if(!s.decryptdata)throw l;return e.open("POST",t,!0),a.call(this.hls,e,t,s,r)}).then(l=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:l||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((r,a)=>{const l=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${l}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return a(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let f=c.response;this.log(`License received ${f instanceof ArrayBuffer?f.byteLength:f}`);const d=this.config.licenseResponseCallback;if(d)try{f=d.call(this.hls,c,l,e)}catch(h){this.error(h)}r(f)}else{const f=s.errorRetry,d=f?f.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||c.status>=400&&c.status<500)a(new fn({type:Xe.KEY_SYSTEM_ERROR,details:ue.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:c,response:{url:l,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${l}). Status: ${c.status} (${c.statusText})`));else{const h=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${h} attempts left`),this.requestLicense(e,t).then(r,a)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,l,e,t).then(({xhr:f,licenseChallenge:d})=>{e.keySystem==Jt.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(f,d)),f.send(d)}).catch(a)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,Ks(s,"encrypted",this.onMediaEncrypted),Ks(s,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(nn(e,"encrypted",this.onMediaEncrypted),nn(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,aa.clearKeyUriToKeyIdMap();const r=s.length;ao.CDMCleanupPromise=Promise.all(s.map(a=>this.removeSession(a)).concat((t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(L.ERROR,{type:Xe.OTHER_ERROR,details:ue.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(L.ERROR,{type:Xe.OTHER_ERROR,details:ue.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((r,a)=>(r.indexOf(a.keyFormat)===-1&&r.push(a.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Gs(r?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const a=this.mediaKeySessions.indexOf(e);a>-1&&this.mediaKeySessions.splice(a,1);const{keyStatusTimeouts:l}=e;l&&Object.keys(l).forEach(d=>self.clearTimeout(l[d]));const{drmSystemOptions:c}=this.config;return(Jk(c)?new Promise((d,h)=>{self.setTimeout(()=>h(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(h)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(L.ERROR,{type:Xe.OTHER_ERROR,details:ue.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(L.ERROR,{type:Xe.OTHER_ERROR,details:ue.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}ao.CDMCleanupPromise=void 0;function Eu(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return Gs(n.keyId)}function xM(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class fn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function $S(n,e){const t=n==="output-restricted",s=t?ue.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:ue.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new fn({type:Xe.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class vM{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const r=performance.now();if(t){if(this.lastTime){const a=r-this.lastTime,l=s-this.lastDroppedFrames,c=t-this.lastDecodedFrames,f=1e3*l/a,d=this.hls;if(d.trigger(L.FPS_DROP,{currentDropped:l,currentDecoded:c,totalDroppedFrames:s}),f>0&&l>d.config.fpsDroppedMonitoringThreshold*c){let h=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=h)&&(h=h-1,d.trigger(L.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:d.currentLevel}),d.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function MA(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function jA(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){Mt.debug(`[texttrack-utils]: ${s}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,n.addCue(r)}catch(r){Mt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(n.mode=t)}function so(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let s=n.cues.length;s--;)e&&n.cues[s].removeEventListener("enter",e),n.removeCue(n.cues[s]);t==="disabled"&&(n.mode=t)}function gg(n,e,t,s){const r=n.mode;if(r==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const a=SM(n.cues,e,t);for(let l=0;l<a.length;l++)(!s||s(a[l]))&&n.removeCue(a[l])}r==="disabled"&&(n.mode=r)}function bM(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let s=0,r=t,a;for(;s<=r;)if(a=Math.floor((r+s)/2),e<n[a].startTime)r=a-1;else if(e>n[a].startTime&&s<t)s=a+1;else return a;return n[s].startTime-e<e-n[r].startTime?s:r}function SM(n,e,t){const s=[],r=bM(n,e);if(r>-1)for(let a=r,l=n.length;a<l;a++){const c=n[a];if(c.startTime>=e&&c.endTime<=t)s.push(c);else if(c.startTime>t)return s}return s}function Gu(n){const e=[];for(let t=0;t<n.length;t++){const s=n[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(n[t])}return e}class EM extends Ip{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=Gu(this.media.textTracks);for(let a=0;a<s.length;a++)if(s[a].mode==="hidden")t=s[a];else if(s[a].mode==="showing"){t=s[a];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;Gu(s.textTracks).forEach(l=>{so(l)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:r,details:a}=t,l=this.tracksInGroup[s];if(!l||l.groupId!==r){this.warn(`Subtitle track with id:${s} and group:${r} not found in active group ${l?.groupId}`);return}const c=l.details;l.details=t.details,this.log(`Subtitle track ${s} "${l.name}" lang:${l.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,r=this.groupIds;let a=this.currentTrack;if(!s||r?.length!==s?.length||s!=null&&s.some(l=>r?.indexOf(l)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(h=>!s||s.indexOf(h.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(h=>h.default)&&(this.selectDefaultTrack=!1),l.forEach((h,g)=>{h.id=g});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const c=this.hls.config.subtitlePreference;if(!a&&c){this.selectDefaultTrack=!1;const h=ui(c,l);if(h>-1)a=l[h];else{const g=ui(c,this.tracks);a=this.tracks[g]}}let f=this.findTrackId(a);f===-1&&a&&(f=this.findTrackId(null));const d={subtitleTracks:l};this.log(`Updating subtitle tracks, ${l.length} track(s) found in "${s?.join(",")}" group-id`),this.hls.trigger(L.SUBTITLE_TRACKS_UPDATED,d),f!==-1&&this.trackId===-1&&this.setSubtitleTrack(f)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const a=t[r];if(!(s&&!a.default||!s&&!e)&&(!e||ra(a,e)))return r}if(e){for(let r=0;r<t.length;r++){const a=t[r];if(Hl(e.attrs,a.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const a=t[r];if(Hl(e.attrs,a.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const r=t[s];if(dg(r,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===pt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&ra(e,s))return s;const r=ui(e,this.tracksInGroup);if(r>-1){const a=this.tracksInGroup[r];return this.setSubtitleTrack(r),a}else{if(s)return null;{const a=ui(e,t);if(a>-1)return t[a]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,t),l=e.details,c=l?.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${a}`),this.hls.trigger(L.SUBTITLE_TRACK_LOADING,{url:a,id:s,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Gu(e.textTracks),s=this.currentTrack;let r;if(s&&(r=t.filter(a=>dg(s,a))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(a=>{a.mode!=="disabled"&&a!==r&&(a.mode="disabled")}),r){const a=this.subtitleDisplay?"showing":"hidden";r.mode!==a&&(r.mode=a)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Be(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:e});return}const a=!!r.details&&!r.details.live;if(e===this.trackId&&r===s&&a)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:l,groupId:c="",name:f,type:d,url:h}=r;this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:l,groupId:c,name:f,type:d,url:h});const g=this.switchParams(r.url,s?.details,r.details);this.loadPlaylist(g)}}function TM(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const a=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?a:a&3|8).toString(16)})}}}function Rl(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const oo=.025;let ud=(function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n})({});function AM(n,e,t){return`${n.identifier}-${t+1}-${Rl(e)}`}class _M{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return lm(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=lm(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Be(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return lm(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<oo))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?ud.Range:ud.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return CM(this)}}function lm(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<oo)?e.start:e.start+e.duration}function UA(n,e,t){const s=new self.URL(n,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function cm(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function CM(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Wa(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class LM{constructor(e,t,s,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(L.PLAYOUT_LIMIT_REACHED,{})};const a=this.hls=new e(t);this.interstitial=s,this.assetItem=r;const l=()=>{this.hasDetails=!0};a.once(L.LEVEL_LOADED,l),a.once(L.AUDIO_TRACK_LOADED,l),a.once(L.SUBTITLE_TRACK_LOADED,l),a.on(L.MEDIA_ATTACHING,(c,{media:f})=>{this.removeMediaListeners(),this.mediaAttached=f,this.interstitial.playoutLimit&&(f.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&a.on(L.BUFFER_APPENDED,()=>{const h=this.bufferedEnd;this.reachedPlayout(h)&&(this._bufferedEosTime=h,a.trigger(L.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=UA(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,a=lt.bufferInfo(e,r,0);return this.getAssetTime(a.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=lt.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,s){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,s){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Wa(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const VS=.033;class wM extends Pn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(a=r[s])!=null&&a.event;){var a;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let r=0;r<s.length;r++){let a=s[r];if(t&&t!=="primary"&&(a=a[t]),e===a.start||e>a.start&&e<a.end)return r}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let r=e;r<=t&&s[r];r++){const a=s[r].event;if(a!=null&&a.restrictions.jump&&!a.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var s;if(((s=t[r].event)==null?void 0:s.identifier)===e)return r}return-1}findAssetIndex(e,t){const s=e.assetList,r=s.length;if(r>1)for(let a=0;a<r;a++){const l=s[a];if(!l.error){const c=l.timelineStart;if(t===c||t>c&&(t<c+(l.duration||0)||a===r-1))return a}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,r=s[s.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:r}=s,a=this.events,l=this.parseDateRanges(r,{url:s.url},t),c=Object.keys(r),f=a?a.filter(d=>!c.includes(d.identifier)):[];l.length&&l.sort((d,h)=>{const g=d.cue.pre,y=d.cue.post,v=h.cue.pre,b=h.cue.post;if(g&&!v)return-1;if(v&&!g||y&&!b)return 1;if(b&&!y)return-1;if(!g&&!v&&!y&&!b){const T=d.startTime,E=h.startTime;if(T!==E)return T-E}return d.dateRange.tagOrder-h.dateRange.tagOrder}),this.events=l,f.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,f)}updateSchedule(e,t=[],s=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const a=this.items,l=this.parseSchedule(r,e);(s||t.length||a?.length!==l.length||l.some((f,d)=>Math.abs(f.playout.start-a[d].playout.start)>.005||Math.abs(f.playout.end-a[d].playout.end)>.005))&&(this.items=l,this.onScheduleUpdate(t,a))}}parseDateRanges(e,t,s){const r=[],a=Object.keys(e);for(let l=0;l<a.length;l++){const c=a[l],f=e[c];if(f.isInterstitial){let d=this.eventMap[c];d?d.setDateRange(f):(d=new _M(f,t),this.eventMap[c]=d,s===!1&&(d.appendInPlace=s)),r.push(d)}}return r}parseSchedule(e,t){const s=[],r=t.main.details,a=r.live?1/0:r.edge;let l=0;if(e=e.filter(f=>!f.error&&!(f.cue.once&&f.hasPlayed)),e.length){this.resolveOffsets(e,t);let f=0,d=0;if(e.forEach((h,g)=>{const y=h.cue.pre,v=h.cue.post,b=e[g-1]||null,T=h.appendInPlace,E=v?a:h.startOffset,_=h.duration,A=h.timelineOccupancy===ud.Range?_:0,C=h.resumptionOffset,N=b?.startTime===E,w=E+h.cumulativeDuration;let G=T?w+_:E+C;if(y||!v&&E<=0){const B=d;d+=A,h.timelineStart=w;const K=l;l+=_,s.push({event:h,start:w,end:G,playout:{start:K,end:l},integrated:{start:B,end:d}})}else if(E<=a){if(!N){const V=E-f;if(V>VS){const $=f,ee=d;d+=V;const he=l;l+=V;const Z={previousEvent:e[g-1]||null,nextEvent:h,start:$,end:$+V,playout:{start:he,end:l},integrated:{start:ee,end:d}};s.push(Z)}else V>0&&b&&(b.cumulativeDuration+=V,s[s.length-1].end=E)}v&&(G=w),h.timelineStart=w;const B=d;d+=A;const K=l;l+=_,s.push({event:h,start:w,end:G,playout:{start:K,end:l},integrated:{start:B,end:d}})}else return;const M=h.resumeTime;v||M>a?f=a:f=M}),f<a){var c;const h=f,g=d,y=a-f;d+=y;const v=l;l+=y,s.push({previousEvent:((c=s[s.length-1])==null?void 0:c.event)||null,nextEvent:null,start:f,end:h+y,playout:{start:v,end:l},integrated:{start:g,end:d}})}this.setDurations(a,l,d)}else s.push({previousEvent:null,nextEvent:null,start:0,end:a,playout:{start:0,end:a},integrated:{start:0,end:a}}),this.setDurations(a,a,a);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,r=s.live?1/0:s.edge;let a=0,l=-1;e.forEach((c,f)=>{const d=c.cue.pre,h=c.cue.post,g=d?0:h?r:c.startTime;this.updateAssetDurations(c),l===g?c.cumulativeDuration=a:(a=0,l=g),!h&&c.snapOptions.in&&(c.resumeAnchor=la(null,s.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,t)||(c.appendInPlace=!1)),!c.appendInPlace&&f+1<e.length&&e[f+1].startTime-e[f].resumeTime<VS&&(e[f+1].appendInPlace=!1,e[f+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const v=Be(c.resumeOffset)?c.resumeOffset:c.duration;a+=v})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(s-r)>oo?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(l=>{const c=t[l].details,f=c.edge;if(s>=f)return this.log(`"${e.identifier}" resumption ${s} past ${l} playlist end ${f}`),!1;const d=la(null,c.fragments,s);if(!d)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${l} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const h=l==="audio"?.175:0;return Math.abs(d.start-s)<oo+h||Math.abs(d.end-s)<oo+h?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${l} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,r=!1,a=!1;for(let l=0;l<e.assetList.length;l++){const c=e.assetList[l],f=t+s;c.startOffset=s,c.timelineStart=f,r||(r=c.duration===null),a||(a=!!c.error);const d=c.error?0:c.duration||0;s+=d}r&&!a?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Kn(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class RM{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let r;try{r=UA(s,this.hls.sessionId,e.baseUrl)}catch(y){const v=this.assignAssetListError(e,ue.ASSET_LIST_LOAD_ERROR,y,s);this.hls.trigger(L.ERROR,v);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const a=this.hls.config,l=a.loader,c=new l(a),f={responseType:"json",url:r.href},d=a.interstitialAssetListLoadPolicy.default,h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,v,b,T)=>{const E=y.data,_=E?.ASSETS;if(!Array.isArray(_)){const A=this.assignAssetListError(e,ue.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),b.url,v,T);this.hls.trigger(L.ERROR,A);return}e.assetListResponse=E,this.hls.trigger(L.ASSET_LIST_LOADED,{event:e,assetListResponse:E,networkDetails:T})},onError:(y,v,b,T)=>{const E=this.assignAssetListError(e,ue.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${y.code} ${y.text} (${v.url})`),v.url,T,b);this.hls.trigger(L.ERROR,E)},onTimeout:(y,v,b)=>{const T=this.assignAssetListError(e,ue.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${v.url})`),v.url,y,b);this.hls.trigger(L.ERROR,T)}};return c.load(f,h,g),this.hls.trigger(L.ASSET_LIST_LOADING,{event:e}),c}assignAssetListError(e,t,s,r,a,l){return e.error=s,{type:Xe.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:s,networkDetails:l,stats:a}}}function GS(n){n?.play().catch(()=>{})}function Tu(n,e){return`[${n}] Advancing timeline position to ${e}`}class DM extends Pn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const r=s-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const l=r<=-.01;this.timelinePos=s,this.bufferedPos=s;const c=this.playingItem;if(!c){this.checkBuffer();return}if(l&&this.schedule.resetErrorsInRange(s,s-r)&&this.updateSchedule(!0),this.checkBuffer(),l&&s<c.start||s>=c.end){var f;const v=this.findItemIndex(c);let b=this.schedule.findItemIndexAtTime(s);if(b===-1&&(b=v+(l?-1:1),this.log(`seeked ${l?"back ":""}to position not covered by schedule ${s} (resolving from ${v} to ${b})`)),!this.isInterstitial(c)&&(f=this.media)!=null&&f.paused&&(this.shouldPlay=!1),!l&&b>v){const T=this.schedule.findJumpRestrictedIndex(v+1,b);if(T>v){this.setSchedulePosition(T);return}}this.setSchedulePosition(b);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(c)){const v=c.event.assetList[0];v&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,v))}return}const h=d.timelineStart,g=d.duration||0;if(l&&s<h||s>=h+g){var y;(y=c.event)!=null&&y.appendInPlace&&(this.clearInterstitial(c.event,c),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,d)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(s>=r.end){this.timelinePos=r.end;const c=this.findItemIndex(r);this.setSchedulePosition(c+1)}const a=this.playingAsset;if(!a)return;const l=a.timelineStart+(a.duration||0);s>=l&&this.setScheduleToAssetAtTime(s,a)},this.onScheduleUpdate=(s,r)=>{const a=this.schedule;if(!a)return;const l=this.playingItem,c=a.events||[],f=a.items||[],d=a.durations,h=s.map(T=>T.identifier),g=!!(c.length||h.length);(g||r)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${f.map(T=>Kn(T))} pos: ${this.timelinePos}`),h.length&&this.log(`Removed events ${h}`);let y=null,v=null;l&&(y=this.updateItem(l,this.timelinePos),this.itemsMatch(l,y)?this.playingItem=y:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const b=this.bufferingItem;if(b&&(v=this.updateItem(b,this.bufferedPos),this.itemsMatch(b,v)?this.bufferingItem=v:b.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(b.event,null))),s.forEach(T=>{T.assetList.forEach(E=>{this.clearAssetPlayer(E.identifier,null)})}),this.playerQueue.forEach(T=>{if(T.interstitial.appendInPlace){const E=T.assetItem.timelineStart,_=T.timelineOffset-E;if(_)try{T.timelineOffset=E}catch(A){Math.abs(_)>oo&&this.warn(`${A} ("${T.assetId}" ${T.timelineOffset}->${E})`)}}}),g||r){if(this.hls.trigger(L.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:f.slice(0),durations:d,removedIds:h}),this.isInterstitial(l)&&h.includes(l.event.identifier)){this.warn(`Interstitial "${l.event.identifier}" removed while playing`),this.primaryFallback(l.event);return}l&&this.trimInPlace(y,l),b&&v!==y&&this.trimInPlace(v,b),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new RM(e),this.schedule=new wM(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(L.MEDIA_ENDED,this.onMediaEnded,this),e.on(L.ERROR,this.onError,this),e.on(L.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(L.MEDIA_ENDED,this.onMediaEnded,this),e.off(L.ERROR,this.onError,this),e.off(L.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){nn(e,"play",this.onPlay),nn(e,"pause",this.onPause),nn(e,"seeking",this.onSeeking),nn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;Ks(s,"seeking",this.onSeeking),Ks(s,"timeupdate",this.onTimeupdate),Ks(s,"play",this.onPlay),Ks(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!r){this.clearScheduleState();const a=this.findItemIndex(s);this.setSchedulePosition(a)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,r=this.media;if(this.media=null,!s&&(r&&this.removeMediaListeners(r),this.detachedData)){const a=this.getBufferingPlayer();a&&(this.log(`Removing schedule state for detachedData and ${a}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,a.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=g=>g&&e.getAssetPlayer(g.identifier),r=(g,y,v,b,T)=>{if(g){let E=g[y].start;const _=g.event;if(_){if(y==="playout"||_.timelineOccupancy!==ud.Point){const A=s(v);A?.interstitial===_&&(E+=A.assetItem.startOffset+A[T])}}else{const A=b==="bufferedPos"?l():e[b];E+=A-g.start}return E}return 0},a=(g,y)=>{var v;if(g!==0&&y!=="primary"&&(v=e.schedule)!=null&&v.length){var b;const T=e.schedule.findItemIndexAtTime(g),E=(b=e.schedule.items)==null?void 0:b[T];if(E){const _=E[y].start-E.start;return g+_}}return g},l=()=>{const g=e.bufferedPos;return g===Number.MAX_VALUE?c("primary"):Math.max(g,0)},c=g=>{var y,v;return(y=e.primaryDetails)!=null&&y.live?e.primaryDetails.edge:((v=e.schedule)==null?void 0:v.durations[g])||0},f=(g,y)=>{var v,b;const T=e.effectivePlayingItem;if(T!=null&&(v=T.event)!=null&&v.restrictions.skip||!e.schedule)return;e.log(`seek to ${g} "${y}"`);const E=e.effectivePlayingItem,_=e.schedule.findItemIndexAtTime(g,y),A=(b=e.schedule.items)==null?void 0:b[_],C=e.getBufferingPlayer(),N=C?.interstitial,w=N?.appendInPlace,G=E&&e.itemsMatch(E,A);if(E&&(w||G)){const M=s(e.playingAsset),B=M?.media||e.primaryMedia;if(B){const K=y==="primary"?B.currentTime:r(E,y,e.playingAsset,"timelinePos","currentTime"),V=g-K,$=(w?K:B.currentTime)+V;if($>=0&&(!M||w||$<=M.duration)){B.currentTime=$;return}}}if(A){let M=g;if(y!=="primary"){const K=A[y].start,V=g-K;M=A.start+V}const B=!e.isInterstitial(A);if((!e.isInterstitial(E)||E.event.appendInPlace)&&(B||A.event.appendInPlace)){const K=e.media||(w?C?.media:null);K&&(K.currentTime=M)}else if(E){const K=e.findItemIndex(E);if(_>K){const $=e.schedule.findJumpRestrictedIndex(K+1,_);if($>K){e.setSchedulePosition($);return}}let V=0;if(B)e.timelinePos=M,e.checkBuffer();else{const $=A.event.assetList,ee=g-(A[y]||A).start;for(let he=$.length;he--;){const Z=$[he];if(Z.duration&&ee>=Z.startOffset&&ee<Z.startOffset+Z.duration){V=he;break}}}e.setSchedulePosition(_,V)}}},d=()=>{const g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;const y=t();return e.isInterstitial(y)?y:null},h={get bufferedEnd(){const g=t(),y=e.bufferingItem;if(y&&y===g){var v;return r(y,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-y.playout.start||((v=e.bufferingAsset)==null?void 0:v.startOffset)||0}return 0},get currentTime(){const g=d(),y=e.effectivePlayingItem;return y&&y===g?r(y,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-y.playout.start:0},set currentTime(g){const y=d(),v=e.effectivePlayingItem;v&&v===y&&f(g+v.playout.start,"playout")},get duration(){const g=d();return g?g.playout.end-g.playout.start:0},get assetPlayers(){var g;const y=(g=d())==null?void 0:g.event.assetList;return y?y.map(v=>e.getAssetPlayer(v.identifier)):[]},get playingIndex(){var g;const y=(g=d())==null?void 0:g.event;return y&&e.effectivePlayingAsset?y.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var g;return((g=e.schedule)==null||(g=g.events)==null?void 0:g.slice(0))||[]},get schedule(){var g;return((g=e.schedule)==null||(g=g.items)==null?void 0:g.slice(0))||[]},get interstitialPlayer(){return d()?h:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const g=t();return e.findItemIndex(g)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const g=e.effectivePlayingItem;return e.findItemIndex(g)},primary:{get bufferedEnd(){return l()},get currentTime(){const g=e.timelinePos;return g>0?g:0},set currentTime(g){f(g,"primary")},get duration(){return c("primary")},get seekableStart(){var g;return((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(g){f(g,"integrated")},get duration(){return c("integrated")},get seekableStart(){var g;return a(((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0,"integrated")}},skip:()=>{const g=e.effectivePlayingItem,y=g?.event;if(y&&!y.restrictions.skip){const v=e.findItemIndex(g);if(y.appendInPlace){const b=g.playout.start+g.event.duration;f(b+.001,"playout")}else e.advanceAfterAssetEnded(y,v,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const a=(t=r)==null?void 0:t.currentTime;if(!(a===void 0||!Be(a)))return a}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,r=e.media;if(s&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const a=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Kt(a)}`),this.detachedData=a}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var s,r;if(e.media===t)return;let a=null;const l=this.hls,c=e!==l,f=c&&e.interstitial.appendInPlace,d=(s=this.detachedData)==null?void 0:s.mediaSource;let h;if(l.media)f&&(a=l.transferMedia(),this.detachedData=a),h="Primary";else if(d){const b=this.getBufferingPlayer();b?(a=b.transferMedia(),h=`${b}`):h="detached MediaSource"}else h="detached media";if(!a){if(d)a=this.detachedData,this.log(`using detachedData: MediaSource ${Kt(a)}`);else if(!this.detachedData||l.media===t){const b=this.playerQueue;b.length>1&&b.forEach(T=>{if(c&&T.interstitial.appendInPlace!==f){const E=T.interstitial;this.clearInterstitial(T.interstitial,null),E.appendInPlace=!1,E.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${E}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const g=a&&"mediaSource"in a&&((r=a.mediaSource)==null?void 0:r.readyState)!=="closed",y=g&&a?a:t;this.log(`${g?"transfering MediaSource":"attaching media"} to ${c?e:"Primary"} from ${h} (media.currentTime: ${t.currentTime})`);const v=this.schedule;if(y===a&&v){const b=c&&e.assetId===v.assetIdAtEnd;y.overrides={duration:v.duration,endOfStream:!c||b,cueRemoval:!c}}e.attachMedia(y)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,r=this.effectivePlayingItem;if(s===-1){const a=this.hls.startPosition;if(this.log(Tu("checkStart",a)),this.timelinePos=a,t.length&&t[0].cue.pre){const l=e.findEventIndex(t[0].identifier);this.setSchedulePosition(l)}else if(a>=0||!this.primaryLive){const l=this.timelinePos=a>0?a:0,c=e.findItemIndexAtTime(l);this.setSchedulePosition(c)}}else if(r&&!this.playingItem){const a=e.findItemIndex(r);this.setSchedulePosition(a)}}advanceAssetBuffering(e,t){const s=e.event,r=s.findAssetIndex(t),a=cm(s,r);if(!s.isAssetPastPlayoutLimit(a))this.bufferedToEvent(e,a);else if(this.schedule){var l;const c=(l=this.schedule.items)==null?void 0:l[this.findItemIndex(e)+1];c&&this.bufferedToItem(c)}}advanceAfterAssetEnded(e,t,s){const r=cm(e,s);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const a=this.schedule.items;if(a){const l=t+1,c=a.length;if(l>=c){this.setSchedulePosition(-1);return}const f=e.resumeTime;this.timelinePos<f&&(this.log(Tu("advanceAfterAssetEnded",f)),this.timelinePos=f,e.appendInPlace&&this.advanceInPlace(f),this.checkBuffer(this.bufferedPos<f)),this.setSchedulePosition(l)}}}else{if(e.appendInPlace){const a=e.assetList[r];a&&this.advanceInPlace(a.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const r=t.parentIdentifier,a=s.getEvent(r);if(a){const l=s.findEventIndex(r),c=s.findAssetIndex(a,e);this.advanceAfterAssetEnded(a,l,c-1)}}setSchedulePosition(e,t){var s;const r=(s=this.schedule)==null?void 0:s.items;if(!r||this.playbackDisabled)return;const a=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${a&&Kn(a)}) pos: ${this.timelinePos}`);const l=this.waitingItem||this.playingItem,c=this.playingLastItem;if(this.isInterstitial(l)){const h=l.event,g=this.playingAsset,y=g?.identifier,v=y?this.getAssetPlayer(y):null;if(v&&y&&(!this.eventItemsMatch(l,a)||t!==void 0&&y!==h.assetList[t].identifier)){var f;const b=h.findAssetIndex(g);if(this.log(`INTERSTITIAL_ASSET_ENDED ${b+1}/${h.assetList.length} ${Wa(g)}`),this.endedAsset=g,this.playingAsset=null,this.hls.trigger(L.INTERSTITIAL_ASSET_ENDED,{asset:g,assetListIndex:b,event:h,schedule:r.slice(0),scheduleIndex:e,player:v}),l!==this.playingItem){this.itemsMatch(l,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(h,this.findItemIndex(this.playingItem),b);return}this.retreiveMediaSource(y,a),v.media&&!((f=this.detachedData)!=null&&f.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(l,a)&&(this.endedItem=l,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${Kn(l)}`),h.hasPlayed=!0,this.hls.trigger(L.INTERSTITIAL_ENDED,{event:h,schedule:r.slice(0),scheduleIndex:e}),h.cue.once)){var d;this.updateSchedule();const b=(d=this.schedule)==null?void 0:d.items;if(a&&b){const T=this.findItemIndex(a);this.advanceSchedule(T,b,t,l,c)}return}}this.advanceSchedule(e,r,t,l,c)}advanceSchedule(e,t,s,r,a){const l=this.schedule;if(!l)return;const c=t[e]||null,f=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(h=>{const g=h.interstitial,y=l.findEventIndex(g.identifier);(y<e||y>e+1)&&this.clearInterstitial(g,c)}),this.isInterstitial(c)){this.timelinePos=Math.min(Math.max(this.timelinePos,c.start),c.end);const h=c.event;if(s===void 0){s=l.findAssetIndex(h,this.timelinePos);const b=cm(h,s-1);if(h.isAssetPastPlayoutLimit(b)||h.appendInPlace&&this.timelinePos===c.end){this.advanceAfterAssetEnded(h,e,s);return}s=b}const g=this.waitingItem;this.assetsBuffered(c,f)||this.setBufferingItem(c);let y=this.preloadAssets(h,s);if(this.eventItemsMatch(c,g||r)||(this.waitingItem=c,this.log(`INTERSTITIAL_STARTED ${Kn(c)} ${h.appendInPlace?"append in place":""}`),this.hls.trigger(L.INTERSTITIAL_STARTED,{event:h,schedule:t.slice(0),scheduleIndex:e})),!h.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${h}`);return}if(h.assetListLoader&&(h.assetListLoader.destroy(),h.assetListLoader=void 0),!f){this.log(`Waiting for attachMedia to start Interstitial ${h}`);return}this.waitingItem=this.endedItem=null,this.playingItem=c;const v=h.assetList[s];if(!v){this.advanceAfterAssetEnded(h,e,s||0);return}if(y||(y=this.getAssetPlayer(v.identifier)),y===null||y.destroyed){const b=h.assetList.length;this.warn(`asset ${s+1}/${b} player destroyed ${h}`),y=this.createAssetPlayer(h,v,s),y.loadSource()}if(!this.eventItemsMatch(c,this.bufferingItem)&&h.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(y,s,t,e,f),this.shouldPlay&&GS(y.media)}else c?(this.resumePrimary(c,e,r),this.shouldPlay&&GS(this.hls.media)):a&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(l.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var r,a;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Kn(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let c=this.timelinePos;(c<e.start||c>=e.end)&&(c=this.getPrimaryResumption(e,t),this.log(Tu("resumePrimary",c)),this.timelinePos=c),this.attachPrimary(c,e)}if(!s)return;const l=(a=this.schedule)==null?void 0:a.items;l&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Kn(e)}`),this.hls.trigger(L.INTERSTITIALS_PRIMARY_RESUMED,{schedule:l.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(s<r.fragmentStart||s>r.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:lt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const a=this.hls;a.media?this.checkBuffer():(this.transferMediaTo(a,r),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Tu("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((s=r.mainForwardBufferInfo)==null?void 0:s.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(L.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(L.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const r=Pt(Pt({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Pt(Pt({},this.altSelection),{},{audio:s});return}const a=Pt(Pt({},r),{},{audio:s});this.mediaSelection=a}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Pt(Pt({},this.altSelection),{},{subtitles:s});return}const a=Pt(Pt({},r),{},{subtitles:s});this.mediaSelection=a}onAudioTrackSwitching(e,t){const s=Zb(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=Zb(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const a=t[r];if(a.cue.post){var s;const l=this.schedule.findEventIndex(a.identifier),c=(s=this.schedule.items)==null?void 0:s[l];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const r=(s=this.schedule)==null?void 0:s.items;if(e&&r){const a=this.findItemIndex(e,t);return r[a]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((a,l)=>{e.event.isAssetPastPlayoutLimit(l)&&this.clearAssetPlayer(a.identifier,null)});const s=e.end+.25,r=lt.bufferInfo(this.primaryMedia,s,0);(r.end>s||(r.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${Kn(e)} (was ${Kn(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const r=lt.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,s,e)}updateBufferedPos(e,t,s){const r=this.schedule,a=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],a)){this.bufferedPos=e;return}const l=this.playingItem,c=this.findItemIndex(l);let f=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const h=this.findItemIndex(a),g=Math.min(h+1,t.length-1),y=t[g];if((f===-1&&a&&e>=a.end||(d=y.event)!=null&&d.appendInPlace&&e+.01>=y.start)&&(f=g),this.isInterstitial(a)){const v=a.event;if(g-c>1&&v.appendInPlace===!1||v.assetList.length===0&&v.assetListLoader)return}if(this.bufferedPos=e,f>h&&f>c)this.bufferedToItem(y);else{const v=this.primaryDetails;this.primaryLive&&v&&e>v.edge-v.targetduration&&y.start<v.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(y)&&this.preloadAssets(y.event,0)}}else s&&l&&!this.itemsMatch(l,a)&&(f===c?this.bufferedToItem(l):f===c+1&&this.bufferedToItem(t[f]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const a=this.getAssetPlayer(r.identifier);return!(a!=null&&a.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:r,events:a}=s;if(!r||!a)return t;const l=this.isInterstitial(e),c=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const f=c?c.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Kn(e)}`+(t?` (${f.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(l){const d=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((h,g)=>{const y=this.getAssetPlayer(h.identifier);y&&(g===d&&y.loadSource(),y.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(L.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:a.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,r=s.assetList.length===0&&!s.assetListLoader,a=s.cue.once;if(r||!a){const l=this.preloadAssets(s,t);if(l!=null&&l.interstitial.appendInPlace){const c=this.primaryMedia;c&&this.bufferAssetPlayer(l,c)}}}preloadAssets(e,t){const s=e.assetUrl,r=e.assetList.length,a=r===0&&!e.assetListLoader,l=e.cue.once;if(a){const f=e.timelineStart;if(e.appendInPlace){var c;const y=this.playingItem;!this.isInterstitial(y)&&(y==null||(c=y.nextEvent)==null?void 0:c.identifier)===e.identifier&&this.flushFrontBuffer(f+.25)}let d,h=0;if(!this.playingItem&&this.primaryLive&&(h=this.hls.startPosition,h===-1&&(h=this.hls.liveSyncPosition||0)),h&&!(e.cue.pre||e.cue.post)){const y=h-f;y>0&&(d=Math.round(y*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:r} ${e}${d?` live-start: ${h} start-offset: ${d}`:""}`),s)return this.createAsset(e,0,0,f,e.duration,s);const g=this.assetListLoader.loadAssetList(e,d);g&&(e.assetListLoader=g)}else if(!l&&r){for(let d=t;d<r;d++){const h=e.assetList[d],g=this.getAssetPlayerQueueIndex(h.identifier);(g===-1||this.playerQueue[g].destroyed)&&!h.error&&this.createAssetPlayer(e,h,d)}const f=e.assetList[t];if(f){const d=this.getAssetPlayer(f.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,r,a,l){const c={parentIdentifier:e.identifier,identifier:AM(e,l,t),duration:a,startOffset:s,timelineStart:r,uri:l};return this.createAssetPlayer(e,c,t)}createAssetPlayer(e,t,s){const r=this.hls,a=r.userConfig;let l=a.videoPreference;const c=r.loadLevelObj||r.levels[r.currentLevel];(l||c)&&(l=$t({},l),c.videoCodec&&(l.videoCodec=c.videoCodec),c.videoRange&&(l.allowedVideoRanges=[c.videoRange]));const f=r.audioTracks[r.audioTrack],d=r.subtitleTracks[r.subtitleTrack];let h=0;if(this.primaryLive||e.appendInPlace){const N=this.timelinePos-t.timelineStart;if(N>1){const w=t.duration;w&&N<w&&(h=N)}}const g=t.identifier,y=Pt(Pt({},a),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:g,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:h,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:l,audioPreference:f||a.audioPreference,subtitlePreference:d||a.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(y.timelineOffset=t.timelineStart));const v=y.cmcd;v!=null&&v.sessionId&&v.contentId&&(y.cmcd=$t({},v,{contentId:Rl(t.uri)})),this.getAssetPlayer(g)&&this.warn(`Duplicate date range identifier ${e} and asset ${g}`);const b=new LM(this.HlsPlayerClass,y,e,t);this.playerQueue.push(b),e.assetList[s]=t;let T=!0;const E=N=>{if(N.live){var w;const B=new Error(`Interstitials MUST be VOD assets ${e}`),K={fatal:!0,type:Xe.OTHER_ERROR,details:ue.INTERSTITIAL_ASSET_ITEM_ERROR,error:B},V=((w=this.schedule)==null?void 0:w.findEventIndex(e.identifier))||-1;this.handleAssetItemError(K,e,V,s,B.message);return}const G=N.edge-N.fragmentStart,M=t.duration;(T||M===null||G>M)&&(T=!1,this.log(`Interstitial asset "${g}" duration change ${M} > ${G}`),t.duration=G,this.updateSchedule())};b.on(L.LEVEL_UPDATED,(N,{details:w})=>E(w)),b.on(L.LEVEL_PTS_UPDATED,(N,{details:w})=>E(w)),b.on(L.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const _=(N,w)=>{const G=this.getAssetPlayer(g);if(G&&w.tracks){G.off(L.BUFFER_CODECS,_),G.tracks=w.tracks;const M=this.primaryMedia;this.bufferingAsset===G.assetItem&&M&&!G.media&&this.bufferAssetPlayer(G,M)}};b.on(L.BUFFER_CODECS,_);const A=()=>{var N;const w=this.getAssetPlayer(g);if(this.log(`buffered to end of asset ${w}`),!w||!this.schedule)return;const G=this.schedule.findEventIndex(e.identifier),M=(N=this.schedule.items)==null?void 0:N[G];this.isInterstitial(M)&&this.advanceAssetBuffering(M,t)};b.on(L.BUFFERED_TO_END,A);const C=N=>()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;this.shouldPlay=!0;const G=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,G,N)};return b.once(L.MEDIA_ENDED,C(s)),b.once(L.PLAYOUT_LIMIT_REACHED,C(1/0)),b.on(L.ERROR,(N,w)=>{if(!this.schedule)return;const G=this.getAssetPlayer(g);if(w.details===ue.BUFFER_STALLED_ERROR){if(G!=null&&G.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(w,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${w.error} ${e}`)}),b.on(L.DESTROYING,()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;const w=new Error(`Asset player destroyed unexpectedly ${g}`),G={fatal:!0,type:Xe.OTHER_ERROR,details:ue.INTERSTITIAL_ASSET_ITEM_ERROR,error:w};this.handleAssetItemError(G,e,this.schedule.findEventIndex(e.identifier),s,w.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Wa(t)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:b}),b}clearInterstitial(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const r=this.playerQueue[s];this.log(`clear ${r} toSegment: ${t&&Kn(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(s,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,r,a){const{interstitial:l,assetItem:c,assetId:f}=e,d=l.assetList.length,h=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!h||h.identifier!==f)&&(h&&(this.clearAssetPlayer(h.identifier,s[r]),delete h.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${Wa(c)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:t,event:l,schedule:s.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,a)}bufferAssetPlayer(e,t){var s,r;if(!this.schedule)return;const{interstitial:a,assetItem:l}=e,c=this.schedule.findEventIndex(a.identifier),f=(s=this.schedule.items)==null?void 0:s[c];if(!f)return;e.loadSource(),this.setBufferingItem(f),this.bufferingAsset=l;const d=this.getBufferingPlayer();if(d===e)return;const h=a.appendInPlace;if(h&&d?.interstitial.appendInPlace===!1)return;const g=d?.tracks||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(h&&l!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(g&&!b1(g,e.tracks)){const y=new Error(`Asset ${Wa(l)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(g)}')`),v={fatal:!0,type:Xe.OTHER_ERROR,details:ue.INTERSTITIAL_ASSET_ITEM_ERROR,error:y},b=a.findAssetIndex(l);this.handleAssetItemError(v,a,c,b,y.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const r=s.currentTime,a=t.findAssetIndex(e,r),l=e.assetList[a];if(l){const c=this.getAssetPlayer(l.identifier);if(c){const f=c.currentTime||r-l.timelineStart,d=c.duration-f;if(this.warn(`Stalled at ${f} of ${f+d} in ${c} ${e} (media.currentTime: ${r})`),f&&(d/s.playbackRate<.5||c.bufferedInPlaceToEnd(s))&&c.hls){const h=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,h,a)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,r,a){if(e.details===ue.BUFFER_STALLED_ERROR)return;const l=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${l&&Wa(l)} ${e.error}`),!this.schedule)return;const c=l?.identifier||"",f=this.getAssetPlayerQueueIndex(c),d=this.playerQueue[f]||null,h=this.schedule.items,g=$t({},e,{fatal:!1,errorAction:io(!0),asset:l,assetListIndex:r,event:t,schedule:h,scheduleIndex:s,player:d});if(this.hls.trigger(L.INTERSTITIAL_ASSET_ERROR,g),!e.fatal)return;const y=this.playingAsset,v=this.bufferingAsset,b=new Error(a);if(l&&(this.clearAssetPlayer(c,null),l.error=b),!t.assetList.some(T=>!T.error))t.error=b;else for(let T=r;T<t.assetList.length;T++)this.resetAssetPlayer(t.assetList[T].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):y&&y.identifier===c?this.advanceAfterAssetEnded(t,s,r):v&&v.identifier===c&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,v)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${Kn(s)} error: ${e.error}`);let r=this.timelinePos;r===-1&&(r=this.hls.startPosition);const a=this.updateItem(s,r);if(this.itemsMatch(s,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const l=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(l)}else this.checkStart()}onAssetListLoaded(e,t){var s,r;const a=t.event,l=a.identifier,c=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(l)))return;const f=a.timelineStart,d=a.duration;let h=0;c.forEach((T,E)=>{const _=parseFloat(T.DURATION);this.createAsset(a,E,h,f+h,_,T.URI),h+=_}),a.duration=h,this.log(`Loaded asset-list with duration: ${h} (was: ${d}) ${a}`);const g=this.waitingItem,y=g?.event.identifier===l;this.updateSchedule();const v=(r=this.bufferingItem)==null?void 0:r.event;if(y){var b;const T=this.schedule.findEventIndex(l),E=(b=this.schedule.items)==null?void 0:b[T];if(E){if(!this.playingItem&&this.timelinePos>E.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==T){a.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${a}`),this.updateSchedule(!0),this.primaryFallback(a);return}this.setBufferingItem(E)}this.setSchedulePosition(T)}else if(v?.identifier===l){const T=a.assetList[0];if(T){const E=this.getAssetPlayer(T.identifier);if(v.appendInPlace){const _=this.primaryMedia;E&&_&&this.bufferAssetPlayer(E,_)}else E&&E.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case ue.ASSET_LIST_PARSING_ERROR:case ue.ASSET_LIST_LOAD_ERROR:case ue.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case ue.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const HS=500;class IM extends Tp{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",He.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=Ee.IDLE,this.setInterval(HS),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:r}=t;if(this.fragContextChanged(s)||(gs(s)&&(this.fragPrevious=s),this.state=Ee.IDLE),!r)return;const a=this.tracksBuffered[this.currentTrackId];if(!a)return;let l;const c=s.start;for(let d=0;d<a.length;d++)if(c>=a[d].start&&c<=a[d].end){l=a[d];break}const f=s.start+s.duration;l?l.end=f:(l={start:c,end:f},a.push(l)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:r}=t;if(s===0&&r!==Number.POSITIVE_INFINITY){const a=r-1;if(a<=0)return;t.endOffsetSubtitles=Math.max(0,a),this.tracksBuffered.forEach(l=>{for(let c=0;c<l.length;){if(l[c].end<=a){l.shift();continue}else if(l[c].start<a)l[c].start=a;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(s,a,He.SUBTITLE)}}onError(e,t){const s=t.frag;s?.type===He.SUBTITLE&&(t.details===ue.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Ee.STOPPED&&(this.state=Ee.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&TA(this.levels,t)){this.levels=t.map(s=>new Bl(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const r=new Bl(s);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,He.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==Ee.STOPPED&&this.setInterval(HS)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:r,levels:a}=this,{details:l,id:c}=t;if(!a){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const f=a[c];if(c>=a.length||!f)return;this.log(`Subtitle track ${c} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(l.live||(s=f.details)!=null&&s.live){if(l.deltaUpdateFailed)return;const g=this.mainDetails;if(!g){this.startFragRequested=!1;return}const y=g.fragments[0];if(!f.details)l.hasProgramDateTime&&g.hasProgramDateTime?(ld(l,g),d=l.fragmentStart):y&&(d=y.start,lg(l,d));else{var h;d=this.alignPlaylists(l,f.details,(h=this.levelLastLoaded)==null?void 0:h.details),d===0&&y&&(d=y.start,lg(l,d))}g&&!this.startFragRequested&&this.setStartPosition(g,d)}f.details=l,this.levelLastLoaded=f,c===r&&(this.hls.trigger(L.SUBTITLE_TRACK_UPDATED,{details:l,id:c,groupId:t.groupId}),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===Ee.IDLE&&(la(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),f.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,r=t.decryptdata,a=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&r!=null&&r.key&&r.iv&&ro(r.method)){const l=performance.now();this.decrypter.decrypt(new Uint8Array(s),r.key.buffer,r.iv.buffer,Sp(r.method)).catch(c=>{throw a.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const f=performance.now();a.trigger(L.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:l,tdecrypt:f}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=Ee.IDLE})}}doTick(){if(!this.media){this.state=Ee.IDLE;return}if(this.state===Ee.IDLE){const{currentTrackId:e,levels:t}=this,s=t?.[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:r}=this,a=this.getLoadPosition(),l=lt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a,r.maxBufferHole),{end:c,len:f}=l,d=s.details,h=this.hls.maxBufferLength+d.levelTargetDuration;if(f>h)return;const g=d.fragments,y=g.length,v=d.edge;let b=null;const T=this.fragPrevious;if(c<v){const A=r.maxFragLookUpTolerance,C=c>v-A?0:A;b=la(T,g,Math.max(g[0].start,c),C),!b&&T&&T.start<g[0].start&&(b=g[0])}else b=g[y-1];if(b=this.filterReplacedPrimary(b,s.details),!b)return;const E=b.sn-d.startSN,_=g[E-1];if(_&&_.cc===b.cc&&this.fragmentTracker.getState(_)===Es.NOT_LOADED&&(b=_),this.fragmentTracker.getState(b)===Es.NOT_LOADED){const A=this.mapToInitFragWhenRequired(b);A&&this.loadFragment(A,s,c)}}}loadFragment(e,t,s){gs(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new NM(this.tracksBuffered[this.currentTrackId]||[])}}class NM{constructor(e){this.buffered=void 0;const t=(s,r,a)=>{if(r=r>>>0,r>a-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${a})`);return e[r][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const kM={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},FA=n=>String.fromCharCode(kM[n]||n),Yn=15,ji=100,PM={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},OM={17:2,18:4,21:6,22:8,23:10,19:13,20:15},MM={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},jM={25:2,26:4,29:6,30:8,31:10,27:13,28:15},UM=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class FM{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;Mt.log(`${this.time} [${e}] ${s}`)}}}const Qr=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class BA{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const r=t[s];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class BM{constructor(){this.uchar=" ",this.penState=new BA}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class $M{constructor(e){this.chars=[],this.pos=0,this.currPenState=new BA,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<ji;t++)this.chars.push(new BM);this.logger=e}equals(e){for(let t=0;t<ji;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<ji;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<ji;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ji&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ji)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=FA(e);if(this.pos>=ji){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<ji;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<ji;s++){const r=this.chars[s].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class um{constructor(e){this.rows=[],this.currRow=Yn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Yn;t++)this.rows.push(new $M(e));this.logger=e}reset(){for(let e=0;e<Yn;e++)this.rows[e].clear();this.currRow=Yn-1}equals(e){let t=!0;for(let s=0;s<Yn;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Yn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Yn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Kt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<Yn;c++)this.rows[c].clear();const a=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){const c=l.rows[a].cueStartTime,f=this.logger.time;if(c!==null&&f!==null&&c<f)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(l.rows[a+d])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const a=e.indent,l=Math.max(a-1,0);s.setCursor(e.indent),e.color=s.chars[l].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Kt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",r=-1;for(let a=0;a<Yn;a++){const l=this.rows[a].getTextString();l&&(r=a+1,e?t.push("Row "+r+": '"+l+"'"):t.push(l.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class KS{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new um(s),this.nonDisplayedMemory=new um(s),this.lastOutputScreen=new um(s),this.currRollUpRow=this.displayedMemory.rows[Yn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Yn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[s]}this.logger.log(2,"MIDROW: "+Kt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class zS{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=GM(),this.logger=void 0;const r=this.logger=new FM;this.channels=[null,new KS(e,t,r),new KS(e+1,s,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const r=t[s]&127,a=t[s+1]&127;let l=!1,c=null;if(r===0&&a===0)continue;this.logger.log(3,()=>"["+Qr([t[s],t[s+1]])+"] -> ("+Qr([r,a])+")");const f=this.cmdHistory;if(r>=16&&r<=31){if(VM(r,a,f)){Au(null,null,f),this.logger.log(3,()=>"Repeated command ("+Qr([r,a])+") is dropped");continue}Au(r,a,this.cmdHistory),l=this.parseCmd(r,a),l||(l=this.parseMidrow(r,a)),l||(l=this.parsePAC(r,a)),l||(l=this.parseBackgroundAttributes(r,a))}else Au(null,null,f);if(!l&&(c=this.parseChars(r,a),c)){const h=this.currentChannel;h&&h>0?this.channels[h].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!l&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Qr([r,a])+" orig: "+Qr([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(s||r))return!1;const a=e===20||e===21||e===23?1:2,l=this.channels[a];return e===20||e===21||e===28||e===29?t===32?l.ccRCL():t===33?l.ccBS():t===34?l.ccAOF():t===35?l.ccAON():t===36?l.ccDER():t===37?l.ccRU(2):t===38?l.ccRU(3):t===39?l.ccRU(4):t===40?l.ccFON():t===41?l.ccRDC():t===42?l.ccTR():t===43?l.ccRTD():t===44?l.ccEDM():t===45?l.ccCR():t===46?l.ccENM():t===47&&l.ccEOC():l.ccTO(t-32),this.currentChannel=a,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[s];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Qr([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(e===16||e===24)&&t>=64&&t<=95;if(!(r||a))return!1;const l=e<=23?1:2;t>=64&&t<=95?s=l===1?PM[e]:MM[e]:s=l===1?OM[e]:jM[e];const c=this.channels[l];return c?(c.setPAC(this.interpretPAC(s,t)),this.currentChannel=l,!0):!1}interpretPAC(e,t){let s;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,r.underline=(s&1)===1,s<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((s-16)/2)*4,r}parseChars(e,t){let s,r=null,a=null;if(e>=25?(s=2,a=e-8):(s=1,a=e),a>=17&&a<=19){let l;a===17?l=t+80:a===18?l=t+112:l=t+144,this.logger.log(2,()=>"Special char '"+FA(l)+"' in channel "+s),r=[l]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+Qr(r).join(",")),r}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(s||r))return!1;let a;const l={};e===16||e===24?(a=Math.floor((t-32)/2),l.background=UM[a],t%2===1&&(l.background=l.background+"_semi")):t===45?l.background="transparent":(l.foreground="black",t===47&&(l.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(l),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Au(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function Au(n,e,t){t.a=n,t.b=e}function VM(n,e,t){return t.a===n&&t.b===e}function GM(){return{a:null,b:null}}var Op=(function(){if(od!=null&&od.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,f){if(typeof f!="string"||!Array.isArray(c))return!1;const d=f.toLowerCase();return~c.indexOf(d)?d:!1}function s(c){return t(n,c)}function r(c){return t(e,c)}function a(c,...f){let d=1;for(;d<arguments.length;d++){const h=arguments[d];for(const g in h)c[g]=h[g]}return c}function l(c,f,d){const h=this,g={enumerable:!0};h.hasBeenReset=!1;let y="",v=!1,b=c,T=f,E=d,_=null,A="",C=!0,N="auto",w="start",G=50,M="middle",B=50,K="middle";Object.defineProperty(h,"id",a({},g,{get:function(){return y},set:function(V){y=""+V}})),Object.defineProperty(h,"pauseOnExit",a({},g,{get:function(){return v},set:function(V){v=!!V}})),Object.defineProperty(h,"startTime",a({},g,{get:function(){return b},set:function(V){if(typeof V!="number")throw new TypeError("Start time must be set to a number.");b=V,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",a({},g,{get:function(){return T},set:function(V){if(typeof V!="number")throw new TypeError("End time must be set to a number.");T=V,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",a({},g,{get:function(){return E},set:function(V){E=""+V,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",a({},g,{get:function(){return _},set:function(V){_=V,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",a({},g,{get:function(){return A},set:function(V){const $=s(V);if($===!1)throw new SyntaxError("An invalid or illegal string was specified.");A=$,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",a({},g,{get:function(){return C},set:function(V){C=!!V,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",a({},g,{get:function(){return N},set:function(V){if(typeof V!="number"&&V!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");N=V,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",a({},g,{get:function(){return w},set:function(V){const $=r(V);if(!$)throw new SyntaxError("An invalid or illegal string was specified.");w=$,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",a({},g,{get:function(){return G},set:function(V){if(V<0||V>100)throw new Error("Position must be between 0 and 100.");G=V,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",a({},g,{get:function(){return M},set:function(V){const $=r(V);if(!$)throw new SyntaxError("An invalid or illegal string was specified.");M=$,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",a({},g,{get:function(){return B},set:function(V){if(V<0||V>100)throw new Error("Size must be between 0 and 100.");B=V,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",a({},g,{get:function(){return K},set:function(V){const $=r(V);if(!$)throw new SyntaxError("An invalid or illegal string was specified.");K=$,this.hasBeenReset=!0}})),h.displayState=void 0}return l.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},l})();class HM{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function $A(n){function e(s,r,a,l){return(s|0)*3600+(r|0)*60+(a|0)+parseFloat(l||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class KM{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let r=0;r<s.length;++r)if(t===s[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function VA(n,e,t,s){const r=s?n.split(s):[n];for(const a in r){if(typeof r[a]!="string")continue;const l=r[a].split(t);if(l.length!==2)continue;const c=l[0],f=l[1];e(c,f)}}const pg=new Op(0,0,""),_u=pg.align==="middle"?"middle":"center";function zM(n,e,t){const s=n;function r(){const c=$A(n);if(c===null)throw new Error("Malformed timestamp: "+s);return n=n.replace(/^[^\sa-zA-Z-]+/,""),c}function a(c,f){const d=new KM;VA(c,function(y,v){let b;switch(y){case"region":for(let T=t.length-1;T>=0;T--)if(t[T].id===v){d.set(y,t[T].region);break}break;case"vertical":d.alt(y,v,["rl","lr"]);break;case"line":b=v.split(","),d.integer(y,b[0]),d.percent(y,b[0])&&d.set("snapToLines",!1),d.alt(y,b[0],["auto"]),b.length===2&&d.alt("lineAlign",b[1],["start",_u,"end"]);break;case"position":b=v.split(","),d.percent(y,b[0]),b.length===2&&d.alt("positionAlign",b[1],["start",_u,"end","line-left","line-right","auto"]);break;case"size":d.percent(y,v);break;case"align":d.alt(y,v,["start",_u,"end","left","right"]);break}},/:/,/\s/),f.region=d.get("region",null),f.vertical=d.get("vertical","");let h=d.get("line","auto");h==="auto"&&pg.line===-1&&(h=-1),f.line=h,f.lineAlign=d.get("lineAlign","start"),f.snapToLines=d.get("snapToLines",!0),f.size=d.get("size",100),f.align=d.get("align",_u);let g=d.get("position","auto");g==="auto"&&pg.position===50&&(g=f.align==="start"||f.align==="left"?0:f.align==="end"||f.align==="right"?100:50),f.position=g}function l(){n=n.replace(/^\s+/,"")}if(l(),e.startTime=r(),l(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);n=n.slice(3),l(),e.endTime=r(),l(),a(n,e)}function GA(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class YM{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new HM,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let a=t.buffer,l=0;for(a=GA(a);l<a.length&&a[l]!=="\r"&&a[l]!==`
`;)++l;const c=a.slice(0,l);return a[l]==="\r"&&++l,a[l]===`
`&&++l,t.buffer=a.slice(l),c}function r(a){VA(a,function(l,c){},/:/)}try{let a="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;a=s();const c=a.match(/^()?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let l=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:a=s(),t.state){case"HEADER":/:/.test(a)?r(a):a||(t.state="ID");continue;case"NOTE":a||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){t.state="NOTE";break}if(!a)continue;if(t.cue=new Op(0,0,""),t.state="CUE",a.indexOf("-->")===-1){t.cue.id=a;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{zM(a,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=a.indexOf("-->")!==-1;if(!a||c&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=a}continue;case"BADCUE":a||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const qM=/\r\n|\n\r|\n|\r/g,dm=function(e,t,s=0){return e.slice(s,s+t.length)===t},XM=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),a=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Be(t)||!Be(s)||!Be(r)||!Be(a))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*r,t+=3600*1e3*a,t};function Mp(n,e,t){return Rl(n.toString())+Rl(e.toString())+Rl(t)}const WM=function(e,t,s){let r=e[t],a=e[r.prevCC];if(!a||!a.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(l=a)!=null&&l.new;){var l;e.ccOffset+=r.start-a.start,r.new=!1,r=a,a=e[r.prevCC]}e.presentationOffset=s};function QM(n,e,t,s,r,a,l){const c=new YM,f=pn(new Uint8Array(n)).trim().replace(qM,`
`).split(`
`),d=[],h=e?nO(e.baseTime,e.timescale):0;let g="00:00.000",y=0,v=0,b,T=!0;c.oncue=function(E){const _=t[s];let A=t.ccOffset;const C=(y-h)/9e4;if(_!=null&&_.new&&(v!==void 0?A=t.ccOffset=_.start:WM(t,s,C)),C){if(!e){b=new Error("Missing initPTS for VTT MPEGTS");return}A=C-t.presentationOffset}const N=E.endTime-E.startTime,w=mn((E.startTime+A-v)*9e4,r*9e4)/9e4;E.startTime=Math.max(w,0),E.endTime=Math.max(w+N,0);const G=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(G)),E.id||(E.id=Mp(E.startTime,E.endTime,G)),E.endTime>0&&d.push(E)},c.onparsingerror=function(E){b=E},c.onflush=function(){if(b){l(b);return}a(d)},f.forEach(E=>{if(T)if(dm(E,"X-TIMESTAMP-MAP=")){T=!1,E.slice(16).split(",").forEach(_=>{dm(_,"LOCAL:")?g=_.slice(6):dm(_,"MPEGTS:")&&(y=parseInt(_.slice(7)))});try{v=XM(g)/1e3}catch(_){b=_}return}else E===""&&(T=!1);c.parse(E+`
`)}),c.flush()}const fm="stpp.ttml.im1t",HA=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,KA=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,ZM={left:"start",center:"center",right:"end",start:"start",end:"end"};function YS(n,e,t,s){const r=ft(new Uint8Array(n),["mdat"]);if(r.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const a=r.map(c=>pn(c)),l=sO(e.baseTime,1,e.timescale);try{a.forEach(c=>t(JM(c,l)))}catch(c){s(c)}}function JM(n,e){const r=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},l=Object.keys(a).reduce((g,y)=>(g[y]=r.getAttribute(`ttp:${y}`)||a[y],g),{}),c=r.getAttribute("xml:space")!=="preserve",f=qS(hm(r,"styling","style")),d=qS(hm(r,"layout","region")),h=hm(r,"body","[begin]");return[].map.call(h,g=>{const y=zA(g,c);if(!y||!g.hasAttribute("begin"))return null;const v=gm(g.getAttribute("begin"),l),b=gm(g.getAttribute("dur"),l);let T=gm(g.getAttribute("end"),l);if(v===null)throw XS(g);if(T===null){if(b===null)throw XS(g);T=v+b}const E=new Op(v-e,T-e,y);E.id=Mp(E.startTime,E.endTime,E.text);const _=d[g.getAttribute("region")],A=f[g.getAttribute("style")],C=e3(_,A,f),{textAlign:N}=C;if(N){const w=ZM[N];w&&(E.lineAlign=w),E.align=N}return $t(E,C),E}).filter(g=>g!==null)}function hm(n,e,t){const s=n.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function qS(n){return n.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function zA(n,e){return[].slice.call(n.childNodes).reduce((t,s,r)=>{var a;return s.nodeName==="br"&&r?t+`
`:(a=s.childNodes)!=null&&a.length?zA(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function e3(n,e,t){const s="http://www.w3.org/ns/ttml#styling";let r=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],l=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return l&&t.hasOwnProperty(l)&&(r=t[l]),a.reduce((c,f)=>{const d=mm(e,s,f)||mm(n,s,f)||mm(r,s,f);return d&&(c[f]=d),c},{})}function mm(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function XS(n){return new Error(`Could not parse ttml timestamp ${n}`)}function gm(n,e){if(!n)return null;let t=$A(n);return t===null&&(HA.test(n)?t=t3(n,e):KA.test(n)&&(t=s3(n,e))),t}function t3(n,e){const t=HA.exec(n),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function s3(n,e){const t=KA.exec(n),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class Cu{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class n3{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=QS(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Cu(this,"textTrack1"),t=new Cu(this,"textTrack2"),s=new Cu(this,"textTrack3"),r=new Cu(this,"textTrack4");this.cea608Parser1=new zS(1,e,t),this.cea608Parser2=new zS(3,s,r)}addCues(e,t,s,r,a){let l=!1;for(let c=a.length;c--;){const f=a[c],d=i3(f[0],f[1],t,s);if(d>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],s),l=!0,d/(s-t)>.5))return}if(l||a.push([t,s]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,s,r)}else{const c=this.Cues.newCue(null,t,s,r);this.hls.trigger(L.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:r,timescale:a,trackId:l}){const{unparsedVttFrags:c}=this;s===He.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:a,trackId:l}),c.length&&(this.unparsedVttFrags=[],c.forEach(f=>{this.initPTS[f.frag.cc]?this.onFragLoaded(L.FRAG_LOADED,f):this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:f.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let r=0;r<s.textTracks.length;r++){const a=s.textTracks[r];if(WS(a,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return a}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:r}=this,{label:a,languageCode:l}=t[e],c=this.getExistingTrack(a,l);if(c)s[e]=c,so(s[e]),MA(s[e],r);else{const f=this.createTextTrack("captions",a,l);f&&(f[e]=!0,s[e]=f)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,r={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,s){const r=this.media;if(r)return r.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:r}=this;Object.keys(r).forEach(a=>{so(r[a]),delete r[a]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=QS(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)so(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],r=s.some(a=>a.textCodec===fm);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(TA(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const l=this.media,c=l?Gu(l.textTracks):null;if(this.tracks.forEach((f,d)=>{let h;if(c){let g=null;for(let y=0;y<c.length;y++)if(c[y]&&WS(c[y],f)){g=c[y],c[y]=null;break}g&&(h=g)}if(h)so(h);else{const g=YA(f);h=this.createTextTrack(g,f.name,f.lang),h&&(h.mode="disabled")}h&&this.textTracks.push(h)}),c!=null&&c.length){const f=c.filter(d=>d!==null).map(d=>d.label);f.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${f.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const l=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const r=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!r)return;const a=`textTrack${r[1]}`,l=this.captionsProperties[a];l&&(l.label=s.name,s.lang&&(l.languageCode=s.lang),l.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===He.MAIN){var s,r;const{cea608Parser1:a,cea608Parser2:l,lastSn:c}=this,{cc:f,sn:d}=t.frag,h=(s=(r=t.part)==null?void 0:r.index)!=null?s:-1;a&&l&&(d!==c+1||d===c&&h!==this.lastPartIndex+1||f!==this.lastCc)&&(a.reset(),l.reset()),this.lastCc=f,this.lastSn=d,this.lastPartIndex=h}}onFragLoaded(e,t){const{frag:s,payload:r}=t;if(s.type===He.SUBTITLE)if(r.byteLength){const a=s.decryptdata,l="stats"in t;if(a==null||!a.encrypted||l){const c=this.tracks[s.level],f=this.vttCCs;f[s.cc]||(f[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),c&&c.textCodec===fm?this._parseIMSC1(s,r):this._parseVTTs(t)}}else this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;YS(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),s.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{s.logger.log(`Failed to parse IMSC1: ${r}`),s.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:s,payload:r}=e,{initPTS:a,unparsedVttFrags:l}=this,c=a.length-1;if(!a[s.cc]&&c===-1){l.push(e);return}const f=this.hls,d=(t=s.initSegment)!=null&&t.data?Nn(s.initSegment.data,new Uint8Array(r)).buffer:r;QM(d,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,h=>{this._appendCues(h,s.level),f.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},h=>{const g=h.message==="Missing initPTS for VTT MPEGTS";g?l.push(e):this._fallbackToIMSC1(s,r),f.logger.log(`Failed to parse VTT cue: ${h}`),!(g&&c>s.cc)&&f.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:h})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||YS(t,this.initPTS[e.cc],()=>{s.textCodec=fm,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(a=>jA(r,a))}else{const r=this.tracks[t];if(!r)return;const a=r.default?"default":"subtitles"+t;s.trigger(L.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===He.SUBTITLE&&this.onFragLoaded(L.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:r}=t;if(!(s.type===He.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let a=0;a<r.length;a++){const l=r[a].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(l);this.cea608Parser1.addData(r[a].pts,c[0]),this.cea608Parser2.addData(r[a].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:r,type:a}){const{media:l}=this;if(!(!l||l.currentTime<s)){if(!a||a==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(f=>gg(c[f],t,s))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(f=>gg(c[f],t,r))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let r=2;for(let a=0;a<s;a++){const l=e[r++],c=127&e[r++],f=127&e[r++];if(c===0&&f===0)continue;if((4&l)!==0){const h=3&l;(h===0||h===1)&&(t[h].push(c),t[h].push(f))}}return t}}function YA(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function WS(n,e){return!!n&&n.kind===YA(e)&&dg(e,n)}function i3(n,e,t,s){return Math.min(e,s)-Math.max(n,t)}function QS(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const r3=/\s/,a3={newCue(n,e,t,s){const r=[];let a,l,c,f,d;const h=self.VTTCue||self.TextTrackCue;for(let y=0;y<s.rows.length;y++)if(a=s.rows[y],c=!0,f=0,d="",!a.isEmpty()){var g;for(let T=0;T<a.chars.length;T++)r3.test(a.chars[T].uchar)&&c?f++:(d+=a.chars[T].uchar,c=!1);a.cueStartTime=e,e===t&&(t+=1e-4),f>=16?f--:f++;const v=GA(d.trim()),b=Mp(e,t,v);n!=null&&(g=n.cues)!=null&&g.getCueById(b)||(l=new h(e,t,v),l.id=b,l.line=y+1,l.align="left",l.position=10+Math.min(80,Math.floor(f*8/32)*10),r.push(l))}return n&&r.length&&(r.sort((y,v)=>y.line==="auto"||v.line==="auto"?0:y.line>8&&v.line>8?v.line-y.line:y.line-v.line),r.forEach(y=>jA(n,y))),r}};function o3(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const l3=/(\d+)-(\d+)\/(\d+)/;class ZS{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||f3,this.controller=new self.AbortController,this.stats=new mp}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const a=c3(e,this.controller.signal),l=e.responseType==="arraybuffer",c=l?"byteLength":"length",{maxTimeToFirstByteMs:f,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=f&&Be(f)?f:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(Gl(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(g=>{var y;this.response=this.loader=g;const v=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},d-(v-r.loading.start)),!g.ok){const{status:T,statusText:E}=g;throw new h3(E||"fetch, bad network response",T,g)}r.loading.first=v,r.total=d3(g.headers)||r.total;const b=(y=this.callbacks)==null?void 0:y.onProgress;return b&&Be(t.highWaterMark)?this.loadProgressively(g,r,e,t.highWaterMark,b):l?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(g=>{var y,v;const b=this.response;if(!b)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const T=g[c];T&&(r.loaded=r.total=T);const E={url:b.url,data:g,code:b.status},_=(y=this.callbacks)==null?void 0:y.onProgress;_&&!Be(t.highWaterMark)&&_(r,e,g,b),(v=this.callbacks)==null||v.onSuccess(E,r,e,b)}).catch(g=>{var y;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const v=g&&g.code||0,b=g?g.message:null;(y=this.callbacks)==null||y.onError({code:v,text:b},e,g?g.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,r=0,a){const l=new nA,c=e.body.getReader(),f=()=>c.read().then(d=>{if(d.done)return l.dataLength&&a(t,s,l.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const h=d.value,g=h.length;return t.loaded+=g,g<r||l.dataLength?(l.push(h),l.dataLength>=r&&a(t,s,l.flush().buffer,e)):a(t,s,h.buffer,e),f()}).catch(()=>Promise.reject());return f()}}function c3(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers($t({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function u3(n){const e=l3.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function d3(n){const e=n.get("Content-Range");if(e){const s=u3(e);if(Be(s))return s}const t=n.get("Content-Length");if(t)return parseInt(t)}function f3(n,e){return new self.Request(n.url,e)}class h3 extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const m3=/^age:\s*[\d.]+\s*$/im;class qA{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new mp,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const a=this.xhrSetup;a?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return a(s,t.url)}).catch(l=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),a(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(l=>{var c;(c=this.callbacks)==null||c.onError({code:s.status,text:l.message},t,s,r)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:l}=s.loadPolicy;if(r)for(const c in r)e.setRequestHeader(c,r[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=a&&Be(a)?a:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const r=t.readyState,a=this.config;if(!s.aborted&&r>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,h=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const b=h??t.response;if(b!=null){var l,c;s.loading.end=Math.max(self.performance.now(),s.loading.first);const T=t.responseType==="arraybuffer"?b.byteLength:b.length;s.loaded=s.total=T,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const E=(l=this.callbacks)==null?void 0:l.onProgress;E&&E(s,e,b,t);const _={url:t.responseURL,data:b,code:d};(c=this.callbacks)==null||c.onSuccess(_,s,e,t);return}}const g=a.loadPolicy.errorRetry,y=s.retry,v={url:e.url,data:void 0,code:d};if(rd(g,y,!1,v))this.retry(g);else{var f;Mt.error(`${d} while loading ${e.url}`),(f=this.callbacks)==null||f.onError({code:d,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(rd(e,t,!0))this.retry(e);else{var s;Mt.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=xp(e,s.retry),s.retry++,Mt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&m3.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const g3={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},p3=Pt(Pt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:qA,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:wk,bufferController:xO,capLevelController:Np,errorController:kk,fpsController:vM,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:z1,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:g3},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},y3()),{},{subtitleStreamController:IM,subtitleTrackController:EM,timelineController:n3,audioStreamController:mO,audioTrackController:gO,emeController:ao,cmcdController:gM,contentSteeringController:yM,interstitialsController:DM});function y3(){return{cueHandler:a3,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function x3(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=yg(n),r=["manifest","level","frag"],a=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(l=>{const c=`${l==="level"?"playlist":l}LoadPolicy`,f=e[c]===void 0,d=[];a.forEach(h=>{const g=`${l}Loading${h}`,y=e[g];if(y!==void 0&&f){d.push(g);const v=s[c].default;switch(e[c]={default:v},h){case"TimeOut":v.maxLoadTimeMs=y,v.maxTimeToFirstByteMs=y;break;case"MaxRetry":v.errorRetry.maxNumRetry=y,v.timeoutRetry.maxNumRetry=y;break;case"RetryDelay":v.errorRetry.retryDelayMs=y,v.timeoutRetry.retryDelayMs=y;break;case"MaxRetryTimeout":v.errorRetry.maxRetryDelayMs=y,v.timeoutRetry.maxRetryDelayMs=y;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${c}": ${Kt(e[c])}`)}),Pt(Pt({},s),e)}function yg(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(yg):Object.keys(n).reduce((e,t)=>(e[t]=yg(n[t]),e),{}):n}function v3(n,e){const t=n.loader;t!==ZS&&t!==qA?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):o3()&&(n.loader=ZS,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Hu=2,b3=.1,S3=.05,E3=100;class T3 extends $1{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(E3),this.mediaSource=t.mediaSource;const s=this.media=t.media;Ks(s,"playing",this.onMediaPlaying),Ks(s,"waiting",this.onMediaWaiting),Ks(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(nn(s,"playing",this.onMediaPlaying),nn(s,"waiting",this.onMediaWaiting),nn(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,r;const a=(s=this.hls)==null?void 0:s.config;if(!a)return;const l=this.media;if(!l)return;const{seeking:c}=l,f=this.seeking&&!c,d=!this.seeking&&c,h=l.paused&&!c||l.ended||l.playbackRate===0;if(this.seeking=c,e!==t){t&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,a.nudgeOnVideoHole&&!h&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||f){f&&this.stallResolved(e);return}if(h){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&l.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1}));return}if(!lt.getBuffered(l).length){this.nudgeRetry=0;return}const g=lt.bufferInfo(l,e,0),y=g.nextStart||0,v=this.fragmentTracker;if(c&&v&&this.hls){const G=JS(this.hls.inFlightFragments,e),M=g.len>Hu,B=!y||G||y-e>Hu&&!v.getPartialFragment(e);if(M||B)return;this.moved=!1}const b=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&v){if(!(g.len>0)&&!y)return;const M=Math.max(y,g.start||0)-e,K=!!(b!=null&&b.live)?b.targetduration*2:Hu,V=Lu(e,v);if(M>0&&(M<=K||V)){l.paused||this._trySkipBufferHole(V);return}}const T=a.detectStallWithCurrentTimeMs,E=self.performance.now(),_=this.waiting;let A=this.stalled;if(A===null)if(_>0&&E-_<T)A=this.stalled=_;else{this.stalled=E;return}const C=E-A;if(!c&&(C>=T||_)&&this.hls){var N;if(((N=this.mediaSource)==null?void 0:N.readyState)==="ended"&&!(b!=null&&b.live)&&Math.abs(e-(b?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(g),!this.media||!this.hls)return}const w=lt.bufferInfo(l,e,a.maxBufferHole);this._tryFixBufferStall(w,C,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(L.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&r&&r.length>1&&e>r.end(0)){const a=lt.bufferedInfo(lt.timeRangesToArray(this.buffered.audio),e,0);if(a.len>1&&t>=a.start){const l=lt.timeRangesToArray(r),c=lt.bufferedInfo(l,t,0).bufferedIndex;if(c>-1&&c<l.length-1){const f=lt.bufferedInfo(l,e,0).bufferedIndex,d=l[c].end,h=l[c+1].start;if((f===-1||f>c)&&h-d<1&&e-d<2){const g=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${h} buffered index: ${f}`);this.warn(g.message),this.media.currentTime+=1e-6;let y=Lu(e,this.fragmentTracker);y&&"fragment"in y?y=y.fragment:y||(y=void 0);const v=lt.bufferInfo(this.media,e,0);this.hls.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:y,buffer:v.len,bufferInfo:v})}}}}}_tryFixBufferStall(e,t,s){var r,a;const{fragmentTracker:l,media:c}=this,f=(r=this.hls)==null?void 0:r.config;if(!c||!l||!f)return;const d=(a=this.hls)==null?void 0:a.latestLevelDetails,h=Lu(s,l);if((h||d!=null&&d.live&&s<d.fragmentStart)&&(this._trySkipBufferHole(h)||!this.media))return;const g=e.buffered,y=this.adjacentTraversal(e,s);(g&&g.length>1&&e.len>f.maxBufferHole||e.nextStart&&(e.nextStart-s<f.maxBufferHole||y))&&(t>f.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,r=e.nextStart;if(s&&r){const a=s.getFragAtPos(t,He.MAIN),l=s.getFragAtPos(r,He.MAIN);if(a&&l)return l.sn-a.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:r,stalled:a}=this;if(!r&&a!==null&&s&&t){this.stallReported=!0;const l=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Kt(e)})`);this.warn(l.message),t.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.BUFFER_STALLED_ERROR,fatal:!1,error:l,buffer:e.len,bufferInfo:e,stalled:{start:a}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:r}=this,a=(t=this.hls)==null?void 0:t.config;if(!r||!s||!a)return 0;const l=r.currentTime,c=lt.bufferInfo(r,l,0),f=l<c.start?c.start:c.nextStart;if(f&&this.hls){const h=c.len<=a.maxBufferHole,g=c.len>0&&c.len<1&&r.readyState<3,y=f-l;if(y>0&&(h||g)){if(y>a.maxBufferHole){let b=!1;if(l===0){const T=s.getAppendedFrag(0,He.MAIN);T&&f<T.end&&(b=!0)}if(!b&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||JS(this.hls.inFlightFragments,f))return 0;let E=!1,_=e.end;for(;_<f;){const A=Lu(_,s);if(A)_+=A.duration;else{E=!0;break}}if(E)return 0}}const v=Math.max(f+S3,l+b3);if(this.warn(`skipping hole, adjusting currentTime from ${l} to ${v}`),this.moved=!0,r.currentTime=v,!(e!=null&&e.gap)){const b=new Error(`fragment loaded with buffer holes, seeking from ${l} to ${v}`),T={type:Xe.MEDIA_ERROR,details:ue.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:b,reason:b.message,buffer:c.len,bufferInfo:c};e&&("fragment"in e?T.part=e:T.frag=e),this.hls.trigger(L.ERROR,T)}return v}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:r}=this,a=t?.config;if(!s||!a)return 0;const l=s.currentTime;if(this.nudgeRetry++,r<a.nudgeMaxRetry){const c=l+(r+1)*a.nudgeOffset,f=new Error(`Nudging 'currentTime' from ${l} to ${c}`);this.warn(f.message),s.currentTime=c,t.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.BUFFER_NUDGE_ON_STALL,error:f,fatal:!1,buffer:e.len,bufferInfo:e})}else{const c=new Error(`Playhead still not moving while enough data buffered @${l} after ${a.nudgeMaxRetry} nudges`);this.error(c.message),t.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:e.len,bufferInfo:e})}}}function JS(n,e){const t=eE(n.main);if(t&&t.start<=e)return t;const s=eE(n.audio);return s&&s.start<=e?s:null}function eE(n){if(!n)return null;switch(n.state){case Ee.IDLE:case Ee.STOPPED:case Ee.ENDED:case Ee.ERROR:return null}return n.frag}function Lu(n,e){return e.getAppendedFrag(n,He.MAIN)||e.getPartialFragment(n)}const A3=.25;function xg(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function pm(n,e,t,s,r){let a=new n(e,t,"");try{a.value=s,r&&(a.type=r)}catch{a=new n(e,t,Kt(r?Pt({type:r},s):s))}return a}const wu=(()=>{const n=xg();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class _3{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(L.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&so(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return MA(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:r}=this.hls.config;if(!s&&!r)return;const{samples:a}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=xg();if(l)for(let c=0;c<a.length;c++){const f=a[c].type;if(f===gn.emsg&&!s||!r)continue;const d=uA(a[c].data),h=a[c].pts;let g=h+a[c].duration;g>wu&&(g=wu),g-h<=0&&(g=h+A3);for(let v=0;v<d.length;v++){const b=d[v];if(!dA(b)){this.updateId3CueEnds(h,f);const T=pm(l,h,g,b,f);T&&this.id3Track.addCue(T)}}}}updateId3CueEnds(e,t){var s;const r=(s=this.id3Track)==null?void 0:s.cues;if(r)for(let a=r.length;a--;){const l=r[a];l.type===t&&l.startTime<e&&l.endTime===wu&&(l.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:r}){const{id3Track:a,hls:l}=this;if(!l)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:f}}=l;if(a&&(c||f)){let d;r==="audio"?d=h=>h.type===gn.audioId3&&f:r==="video"?d=h=>h.type===gn.emsg&&c:d=h=>h.type===gn.audioId3&&f||h.type===gn.emsg&&c,gg(a,t,s,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:r,enableDateRangeMetadataCues:a,interstitialsController:l}=this.hls.config;if(!a)return;const c=xg();if(s&&r&&!l){const{fragmentStart:T,fragmentEnd:E}=e;let _=this.assetCue;_?(_.startTime=T,_.endTime=E):c&&(_=this.assetCue=pm(c,T,E,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),_&&(_.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(_),_.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:f}=this,{dateRanges:d}=e,h=Object.keys(d);let g=this.dateRangeCuesAppended;if(f&&t){var y;if((y=f.cues)!=null&&y.length){const T=Object.keys(g).filter(E=>!h.includes(E));for(let E=T.length;E--;){var v;const _=T[E],A=(v=g[_])==null?void 0:v.cues;delete g[_],A&&Object.keys(A).forEach(C=>{const N=A[C];if(N){N.removeEventListener("enter",this.onEventCueEnter);try{f.removeCue(N)}catch{}}})}}else g=this.dateRangeCuesAppended={}}const b=e.fragments[e.fragments.length-1];if(!(h.length===0||!Be(b?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let T=0;T<h.length;T++){const E=h[T],_=d[E],A=_.startTime,C=g[E],N=C?.cues||{};let w=C?.durationKnown||!1,G=wu;const{duration:M,endDate:B}=_;if(B&&M!==null)G=A+M,w=!0;else if(_.endOnNext&&!w){const V=h.reduce(($,ee)=>{if(ee!==_.id){const he=d[ee];if(he.class===_.class&&he.startDate>_.startDate&&(!$||_.startDate<$.startDate))return he}return $},null);V&&(G=V.startTime,w=!0)}const K=Object.keys(_.attr);for(let V=0;V<K.length;V++){const $=K[V];if(!zk($))continue;const ee=N[$];if(ee)w&&!(C!=null&&C.durationKnown)?ee.endTime=G:Math.abs(ee.startTime-A)>.01&&(ee.startTime=A,ee.endTime=G);else if(c){let he=_.attr[$];Yk($)&&(he=S1(he));const H=pm(c,A,G,{key:$,data:he},gn.dateRange);H&&(H.id=E,this.id3Track.addCue(H),N[$]=H,l&&($==="X-ASSET-LIST"||$==="X-ASSET-URL")&&H.addEventListener("enter",this.onEventCueEnter))}}g[E]={cues:N,dateRange:_,durationKnown:w}}}}}class C3{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:a,maxLiveSyncPlaybackRate:l}=this.config;if(!a||l===1||!s.live)return;const c=this.targetLatency;if(c===null)return;const f=r-c,d=Math.min(this.maxLatency,c+s.targetduration);if(f<d&&f>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,l)),y=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20,v=Math.min(g,Math.max(1,y));this.changeMediaPlaybackRate(t,v)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:r}=e,{liveSyncDuration:a,liveSyncDurationCount:l,lowLatencyMode:c}=this.config,f=this.hls.userConfig;let d=c&&s||t;(this._targetLatencyUpdated||f.liveSyncDuration||f.liveSyncDurationCount||d===0)&&(d=a!==void 0?a:l*r);const h=r;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,h)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const r=s.edge,a=e-t-this.edgeStalled,l=r-s.totalduration,c=r-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(l,a),c)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===ue.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,r;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class L3 extends Ip{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,r=[],a={},l={};let c=!1,f=!1,d=!1;t.levels.forEach(h=>{const g=h.attrs;let{audioCodec:y,videoCodec:v}=h;y&&(h.audioCodec=y=td(y,s)||void 0),v&&(v=h.videoCodec=ck(v));const{width:b,height:T,unknownCodecs:E}=h,_=E?.length||0;if(c||(c=!!(b&&T)),f||(f=!!v),d||(d=!!y),_||y&&!this.isAudioSupported(y)||v&&!this.isVideoSupported(v)){this.log(`Some or all CODECS not supported "${g.CODECS}"`);return}const{CODECS:A,"FRAME-RATE":C,"HDCP-LEVEL":N,"PATHWAY-ID":w,RESOLUTION:G,"VIDEO-RANGE":M}=g,K=`${`${w||"."}-`}${h.bitrate}-${G}-${C}-${A}-${M}-${N}`;if(a[K])if(a[K].uri!==h.url&&!h.attrs["PATHWAY-ID"]){const V=l[K]+=1;h.attrs["PATHWAY-ID"]=new Array(V+1).join(".");const $=this.createLevel(h);a[K]=$,r.push($)}else a[K].addGroupId("audio",g.AUDIO),a[K].addGroupId("text",g.SUBTITLES);else{const V=this.createLevel(h);a[K]=V,l[K]=1,r.push(V)}}),this.filterAndSortMediaOptions(r,t,c,f,d)}createLevel(e){const t=new Bl(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(r.message),t.supportedResult=k1(r,[])}return t}isAudioSupported(e){return Ul(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Ul(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,r,a){var l;let c=[],f=[],d=e;const h=((l=t.stats)==null?void 0:l.parsing)||{};if((s||r)&&a&&(d=d.filter(({videoCodec:A,videoRange:C,width:N,height:w})=>(!!A||!!(N&&w))&&vk(C))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let A="no level with compatible codecs found in manifest",C=A;t.levels.length&&(C=`one or more CODECS in variant not supported: ${Kt(t.levels.map(w=>w.attrs.CODECS).filter((w,G,M)=>M.indexOf(w)===G))}`,this.warn(C),A+=` (${C})`);const N=new Error(A);this.hls.trigger(L.ERROR,{type:Xe.MEDIA_ERROR,details:ue.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:N,reason:C})}}),h.end=performance.now();return}t.audioTracks&&(c=t.audioTracks.filter(A=>!A.audioCodec||this.isAudioSupported(A.audioCodec)),tE(c)),t.subtitles&&(f=t.subtitles,tE(f));const g=d.slice(0);d.sort((A,C)=>{if(A.attrs["HDCP-LEVEL"]!==C.attrs["HDCP-LEVEL"])return(A.attrs["HDCP-LEVEL"]||"")>(C.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&A.height!==C.height)return A.height-C.height;if(A.frameRate!==C.frameRate)return A.frameRate-C.frameRate;if(A.videoRange!==C.videoRange)return sd.indexOf(A.videoRange)-sd.indexOf(C.videoRange);if(A.videoCodec!==C.videoCodec){const N=zb(A.videoCodec),w=zb(C.videoCodec);if(N!==w)return w-N}if(A.uri===C.uri&&A.codecSet!==C.codecSet){const N=ed(A.codecSet),w=ed(C.codecSet);if(N!==w)return w-N}return A.averageBitrate!==C.averageBitrate?A.averageBitrate-C.averageBitrate:0});let y=g[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==g.length)){for(let A=0;A<g.length;A++)if(g[A].pathwayId===d[0].pathwayId){y=g[A];break}}this._levels=d;for(let A=0;A<d.length;A++)if(d[A]===y){var v;this._firstLevel=A;const C=y.bitrate,N=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${C}`),((v=this.hls.userConfig)==null?void 0:v.abrEwmaDefaultEstimate)===void 0){const w=Math.min(C,this.hls.config.abrEwmaDefaultEstimateMax);w>N&&N===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=w)}break}const b=a&&!r,T=this.hls.config,E=!!(T.audioStreamController&&T.audioTrackController),_={levels:d,audioTracks:c,subtitleTracks:f,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:r,altAudio:E&&!b&&c.some(A=>!!A.url)};h.end=performance.now(),this.hls.trigger(L.MANIFEST_PARSED,_)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const h=new Error("invalid level idx"),g=e<0;if(this.hls.trigger(L.ERROR,{type:Xe.OTHER_ERROR,details:ue.LEVEL_SWITCH_ERROR,level:e,fatal:g,error:h,reason:h.message}),g)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,r=this.currentLevel,a=r?r.attrs["PATHWAY-ID"]:void 0,l=t[e],c=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=l,s===e&&r&&a===c)return;this.log(`Switching to level ${e} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${c?" with Pathway "+c:""} from level ${s}${a?" with Pathway "+a:""}`);const f={level:e,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(L.LEVEL_SWITCHING,f);const d=l.details;if(!d||d.live){const h=this.switchParams(l.uri,r?.details,d);this.loadPlaylist(h)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===pt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===He.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(a=>!!s[a]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var s;const{level:r,details:a}=t,l=t.levelInfo;if(!l){var c;this.warn(`Invalid level index ${r}`),(c=t.deliveryDirectives)!=null&&c.skip&&(a.deltaUpdateFailed=!0);return}if(l===this.currentLevel||t.withoutMultiVariant){l.fragmentError===0&&(l.loadError=0);let f=l.details;f===t.details&&f.advanced&&(f=void 0),this.playlistLoaded(r,t,f)}else(s=t.deliveryDirectives)!=null&&s.skip&&(a.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,a=e.attrs["PATHWAY-ID"],l=e.details,c=l?.age;this.log(`Loading level index ${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${a?" Pathway "+a:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${s}`),this.hls.trigger(L.LEVEL_LOADING,{url:s,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((a,l)=>l!==e?!0:(this.steering&&this.steering.removeLevel(a),a===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,a.details&&a.details.fragments.forEach(c=>c.level=-1)),!1));eA(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=s.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(L.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(L.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function tE(n){const e={};n.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function XA(){return self.SourceBuffer||self.WebKitSourceBuffer}function WA(){if(!_r())return!1;const e=XA();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function w3(){if(!WA())return!1;const n=_r();return typeof n?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Fl(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Fl(e,"audio"))))}function R3(){var n;const e=XA();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const D3=100;class I3 extends Tp{constructor(e,t,s){super(e,t,s,"stream-controller",He.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,a=r?r.currentTime:null;if(a===null||!Be(a)||(this.log(`Media seeked to ${a.toFixed(3)}`),!this.getBufferedFrag(a)))return;const l=this.getFwdBufferInfoAtPos(r,a,He.MAIN,0);if(l===null||l.len===0){this.warn(`Main forward buffer length at ${a} on "seeked" event ${l?l.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:r}=this;if(this.stopLoad(),this.setInterval(D3),this.level=-1,!this.startFragRequested){let a=r.startLevel;a===-1&&(r.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=r.firstAutoLevel),r.nextLoadLevel=a,this.level=r.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=Ee.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Ee.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Ee.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e?.[t],r=s?.details;if(r&&(!r.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(r))break;this.state=Ee.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Ee.IDLE;break}break}case Ee.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===Ee.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const a=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[a]))return;const l=s[a],c=this.getMainFwdBufferInfo();if(c===null)return;const f=this.getLevelDetails();if(f&&this._streamEnded(c,f)){const T={};this.altAudio===2&&(T.type="video"),this.hls.trigger(L.BUFFER_EOS,T),this.state=Ee.ENDED;return}if(!this.buffering)return;e.loadLevel!==a&&e.manualLevel===-1&&this.log(`Adapting to level ${a} from level ${this.level}`),this.level=e.nextLoadLevel=a;const d=l.details;if(!d||this.state===Ee.WAITING_LEVEL||this.waitForLive(l)){this.level=a,this.state=Ee.WAITING_LEVEL,this.startFragRequested=!1;return}const h=c.len,g=this.getMaxBufferLength(l.maxBitrate);if(h>=g)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const y=this.backtrackFragment?this.backtrackFragment.start:c.end;let v=this.getNextFragment(y,d);if(this.couldBacktrack&&!this.fragPrevious&&v&&gs(v)&&this.fragmentTracker.getState(v)!==Es.OK){var b;const E=((b=this.backtrackFragment)!=null?b:v).sn-d.startSN,_=d.fragments[E-1];_&&v.cc===_.cc&&(v=_,this.fragmentTracker.removeFragment(_))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,y)){if(!v.gap){const E=this.audioOnly&&!this.altAudio?Ht.AUDIO:Ht.VIDEO,_=(E===Ht.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;_&&this.afterBufferFlushed(_,E,He.MAIN)}v=this.getNextFragmentLoopLoading(v,d,c,He.MAIN,g)}v&&(v.initSegment&&!v.initSegment.data&&!this.bitrateTest&&(v=v.initSegment),this.loadFragment(v,l,y))}loadFragment(e,t,s){const r=this.fragmentTracker.getState(e);r===Es.NOT_LOADED||r===Es.PARTIAL?gs(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,He.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const a=this.getLevelDetails();if(a!=null&&a.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<a.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,f=e[c],d=this.fragLastKbps;d&&this.fragCurrent?s=this.fragCurrent.duration*f.maxBitrate/(1e3*d)+1:s=0}else s=0;const l=this.getBufferedFrag(t.currentTime+s);if(l){const c=this.followingBufferedFrag(l);if(c){this.abortCurrentFrag();const f=c.maxStartPTS?c.maxStartPTS:c.start,d=c.duration,h=Math.max(l.end,f+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Ee.KEY_LOADING:case Ee.FRAG_LOADING:case Ee.FRAG_LOADING_WAITING_RETRY:case Ee.PARSING:case Ee.PARSED:this.state=Ee.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;Ks(s,"playing",this.onMediaPlaying),Ks(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(nn(s,"playing",this.onMediaPlaying),nn(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(L.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,r=!1;for(let a=0;a<t.levels.length;a++){const l=t.levels[a].audioCodec;l&&(s=s||l.indexOf("mp4a.40.2")!==-1,r=r||l.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&r&&!R3(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==Ee.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=Ee.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:r,startFragRequested:a}=this,l=t.level,c=t.details,f=c.totalduration;if(!r){this.warn(`Levels were reset while loading level ${l}`);return}this.log(`Level ${l} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${f}`);const d=t.levelInfo,h=this.fragCurrent;h&&(this.state===Ee.FRAG_LOADING||this.state===Ee.FRAG_LOADING_WAITING_RETRY)&&h.level!==t.level&&h.loader&&this.abortCurrentFrag();let g=0;if(c.live||(s=d.details)!=null&&s.live){var y;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;g=this.alignPlaylists(c,d.details,(y=this.levelLastLoaded)==null?void 0:y.details)}if(d.details=c,this.levelLastLoaded=d,a||this.setStartPosition(c,g),this.hls.trigger(L.LEVEL_UPDATED,{details:c,level:l}),this.state===Ee.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=Ee.IDLE}a&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const r=this.hls.liveSyncPosition,a=this.getLoadPosition(),l=e.fragmentStart,c=e.edge,f=a>=l-t.maxFragLookUpTolerance&&a<=c;if(r!==null&&s.duration>r&&(a<r||!f)){const h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!f&&s.readyState<4||a<c-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),s.readyState))if(this.warn(`Playback: ${a.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const g=lt.bufferInfo(s,r,0);if(!((d=g.buffered)!=null&&d.length)){s.currentTime=r;return}if(g.start<=a){s.currentTime=r;return}const{nextStart:v}=lt.bufferedInfo(g.buffered,a,0);v&&(s.currentTime=v)}else s.currentTime=r}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:r,payload:a}=e,{levels:l}=this;if(!l){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const c=l[s.level];if(!c){this.warn(`Level ${s.level} not found on progress`);return}const f=c.details;if(!f){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const d=c.videoCodec,h=f.PTSKnown||!f.live,g=(t=s.initSegment)==null?void 0:t.data,y=this._getAudioCodec(c),v=this.transmuxer=this.transmuxer||new EA(this.hls,He.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),b=r?r.index:-1,T=b!==-1,E=new bp(s.level,s.sn,s.stats.chunkCount,a.byteLength,b,T),_=this.initPTS[s.cc];v.push(a,g,y,d,s,r,f.totalduration,h,E,_)}onAudioTrackSwitching(e,t){const s=this.hls,r=this.altAudio===2;if(nd(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.fragmentTracker.removeAllFragments(),s.once(L.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(L.AUDIO_TRACK_SWITCHED,t)}),s.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(L.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=nd(t.url,this.hls);if(s){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let r,a,l=!1;for(const c in s){const f=s[c];if(f.id==="main"){if(a=c,r=f,c==="video"){const d=s[c];d&&(this.videoBuffer=d.buffer)}}else l=!0}l&&r?(this.log(`Alternate track found, use ${a}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:r}=t,a=s.type===He.MAIN;if(a){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===Ee.PARSED&&(this.state=Ee.IDLE);return}const c=r?r.stats:s.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),gs(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,r)}const l=this.media;l&&(!this._hasEnoughToStart&&lt.getBuffered(l).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),a&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=Ee.ERROR;return}switch(t.details){case ue.FRAG_GAP:case ue.FRAG_PARSING_ERROR:case ue.FRAG_DECRYPT_ERROR:case ue.FRAG_LOAD_ERROR:case ue.FRAG_LOAD_TIMEOUT:case ue.KEY_LOAD_ERROR:case ue.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(He.MAIN,t);break;case ue.LEVEL_LOAD_ERROR:case ue.LEVEL_LOAD_TIMEOUT:case ue.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Ee.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===pt.LEVEL&&(this.state=Ee.IDLE);break;case ue.BUFFER_ADD_CODEC_ERROR:case ue.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case ue.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case ue.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=Ee.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ht.AUDIO||!this.altAudio){const s=(t===Ht.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,He.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&s&&(s+=r);const a=this.getLevelDetails(),l=lt.getBuffered(e),c=l.length?l.start(0):0,f=c-s,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||f>0&&(f<d||this.loadingParts&&f<2*(a?.partTarget||0)))&&(this.log(`adjusting start position by ${f} to match buffer start`),s+=f,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${c}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:r}=this,a=s?.frag;if(!a||this.fragContextChanged(a))return;t.fragmentError=0,this.state=Ee.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const l=a.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),r.trigger(L.FRAG_LOADED,s),a.bitrateTest=!1}).catch(s=>{this.state===Ee.STOPPED||this.state===Ee.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:r,chunkMeta:a}=e,l=this.getCurrentContext(a);if(!l){this.resetWhenMissingContext(a);return}const{frag:c,part:f,level:d}=l,{video:h,text:g,id3:y,initSegment:v}=r,{details:b}=d,T=this.altAudio?void 0:r.audio;if(this.fragContextChanged(c)){this.fragmentTracker.removeFragment(c);return}if(this.state=Ee.PARSING,v){const E=v.tracks;if(E){const N=c.initSegment||c;if(this.unhandledEncryptionError(v,c))return;this._bufferInitSegment(d,E,N,a),s.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:N,id:t,tracks:E})}const _=v.initPTS,A=v.timescale,C=this.initPTS[c.cc];if(Be(_)&&(!C||C.baseTime!==_||C.timescale!==A)){const N=v.trackId;this.initPTS[c.cc]={baseTime:_,timescale:A,trackId:N},s.trigger(L.INIT_PTS_FOUND,{frag:c,id:t,initPTS:_,timescale:A,trackId:N})}}if(h&&b){T&&h.type==="audiovideo"&&this.logMuxedErr(c);const E=b.fragments[c.sn-1-b.startSN],_=c.sn===b.startSN,A=!E||c.cc>E.cc;if(r.independent!==!1){const{startPTS:C,endPTS:N,startDTS:w,endDTS:G}=h;if(f)f.elementaryStreams[h.type]={startPTS:C,endPTS:N,startDTS:w,endDTS:G};else if(h.firstKeyFrame&&h.independent&&a.id===1&&!A&&(this.couldBacktrack=!0),h.dropped&&h.independent){const M=this.getMainFwdBufferInfo(),B=(M?M.end:this.getLoadPosition())+this.config.maxBufferHole,K=h.firstKeyFramePTS?h.firstKeyFramePTS:C;if(!_&&B<K-this.config.maxBufferHole&&!A){this.backtrack(c);return}else A&&(c.gap=!0);c.setElementaryStreamInfo(h.type,c.start,N,c.start,G,!0)}else _&&C-(b.appliedTimelineOffset||0)>Hu&&(c.gap=!0);c.setElementaryStreamInfo(h.type,C,N,w,G),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(h,c,f,a,_||A)}else if(_||A)c.gap=!0;else{this.backtrack(c);return}}if(T){const{startPTS:E,endPTS:_,startDTS:A,endDTS:C}=T;f&&(f.elementaryStreams[Ht.AUDIO]={startPTS:E,endPTS:_,startDTS:A,endDTS:C}),c.setElementaryStreamInfo(Ht.AUDIO,E,_,A,C),this.bufferFragmentData(T,c,f,a)}if(b&&y!=null&&y.samples.length){const E={id:t,frag:c,details:b,samples:y.samples};s.trigger(L.FRAG_PARSING_METADATA,E)}if(b&&g){const E={id:t,frag:c,details:b,samples:g.samples};s.trigger(L.FRAG_PARSING_USERDATA,E)}}logMuxedErr(e){this.warn(`${gs(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,r){if(this.state!==Ee.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:a,video:l,audiovideo:c}=t;if(a){const d=e.audioCodec;let h=ju(a.codec,d);h==="mp4a"&&(h="mp4a.40.5");const g=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5");const y=a.metadata;y&&"channelCount"in y&&(y.channelCount||1)!==1&&g.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&g.indexOf("android")!==-1&&a.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log(`Android: force audio codec to ${h}`)),d&&d!==h&&this.log(`Swapping manifest audio codec "${d}" for "${h}"`),a.levelCodec=h,a.id=He.MAIN,this.log(`Init audio buffer, container:${a.container}, codecs[selected/level/parsed]=[${h||""}/${d||""}/${a.codec}]`),delete t.audiovideo}if(l){l.levelCodec=e.videoCodec,l.id=He.MAIN;const d=l.codec;if(d?.length===4)switch(d){case"hvc1":case"hev1":l.codec="hvc1.1.6.L120.90";break;case"av01":l.codec="av01.0.04M.08";break;case"avc1":l.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${l.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${l.codec!==d?" parsed-corrected="+l.codec:""}${l.supplemental?" supplemental="+l.supplemental:""}`),delete t.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),delete t.video,delete t.audio);const f=Object.keys(t);if(f.length){if(this.hls.trigger(L.BUFFER_CODECS,t),!this.hls)return;f.forEach(d=>{const g=t[d].initSegment;g!=null&&g.byteLength&&this.hls.trigger(L.BUFFER_APPENDING,{type:d,data:g,frag:s,part:null,chunkMeta:r,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,He.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e?.[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Ee.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(lt.isBuffered(e,s)?t=this.getAppendedFrag(s):lt.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,a=t.level;(!r||t.sn!==r.sn||r.level!==a)&&(this.fragPlaying=t,this.hls.trigger(L.FRAG_CHANGED,{frag:t}),(!r||r.level!==a)&&this.hls.trigger(L.LEVEL_SWITCHED,{level:a}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Be(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Be(t)){const s=this.getLevelDetails(),r=this.currentFrag||(s?la(null,s.fragments,t):null);if(r){const a=r.programDateTime;if(a!==null){const l=a+(t-r.start)*1e3;return new Date(l)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class N3 extends Pn{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[s].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=ue.KEY_LOAD_ERROR,s,r,a){return new Ui({type:Xe.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:a,error:s,networkDetails:r})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,a=t.length;r<a;r++){const l=t[r];if(e.cc<=l.cc&&(!gs(e)||!gs(l)||e.sn<l.sn)||!s&&r==a-1)return this.emeController.selectKeySystemFormat(l).then(c=>{if(!this.emeController)return;l.setKeyFormat(c);const f=Fu(c);if(f)return this.emeController.getKeySystemAccess([f])})}if(this.config.requireKeySystemAccessOnStart){const r=Sl(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,r;t&&e.setKeyFormat(t);const a=e.decryptdata;if(!a){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,ue.KEY_LOAD_ERROR,d))}const l=a.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,ue.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));const c=ym(a);let f=this.keyIdToKeyInfo[c];if((s=f)!=null&&s.decryptdata.key)return a.key=f.decryptdata.key,Promise.resolve({frag:e,keyInfo:f});if(this.emeController&&(r=f)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(f.decryptdata)){case"usable":case"usable-in-future":return f.keyLoadPromise.then(h=>{const{keyInfo:g}=h;return a.key=g.decryptdata.key,{frag:e,keyInfo:g}})}switch(this.log(`${this.keyIdToKeyInfo[c]?"Rel":"L"}oading${a.keyId?" keyId: "+Gs(a.keyId):""} URI: ${a.uri} from ${e.type} ${e.level}`),f=this.keyIdToKeyInfo[c]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(f,e):this.loadKeyEME(f,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(f,e);default:return Promise.reject(this.createKeyLoadError(e,ue.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${a.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){const l=Q2(t.initSegment.data);if(l.length){const c=l[0];c.some(f=>f!==0)&&(this.log(`Using keyId found in init segment ${Gs(c)}`),e.decryptdata.keyId=c,aa.setKeyIdForUri(e.decryptdata.uri,c))}}const a=this.emeController.loadKey(s);return(e.keyLoadPromise=a.then(l=>(e.mediaKeySessionContext=l,s))).catch(l=>{throw e.keyLoadPromise=null,"data"in l&&(l.data.frag=t),l})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,r=s.loader,a=new r(s);return t.keyLoader=e.loader=a,e.keyLoadPromise=new Promise((l,c)=>{const f={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=s.keyLoadPolicy.default,h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,v,b,T)=>{const{frag:E,keyInfo:_}=b,A=ym(_.decryptdata);if(!E.decryptdata||_!==this.keyIdToKeyInfo[A])return c(this.createKeyLoadError(E,ue.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),T));_.decryptdata.key=E.decryptdata.key=new Uint8Array(y.data),E.keyLoader=null,_.loader=null,l({frag:E,keyInfo:_})},onError:(y,v,b,T)=>{this.resetLoader(v),c(this.createKeyLoadError(t,ue.KEY_LOAD_ERROR,new Error(`HTTP Error ${y.code} loading key ${y.text}`),b,Pt({url:f.url,data:void 0},y)))},onTimeout:(y,v,b)=>{this.resetLoader(v),c(this.createKeyLoadError(t,ue.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),b))},onAbort:(y,v,b)=>{this.resetLoader(v),c(this.createKeyLoadError(t,ue.INTERNAL_ABORTED,new Error("key loading aborted"),b))}};a.load(f,h,g)})}resetLoader(e){const{frag:t,keyInfo:s,url:r}=e,a=s.loader;t.keyLoader===a&&(t.keyLoader=null,s.loader=null);const l=ym(s.decryptdata)||r;delete this.keyIdToKeyInfo[l],a&&a.destroy()}}function ym(n){if(n.keyFormat!==Ps.FAIRPLAY){const e=n.keyId;if(e)return Gs(e)}return n.uri}function sE(n){const{type:e}=n;switch(e){case pt.AUDIO_TRACK:return He.AUDIO;case pt.SUBTITLE_TRACK:return He.SUBTITLE;default:return He.MAIN}}function xm(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class k3{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,r=t.loader,a=s||r,l=new a(t);return this.loaders[e.type]=l,l}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:pt.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:r,pathwayId:a,url:l,deliveryDirectives:c,levelInfo:f}=t;this.load({id:s,level:r,pathwayId:a,responseType:"text",type:pt.LEVEL,url:l,deliveryDirectives:c,levelOrTrack:f})}onAudioTrackLoading(e,t){const{id:s,groupId:r,url:a,deliveryDirectives:l,track:c}=t;this.load({id:s,groupId:r,level:null,responseType:"text",type:pt.AUDIO_TRACK,url:a,deliveryDirectives:l,levelOrTrack:c})}onSubtitleTrackLoading(e,t){const{id:s,groupId:r,url:a,deliveryDirectives:l,track:c}=t;this.load({id:s,groupId:r,level:null,responseType:"text",type:pt.SUBTITLE_TRACK,url:a,deliveryDirectives:l,levelOrTrack:c})}onLevelsUpdated(e,t){const s=this.loaders[pt.LEVEL];if(s){const r=s.context;r&&!t.levels.some(a=>a===r.levelOrTrack)&&(s.abort(),delete this.loaders[pt.LEVEL])}}load(e){var t;const s=this.hls.config;let r=this.getInternalLoader(e);if(r){const d=this.hls.logger,h=r.context;if(h&&h.levelOrTrack===e.levelOrTrack&&(h.url===e.url||h.deliveryDirectives&&!e.deliveryDirectives)){h.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${h.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let a;if(e.type===pt.MANIFEST?a=s.manifestLoadPolicy.default:a=$t({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),Be((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===pt.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===pt.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===pt.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const h=d.partTarget,g=d.targetduration;if(h&&g){const y=Math.max(h*3,g*.8)*1e3;a=$t({},a,{maxTimeToFirstByteMs:Math.min(y,a.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(y,a.maxTimeToFirstByteMs)})}}}const l=a.errorRetry||a.timeoutRetry||{},c={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},f={onSuccess:(d,h,g,y)=>{const v=this.getInternalLoader(g);this.resetInternalLoader(g.type);const b=d.data;h.parsing.start=performance.now(),di.isMediaPlaylist(b)||g.type!==pt.MANIFEST?this.handleTrackOrLevelPlaylist(d,h,g,y||null,v):this.handleMasterPlaylist(d,h,g,y)},onError:(d,h,g,y)=>{this.handleNetworkError(h,g,!1,d,y)},onTimeout:(d,h,g)=>{this.handleNetworkError(h,g,!0,void 0,d)}};r.load(e,c,f)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,r){const a=this.hls,l=e.data,c=xm(e,s),f=di.parseMasterPlaylist(l,c);if(f.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,f.playlistParsingError,r,t);return}const{contentSteering:d,levels:h,sessionData:g,sessionKeys:y,startTimeOffset:v,variableList:b}=f;this.variableList=b,h.forEach(A=>{const{unknownCodecs:C}=A;if(C){const{preferManagedMediaSource:N}=this.hls.config;let{audioCodec:w,videoCodec:G}=A;for(let M=C.length;M--;){const B=C[M];Ul(B,"audio",N)?(A.audioCodec=w=w?`${w},${B}`:B,uo.audio[w.substring(0,4)]=2,C.splice(M,1)):Ul(B,"video",N)&&(A.videoCodec=G=G?`${G},${B}`:B,uo.video[G.substring(0,4)]=2,C.splice(M,1))}}});const{AUDIO:T=[],SUBTITLES:E,"CLOSED-CAPTIONS":_}=di.parseMasterPlaylistMedia(l,c,f);T.length&&!T.some(C=>!C.url)&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),T.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Zt({}),bitrate:0,url:""})),a.trigger(L.MANIFEST_LOADED,{levels:h,audioTracks:T,subtitles:E,captions:_,contentSteering:d,url:c,stats:t,networkDetails:r,sessionData:g,sessionKeys:y,startTimeOffset:v,variableList:b})}handleTrackOrLevelPlaylist(e,t,s,r,a){const l=this.hls,{id:c,level:f,type:d}=s,h=xm(e,s),g=Be(f)?f:Be(c)?c:0,y=sE(s),v=di.parseLevelPlaylist(e.data,h,g,y,0,this.variableList);if(d===pt.MANIFEST){const b={attrs:new Zt({}),bitrate:0,details:v,name:"",url:h};v.requestScheduled=t.loading.start+Q1(v,0),l.trigger(L.MANIFEST_LOADED,{levels:[b],audioTracks:[],url:h,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=v,this.handlePlaylistLoaded(v,e,t,s,r,a)}handleManifestParsingError(e,t,s,r,a){this.hls.trigger(L.ERROR,{type:Xe.NETWORK_ERROR,details:ue.MANIFEST_PARSING_ERROR,fatal:t.type===pt.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:r,stats:a})}handleNetworkError(e,t,s=!1,r,a){let l=`A network ${s?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===pt.LEVEL?l+=`: ${e.level} id: ${e.id}`:(e.type===pt.AUDIO_TRACK||e.type===pt.SUBTITLE_TRACK)&&(l+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(l);this.hls.logger.warn(`[playlist-loader]: ${l}`);let f=ue.UNKNOWN,d=!1;const h=this.getInternalLoader(e);switch(e.type){case pt.MANIFEST:f=s?ue.MANIFEST_LOAD_TIMEOUT:ue.MANIFEST_LOAD_ERROR,d=!0;break;case pt.LEVEL:f=s?ue.LEVEL_LOAD_TIMEOUT:ue.LEVEL_LOAD_ERROR,d=!1;break;case pt.AUDIO_TRACK:f=s?ue.AUDIO_TRACK_LOAD_TIMEOUT:ue.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case pt.SUBTITLE_TRACK:f=s?ue.SUBTITLE_TRACK_LOAD_TIMEOUT:ue.SUBTITLE_LOAD_ERROR,d=!1;break}h&&this.resetInternalLoader(e.type);const g={type:Xe.NETWORK_ERROR,details:f,fatal:d,url:e.url,loader:h,context:e,error:c,networkDetails:t,stats:a};if(r){const y=t?.url||e.url;g.response=Pt({url:y,data:void 0},r)}this.hls.trigger(L.ERROR,g)}handlePlaylistLoaded(e,t,s,r,a,l){const c=this.hls,{type:f,level:d,levelOrTrack:h,id:g,groupId:y,deliveryDirectives:v}=r,b=xm(t,r),T=sE(r);let E=typeof r.level=="number"&&T===He.MAIN?d:void 0;const _=e.playlistParsingError;if(_){if(this.hls.logger.warn(`${_} ${e.url}`),!c.config.ignorePlaylistParsingErrors){c.trigger(L.ERROR,{type:Xe.NETWORK_ERROR,details:ue.LEVEL_PARSING_ERROR,fatal:!1,url:b,error:_,reason:_.message,response:t,context:r,level:E,parent:T,networkDetails:a,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const A=e.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(L.ERROR,{type:Xe.NETWORK_ERROR,details:ue.LEVEL_EMPTY_ERROR,fatal:!1,url:b,error:A,reason:A.message,response:t,context:r,level:E,parent:T,networkDetails:a,stats:s});return}switch(e.live&&l&&(l.getCacheAge&&(e.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),f){case pt.MANIFEST:case pt.LEVEL:if(E){if(!h)E=0;else if(h!==c.levels[E]){const A=c.levels.indexOf(h);A>-1&&(E=A)}}c.trigger(L.LEVEL_LOADED,{details:e,levelInfo:h||c.levels[0],level:E||0,id:g||0,stats:s,networkDetails:a,deliveryDirectives:v,withoutMultiVariant:f===pt.MANIFEST});break;case pt.AUDIO_TRACK:c.trigger(L.AUDIO_TRACK_LOADED,{details:e,track:h,id:g||0,groupId:y||"",stats:s,networkDetails:a,deliveryDirectives:v});break;case pt.SUBTITLE_TRACK:c.trigger(L.SUBTITLE_TRACK_LOADED,{details:e,track:h,id:g||0,groupId:y||"",stats:s,networkDetails:a,deliveryDirectives:v});break}}}class ci{static get version(){return $l}static isMSESupported(){return WA()}static isSupported(){return w3()}static getMediaSource(){return _r()}static get Events(){return L}static get MetadataSchema(){return gn}static get ErrorTypes(){return Xe}static get ErrorDetails(){return ue}static get DefaultConfig(){return ci.defaultConfig?ci.defaultConfig:p3}static set DefaultConfig(e){ci.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Ap,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=F2(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=x3(ci.DefaultConfig,e,t);this.userConfig=e,s.progressive&&v3(s,t);const{abrController:r,bufferController:a,capLevelController:l,errorController:c,fpsController:f}=s,d=new c(this),h=this.abrController=new r(this),g=new Pk(this),y=s.interstitialsController,v=y?this.interstitialsController=new y(this,ci):null,b=this.bufferController=new a(this,g),T=this.capLevelController=new l(this),E=new f(this),_=new k3(this),A=s.contentSteeringController,C=A?new A(this):null,N=this.levelController=new L3(this,C),w=new _3(this),G=new N3(this.config,this.logger),M=this.streamController=new I3(this,g,G),B=this.gapController=new T3(this,g);T.setStreamController(M),E.setStreamController(M);const K=[_,N,M];v&&K.splice(1,0,v),C&&K.splice(1,0,C),this.networkControllers=K;const V=[h,b,B,T,E,w,g];this.audioTrackController=this.createController(s.audioTrackController,K);const $=s.audioStreamController;$&&K.push(this.audioStreamController=new $(this,g,G)),this.subtitleTrackController=this.createController(s.subtitleTrackController,K);const ee=s.subtitleStreamController;ee&&K.push(this.subtititleStreamController=new ee(this,g,G)),this.createController(s.timelineController,V),G.emeController=this.emeController=this.createController(s.emeController,V),this.cmcdController=this.createController(s.cmcdController,V),this.latencyController=this.createController(C3,V),this.coreComponents=V,K.push(d);const he=d.onErrorOut;typeof he=="function"&&this.on(L.ERROR,he,d),this.on(L.MANIFEST_LOADED,_.onManifestLoaded,_)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,r){this._emitter.off(e,t,s,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const r=e===L.ERROR;this.trigger(L.ERROR,{type:Xe.OTHER_ERROR,details:ue.INTERNAL_EXCEPTION,fatal:r,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(L.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const a=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(L.ERROR,{type:Xe.OTHER_ERROR,details:ue.ATTACH_MEDIA_ERROR,fatal:!0,error:a});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,r=t?e:{media:s};this._media=s,this.trigger(L.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(L.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(L.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,r=this._url=hp.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&s&&(s!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(L.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[He.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[He.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[He.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=TM()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){xk(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let r=0;r<s;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,s)for(let a=r;a--;){const l=e[a].attrs["HDCP-LEVEL"];if(l&&l<=s)return a}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=M1(t);return P1(e,s,navigator.mediaCapabilities)}}ci.defaultConfig=void 0;const P3=n=>n==="Online"?p.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-700 font-semibold text-xs gap-1",children:[p.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Online"]}):n==="Offline"?p.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-gray-200 text-gray-500 font-semibold text-xs gap-1",children:[p.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full"}),"Offline"]}):n==="Unknown"?p.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-yellow-50 text-yellow-700 font-semibold text-xs gap-1",children:[p.jsx("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),"Unknown"]}):p.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-red-100 text-red-600 font-semibold text-xs gap-1",children:[p.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Error"]}),O3=n=>n==="Available"?p.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-700 font-semibold text-xs gap-1",children:[p.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Available"]}):p.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-yellow-100 text-yellow-800 font-semibold text-xs gap-1",children:[p.jsx("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),"Unavailable"]}),M3=n=>p.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[n.cameraStatus==="Error"&&p.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-red-50 text-red-500 text-[11px] font-semibold gap-1 border border-red-100",children:[p.jsx("span",{className:"w-1.5 h-1.5 bg-red-400 rounded-full"}),"Error"]}),n.operatorStatus==="Unavailable"&&p.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-yellow-50 text-yellow-800 text-[11px] font-semibold gap-1 border border-yellow-100",children:[p.jsx("span",{className:"w-1.5 h-1.5 bg-yellow-400 rounded-full"}),"Unavailable"]})]}),j3=({src:n})=>{const e=R.useRef(null);return R.useEffect(()=>{const t=e.current;if(t){if(t.canPlayType("application/vnd.apple.mpegurl")){t.src=n,t.play().catch(()=>{});return}if(ci.isSupported()){const s=new ci({lowLatencyMode:!0});return s.loadSource(n),s.attachMedia(t),s.on(ci.Events.MANIFEST_PARSED,()=>{t.play().catch(()=>{})}),()=>s.destroy()}}},[n]),p.jsx("video",{ref:e,controls:!0,playsInline:!0,autoPlay:!0,className:"w-full h-full object-contain bg-black rounded-xl"})};function nE(n){const e=(n||"").trim(),t=/^rtsp(s)?:\/\//i.test(e),s=/\.m3u8(\?|$)/i.test(e),r=/^https?:\/\//i.test(e);if(t||s||r){const a=r&&/\/(mjpeg|mjpg|video)(\/|\?|$)/i.test(e);return{url:e,isRtsp:t,isHls:s,isMjpeg:a}}return{url:e,isRtsp:t,isHls:s,isMjpeg:!1}}const vm=n=>{if(!n.operatorPhone)return null;const e=n.operatorPhone.replace(/\D/g,""),t=["Station Alert",`Plant: ${n.plantName}`,`Station: ${n.stationName} (${n.stationId??""})`,`Camera(s): ${Array.isArray(n.cameras)?n.cameras.map(r=>r.code).join(", "):"-"}`,`Status: Camera=${n.cameraStatus}, Operator=${n.operatorStatus}`];n.cameras?.[0]?.url&&t.push(`Stream: ${n.cameras[0].url}`);const s=t.join(`
`);return`https://wa.me/${e}?text=${encodeURIComponent(s)}`};function iE(n){const e=(n.operator||"").split(",").map(s=>s.trim()).filter(Boolean),t=(n.operatorPhone||"").split(",").map(s=>s.trim()).filter(Boolean);return e.map((s,r)=>({name:s,phone:t[r]||""}))}const U3=()=>{const[n,e]=R.useState([]),[t,s]=R.useState([]),[r,a]=R.useState(""),[l,c]=R.useState(null),[f,d]=R.useState(null),[h,g]=R.useState(!0),[y,v]=R.useState(""),[b,T]=R.useState("none"),[E,_]=R.useState(null),[A,C]=R.useState([]),[N,w]=R.useState(""),[G,M]=R.useState(new Set),[B,K]=R.useState(null),V=O=>{K(O),setTimeout(()=>K(null),3e3)},[$,ee]=R.useState({});R.useEffect(()=>{if(!f)return;const O=Y=>Y.key==="Escape"&&d(null);return window.addEventListener("keydown",O),()=>window.removeEventListener("keydown",O)},[f]),R.useEffect(()=>{Qe("fn_list_dim_plant").then(O=>e(Array.isArray(O)?O:[])).catch(O=>{e([]),console.error("Error fetching plants:",O)})},[]),R.useEffect(()=>{if(!r){C([]);return}const Y=n.find(I=>I.p_code===r)?.p_name||"";if(!Y){C([]);return}Qe("fn_list_units_by_plant2",[Y]).then(I=>C(Array.isArray(I)?I:[])).catch(I=>{C([]),console.error("Error fetching units:",I)})},[r,n]),R.useEffect(()=>{g(!0),_(null),Qe("fn_list_station_dashboard_simple1",[]).then(O=>{s(Array.isArray(O)?O.map(Y=>({stationId:Y.station_id??Y.s_code??"",plantName:Y.plant_name??"",unitName:Y.un_name??"",stationName:Y.station_name??"",cameras:Array.isArray(Y.cameras_json)?Y.cameras_json:Y.cameras_json&&typeof Y.cameras_json=="object"?Object.values(Y.cameras_json):[],cameraStatus:Y.camera_status==="Online"?"Online":Y.camera_status==="Offline"?"Offline":Y.camera_status==="Unknown"?"Unknown":"Error",operator:Y.operator??"",operatorStatus:Y.operator_status==="Available"?"Available":"Unavailable",personCount:typeof Y.person_count=="number"?Y.person_count:null,operatorPhone:Y.operator_phone??""})):[]),g(!1)}).catch(O=>{_(O.message||"Error loading data"),s([]),g(!1)})},[]);const he=R.useMemo(()=>{let O=Array.isArray(t)?t:[];if(r){const Y=n.find(I=>I.p_code===r);Y&&(O=O.filter(I=>I.plantName===Y.p_name))}return N&&(O=O.filter(Y=>Y.unitName===N)),O},[t,n,r,N]),Z=R.useMemo(()=>{if(!y||b==="none")return he;const O=I=>Array.isArray(I)?I.map(j=>j?.code??j).join(", "):I;return[...he].sort((I,j)=>{const z=O(I[y]),J=O(j[y]);if(typeof z=="number"&&typeof J=="number")return b==="asc"?z-J:J-z;const q=String(z),P=String(J);return b==="asc"?q.localeCompare(P):P.localeCompare(q)})},[he,y,b]),H=56,k=(O,Y,I="")=>p.jsx("th",{className:`sticky top-0 z-20 bg-[#cfe7ff] px-4 py-3 font-semibold shadow cursor-pointer select-none ${I}`,onClick:()=>{y!==Y?(v(Y),T("asc")):b==="asc"?T("desc"):b==="desc"?(T("none"),v("")):T("asc")},children:p.jsxs("span",{className:"inline-flex items-center gap-1",children:[O,y===Y?b==="asc"?p.jsx("span",{className:"text-xs",children:""}):b==="desc"?p.jsx("span",{className:"text-xs",children:""}):null:null]})}),F=()=>f&&p.jsx("div",{className:"fixed inset-0 z-[999] flex items-center justify-center bg-black/40 backdrop-blur-sm",onClick:O=>{O.target===O.currentTarget&&d(null)},children:p.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 relative",children:[p.jsx("button",{className:"absolute top-2 right-3 text-2xl text-gray-400 hover:text-gray-700",onClick:()=>d(null),"aria-label":"Close",children:""}),p.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Message Operator on WhatsApp"}),p.jsx("div",{className:"space-y-3",children:f.ops.map((O,Y)=>{const I=vm({...f.row,operatorPhone:O.phone,operator:O.name})||"#";return p.jsxs("a",{href:I,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 border border-gray-200 rounded-lg px-4 py-2 hover:bg-green-50 transition",onClick:()=>d(null),children:[p.jsx("span",{className:"font-medium",children:O.name}),p.jsx("span",{className:"ml-auto text-gray-700 font-mono",children:O.phone}),p.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg",alt:"WhatsApp",className:"w-5 h-5"})]},Y)})}),p.jsx("button",{onClick:()=>d(null),className:"mt-5 w-full py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-900 font-semibold",children:"Cancel"})]})});return p.jsxs("div",{className:"p-0 h-screen overflow-hidden bg-white",children:[p.jsxs("div",{className:"w-full h-full bg-white rounded-b-sm rounded-t-none shadow-lg border border-[#fbfcfc] flex flex-col overflow-hidden",children:[p.jsxs("div",{className:"flex flex-wrap md:flex-nowrap justify-end items-center gap-3 py-2 bg-white sticky top-0 z-30 border-b border-[#cfe7ff]",style:{minHeight:H},children:[p.jsxs("select",{className:"w-full md:w-32 border rounded px-2 py-1 text-sm bg-white shadow-sm focus:outline-none",value:r,onChange:O=>{a(O.target.value),w("")},children:[p.jsx("option",{value:"",children:"All Plants"}),Array.isArray(n)&&n.map(O=>p.jsx("option",{value:O.p_code,children:O.p_name},O.p_code))]}),p.jsxs("select",{className:"w-full md:w-32 border rounded px-2 py-1 text-sm bg-white shadow-sm focus:outline-none",value:N,onChange:O=>w(O.target.value),disabled:!r,children:[p.jsx("option",{value:"",children:"All Units"}),Array.isArray(A)&&A.map(O=>p.jsx("option",{value:O.uname,children:O.uname},O.uname))]})]}),p.jsx("div",{className:"hidden md:block overflow-y-auto",style:{height:"90vh"},children:p.jsx("div",{className:"overflow-x-auto w-full",children:p.jsxs("table",{className:"w-full text-sm border-separate border-spacing-0",children:[p.jsx("thead",{children:p.jsxs("tr",{className:"bg-[#cfe7ff] text-[#0c1e36] text-left text-sm",children:[k("Plant Name","plantName","rounded-l-sm"),k("Unit","unitName"),k("Station Name","stationName"),k("Camera ID","cameras"),k("Camera Status","cameraStatus"),k("Operator","operator"),k("Operator Status","operatorStatus"),k("Person Count","personCount"),p.jsx("th",{className:"sticky top-0 z-20 bg-[#cfe7ff] px-4 py-3 font-semibold min-w-0 text-center rounded-r-sm shadow",children:"Actions"})]})}),p.jsx("tbody",{children:h?p.jsx("tr",{children:p.jsx("td",{colSpan:9,className:"text-center py-6",children:"Loading"})}):E?p.jsx("tr",{children:p.jsx("td",{colSpan:9,className:"text-center py-6 text-red-500",children:E})}):Array.isArray(Z)&&Z.length===0?p.jsx("tr",{children:p.jsx("td",{colSpan:9,className:"text-center py-6",children:"No data available"})}):Z.map((O,Y)=>{const I=iE(O),j=I.length===1&&I[0].phone;return p.jsxs("tr",{className:"bg-white text-gray-900 hover:bg-[#e7f3ff] transition",children:[p.jsx("td",{className:"px-4 py-3 min-w-0 rounded-l-lg",children:O.plantName}),p.jsx("td",{className:"px-4 py-3",children:O.unitName}),p.jsx("td",{className:"px-4 py-3",children:O.stationName}),p.jsx("td",{className:"px-4 py-3",children:Array.isArray(O.cameras)?O.cameras.map(z=>z.code).join(", "):""}),p.jsx("td",{className:"px-4 py-3",children:P3(O.cameraStatus)}),p.jsx("td",{className:"px-4 py-3",children:O.operator}),p.jsx("td",{className:"px-4 py-3",children:O3(O.operatorStatus)}),p.jsx("td",{className:"px-4 py-3",children:O.personCount!==null&&O.personCount!==void 0?O.personCount:""}),p.jsx("td",{className:"px-4 py-3 text-center rounded-r-lg",children:p.jsxs("div",{className:"flex items-center justify-center gap-2",children:[O.cameras&&O.cameras.length>0&&p.jsx("button",{className:"flex items-center justify-center w-9 h-9 bg-[#ddefff] hover:bg-[#c2e1ff] rounded-full transition",onClick:()=>c({station:O.stationName,cameras:O.cameras,activeCode:O.cameras[0]?.code||"",plantName:O.plantName,operatorPhone:O.operatorPhone,operatorStatus:O.operatorStatus,cameraStatus:O.cameraStatus}),title:"View camera(s)",children:p.jsx("img",{src:Ub,alt:"CCTV",className:"w-5 h-5"})}),I.length>0&&(j?p.jsx("a",{href:vm({...O,operatorPhone:I[0].phone,operator:I[0].name})||"#",target:"_blank",rel:"noopener noreferrer",title:`Message ${I[0].name} on WhatsApp`,className:"flex items-center justify-center w-9 h-9 bg-[#e9ffe9] hover:bg-[#cff5cf] rounded-full transition",children:p.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg",alt:"WhatsApp",className:"w-5 h-5"})}):p.jsx("button",{className:"flex items-center justify-center w-9 h-9 bg-[#e9ffe9] hover:bg-[#cff5cf] rounded-full transition",onClick:()=>d({row:O,ops:I}),title:"Choose operator to message",children:p.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg",alt:"WhatsApp",className:"w-5 h-5"})})),p.jsxs("button",{type:"button",disabled:B===Y,className:`flex items-center justify-center w-9 h-9 rounded-full transition relative border group
      ${B===Y?"bg-gradient-to-br from-red-600 to-orange-500 border-red-700 shadow-[0_0_24px_4px_rgba(255,44,0,0.35)] animate-hooterglow":"bg-[#ffeaea] border-red-200 hover:bg-orange-200"}`,title:B===Y?"Hooter is ON":"Sound Hooter",onClick:()=>V(Y),children:[p.jsx("span",{className:`absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full
      ${B===Y?"bg-yellow-300 animate-pulse":"bg-gray-300"}
    `}),p.jsx(Fb,{size:24,className:B===Y?"text-red-600 animate-pulse drop-shadow-lg":"text-red-400 group-hover:text-orange-600"}),B===Y&&p.jsx("span",{className:"absolute w-12 h-12 rounded-full bg-orange-500/30 animate-ping -z-10 left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"})]}),p.jsxs("label",{className:"inline-flex items-center cursor-pointer ml-1",children:[p.jsx("input",{type:"checkbox",className:"sr-only peer",checked:!!$[Y],onChange:()=>ee(z=>({...z,[Y]:!z[Y]}))}),p.jsx("div",{className:"w-9 h-5 bg-gray-300 rounded-full peer peer-checked:bg-red-500 transition duration-200 relative",children:p.jsx("div",{className:"absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow-md transition-transform duration-200 "+($[Y]?"translate-x-4":"")})})]})]})})]},O.plantName+O.stationName+Y)})})]})})}),p.jsx("div",{className:"block md:hidden overflow-y-auto px-2",style:{height:"90vh"},children:h?p.jsx("div",{className:"text-center py-10 text-gray-500 text-sm",children:"Loading"}):E?p.jsx("div",{className:"text-center py-10 text-red-500 text-sm",children:E}):Array.isArray(Z)&&Z.length===0?p.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"No data available"}):Z.map((O,Y)=>{const I=iE(O),j=I.length===1&&I[0].phone,z=G.has(Y);return p.jsxs("div",{className:`bg-white rounded-xl shadow mb-3 border border-gray-100 transition-all duration-200
                    ${z?"p-4":"p-3"}`,children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("div",{className:"font-bold text-lg",children:O.plantName}),p.jsx("div",{className:"text-gray-700",children:O.stationName})]}),p.jsxs("div",{className:"flex flex-col items-end",children:[M3(O),p.jsx("button",{className:"mt-1 text-gray-400 hover:text-blue-500 transition flex items-center justify-center",style:{fontSize:18,fontWeight:400,padding:0,background:"none",border:"none"},onClick:()=>{M(J=>{const q=new Set(J);return q.has(Y)?q.delete(Y):q.add(Y),q})},"aria-label":z?"Collapse details":"Show details",children:z?p.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 20 20",children:p.jsx("path",{d:"M6 12l4-4 4 4",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})}):p.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 20 20",children:p.jsx("path",{d:"M6 8l4 4 4-4",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),z&&p.jsxs("div",{className:"mt-2",children:[p.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[p.jsxs("div",{className:"flex",children:[p.jsx("span",{className:"min-w-[110px] font-semibold text-gray-500",children:"Station:"}),p.jsx("span",{className:"ml-2 text-gray-900",children:O.stationName||"--"})]}),p.jsx("div",{className:"flex",children:p.jsxs("div",{className:"flex",children:[p.jsx("span",{className:"min-w-[110px] font-semibold text-gray-500",children:"Unit:"}),p.jsx("span",{className:"ml-2 text-gray-900",children:O.unitName||"--"})]})}),p.jsxs("div",{className:"flex",children:[p.jsx("span",{className:"min-w-[110px] font-semibold text-gray-500",children:"Camera(s):"}),p.jsx("span",{className:"ml-2 text-gray-900",children:Array.isArray(O.cameras)?O.cameras.map(J=>J.code).join(", "):"--"})]}),p.jsxs("div",{className:"flex",children:[p.jsx("span",{className:"min-w-[110px] font-semibold text-gray-500",children:"Operator:"}),p.jsx("span",{className:"ml-2 text-gray-900",children:O.operator||"--"})]}),p.jsxs("div",{className:"flex",children:[p.jsx("span",{className:"min-w-[110px] font-semibold text-gray-500",children:"Person Count:"}),p.jsx("span",{className:"ml-2 text-gray-900",children:O.personCount??"--"})]})]}),p.jsxs("div",{className:"flex gap-2 mt-4",children:[O.cameras&&O.cameras.length>0&&p.jsx("button",{className:"flex items-center justify-center w-9 h-9 bg-[#ddefff] hover:bg-[#c2e1ff] rounded-full transition",onClick:()=>c({station:O.stationName,cameras:O.cameras,activeCode:O.cameras[0]?.code||"",plantName:O.plantName,operatorPhone:O.operatorPhone,operatorStatus:O.operatorStatus,cameraStatus:O.cameraStatus}),title:"View camera(s)",children:p.jsx("img",{src:Ub,alt:"CCTV",className:"w-5 h-5"})}),I.length>0&&(j?p.jsx("a",{href:vm({...O,operatorPhone:I[0].phone,operator:I[0].name})||"#",target:"_blank",rel:"noopener noreferrer",title:`Message ${I[0].name} on WhatsApp`,className:"flex items-center justify-center w-9 h-9 bg-[#e9ffe9] hover:bg-[#cff5cf] rounded-full transition",children:p.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg",alt:"WhatsApp",className:"w-5 h-5"})}):p.jsx("button",{className:"flex items-center justify-center w-9 h-9 bg-[#e9ffe9] hover:bg-[#cff5cf] rounded-full transition",onClick:()=>d({row:O,ops:I}),title:"Choose operator to message",children:p.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg",alt:"WhatsApp",className:"w-5 h-5"})})),p.jsxs("button",{type:"button",disabled:B===Y,className:`flex items-center justify-center w-9 h-9 rounded-full transition relative border group
        ${B===Y?"bg-gradient-to-br from-red-600 to-orange-500 border-red-700 shadow-[0_0_24px_4px_rgba(255,44,0,0.35)] animate-hooterglow":"bg-[#ffeaea] border-red-200 hover:bg-orange-200"}`,title:B===Y?"Hooter is ON":"Sound Hooter",onClick:()=>V(Y),children:[p.jsx("span",{className:`absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full
          ${B===Y?"bg-yellow-300 animate-pulse":"bg-gray-300"}
        `}),p.jsx(Fb,{size:24,className:B===Y?"text-red-600 animate-pulse drop-shadow-lg":"text-red-400 group-hover:text-orange-600"}),B===Y&&p.jsx("span",{className:"absolute w-12 h-12 rounded-full bg-orange-500/30 animate-ping -z-10 left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"})]}),p.jsxs("label",{className:"inline-flex items-center cursor-pointer ml-1",children:[p.jsx("input",{type:"checkbox",className:"sr-only peer",checked:!!$[Y],onChange:()=>ee(J=>({...J,[Y]:!J[Y]}))}),p.jsx("div",{className:"w-9 h-5 bg-gray-300 rounded-full peer peer-checked:bg-red-500 transition duration-200 relative",children:p.jsx("div",{className:"absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow-md transition-transform duration-200 "+($[Y]?"translate-x-4":"")})})]})]})]})]},O.plantName+O.stationName+Y)})})]}),l&&p.jsx("div",{className:"fixed inset-0 z-[99] flex items-center justify-center bg-black/50",children:p.jsxs("div",{className:`\r
        w-[94vw] max-w-[420px] md:max-w-2xl\r
        max-h-[90svh] overflow-hidden\r
        rounded-2xl bg-white shadow-2xl relative flex flex-col\r
        p-0\r
      `,style:{boxSizing:"border-box"},children:[p.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b relative",children:[p.jsx("h3",{className:"text-base font-semibold m-0",children:l.station}),p.jsx("button",{onClick:()=>c(null),className:"text-xl text-gray-400 hover:text-gray-700","aria-label":"Close",children:""}),l.operatorPhone?(()=>{const O=l.cameras.find(J=>J.code===l.activeCode),{url:Y}=nE(O?.url),I=l.operatorPhone.replace(/\D/g,""),j=["Station Alert",`Plant: ${l.plantName??"-"}`,`Station: ${l.station}`,`Camera: ${l.activeCode}`,`Status: Camera=${l.cameraStatus??"-"}, Operator=${l.operatorStatus??"-"}`];Y&&j.push(`Stream: ${Y}`);const z=`https://wa.me/${I}?text=${encodeURIComponent(j.join(`
`))}`;return p.jsx("a",{href:z,target:"_blank",rel:"noopener noreferrer",title:"Message on WhatsApp (active camera)",className:"absolute z-40 flex items-center justify-center w-9 h-9 bg-[#e9ffe9] hover:bg-[#cff5cf] rounded-full transition",style:{top:14,right:44},"aria-label":"WhatsApp",children:p.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg",alt:"WhatsApp",className:"w-5 h-5"})})})():null]}),p.jsxs("div",{className:"flex-1 flex flex-col p-3 overflow-y-auto",style:{maxHeight:"calc(90svh - 56px)"},children:[p.jsx("div",{className:"flex gap-2 mb-2 flex-wrap",children:l.cameras.map(O=>p.jsx("button",{onClick:()=>c(Y=>Y?{...Y,activeCode:O.code}:null),className:`px-3 py-1 rounded font-mono text-xs border transition ${l.activeCode===O.code?"bg-blue-600 text-white border-blue-800":"bg-gray-100 text-gray-800 border-gray-300 hover:bg-blue-50"}`,children:O.code},O.code))}),p.jsx("div",{className:"w-full aspect-video rounded-xl overflow-hidden bg-black mb-3 flex items-center justify-center",children:(()=>{const O=l.cameras.find(J=>J.code===l.activeCode);if(!O)return p.jsx("span",{className:"text-gray-400",children:"No stream found."});const{url:Y,isRtsp:I,isHls:j,isMjpeg:z}=nE(O.url);if(I){const J=`http://10.0.12.56:7000/api/stream?c_code=${l.activeCode}`;return p.jsx("img",{src:J,alt:`Live camera ${l.activeCode}`,className:"w-full h-full object-contain",style:{background:"#000"},onError:q=>{q.currentTarget.style.opacity="0.6"}})}return j?p.jsx(j3,{src:Y}):Y&&z?p.jsx("img",{src:Y,alt:`Live camera ${l.activeCode}`,className:"w-full h-full object-contain",style:{background:"#000"},onError:J=>{J.currentTarget.style.opacity="0.6"}}):p.jsxs("span",{className:"text-gray-600",children:["[No live video available for ",l.activeCode,". Provide MJPEG or HLS URL.]"]})})()})]})]})}),F()]})},F3=()=>{const n=[];for(let e=1;e<=20;e++)n.push({cameraName:`Camera ${e}`,ipAddress:`192.168.0.${e}`,location:`Zone ${e%5}`,station:`Station ${e%10}`,status:e%3===0?"Offline":"Online",stream:e%2===0?"Live":"Stopped",ai:e%4===0?"Enabled":"Disabled",people:Math.floor(Math.random()*5),lastDetected:`2025-07-${e%28+1} 14:${e*2%60}`,lastAlert:`2025-07-${e%28+1} 13:${e*3%60}`,hooter:e%5===0?"Active":"Inactive",view:"",actions:""});return n},B3=()=>{const[n,e]=R.useState(F3()),[t,s]=R.useState(null),[r,a]=R.useState(!1),[l,c]=R.useState({cameraName:"",ipAddress:"",location:"",station:"",ai:"Enabled",stream:"Live",hooter:"Active"});R.useEffect(()=>{const d=document.getElementById("scroll-container");d&&(d.style.position="fixed",d.style.bottom="0",d.style.left="0",d.style.right="0",d.style.zIndex="10",d.style.backgroundColor="#f3f4f6",d.style.overflowX="auto")},[]);const f=()=>{const d={...l,status:"Online",people:0,lastDetected:new Date().toISOString(),lastAlert:new Date().toISOString(),view:"",actions:""};e([d,...n]),a(!1),c({cameraName:"",ipAddress:"",location:"",station:"",ai:"Enabled",stream:"Live",hooter:"Active"})};return p.jsxs("div",{className:"min-h-screen bg-gray-100 p-6 text-black relative w-full",children:[p.jsxs("div",{className:"flex justify-between items-center mb-4",children:[p.jsx("h1",{className:"text-2xl font-bold",children:"Camera Dashboard"}),p.jsx("button",{onClick:()=>a(!0),className:"bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700",children:"+ Add Camera"})]}),p.jsx("div",{className:"w-full border border-gray-300 rounded-md",style:{paddingBottom:"60px"},children:p.jsx("div",{className:"min-w-[1500px]",children:p.jsxs("table",{className:"w-full text-sm bg-white",children:[p.jsx("thead",{className:"bg-gray-200 text-gray-700 font-semibold",children:p.jsx("tr",{children:["Camera Name","IP Address","Location","Station","Status","Stream","AI","People","Last Detected","Last Alert","Hooter","View","Actions"].map((d,h)=>p.jsx("th",{className:"px-4 py-2 text-left whitespace-nowrap",children:d},h))})}),p.jsx("tbody",{className:"text-gray-800",children:n.map((d,h)=>p.jsxs("tr",{className:"border-b hover:bg-gray-50 transition",children:[p.jsx("td",{className:"px-4 py-2",children:d.cameraName}),p.jsx("td",{className:"px-4 py-2",children:d.ipAddress}),p.jsx("td",{className:"px-4 py-2",children:d.location}),p.jsx("td",{className:"px-4 py-2",children:d.station}),p.jsx("td",{className:"px-4 py-2",children:d.status}),p.jsx("td",{className:"px-4 py-2",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:`w-3 h-3 rounded-full ${d.stream==="Live"?"bg-green-500 blink":"bg-red-500"}`}),p.jsx("span",{children:d.stream})]})}),p.jsx("td",{className:"px-4 py-2",children:d.ai}),p.jsx("td",{className:"px-4 py-2",children:d.people}),p.jsx("td",{className:"px-4 py-2",children:d.lastDetected}),p.jsx("td",{className:"px-4 py-2",children:d.lastAlert}),p.jsx("td",{className:"px-4 py-2",children:d.hooter}),p.jsx("td",{className:"px-4 py-2",children:p.jsx("img",{src:"/src/assets/cctv.png",alt:"View Camera",className:"w-6 h-6 cursor-pointer hover:scale-110 transition-transform",onClick:()=>s(d)})}),p.jsx("td",{className:"px-4 py-2",children:p.jsx("button",{className:"text-blue-500 hover:underline",children:"Actions"})})]},h))})]})})}),p.jsx("div",{id:"scroll-container"}),p.jsx("style",{children:`
                    .blink {
                      animation: blink-animation 1s steps(1, start) infinite;
                    }

                    @keyframes blink-animation {
                      0%, 100% { opacity: 1; }
                      50% { opacity: 0; }
                    }
                `}),t&&p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 backdrop-blur-sm",children:p.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative",children:[p.jsxs("h2",{className:"text-lg font-semibold mb-2",children:[" ",t.cameraName,"  Live Feed"]}),p.jsx("p",{className:"mb-4 text-gray-700",children:"This is a placeholder for the real-time camera stream."}),p.jsx("div",{className:"w-full h-64 bg-gray-300 rounded-md flex items-center justify-center",children:p.jsx("span",{className:"text-gray-600",children:"[Live video stream]"})}),p.jsx("button",{onClick:()=>s(null),className:"absolute top-2 right-2 text-gray-600 hover:text-red-600 text-xl font-bold",children:""})]})}),r&&p.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:p.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-md space-y-4 relative",children:[p.jsx("h2",{className:"text-xl font-semibold",children:"Add New Camera"}),["cameraName","ipAddress","location","station"].map(d=>p.jsx("input",{placeholder:d.replace(/([A-Z])/g," $1"),value:l[d],onChange:h=>c({...l,[d]:h.target.value}),className:"w-full border border-gray-300 px-4 py-2 rounded focus:outline-none"},d)),p.jsxs("select",{value:l.ai,onChange:d=>c({...l,ai:d.target.value}),className:"w-full border border-gray-300 px-4 py-2 rounded",children:[p.jsx("option",{children:"Enabled"}),p.jsx("option",{children:"Disabled"})]}),p.jsxs("select",{value:l.stream,onChange:d=>c({...l,stream:d.target.value}),className:"w-full border border-gray-300 px-4 py-2 rounded",children:[p.jsx("option",{children:"Live"}),p.jsx("option",{children:"Stopped"})]}),p.jsxs("select",{value:l.hooter,onChange:d=>c({...l,hooter:d.target.value}),className:"w-full border border-gray-300 px-4 py-2 rounded",children:[p.jsx("option",{children:"Active"}),p.jsx("option",{children:"Inactive"})]}),p.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[p.jsx("button",{onClick:()=>a(!1),className:"px-4 py-1 border border-gray-400 rounded hover:bg-gray-200",children:"Cancel"}),p.jsx("button",{onClick:f,className:"px-4 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Add"})]})]})})]})};function QA(n){var e,t,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var r=n.length;for(e=0;e<r;e++)n[e]&&(t=QA(n[e]))&&(s&&(s+=" "),s+=t)}else for(t in n)n[t]&&(s&&(s+=" "),s+=t);return s}function oa(){for(var n,e,t=0,s="",r=arguments.length;t<r;t++)(n=arguments[t])&&(e=QA(n))&&(s&&(s+=" "),s+=e);return s}function $3(n){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t),t.styleSheet?t.styleSheet.cssText=n:t.appendChild(document.createTextNode(n))}$3(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var Jl=n=>typeof n=="number"&&!isNaN(n),ca=n=>typeof n=="string",Hi=n=>typeof n=="function",V3=n=>ca(n)||Jl(n),vg=n=>ca(n)||Hi(n)?n:null,G3=(n,e)=>n===!1||Jl(n)&&n>0?n:e,bg=n=>R.isValidElement(n)||ca(n)||Hi(n)||Jl(n);function H3(n,e,t=300){let{scrollHeight:s,style:r}=n;requestAnimationFrame(()=>{r.minHeight="initial",r.height=s+"px",r.transition=`all ${t}ms`,requestAnimationFrame(()=>{r.height="0",r.padding="0",r.margin="0",setTimeout(e,t)})})}function K3({enter:n,exit:e,appendPosition:t=!1,collapse:s=!0,collapseDuration:r=300}){return function({children:a,position:l,preventExitTransition:c,done:f,nodeRef:d,isIn:h,playToast:g}){let y=t?`${n}--${l}`:n,v=t?`${e}--${l}`:e,b=R.useRef(0);return R.useLayoutEffect(()=>{let T=d.current,E=y.split(" "),_=A=>{A.target===d.current&&(g(),T.removeEventListener("animationend",_),T.removeEventListener("animationcancel",_),b.current===0&&A.type!=="animationcancel"&&T.classList.remove(...E))};T.classList.add(...E),T.addEventListener("animationend",_),T.addEventListener("animationcancel",_)},[]),R.useEffect(()=>{let T=d.current,E=()=>{T.removeEventListener("animationend",E),s?H3(T,f,r):f()};h||(c?E():(b.current=1,T.className+=` ${v}`,T.addEventListener("animationend",E)))},[h]),ht.createElement(ht.Fragment,null,a)}}function rE(n,e){return{content:ZA(n.content,n.props),containerId:n.props.containerId,id:n.props.toastId,theme:n.props.theme,type:n.props.type,data:n.props.data||{},isLoading:n.props.isLoading,icon:n.props.icon,reason:n.removalReason,status:e}}function ZA(n,e,t=!1){return R.isValidElement(n)&&!ca(n.type)?R.cloneElement(n,{closeToast:e.closeToast,toastProps:e,data:e.data,isPaused:t}):Hi(n)?n({closeToast:e.closeToast,toastProps:e,data:e.data,isPaused:t}):n}function z3({closeToast:n,theme:e,ariaLabel:t="close"}){return ht.createElement("button",{className:`Toastify__close-button Toastify__close-button--${e}`,type:"button",onClick:s=>{s.stopPropagation(),n(!0)},"aria-label":t},ht.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},ht.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function Y3({delay:n,isRunning:e,closeToast:t,type:s="default",hide:r,className:a,controlledProgress:l,progress:c,rtl:f,isIn:d,theme:h}){let g=r||l&&c===0,y={animationDuration:`${n}ms`,animationPlayState:e?"running":"paused"};l&&(y.transform=`scaleX(${c})`);let v=oa("Toastify__progress-bar",l?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${h}`,`Toastify__progress-bar--${s}`,{"Toastify__progress-bar--rtl":f}),b=Hi(a)?a({rtl:f,type:s,defaultClassName:v}):oa(v,a),T={[l&&c>=1?"onTransitionEnd":"onAnimationEnd"]:l&&c<1?null:()=>{d&&t()}};return ht.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":g},ht.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${h} Toastify__progress-bar--${s}`}),ht.createElement("div",{role:"progressbar","aria-hidden":g?"true":"false","aria-label":"notification timer",className:b,style:y,...T}))}var q3=1,JA=()=>`${q3++}`;function X3(n,e,t){let s=1,r=0,a=[],l=[],c=e,f=new Map,d=new Set,h=A=>(d.add(A),()=>d.delete(A)),g=()=>{l=Array.from(f.values()),d.forEach(A=>A())},y=({containerId:A,toastId:C,updateId:N})=>{let w=A?A!==n:n!==1,G=f.has(C)&&N==null;return w||G},v=(A,C)=>{f.forEach(N=>{var w;(C==null||C===N.props.toastId)&&((w=N.toggle)==null||w.call(N,A))})},b=A=>{var C,N;(N=(C=A.props)==null?void 0:C.onClose)==null||N.call(C,A.removalReason),A.isActive=!1},T=A=>{if(A==null)f.forEach(b);else{let C=f.get(A);C&&b(C)}g()},E=()=>{r-=a.length,a=[]},_=A=>{var C,N;let{toastId:w,updateId:G}=A.props,M=G==null;A.staleId&&f.delete(A.staleId),A.isActive=!0,f.set(w,A),g(),t(rE(A,M?"added":"updated")),M&&((N=(C=A.props).onOpen)==null||N.call(C))};return{id:n,props:c,observe:h,toggle:v,removeToast:T,toasts:f,clearQueue:E,buildToast:(A,C)=>{if(y(C))return;let{toastId:N,updateId:w,data:G,staleId:M,delay:B}=C,K=w==null;K&&r++;let V={...c,style:c.toastStyle,key:s++,...Object.fromEntries(Object.entries(C).filter(([ee,he])=>he!=null)),toastId:N,updateId:w,data:G,isIn:!1,className:vg(C.className||c.toastClassName),progressClassName:vg(C.progressClassName||c.progressClassName),autoClose:C.isLoading?!1:G3(C.autoClose,c.autoClose),closeToast(ee){f.get(N).removalReason=ee,T(N)},deleteToast(){let ee=f.get(N);if(ee!=null){if(t(rE(ee,"removed")),f.delete(N),r--,r<0&&(r=0),a.length>0){_(a.shift());return}g()}}};V.closeButton=c.closeButton,C.closeButton===!1||bg(C.closeButton)?V.closeButton=C.closeButton:C.closeButton===!0&&(V.closeButton=bg(c.closeButton)?c.closeButton:!0);let $={content:A,props:V,staleId:M};c.limit&&c.limit>0&&r>c.limit&&K?a.push($):Jl(B)?setTimeout(()=>{_($)},B):_($)},setProps(A){c=A},setToggle:(A,C)=>{let N=f.get(A);N&&(N.toggle=C)},isToastActive:A=>{var C;return(C=f.get(A))==null?void 0:C.isActive},getSnapshot:()=>l}}var zs=new Map,Kl=[],Sg=new Set,W3=n=>Sg.forEach(e=>e(n)),e_=()=>zs.size>0;function Q3(){Kl.forEach(n=>s_(n.content,n.options)),Kl=[]}var Z3=(n,{containerId:e})=>{var t;return(t=zs.get(e||1))==null?void 0:t.toasts.get(n)};function t_(n,e){var t;if(e)return!!((t=zs.get(e))!=null&&t.isToastActive(n));let s=!1;return zs.forEach(r=>{r.isToastActive(n)&&(s=!0)}),s}function J3(n){if(!e_()){Kl=Kl.filter(e=>n!=null&&e.options.toastId!==n);return}if(n==null||V3(n))zs.forEach(e=>{e.removeToast(n)});else if(n&&("containerId"in n||"id"in n)){let e=zs.get(n.containerId);e?e.removeToast(n.id):zs.forEach(t=>{t.removeToast(n.id)})}}var ej=(n={})=>{zs.forEach(e=>{e.props.limit&&(!n.containerId||e.id===n.containerId)&&e.clearQueue()})};function s_(n,e){bg(n)&&(e_()||Kl.push({content:n,options:e}),zs.forEach(t=>{t.buildToast(n,e)}))}function tj(n){var e;(e=zs.get(n.containerId||1))==null||e.setToggle(n.id,n.fn)}function n_(n,e){zs.forEach(t=>{(e==null||!(e!=null&&e.containerId)||e?.containerId===t.id)&&t.toggle(n,e?.id)})}function sj(n){let e=n.containerId||1;return{subscribe(t){let s=X3(e,n,W3);zs.set(e,s);let r=s.observe(t);return Q3(),()=>{r(),zs.delete(e)}},setProps(t){var s;(s=zs.get(e))==null||s.setProps(t)},getSnapshot(){var t;return(t=zs.get(e))==null?void 0:t.getSnapshot()}}}function nj(n){return Sg.add(n),()=>{Sg.delete(n)}}function ij(n){return n&&(ca(n.toastId)||Jl(n.toastId))?n.toastId:JA()}function ec(n,e){return s_(n,e),e.toastId}function Ed(n,e){return{...e,type:e&&e.type||n,toastId:ij(e)}}function Td(n){return(e,t)=>ec(e,Ed(n,t))}function ce(n,e){return ec(n,Ed("default",e))}ce.loading=(n,e)=>ec(n,Ed("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...e}));function rj(n,{pending:e,error:t,success:s},r){let a;e&&(a=ca(e)?ce.loading(e,r):ce.loading(e.render,{...r,...e}));let l={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},c=(d,h,g)=>{if(h==null){ce.dismiss(a);return}let y={type:d,...l,...r,data:g},v=ca(h)?{render:h}:h;return a?ce.update(a,{...y,...v}):ce(v.render,{...y,...v}),g},f=Hi(n)?n():n;return f.then(d=>c("success",s,d)).catch(d=>c("error",t,d)),f}ce.promise=rj;ce.success=Td("success");ce.info=Td("info");ce.error=Td("error");ce.warning=Td("warning");ce.warn=ce.warning;ce.dark=(n,e)=>ec(n,Ed("default",{theme:"dark",...e}));function aj(n){J3(n)}ce.dismiss=aj;ce.clearWaitingQueue=ej;ce.isActive=t_;ce.update=(n,e={})=>{let t=Z3(n,e);if(t){let{props:s,content:r}=t,a={delay:100,...s,...e,toastId:e.toastId||n,updateId:JA()};a.toastId!==n&&(a.staleId=n);let l=a.render||r;delete a.render,ec(l,a)}};ce.done=n=>{ce.update(n,{progress:1})};ce.onChange=nj;ce.play=n=>n_(!0,n);ce.pause=n=>n_(!1,n);function oj(n){var e;let{subscribe:t,getSnapshot:s,setProps:r}=R.useRef(sj(n)).current;r(n);let a=(e=R.useSyncExternalStore(t,s,s))==null?void 0:e.slice();function l(c){if(!a)return[];let f=new Map;return n.newestOnTop&&a.reverse(),a.forEach(d=>{let{position:h}=d.props;f.has(h)||f.set(h,[]),f.get(h).push(d)}),Array.from(f,d=>c(d[0],d[1]))}return{getToastToRender:l,isToastActive:t_,count:a?.length}}function lj(n){let[e,t]=R.useState(!1),[s,r]=R.useState(!1),a=R.useRef(null),l=R.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:c,pauseOnHover:f,closeToast:d,onClick:h,closeOnClick:g}=n;tj({id:n.toastId,containerId:n.containerId,fn:t}),R.useEffect(()=>{if(n.pauseOnFocusLoss)return y(),()=>{v()}},[n.pauseOnFocusLoss]);function y(){document.hasFocus()||_(),window.addEventListener("focus",E),window.addEventListener("blur",_)}function v(){window.removeEventListener("focus",E),window.removeEventListener("blur",_)}function b(M){if(n.draggable===!0||n.draggable===M.pointerType){A();let B=a.current;l.canCloseOnClick=!0,l.canDrag=!0,B.style.transition="none",n.draggableDirection==="x"?(l.start=M.clientX,l.removalDistance=B.offsetWidth*(n.draggablePercent/100)):(l.start=M.clientY,l.removalDistance=B.offsetHeight*(n.draggablePercent===80?n.draggablePercent*1.5:n.draggablePercent)/100)}}function T(M){let{top:B,bottom:K,left:V,right:$}=a.current.getBoundingClientRect();M.nativeEvent.type!=="touchend"&&n.pauseOnHover&&M.clientX>=V&&M.clientX<=$&&M.clientY>=B&&M.clientY<=K?_():E()}function E(){t(!0)}function _(){t(!1)}function A(){l.didMove=!1,document.addEventListener("pointermove",N),document.addEventListener("pointerup",w)}function C(){document.removeEventListener("pointermove",N),document.removeEventListener("pointerup",w)}function N(M){let B=a.current;if(l.canDrag&&B){l.didMove=!0,e&&_(),n.draggableDirection==="x"?l.delta=M.clientX-l.start:l.delta=M.clientY-l.start,l.start!==M.clientX&&(l.canCloseOnClick=!1);let K=n.draggableDirection==="x"?`${l.delta}px, var(--y)`:`0, calc(${l.delta}px + var(--y))`;B.style.transform=`translate3d(${K},0)`,B.style.opacity=`${1-Math.abs(l.delta/l.removalDistance)}`}}function w(){C();let M=a.current;if(l.canDrag&&l.didMove&&M){if(l.canDrag=!1,Math.abs(l.delta)>l.removalDistance){r(!0),n.closeToast(!0),n.collapseAll();return}M.style.transition="transform 0.2s, opacity 0.2s",M.style.removeProperty("transform"),M.style.removeProperty("opacity")}}let G={onPointerDown:b,onPointerUp:T};return c&&f&&(G.onMouseEnter=_,n.stacked||(G.onMouseLeave=E)),g&&(G.onClick=M=>{h&&h(M),l.canCloseOnClick&&d(!0)}),{playToast:E,pauseToast:_,isRunning:e,preventExitTransition:s,toastRef:a,eventHandlers:G}}var cj=typeof window<"u"?R.useLayoutEffect:R.useEffect,Ad=({theme:n,type:e,isLoading:t,...s})=>ht.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:n==="colored"?"currentColor":`var(--toastify-icon-color-${e})`,...s});function uj(n){return ht.createElement(Ad,{...n},ht.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))}function dj(n){return ht.createElement(Ad,{...n},ht.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))}function fj(n){return ht.createElement(Ad,{...n},ht.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))}function hj(n){return ht.createElement(Ad,{...n},ht.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))}function mj(){return ht.createElement("div",{className:"Toastify__spinner"})}var Eg={info:dj,warning:uj,success:fj,error:hj,spinner:mj},gj=n=>n in Eg;function pj({theme:n,type:e,isLoading:t,icon:s}){let r=null,a={theme:n,type:e};return s===!1||(Hi(s)?r=s({...a,isLoading:t}):R.isValidElement(s)?r=R.cloneElement(s,a):t?r=Eg.spinner():gj(e)&&(r=Eg[e](a))),r}var yj=n=>{let{isRunning:e,preventExitTransition:t,toastRef:s,eventHandlers:r,playToast:a}=lj(n),{closeButton:l,children:c,autoClose:f,onClick:d,type:h,hideProgressBar:g,closeToast:y,transition:v,position:b,className:T,style:E,progressClassName:_,updateId:A,role:C,progress:N,rtl:w,toastId:G,deleteToast:M,isIn:B,isLoading:K,closeOnClick:V,theme:$,ariaLabel:ee}=n,he=oa("Toastify__toast",`Toastify__toast-theme--${$}`,`Toastify__toast--${h}`,{"Toastify__toast--rtl":w},{"Toastify__toast--close-on-click":V}),Z=Hi(T)?T({rtl:w,position:b,type:h,defaultClassName:he}):oa(he,T),H=pj(n),k=!!N||!f,F={closeToast:y,type:h,theme:$},O=null;return l===!1||(Hi(l)?O=l(F):R.isValidElement(l)?O=R.cloneElement(l,F):O=z3(F)),ht.createElement(v,{isIn:B,done:M,position:b,preventExitTransition:t,nodeRef:s,playToast:a},ht.createElement("div",{id:G,tabIndex:0,onClick:d,"data-in":B,className:Z,...r,style:E,ref:s,...B&&{role:C,"aria-label":ee}},H!=null&&ht.createElement("div",{className:oa("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!K})},H),ZA(c,n,!e),O,!n.customProgressBar&&ht.createElement(Y3,{...A&&!k?{key:`p-${A}`}:{},rtl:w,theme:$,delay:f,isRunning:e,isIn:B,closeToast:y,hide:g,type:h,className:_,controlledProgress:k,progress:N||0})))},xj=(n,e=!1)=>({enter:`Toastify--animate Toastify__${n}-enter`,exit:`Toastify--animate Toastify__${n}-exit`,appendPosition:e}),vj=K3(xj("bounce",!0)),bj={position:"top-right",transition:vj,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:n=>n.altKey&&n.code==="KeyT"};function Dr(n){let e={...bj,...n},t=n.stacked,[s,r]=R.useState(!0),a=R.useRef(null),{getToastToRender:l,isToastActive:c,count:f}=oj(e),{className:d,style:h,rtl:g,containerId:y,hotKeys:v}=e;function b(E){let _=oa("Toastify__toast-container",`Toastify__toast-container--${E}`,{"Toastify__toast-container--rtl":g});return Hi(d)?d({position:E,rtl:g,defaultClassName:_}):oa(_,vg(d))}function T(){t&&(r(!0),ce.play())}return cj(()=>{var E;if(t){let _=a.current.querySelectorAll('[data-in="true"]'),A=12,C=(E=e.position)==null?void 0:E.includes("top"),N=0,w=0;Array.from(_).reverse().forEach((G,M)=>{let B=G;B.classList.add("Toastify__toast--stacked"),M>0&&(B.dataset.collapsed=`${s}`),B.dataset.pos||(B.dataset.pos=C?"top":"bot");let K=N*(s?.2:1)+(s?0:A*M);B.style.setProperty("--y",`${C?K:K*-1}px`),B.style.setProperty("--g",`${A}`),B.style.setProperty("--s",`${1-(s?w:0)}`),N+=B.offsetHeight,w+=.025})}},[s,f,t]),R.useEffect(()=>{function E(_){var A;let C=a.current;v(_)&&((A=C.querySelector('[tabIndex="0"]'))==null||A.focus(),r(!1),ce.pause()),_.key==="Escape"&&(document.activeElement===C||C!=null&&C.contains(document.activeElement))&&(r(!0),ce.play())}return document.addEventListener("keydown",E),()=>{document.removeEventListener("keydown",E)}},[v]),ht.createElement("section",{ref:a,className:"Toastify",id:y,onMouseEnter:()=>{t&&(r(!1),ce.pause())},onMouseLeave:T,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":e["aria-label"]},l((E,_)=>{let A=_.length?{...h}:{...h,pointerEvents:"none"};return ht.createElement("div",{tabIndex:-1,className:b(E),"data-stacked":t,style:A,key:`c-${E}`},_.map(({content:C,props:N})=>ht.createElement(yj,{...N,stacked:t,collapseAll:T,isIn:c(N.toastId,N.containerId),key:`t-${N.key}`},C)))}))}const Sj=["East","West","North","South"],dd=[];Sj.forEach((n,e)=>{for(let t=1;t<=3;t++)dd.push({id:`PL${e+1}${t}`,name:`Plant ${String.fromCharCode(65+e*3+(t-1))}`,location:n})});const Dl=[];dd.forEach(n=>{for(let e=1;e<=3;e++)Dl.push({id:`ST${n.id}${String(e).padStart(2,"0")}`,name:`Station ${String(e).padStart(2,"0")}`,plantId:n.id,plantName:n.name,location:n.location})});const Ej=Dl.flatMap((n,e)=>{const t=2+e%2;return Array.from({length:t},(s,r)=>{const a=Math.random()<.3,l="07",c=String(23+r).padStart(2,"0"),f=`0${r+1}`;return{id:`CAM_${n.id}_${r+1}`,stationId:n.id,name:`Camera ${r+1}`,url:`https://placehold.co/800x500?text=${n.id}+Cam${r+1}`,isOnline:!a,offlineSince:a?`2025-${l}-${c} ${f}:00 AM`:void 0}})}),Tj=()=>{const[n]=R.useState(""),[e,t]=R.useState(""),[s,r]=R.useState(""),[a,l]=R.useState(null),c=n?dd.filter(y=>y.location===n):dd,f=Dl.filter(y=>(!n||y.location===n)&&(!e||y.plantId===e)),d=e?Dl.filter(y=>y.plantId===e&&(!n||y.location===n)):f,h=f.filter(y=>!s||y.id===s),g=Ej.filter(y=>h.some(v=>v.id===y.stationId));return p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"min-h-screen bg-[#f0f7ff] text-[#0c1e36] font-sans pt-2 pb-2 px-6",children:[p.jsx("div",{className:"flex justify-end items-center mb-2",children:p.jsxs("div",{className:"flex flex-nowrap items-center gap-3",children:[p.jsxs("select",{value:e,onChange:y=>{t(y.target.value),r("")},className:"p-2 border border-[#131314] rounded-sm shadow-inner bg-white",disabled:!c.length,children:[p.jsx("option",{value:"",children:"All Plants"}),c.map(y=>p.jsx("option",{value:y.id,children:y.name},y.id))]}),p.jsxs("select",{value:s,onChange:y=>r(y.target.value),className:"p-2 border border-[#131314] rounded-sm shadow-inner bg-white",disabled:!d.length,children:[p.jsx("option",{value:"",children:"All Stations"}),d.map(y=>p.jsx("option",{value:y.id,children:y.name},y.id))]})]})}),p.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mb-10",children:g.slice(0,10).map(y=>p.jsxs("div",{className:`rounded-xl shadow-md border-2 ${y.isOnline?"bg-white border-[#cfe7ff]":"bg-[#fef2f2] border-red-400"} hover:shadow-lg transform hover:scale-[1.02] transition cursor-pointer`,onClick:()=>l(y),children:[p.jsx("img",{src:y.url,alt:y.name,className:`w-full h-48 object-cover rounded-t-lg ${y.isOnline?"":"opacity-60 grayscale"}`}),p.jsxs("div",{className:"p-4",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("h2",{className:"font-semibold text-lg text-[#0c1e36]",children:y.name}),!y.isOnline&&p.jsx("span",{className:"text-xs bg-white bg-opacity-70 text-red-600 px-2 py-0.5 rounded font-semibold",children:"Offline"})]}),p.jsxs("p",{className:"text-sm mt-1 text-[#0c1e36]",children:["ID: ",y.id]})]})]},y.id))}),p.jsx("div",{className:"mt-8 bg-white border border-[#cfe7ff] rounded-sm shadow-lg overflow-hidden",children:p.jsx("div",{className:"overflow-x-auto",children:p.jsxs("table",{className:"w-full text-sm border-separate border-spacing-0",children:[p.jsx("thead",{children:p.jsx("tr",{className:"bg-[#cfe7ff] text-[#0c1e36] text-left text-sm",children:["Plant ID","Plant Name","Station ID","Station Name","Operator","Availability %","In/Out Count","Last In","Last Out","Status","Absent Since","Hooter","Call"].map((y,v)=>p.jsx("th",{className:`sticky top-0 z-20 bg-[#cfe7ff] px-4 py-3 font-semibold shadow ${v===0?"rounded-sm":""}`,children:y},y))})}),p.jsx("tbody",{children:g.slice(0,10).map((y,v)=>{const b=Dl.find(A=>A.id===y.stationId),T=String(v%9+1).padStart(2,"0"),E=`0${v%9}`,_=`1${v%9}`;return p.jsxs("tr",{className:"bg-white text-[#0c1e36] shadow-sm hover:bg-[#e7f3ff] transition",children:[p.jsx("td",{className:"px-4 py-3",children:b?.plantId}),p.jsx("td",{className:"px-4 py-3",children:b?.plantName}),p.jsx("td",{className:"px-4 py-3",children:b?.id}),p.jsx("td",{className:"px-4 py-3",children:b?.name}),p.jsx("td",{className:"px-4 py-3",children:`Operator ${v+1}`}),p.jsx("td",{className:"px-4 py-3",children:`${((50+v*3.7)%100).toFixed(1)}%`}),p.jsx("td",{className:"px-4 py-3",children:`${v+3}/${v+1}`}),p.jsx("td",{className:"px-4 py-3",children:`2025-08-${T} ${E}:00`}),p.jsx("td",{className:"px-4 py-3",children:`2025-08-${T} ${_}:00`}),p.jsx("td",{className:"px-4 py-3",children:p.jsx("span",{className:`font-medium ${y.isOnline?"text-green-600":"text-red-500"}`,children:y.isOnline?"Online":"Offline"})}),p.jsx("td",{className:"px-4 py-3",children:v%3===0?`2025-08-${String(v+1).padStart(2,"0")} 0${v%9}:00`:"-"}),p.jsx("td",{className:"px-4 py-3",children:v%4===0?p.jsx("button",{onClick:()=>ce.success("Hooter triggered!"),className:"px-2 py-1 bg-[#155697] hover:bg-[#0f3e66] text-white rounded text-xs",children:"Trigger"}):p.jsx("span",{className:"text-sm text-gray-500",children:"-"})}),p.jsx("td",{className:"px-4 py-3 text-center",children:p.jsx("a",{href:"https://wa.me/917978998635",target:"_blank",rel:"noopener noreferrer",title:"Call via WhatsApp",children:p.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg",alt:"WhatsApp",className:"w-6 h-6 mx-auto"})})})]},`row-${y.id}`)})})]})})})]}),a&&Ng.createPortal(p.jsx("div",{className:"fixed inset-0 bg-[#0c1e36]/90 z-50 flex items-center justify-center p-6",children:p.jsxs("div",{className:"relative max-w-6xl w-full bg-white rounded-lg shadow-lg overflow-hidden",children:[p.jsx("button",{onClick:()=>l(null),className:"absolute top-4 right-4 text-white bg-[#0f3e66] hover:bg-[#092339] px-5 py-2 rounded-lg shadow font-semibold transition",children:" Close"}),p.jsx("img",{src:a.url,alt:a.name,className:"w-full max-h-[80vh] object-contain"}),p.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 px-6 py-4 text-[#0c1e36]",children:[p.jsx("p",{className:"text-xl font-bold text-center md:text-left",children:`${a.name} (ID: ${a.id})`}),p.jsx("button",{onClick:()=>ce.success(`Hooter triggered for ${a.name}!`),className:"px-4 py-2 bg-[#d62828] hover:bg-[#a30f0f] text-white rounded-md shadow text-sm font-semibold transition",children:" Trigger Hooter"})]})]})}),document.body),p.jsx(Dr,{limit:1,hideProgressBar:!0})]})},Zr="cursor-pointer w-[300px] h-[130px] bg-white p-5 border border-[#cfe7ff] rounded-xl shadow-sm hover:shadow-md hover:bg-[#eaf4ff] transition",Aj=()=>{const n=wr();return p.jsxs("div",{className:"min-h-screen bg-[#f0f7ff] text-[#0c1e36] p-8 font-sans",children:[p.jsxs("div",{className:"mb-10",children:[p.jsx("h2",{className:"text-xl font-semibold mb-4",children:"General"}),p.jsxs("div",{className:"flex flex-wrap gap-6",children:[p.jsxs("div",{onClick:()=>n("/administration/shift"),className:Zr,children:[p.jsx("h3",{className:"text-[15px] font-semibold mb-2",children:"Shift"}),p.jsx("p",{className:"text-sm text-[#1e3350]",children:"Configure shifts and assignments"})]}),p.jsxs("div",{onClick:()=>n("/administration/users"),className:Zr,children:[p.jsx("h3",{className:"text-[15px] font-semibold mb-2",children:"Users"}),p.jsx("p",{className:"text-sm text-[#1e3350]",children:"Manage users and their access"})]}),p.jsxs("div",{onClick:()=>n("/administration/camera"),className:Zr,children:[p.jsx("h3",{className:"text-[15px] font-semibold mb-2",children:"Camera"}),p.jsx("p",{className:"text-sm text-[#1e3350]",children:"Manage and assign cameras"})]})]})]}),p.jsxs("div",{children:[p.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Administration"}),p.jsxs("div",{className:"flex flex-wrap gap-6",children:[p.jsxs("div",{onClick:()=>n("/administration/organization"),className:Zr,children:[p.jsx("h3",{className:"text-[15px] font-semibold mb-2",children:"Organisation"}),p.jsx("p",{className:"text-sm text-[#1e3350]",children:"Manage organisation details"})]}),p.jsxs("div",{onClick:()=>n("/administration/plant"),className:Zr,children:[p.jsx("h3",{className:"text-[15px] font-semibold mb-2",children:"Plant"}),p.jsx("p",{className:"text-sm text-[#1e3350]",children:"Manage plant records"})]}),p.jsxs("div",{onClick:()=>n("/administration/unit"),className:Zr,children:[p.jsx("h3",{className:"text-[15px] font-semibold mb-2",children:"Unit"}),p.jsx("p",{className:"text-sm text-[#1e3350]",children:"Manage units"})]}),p.jsxs("div",{onClick:()=>n("/administration/station"),className:Zr,children:[p.jsx("h3",{className:"text-[15px] font-semibold mb-2",children:"Station"}),p.jsx("p",{className:"text-sm text-[#1e3350]",children:"Manage stations"})]})]})]})]})};function _j(n){return Ki({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"},child:[]}]})(n)}function Cj(n){return Ki({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"},child:[]}]})(n)}function Lj(n){return Ki({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"},child:[]}]})(n)}function i_(n){return Ki({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5zM4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25H4.34zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12zm0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7zm7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44zM15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35z"},child:[]}]})(n)}function r_(n){return Ki({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"},child:[]},{tag:"path",attr:{d:"M9 4v16"},child:[]},{tag:"path",attr:{d:"M15 10l-2 2l2 2"},child:[]}]})(n)}function a_(n){return Ki({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"},child:[]},{tag:"path",attr:{d:"M9 4v16"},child:[]},{tag:"path",attr:{d:"M14 10l2 2l-2 2"},child:[]}]})(n)}const wj=256,Rj=80,aE="/xyz/blkwhtlogo.png",Dj=({text:n,x:e,y:t,visible:s})=>typeof document>"u"?null:Ng.createPortal(p.jsxs("div",{style:{position:"fixed",left:e,top:t,transform:"translateY(-50%)",zIndex:9999,pointerEvents:"none",opacity:s?1:0,transition:"opacity 120ms ease, transform 120ms ease"},className:"relative px-3 py-1 rounded-md border border-[#232834] bg-[#1b2131] text-white text-xs shadow-xl whitespace-nowrap",children:[p.jsx("span",{className:`absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 w-2 h-2 rotate-45\r
                   bg-[#1b2131] border-l border-t border-[#232834] shadow-sm`}),n]}),document.body),Ij=({collapsed:n,setCollapsed:e})=>{const t=wr(),s=kn(),r=R.useRef(null),[a,l]=R.useState({text:"",x:0,y:0,visible:!1}),c=R.useCallback((T,E)=>{const _=E.getBoundingClientRect();l({text:T,x:_.right+28,y:_.top+_.height/2,visible:!0})},[]),f=R.useCallback(()=>l(T=>({...T,visible:!1})),[]),d=T=>s.pathname.startsWith(T),h=localStorage.getItem("username"),g=localStorage.getItem("isSuperAdmin")==="true";console.log(" Sidebar Debug  username:",h,"isSuperAdmin:",g);const y=[{label:"Station Report",key:"/station",Icon:i_}];g&&y.push({label:"Admin",key:"/administration",Icon:Cj});const v=T=>{if(!n)return;T.target.closest("button")||e(!1)},b=n?20:22;return p.jsxs(p.Fragment,{children:[p.jsx(Dj,{text:a.text,x:a.x,y:a.y,visible:a.visible}),p.jsxs("aside",{ref:r,className:`\r
          fixed left-0 top-0 h-full\r
          bg-[#0f1420] border-r border-[#162036] shadow-xl\r
          flex flex-col transition-all duration-300\r
          overflow-y-auto overflow-x-hidden\r
          z-[60]\r
        `,style:{width:n?Rj:wj},onClick:v,children:[n?p.jsx("div",{className:"pt-5 pb-4 flex items-center justify-center relative",children:p.jsxs("button",{onClick:()=>e(!1),className:"relative group cursor-pointer outline-none","aria-label":"Expand sidebar",onMouseEnter:T=>c("Expand sidebar",T.currentTarget),onMouseLeave:f,children:[p.jsx("img",{src:aE,alt:"logo",className:"w-12 h-12 object-contain rounded-xl"}),p.jsx("div",{className:"absolute inset-0 rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-150 flex items-center justify-center",children:p.jsx(a_,{size:18,className:"text-white/90"})})]})}):p.jsxs("div",{className:"px-5 pt-6 pb-4 flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("img",{src:aE,alt:"logo",className:"w-[60px] h-[60px] object-contain rounded-2xl"}),p.jsx("span",{className:"font-semibold text-[22px] leading-none text-white tracking-wide select-none",children:"I-Grid"})]}),p.jsx("button",{onClick:()=>{e(!0),l(T=>({...T,visible:!1}))},"aria-label":"Collapse sidebar",className:"relative group inline-flex items-center justify-center h-9 w-9 rounded-xl overflow-hidden",children:p.jsx(r_,{size:18,className:"text-white/90"})})]}),p.jsx("div",{className:"mx-4 mb-3 h-px bg-white/10"}),p.jsx("nav",{className:`${n?"px-0":"px-3"} mt-1`,children:p.jsx("ul",{className:"space-y-1",children:y.map(({label:T,key:E,Icon:_})=>{const A=d(E);return p.jsx("li",{children:p.jsxs("button",{onClick:()=>t(E),className:`flex items-center gap-3 px-4 py-2.5 w-full rounded-lg transition ${A?"text-white font-semibold bg-[rgba(0,148,217,0.24)] border-l-4 border-cyan-500":"text-[#e0e5f5] hover:text-white hover:bg-white/[0.04]"}`,children:[p.jsx(_,{size:b}),!n&&p.jsx("span",{children:T})]})},E)})})})]})]})},oE="/assets/drools-KWoj7Ptm.webp",Nj=({collapsed:n})=>{const[e,t]=R.useState(!1),s=R.useRef(null),r=kn(),a=wr(),l={"/station":"Station Report","/surveillance":"Surveillance Dashboard","/administration":"Admin"},c=r.pathname,f=Object.keys(l).find(b=>c.startsWith(b)),d=f?l[f]:"Admin Panel",h=c.startsWith("/administration/")&&c!=="/administration",g=()=>{window.history.length>1?a(-1):a("/administration")};R.useEffect(()=>{const b=T=>{s.current&&!s.current.contains(T.target)&&t(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[]);const y=()=>{localStorage.removeItem("isLoggedIn"),localStorage.removeItem("isSuperAdmin"),localStorage.removeItem("username"),window.location.href="/login"},v=localStorage.getItem("username")||"User";return p.jsxs("div",{className:`
    fixed top-0 right-0 z-50 transition-all duration-300
    flex items-center justify-between
    bg-[var(--light-bg)] border-b border-[var(--border)] shadow-sm
    px-3 py-2
    md:px-6 md:py-3
  `,style:{minHeight:56,backdropFilter:"saturate(140%) blur(2px)",left:n?80:256},children:[p.jsxs("div",{className:"flex items-center gap-3",children:[h&&p.jsxs("button",{onClick:g,"aria-label":"Back",className:"group relative inline-flex h-9 w-9 items-center justify-center bg-transparent hover:bg-black/5 active:scale-[0.98]",children:[p.jsx(Lj,{size:22}),p.jsx("span",{className:"pointer-events-none absolute -bottom-8 left-1/2 -translate-x-1/2 whitespace-nowrap rounded-md bg-black px-2 py-1 text-xs text-white opacity-0 shadow-md transition-opacity group-hover:opacity-100 z-50",children:"Back"})]}),p.jsx("span",{className:"font-semibold text-2xl tracking-wide select-none text-[var(--dark-blue)]",children:d})]}),p.jsx("div",{className:"flex items-center gap-4 relative",children:p.jsxs("div",{className:"relative",ref:s,children:[p.jsx("img",{src:oE,alt:"Profile",className:"w-9 h-9 rounded-full border cursor-pointer shadow-sm border-[var(--border)]",title:v,onClick:()=>t(b=>!b)}),e&&p.jsxs("div",{className:`\r
                absolute right-0 mt-2 w-60 p-3 rounded-xl z-50\r
                bg-[var(--surface)] border border-[var(--border)] shadow-[var(--card-shadow)]\r
              `,children:[p.jsxs("div",{className:"flex items-center gap-3 px-1 py-2",children:[p.jsx("img",{src:oE,alt:"User",className:"w-10 h-10 rounded-full border border-[var(--border)]"}),p.jsx("div",{children:p.jsx("div",{className:"font-semibold text-[var(--main-text)] leading-tight",children:v})})]}),p.jsx("div",{className:"my-2 h-px bg-[var(--border)]"}),p.jsxs("button",{className:`w-full flex items-center gap-2 text-left text-sm px-3 py-2 rounded-lg\r
                  hover:bg-[#ffe9ee] text-[var(--danger-red)]`,onClick:y,children:[p.jsx(_j,{size:18}),"Sign out"]})]})]})})]})},kj=256,Pj=80,Oj="#0EA5E9",bm="/blkwhtlogo.png",Mj=[{label:"Station Report",key:"/station",Icon:i_}],Sm=`radial-gradient(120% 140% at 30% 15%, rgba(255,255,255,.35) 0%, rgba(255,255,255,.12) 18%, rgba(255,255,255,0) 40%),
   linear-gradient(145deg, #0a2440 0%, #0d6efd 48%, #1493ff 58%, #0a2b4a 100%)`,jj=({text:n,x:e,y:t,visible:s})=>typeof document>"u"?null:Ng.createPortal(p.jsxs("div",{style:{position:"fixed",left:e,top:t,transform:"translateY(-50%)",zIndex:9999,pointerEvents:"none",opacity:s?1:0,transition:"opacity 120ms ease, transform 120ms ease"},className:"relative px-3 py-1 rounded-md border border-[#232834] bg-[#1b2131] text-white text-xs shadow-xl whitespace-nowrap",children:[p.jsx("span",{className:`absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 w-2 h-2 rotate-45\r
                   bg-[#1b2131] border-l border-t border-[#232834] shadow-sm`}),n]}),document.body),Uj=({collapsed:n,setCollapsed:e})=>{const t=wr(),s=kn(),r=R.useRef(null),[a,l]=R.useState({text:"",x:0,y:0,visible:!1}),[c,f]=R.useState(!1),[d,h]=R.useState(!1),g=n&&c&&!d,y=R.useCallback((_,A)=>{const C=A.getBoundingClientRect();l({text:_,x:C.right+28,y:C.top+C.height/2,visible:!0})},[]),v=R.useCallback(()=>l(_=>({..._,visible:!1})),[]),b=_=>s.pathname.startsWith(_),T=_=>{if(!n)return;_.target.closest("button")||e(!1)},E=n?20:22;return p.jsxs(p.Fragment,{children:[p.jsx(jj,{text:a.text,x:a.x,y:a.y,visible:a.visible}),p.jsxs("aside",{ref:r,className:`\r
          fixed left-0 top-0 h-full\r
          bg-[#0f1420] border-r border-[#162036] shadow-xl\r
          flex flex-col transition-all duration-300\r
          overflow-y-auto overflow-x-hidden\r
          z-[60]\r
        `,style:{width:n?Pj:kj},onMouseEnter:()=>f(!0),onMouseLeave:()=>{f(!1),h(!1)},onClick:T,children:[n?p.jsxs("div",{className:"pt-5 pb-4 flex items-center justify-center relative",children:[p.jsx("div",{className:`absolute w-12 h-12 rounded-2xl pointer-events-none transition-opacity duration-300
                          ${g?"opacity-100":"opacity-0"}`,style:{backgroundImage:Sm,boxShadow:"0 10px 24px rgba(20,147,255,0.35), inset 0 1px 0 rgba(255,255,255,0.35)"}}),p.jsxs("button",{onClick:()=>e(!1),className:"relative group cursor-pointer outline-none","aria-label":"Expand sidebar",onMouseEnter:_=>y("Expand sidebar",_.currentTarget),onMouseLeave:v,children:[p.jsx("img",{src:bm,alt:"logo",className:"w-12 h-12 object-contain rounded-xl"}),p.jsx("div",{className:"absolute inset-0 rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-150 flex items-center justify-center",style:{backgroundImage:Sm,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.35), 0 8px 22px rgba(20,147,255,0.35)"},children:p.jsx(a_,{size:18,className:"text-white/90"})})]})]}):p.jsxs("div",{className:"px-5 pt-6 pb-4 flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("img",{src:bm,alt:"logo",className:"w-[60px] h-[60px] object-contain rounded-2xl"}),p.jsx("span",{className:"font-semibold text-[22px] leading-none text-white tracking-wide select-none",children:"I-Grid"})]}),p.jsxs("button",{onClick:()=>{e(!0),l(_=>({..._,visible:!1}))},"aria-label":"Collapse sidebar",className:"relative group inline-flex items-center justify-center h-9 w-9 rounded-xl overflow-hidden",onMouseEnter:_=>y("Collapse sidebar",_.currentTarget),onMouseLeave:v,children:[p.jsx("span",{className:"absolute inset-0 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity",style:{backgroundImage:Sm,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.35), 0 8px 22px rgba(20,147,255,0.35)"}}),p.jsx("span",{className:"relative z-10 flex items-center justify-center h-full w-full",children:p.jsx(r_,{size:18,className:"text-white/90"})})]})]}),p.jsx("div",{className:"mx-4 mb-3 h-px bg-white/10"}),p.jsx("nav",{className:`${n?"px-0":"px-3"} mt-1`,children:p.jsx("ul",{className:"space-y-1",children:Mj.map(({label:_,key:A,Icon:C})=>{const N=b(A);return p.jsx("li",{onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),className:"relative",children:p.jsxs("button",{onClick:()=>t(A),className:n?`
                          flex items-center justify-center
                          w-12 h-12 mx-auto rounded-lg transition
                          ${N?"bg-[rgba(0,148,217,0.18)] text-white shadow":"text-[#c9d3f5] hover:bg-[#1a2440] hover:text-white"}
                        `:`
                          flex items-center gap-3 px-4 py-2.5 w-full rounded-lg transition
                          ${N?"text-white font-semibold":"text-[#e0e5f5] hover:text-white hover:bg-white/[0.04]"}
                        `,"aria-label":_,onMouseEnter:w=>{n&&y(_,w.currentTarget)},onMouseLeave:v,style:{background:!n&&N?"linear-gradient(90deg, rgba(0,148,217,0.24), rgba(0,90,143,0.24))":"transparent",borderLeft:!n&&N?`3px solid ${Oj}`:"3px solid transparent",letterSpacing:n?void 0:".005em"},children:[p.jsx(C,{size:E}),!n&&p.jsx("span",{className:"select-none",children:_})]})},A)})})}),n?p.jsx("div",{className:"mt-auto pb-4 flex justify-center",children:p.jsx("button",{className:"group relative inline-flex items-center justify-center w-9 h-9 rounded-full bg-white/10 border border-white/20 hover:bg-white/20 transition",onMouseEnter:_=>y("Powered by Thingsi  2025",_.currentTarget),onMouseLeave:v,onClick:()=>window.open("https://thingsi.ai","_blank","noopener,noreferrer"),"aria-label":"Powered by Thingsi",children:p.jsx("img",{src:bm,alt:"Thingsi",className:"w-5 h-5 object-contain"})})}):p.jsxs("div",{className:"mt-auto px-5 pt-4 pb-5",children:[p.jsx("div",{className:"h-px bg-white/20 mb-3"}),p.jsxs("div",{className:"text-[12.5px]",children:[p.jsx("span",{className:"text-gray-400",children:"Powered by "}),p.jsx("a",{href:"https://thingsi.ai",target:"_blank",rel:"noreferrer",style:{color:"#fff"},className:"font-semibold underline-offset-2 hover:underline focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/30 rounded-sm",children:"Thingsi"})]})]})]})]})},lE=56,Fj=({children:n})=>{const[e,t]=R.useState(!1),s=wr();R.useEffect(()=>{const f=()=>{const d=window.innerWidth<=768;t(d)};return f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]);const r=typeof window<"u"?localStorage.getItem("userRole"):null,a=r==="superadmin"||r==="admin"||localStorage.getItem("isSuperAdmin")==="true",l=R.useMemo(()=>e?80:256,[e]);R.useEffect(()=>{typeof window<"u"&&(localStorage.getItem("isLoggedIn")==="true"||s("/login",{replace:!0}))},[s]);const c=a?Ij:Uj;return p.jsxs("div",{className:"h-screen w-screen overflow-hidden",style:{background:"var(--light-bg)",color:"var(--main-text)"},children:[p.jsx(c,{collapsed:e,setCollapsed:t}),p.jsx("div",{style:{position:"fixed",top:0,left:l,right:0,height:lE,zIndex:50},children:p.jsx(Nj,{collapsed:e,setCollapsed:t})}),p.jsx("div",{style:{position:"relative",marginLeft:l,paddingTop:lE,height:"100vh",overflowY:"auto",WebkitOverflowScrolling:"touch",background:"var(--light-bg)"},children:p.jsx("div",{className:"px-6 py-6 w-full",children:n})})]})};var Em,cE;function Bj(){return cE||(cE=1,Em=(function(n){var e={};function t(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return n[s].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=n,t.c=e,t.d=function(s,r,a){t.o(s,r)||Object.defineProperty(s,r,{enumerable:!0,get:a})},t.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},t.t=function(s,r){if(1&r&&(s=t(s)),8&r||4&r&&typeof s=="object"&&s&&s.__esModule)return s;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:s}),2&r&&typeof s!="string")for(var l in s)t.d(a,l,(function(c){return s[c]}).bind(null,l));return a},t.n=function(s){var r=s&&s.__esModule?function(){return s.default}:function(){return s};return t.d(r,"a",r),r},t.o=function(s,r){return Object.prototype.hasOwnProperty.call(s,r)},t.p="",t(t.s=9)})([function(n,e){n.exports=fd()},function(n,e,t){var s;/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/(function(){var r={}.hasOwnProperty;function a(){for(var l=[],c=0;c<arguments.length;c++){var f=arguments[c];if(f){var d=typeof f;if(d==="string"||d==="number")l.push(f);else if(Array.isArray(f)&&f.length){var h=a.apply(null,f);h&&l.push(h)}else if(d==="object")for(var g in f)r.call(f,g)&&f[g]&&l.push(g)}}return l.join(" ")}n.exports?(a.default=a,n.exports=a):(s=(function(){return a}).apply(e,[]))===void 0||(n.exports=s)})()},function(n,e,t){(function(s){var r=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,f=parseInt,d=typeof s=="object"&&s&&s.Object===Object&&s,h=typeof self=="object"&&self&&self.Object===Object&&self,g=d||h||Function("return this")(),y=Object.prototype.toString,v=g.Symbol,b=v?v.prototype:void 0,T=b?b.toString:void 0;function E(N){if(typeof N=="string")return N;if(A(N))return T?T.call(N):"";var w=N+"";return w=="0"&&1/N==-1/0?"-0":w}function _(N){var w=typeof N;return!!N&&(w=="object"||w=="function")}function A(N){return typeof N=="symbol"||(function(w){return!!w&&typeof w=="object"})(N)&&y.call(N)=="[object Symbol]"}function C(N){return N?(N=(function(w){if(typeof w=="number")return w;if(A(w))return NaN;if(_(w)){var G=typeof w.valueOf=="function"?w.valueOf():w;w=_(G)?G+"":G}if(typeof w!="string")return w===0?w:+w;w=w.replace(r,"");var M=l.test(w);return M||c.test(w)?f(w.slice(2),M?2:8):a.test(w)?NaN:+w})(N))===1/0||N===-1/0?17976931348623157e292*(N<0?-1:1):N==N?N:0:N===0?N:0}n.exports=function(N,w,G){var M,B,K,V;return N=(M=N)==null?"":E(M),B=(function($){var ee=C($),he=ee%1;return ee==ee?he?ee-he:ee:0})(G),K=0,V=N.length,B==B&&(V!==void 0&&(B=B<=V?B:V),K!==void 0&&(B=B>=K?B:K)),G=B,w=E(w),N.slice(G,G+w.length)==w}}).call(this,t(3))},function(n,e){var t;t=(function(){return this})();try{t=t||new Function("return this")()}catch{typeof window=="object"&&(t=window)}n.exports=t},function(n,e,t){(function(s){var r=/^\[object .+?Constructor\]$/,a=typeof s=="object"&&s&&s.Object===Object&&s,l=typeof self=="object"&&self&&self.Object===Object&&self,c=a||l||Function("return this")(),f,d=Array.prototype,h=Function.prototype,g=Object.prototype,y=c["__core-js_shared__"],v=(f=/[^.]+$/.exec(y&&y.keys&&y.keys.IE_PROTO||""))?"Symbol(src)_1."+f:"",b=h.toString,T=g.hasOwnProperty,E=g.toString,_=RegExp("^"+b.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),A=d.splice,C=$(c,"Map"),N=$(Object,"create");function w(Z){var H=-1,k=Z?Z.length:0;for(this.clear();++H<k;){var F=Z[H];this.set(F[0],F[1])}}function G(Z){var H=-1,k=Z?Z.length:0;for(this.clear();++H<k;){var F=Z[H];this.set(F[0],F[1])}}function M(Z){var H=-1,k=Z?Z.length:0;for(this.clear();++H<k;){var F=Z[H];this.set(F[0],F[1])}}function B(Z,H){for(var k,F,O=Z.length;O--;)if((k=Z[O][0])===(F=H)||k!=k&&F!=F)return O;return-1}function K(Z){return!(!he(Z)||(H=Z,v&&v in H))&&((function(k){var F=he(k)?E.call(k):"";return F=="[object Function]"||F=="[object GeneratorFunction]"})(Z)||(function(k){var F=!1;if(k!=null&&typeof k.toString!="function")try{F=!!(k+"")}catch{}return F})(Z)?_:r).test((function(k){if(k!=null){try{return b.call(k)}catch{}try{return k+""}catch{}}return""})(Z));var H}function V(Z,H){var k,F,O=Z.__data__;return((F=typeof(k=H))=="string"||F=="number"||F=="symbol"||F=="boolean"?k!=="__proto__":k===null)?O[typeof H=="string"?"string":"hash"]:O.map}function $(Z,H){var k=(function(F,O){return F?.[O]})(Z,H);return K(k)?k:void 0}function ee(Z,H){if(typeof Z!="function"||H&&typeof H!="function")throw new TypeError("Expected a function");var k=function(){var F=arguments,O=H?H.apply(this,F):F[0],Y=k.cache;if(Y.has(O))return Y.get(O);var I=Z.apply(this,F);return k.cache=Y.set(O,I),I};return k.cache=new(ee.Cache||M),k}function he(Z){var H=typeof Z;return!!Z&&(H=="object"||H=="function")}w.prototype.clear=function(){this.__data__=N?N(null):{}},w.prototype.delete=function(Z){return this.has(Z)&&delete this.__data__[Z]},w.prototype.get=function(Z){var H=this.__data__;if(N){var k=H[Z];return k==="__lodash_hash_undefined__"?void 0:k}return T.call(H,Z)?H[Z]:void 0},w.prototype.has=function(Z){var H=this.__data__;return N?H[Z]!==void 0:T.call(H,Z)},w.prototype.set=function(Z,H){return this.__data__[Z]=N&&H===void 0?"__lodash_hash_undefined__":H,this},G.prototype.clear=function(){this.__data__=[]},G.prototype.delete=function(Z){var H=this.__data__,k=B(H,Z);return!(k<0)&&(k==H.length-1?H.pop():A.call(H,k,1),!0)},G.prototype.get=function(Z){var H=this.__data__,k=B(H,Z);return k<0?void 0:H[k][1]},G.prototype.has=function(Z){return B(this.__data__,Z)>-1},G.prototype.set=function(Z,H){var k=this.__data__,F=B(k,Z);return F<0?k.push([Z,H]):k[F][1]=H,this},M.prototype.clear=function(){this.__data__={hash:new w,map:new(C||G),string:new w}},M.prototype.delete=function(Z){return V(this,Z).delete(Z)},M.prototype.get=function(Z){return V(this,Z).get(Z)},M.prototype.has=function(Z){return V(this,Z).has(Z)},M.prototype.set=function(Z,H){return V(this,Z).set(Z,H),this},ee.Cache=M,n.exports=ee}).call(this,t(3))},function(n,e,t){(function(s){var r=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,f=parseInt,d=typeof s=="object"&&s&&s.Object===Object&&s,h=typeof self=="object"&&self&&self.Object===Object&&self,g=d||h||Function("return this")(),y=Object.prototype.toString,v=Math.max,b=Math.min,T=function(){return g.Date.now()};function E(A){var C=typeof A;return!!A&&(C=="object"||C=="function")}function _(A){if(typeof A=="number")return A;if((function(w){return typeof w=="symbol"||(function(G){return!!G&&typeof G=="object"})(w)&&y.call(w)=="[object Symbol]"})(A))return NaN;if(E(A)){var C=typeof A.valueOf=="function"?A.valueOf():A;A=E(C)?C+"":C}if(typeof A!="string")return A===0?A:+A;A=A.replace(r,"");var N=l.test(A);return N||c.test(A)?f(A.slice(2),N?2:8):a.test(A)?NaN:+A}n.exports=function(A,C,N){var w,G,M,B,K,V,$=0,ee=!1,he=!1,Z=!0;if(typeof A!="function")throw new TypeError("Expected a function");function H(j){var z=w,J=G;return w=G=void 0,$=j,B=A.apply(J,z)}function k(j){return $=j,K=setTimeout(O,C),ee?H(j):B}function F(j){var z=j-V;return V===void 0||z>=C||z<0||he&&j-$>=M}function O(){var j=T();if(F(j))return Y(j);K=setTimeout(O,(function(z){var J=C-(z-V);return he?b(J,M-(z-$)):J})(j))}function Y(j){return K=void 0,Z&&w?H(j):(w=G=void 0,B)}function I(){var j=T(),z=F(j);if(w=arguments,G=this,V=j,z){if(K===void 0)return k(V);if(he)return K=setTimeout(O,C),H(V)}return K===void 0&&(K=setTimeout(O,C)),B}return C=_(C)||0,E(N)&&(ee=!!N.leading,M=(he="maxWait"in N)?v(_(N.maxWait)||0,C):M,Z="trailing"in N?!!N.trailing:Z),I.cancel=function(){K!==void 0&&clearTimeout(K),$=0,w=V=G=K=void 0},I.flush=function(){return K===void 0?B:Y(T())},I}}).call(this,t(3))},function(n,e,t){(function(s,r){var a="[object Arguments]",l="[object Map]",c="[object Object]",f="[object Set]",d=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,h=/^\w*$/,g=/^\./,y=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,v=/\\(\\)?/g,b=/^\[object .+?Constructor\]$/,T=/^(?:0|[1-9]\d*)$/,E={};E["[object Float32Array]"]=E["[object Float64Array]"]=E["[object Int8Array]"]=E["[object Int16Array]"]=E["[object Int32Array]"]=E["[object Uint8Array]"]=E["[object Uint8ClampedArray]"]=E["[object Uint16Array]"]=E["[object Uint32Array]"]=!0,E[a]=E["[object Array]"]=E["[object ArrayBuffer]"]=E["[object Boolean]"]=E["[object DataView]"]=E["[object Date]"]=E["[object Error]"]=E["[object Function]"]=E[l]=E["[object Number]"]=E[c]=E["[object RegExp]"]=E[f]=E["[object String]"]=E["[object WeakMap]"]=!1;var _=typeof s=="object"&&s&&s.Object===Object&&s,A=typeof self=="object"&&self&&self.Object===Object&&self,C=_||A||Function("return this")(),N=e&&!e.nodeType&&e,w=N&&typeof r=="object"&&r&&!r.nodeType&&r,G=w&&w.exports===N&&_.process,M=(function(){try{return G&&G.binding("util")}catch{}})(),B=M&&M.isTypedArray;function K(X,ge,ve,Oe){var Ze=-1,et=X?X.length:0;for(Oe&&et&&(ve=X[++Ze]);++Ze<et;)ve=ge(ve,X[Ze],Ze,X);return ve}function V(X,ge){for(var ve=-1,Oe=X?X.length:0;++ve<Oe;)if(ge(X[ve],ve,X))return!0;return!1}function $(X,ge,ve,Oe,Ze){return Ze(X,(function(et,at,Rt){ve=Oe?(Oe=!1,et):ge(ve,et,at,Rt)})),ve}function ee(X){var ge=!1;if(X!=null&&typeof X.toString!="function")try{ge=!!(X+"")}catch{}return ge}function he(X){var ge=-1,ve=Array(X.size);return X.forEach((function(Oe,Ze){ve[++ge]=[Ze,Oe]})),ve}function Z(X){var ge=-1,ve=Array(X.size);return X.forEach((function(Oe){ve[++ge]=Oe})),ve}var H,k,F,O=Array.prototype,Y=Function.prototype,I=Object.prototype,j=C["__core-js_shared__"],z=(H=/[^.]+$/.exec(j&&j.keys&&j.keys.IE_PROTO||""))?"Symbol(src)_1."+H:"",J=Y.toString,q=I.hasOwnProperty,P=I.toString,de=RegExp("^"+J.call(q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_e=C.Symbol,Le=C.Uint8Array,Fe=I.propertyIsEnumerable,$e=O.splice,pe=(k=Object.keys,F=Object,function(X){return k(F(X))}),Ne=Mn(C,"DataView"),Ve=Mn(C,"Map"),Ge=Mn(C,"Promise"),le=Mn(C,"Set"),W=Mn(C,"WeakMap"),te=Mn(Object,"create"),be=De(Ne),Ie=De(Ve),Ue=De(Ge),Ke=De(le),We=De(W),ae=_e?_e.prototype:void 0,ie=ae?ae.valueOf:void 0,we=ae?ae.toString:void 0;function Ae(X){var ge=-1,ve=X?X.length:0;for(this.clear();++ge<ve;){var Oe=X[ge];this.set(Oe[0],Oe[1])}}function Me(X){var ge=-1,ve=X?X.length:0;for(this.clear();++ge<ve;){var Oe=X[ge];this.set(Oe[0],Oe[1])}}function mt(X){var ge=-1,ve=X?X.length:0;for(this.clear();++ge<ve;){var Oe=X[ge];this.set(Oe[0],Oe[1])}}function _t(X){var ge=-1,ve=X?X.length:0;for(this.__data__=new mt;++ge<ve;)this.add(X[ge])}function jt(X){this.__data__=new Me(X)}function ts(X,ge){var ve=St(X)||tt(X)?(function(at,Rt){for(var vt=-1,Ct=Array(at);++vt<at;)Ct[vt]=Rt(vt);return Ct})(X.length,String):[],Oe=ve.length,Ze=!!Oe;for(var et in X)!q.call(X,et)||Ze&&(et=="length"||zi(et,Oe))||ve.push(et);return ve}function Ys(X,ge){for(var ve=X.length;ve--;)if(qe(X[ve][0],ge))return ve;return-1}Ae.prototype.clear=function(){this.__data__=te?te(null):{}},Ae.prototype.delete=function(X){return this.has(X)&&delete this.__data__[X]},Ae.prototype.get=function(X){var ge=this.__data__;if(te){var ve=ge[X];return ve==="__lodash_hash_undefined__"?void 0:ve}return q.call(ge,X)?ge[X]:void 0},Ae.prototype.has=function(X){var ge=this.__data__;return te?ge[X]!==void 0:q.call(ge,X)},Ae.prototype.set=function(X,ge){return this.__data__[X]=te&&ge===void 0?"__lodash_hash_undefined__":ge,this},Me.prototype.clear=function(){this.__data__=[]},Me.prototype.delete=function(X){var ge=this.__data__,ve=Ys(ge,X);return!(ve<0)&&(ve==ge.length-1?ge.pop():$e.call(ge,ve,1),!0)},Me.prototype.get=function(X){var ge=this.__data__,ve=Ys(ge,X);return ve<0?void 0:ge[ve][1]},Me.prototype.has=function(X){return Ys(this.__data__,X)>-1},Me.prototype.set=function(X,ge){var ve=this.__data__,Oe=Ys(ve,X);return Oe<0?ve.push([X,ge]):ve[Oe][1]=ge,this},mt.prototype.clear=function(){this.__data__={hash:new Ae,map:new(Ve||Me),string:new Ae}},mt.prototype.delete=function(X){return vi(this,X).delete(X)},mt.prototype.get=function(X){return vi(this,X).get(X)},mt.prototype.has=function(X){return vi(this,X).has(X)},mt.prototype.set=function(X,ge){return vi(this,X).set(X,ge),this},_t.prototype.add=_t.prototype.push=function(X){return this.__data__.set(X,"__lodash_hash_undefined__"),this},_t.prototype.has=function(X){return this.__data__.has(X)},jt.prototype.clear=function(){this.__data__=new Me},jt.prototype.delete=function(X){return this.__data__.delete(X)},jt.prototype.get=function(X){return this.__data__.get(X)},jt.prototype.has=function(X){return this.__data__.has(X)},jt.prototype.set=function(X,ge){var ve=this.__data__;if(ve instanceof Me){var Oe=ve.__data__;if(!Ve||Oe.length<199)return Oe.push([X,ge]),this;ve=this.__data__=new mt(Oe)}return ve.set(X,ge),this};var Os,Dt=(Os=function(X,ge){return X&&Ms(X,ge,Zn)},function(X,ge){if(X==null)return X;if(!At(X))return Os(X,ge);for(var ve=X.length,Oe=-1,Ze=Object(X);++Oe<ve&&ge(Ze[Oe],Oe,Ze)!==!1;);return X}),Ms=(function(X){return function(ge,ve,Oe){for(var Ze=-1,et=Object(ge),at=Oe(ge),Rt=at.length;Rt--;){var vt=at[++Ze];if(ve(et[vt],vt,et)===!1)break}return ge}})();function yn(X,ge){for(var ve=0,Oe=(ge=ne(ge,X)?[ge]:ps(ge)).length;X!=null&&ve<Oe;)X=X[ze(ge[ve++])];return ve&&ve==Oe?X:void 0}function On(X,ge){return X!=null&&ge in Object(X)}function xi(X,ge,ve,Oe,Ze){return X===ge||(X==null||ge==null||!js(X)&&!Ts(ge)?X!=X&&ge!=ge:(function(et,at,Rt,vt,Ct,bt){var ys=St(et),as=St(at),Wt="[object Array]",us="[object Array]";ys||(Wt=(Wt=qs(et))==a?c:Wt),as||(us=(us=qs(at))==a?c:us);var Ws=Wt==c&&!ee(et),xs=us==c&&!ee(at),jn=Wt==us;if(jn&&!Ws)return bt||(bt=new jt),ys||Vt(et)?vn(et,at,Rt,vt,Ct,bt):(function(It,ct,Nr,Jn,Yi,ds,bn){switch(Nr){case"[object DataView]":if(It.byteLength!=ct.byteLength||It.byteOffset!=ct.byteOffset)return!1;It=It.buffer,ct=ct.buffer;case"[object ArrayBuffer]":return!(It.byteLength!=ct.byteLength||!Jn(new Le(It),new Le(ct)));case"[object Boolean]":case"[object Date]":case"[object Number]":return qe(+It,+ct);case"[object Error]":return It.name==ct.name&&It.message==ct.message;case"[object RegExp]":case"[object String]":return It==ct+"";case l:var Un=he;case f:var Sn=2&ds;if(Un||(Un=Z),It.size!=ct.size&&!Sn)return!1;var fa=bn.get(It);if(fa)return fa==ct;ds|=1,bn.set(It,ct);var bi=vn(Un(It),Un(ct),Jn,Yi,ds,bn);return bn.delete(It),bi;case"[object Symbol]":if(ie)return ie.call(It)==ie.call(ct)}return!1})(et,at,Wt,Rt,vt,Ct,bt);if(!(2&Ct)){var tc=Ws&&q.call(et,"__wrapped__"),Ir=xs&&q.call(at,"__wrapped__");if(tc||Ir){var sc=tc?et.value():et,da=Ir?at.value():at;return bt||(bt=new jt),Rt(sc,da,vt,Ct,bt)}}return jn?(bt||(bt=new jt),(function(It,ct,Nr,Jn,Yi,ds){var bn=2&Yi,Un=Zn(It),Sn=Un.length,fa=Zn(ct).length;if(Sn!=fa&&!bn)return!1;for(var bi=Sn;bi--;){var Fn=Un[bi];if(!(bn?Fn in ct:q.call(ct,Fn)))return!1}var ha=ds.get(It);if(ha&&ds.get(ct))return ha==ct;var ma=!0;ds.set(It,ct),ds.set(ct,It);for(var vo=bn;++bi<Sn;){Fn=Un[bi];var Si=It[Fn],qi=ct[Fn];if(Jn)var ga=bn?Jn(qi,Si,Fn,ct,It,ds):Jn(Si,qi,Fn,It,ct,ds);if(!(ga===void 0?Si===qi||Nr(Si,qi,Jn,Yi,ds):ga)){ma=!1;break}vo||(vo=Fn=="constructor")}if(ma&&!vo){var Bn=It.constructor,$n=ct.constructor;Bn==$n||!("constructor"in It)||!("constructor"in ct)||typeof Bn=="function"&&Bn instanceof Bn&&typeof $n=="function"&&$n instanceof $n||(ma=!1)}return ds.delete(It),ds.delete(ct),ma})(et,at,Rt,vt,Ct,bt)):!1})(X,ge,xi,ve,Oe,Ze))}function Wn(X){return!(!js(X)||(function(ge){return!!z&&z in ge})(X))&&(Xs(X)||ee(X)?de:b).test(De(X))}function Qn(X){return typeof X=="function"?X:X==null?ua:typeof X=="object"?St(X)?(function(Oe,Ze){return ne(Oe)&&Re(Ze)?ke(ze(Oe),Ze):function(et){var at=(function(Rt,vt,Ct){var bt=Rt==null?void 0:yn(Rt,vt);return bt===void 0?Ct:bt})(et,Oe);return at===void 0&&at===Ze?(function(Rt,vt){return Rt!=null&&(function(Ct,bt,ys){bt=ne(bt,Ct)?[bt]:ps(bt);for(var as,Wt=-1,us=bt.length;++Wt<us;){var Ws=ze(bt[Wt]);if(!(as=Ct!=null&&ys(Ct,Ws)))break;Ct=Ct[Ws]}return as||!!(us=Ct?Ct.length:0)&&ws(us)&&zi(Ws,us)&&(St(Ct)||tt(Ct))})(Rt,vt,On)})(et,Oe):xi(Ze,at,void 0,3)}})(X[0],X[1]):(function(Oe){var Ze=(function(et){for(var at=Zn(et),Rt=at.length;Rt--;){var vt=at[Rt],Ct=et[vt];at[Rt]=[vt,Ct,Re(Ct)]}return at})(Oe);return Ze.length==1&&Ze[0][2]?ke(Ze[0][0],Ze[0][1]):function(et){return et===Oe||(function(at,Rt,vt,Ct){var bt=vt.length,ys=bt;if(at==null)return!ys;for(at=Object(at);bt--;){var as=vt[bt];if(as[2]?as[1]!==at[as[0]]:!(as[0]in at))return!1}for(;++bt<ys;){var Wt=(as=vt[bt])[0],us=at[Wt],Ws=as[1];if(as[2]){if(us===void 0&&!(Wt in at))return!1}else{var xs=new jt,jn;if(!(jn===void 0?xi(Ws,us,Ct,3,xs):jn))return!1}}return!0})(et,Oe,Ze)}})(X):ne(ge=X)?(ve=ze(ge),function(Oe){return Oe?.[ve]}):(function(Oe){return function(Ze){return yn(Ze,Oe)}})(ge);var ge,ve}function xn(X){if(ve=(ge=X)&&ge.constructor,Oe=typeof ve=="function"&&ve.prototype||I,ge!==Oe)return pe(X);var ge,ve,Oe,Ze=[];for(var et in Object(X))q.call(X,et)&&et!="constructor"&&Ze.push(et);return Ze}function ps(X){return St(X)?X:je(X)}function vn(X,ge,ve,Oe,Ze,et){var at=2&Ze,Rt=X.length,vt=ge.length;if(Rt!=vt&&!(at&&vt>Rt))return!1;var Ct=et.get(X);if(Ct&&et.get(ge))return Ct==ge;var bt=-1,ys=!0,as=1&Ze?new _t:void 0;for(et.set(X,ge),et.set(ge,X);++bt<Rt;){var Wt=X[bt],us=ge[bt];if(Oe)var Ws=at?Oe(us,Wt,bt,ge,X,et):Oe(Wt,us,bt,X,ge,et);if(Ws!==void 0){if(Ws)continue;ys=!1;break}if(as){if(!V(ge,(function(xs,jn){if(!as.has(jn)&&(Wt===xs||ve(Wt,xs,Oe,Ze,et)))return as.add(jn)}))){ys=!1;break}}else if(Wt!==us&&!ve(Wt,us,Oe,Ze,et)){ys=!1;break}}return et.delete(X),et.delete(ge),ys}function vi(X,ge){var ve,Oe,Ze=X.__data__;return((Oe=typeof(ve=ge))=="string"||Oe=="number"||Oe=="symbol"||Oe=="boolean"?ve!=="__proto__":ve===null)?Ze[typeof ge=="string"?"string":"hash"]:Ze.map}function Mn(X,ge){var ve=(function(Oe,Ze){return Oe?.[Ze]})(X,ge);return Wn(ve)?ve:void 0}var qs=function(X){return P.call(X)};function zi(X,ge){return!!(ge=ge??9007199254740991)&&(typeof X=="number"||T.test(X))&&X>-1&&X%1==0&&X<ge}function ne(X,ge){if(St(X))return!1;var ve=typeof X;return!(ve!="number"&&ve!="symbol"&&ve!="boolean"&&X!=null&&!Et(X))||h.test(X)||!d.test(X)||ge!=null&&X in Object(ge)}function Re(X){return X==X&&!js(X)}function ke(X,ge){return function(ve){return ve!=null&&ve[X]===ge&&(ge!==void 0||X in Object(ve))}}(Ne&&qs(new Ne(new ArrayBuffer(1)))!="[object DataView]"||Ve&&qs(new Ve)!=l||Ge&&qs(Ge.resolve())!="[object Promise]"||le&&qs(new le)!=f||W&&qs(new W)!="[object WeakMap]")&&(qs=function(X){var ge=P.call(X),ve=ge==c?X.constructor:void 0,Oe=ve?De(ve):void 0;if(Oe)switch(Oe){case be:return"[object DataView]";case Ie:return l;case Ue:return"[object Promise]";case Ke:return f;case We:return"[object WeakMap]"}return ge});var je=Pe((function(X){var ge;X=(ge=X)==null?"":(function(Oe){if(typeof Oe=="string")return Oe;if(Et(Oe))return we?we.call(Oe):"";var Ze=Oe+"";return Ze=="0"&&1/Oe==-1/0?"-0":Ze})(ge);var ve=[];return g.test(X)&&ve.push(""),X.replace(y,(function(Oe,Ze,et,at){ve.push(et?at.replace(v,"$1"):Ze||Oe)})),ve}));function ze(X){if(typeof X=="string"||Et(X))return X;var ge=X+"";return ge=="0"&&1/X==-1/0?"-0":ge}function De(X){if(X!=null){try{return J.call(X)}catch{}try{return X+""}catch{}}return""}function Pe(X,ge){if(typeof X!="function"||ge&&typeof ge!="function")throw new TypeError("Expected a function");var ve=function(){var Oe=arguments,Ze=ge?ge.apply(this,Oe):Oe[0],et=ve.cache;if(et.has(Ze))return et.get(Ze);var at=X.apply(this,Oe);return ve.cache=et.set(Ze,at),at};return ve.cache=new(Pe.Cache||mt),ve}function qe(X,ge){return X===ge||X!=X&&ge!=ge}function tt(X){return(function(ge){return Ts(ge)&&At(ge)})(X)&&q.call(X,"callee")&&(!Fe.call(X,"callee")||P.call(X)==a)}Pe.Cache=mt;var St=Array.isArray;function At(X){return X!=null&&ws(X.length)&&!Xs(X)}function Xs(X){var ge=js(X)?P.call(X):"";return ge=="[object Function]"||ge=="[object GeneratorFunction]"}function ws(X){return typeof X=="number"&&X>-1&&X%1==0&&X<=9007199254740991}function js(X){var ge=typeof X;return!!X&&(ge=="object"||ge=="function")}function Ts(X){return!!X&&typeof X=="object"}function Et(X){return typeof X=="symbol"||Ts(X)&&P.call(X)=="[object Symbol]"}var Vt=B?(function(X){return function(ge){return X(ge)}})(B):function(X){return Ts(X)&&ws(X.length)&&!!E[P.call(X)]};function Zn(X){return At(X)?ts(X):xn(X)}function ua(X){return X}r.exports=function(X,ge,ve){var Oe=St(X)?K:$,Ze=arguments.length<3;return Oe(X,Qn(ge),ve,Ze,Dt)}}).call(this,t(3),t(7)(n))},function(n,e){n.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(n,e){String.prototype.padEnd||(String.prototype.padEnd=function(t,s){return t>>=0,s=String(s!==void 0?s:" "),this.length>t?String(this):((t-=this.length)>s.length&&(s+=s.repeat(t/s.length)),String(this)+s.slice(0,t))})},function(n,e,t){function s(I,j,z){return j in I?Object.defineProperty(I,j,{value:z,enumerable:!0,configurable:!0,writable:!0}):I[j]=z,I}function r(I){if(Symbol.iterator in Object(I)||Object.prototype.toString.call(I)==="[object Arguments]")return Array.from(I)}function a(I){return(function(j){if(Array.isArray(j)){for(var z=0,J=new Array(j.length);z<j.length;z++)J[z]=j[z];return J}})(I)||r(I)||(function(){throw new TypeError("Invalid attempt to spread non-iterable instance")})()}function l(I){if(Array.isArray(I))return I}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function f(I,j){if(!(I instanceof j))throw new TypeError("Cannot call a class as a function")}function d(I,j){for(var z=0;z<j.length;z++){var J=j[z];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(I,J.key,J)}}function h(I){return(h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(j){return typeof j}:function(j){return j&&typeof Symbol=="function"&&j.constructor===Symbol&&j!==Symbol.prototype?"symbol":typeof j})(I)}function g(I){return(g=typeof Symbol=="function"&&h(Symbol.iterator)==="symbol"?function(j){return h(j)}:function(j){return j&&typeof Symbol=="function"&&j.constructor===Symbol&&j!==Symbol.prototype?"symbol":h(j)})(I)}function y(I){if(I===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I}function v(I){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(j){return j.__proto__||Object.getPrototypeOf(j)})(I)}function b(I,j){return(b=Object.setPrototypeOf||function(z,J){return z.__proto__=J,z})(I,j)}t.r(e);var T=t(0),E=t.n(T),_=t(5),A=t.n(_),C=t(4),N=t.n(C),w=t(6),G=t.n(w),M=t(2),B=t.n(M),K=t(1),V=t.n(K);t(8);function $(I,j){return l(I)||(function(z,J){var q=[],P=!0,de=!1,_e=void 0;try{for(var Le,Fe=z[Symbol.iterator]();!(P=(Le=Fe.next()).done)&&(q.push(Le.value),!J||q.length!==J);P=!0);}catch($e){de=!0,_e=$e}finally{try{P||Fe.return==null||Fe.return()}finally{if(de)throw _e}}return q})(I,j)||c()}var ee=[["Afghanistan",["asia"],"af","93"],["Albania",["europe"],"al","355"],["Algeria",["africa","north-africa"],"dz","213"],["Andorra",["europe"],"ad","376"],["Angola",["africa"],"ao","244"],["Antigua and Barbuda",["america","carribean"],"ag","1268"],["Argentina",["america","south-america"],"ar","54","(..) ........",0,["11","221","223","261","264","2652","280","2905","291","2920","2966","299","341","342","343","351","376","379","381","3833","385","387","388"]],["Armenia",["asia","ex-ussr"],"am","374",".. ......"],["Aruba",["america","carribean"],"aw","297"],["Australia",["oceania"],"au","61","(..) .... ....",0,["2","3","4","7","8","02","03","04","07","08"]],["Austria",["europe","eu-union"],"at","43"],["Azerbaijan",["asia","ex-ussr"],"az","994","(..) ... .. .."],["Bahamas",["america","carribean"],"bs","1242"],["Bahrain",["middle-east"],"bh","973"],["Bangladesh",["asia"],"bd","880"],["Barbados",["america","carribean"],"bb","1246"],["Belarus",["europe","ex-ussr"],"by","375","(..) ... .. .."],["Belgium",["europe","eu-union"],"be","32","... .. .. .."],["Belize",["america","central-america"],"bz","501"],["Benin",["africa"],"bj","229"],["Bhutan",["asia"],"bt","975"],["Bolivia",["america","south-america"],"bo","591"],["Bosnia and Herzegovina",["europe","ex-yugos"],"ba","387"],["Botswana",["africa"],"bw","267"],["Brazil",["america","south-america"],"br","55","(..) ........."],["British Indian Ocean Territory",["asia"],"io","246"],["Brunei",["asia"],"bn","673"],["Bulgaria",["europe","eu-union"],"bg","359"],["Burkina Faso",["africa"],"bf","226"],["Burundi",["africa"],"bi","257"],["Cambodia",["asia"],"kh","855"],["Cameroon",["africa"],"cm","237"],["Canada",["america","north-america"],"ca","1","(...) ...-....",1,["204","226","236","249","250","289","306","343","365","387","403","416","418","431","437","438","450","506","514","519","548","579","581","587","604","613","639","647","672","705","709","742","778","780","782","807","819","825","867","873","902","905"]],["Cape Verde",["africa"],"cv","238"],["Caribbean Netherlands",["america","carribean"],"bq","599","",1],["Central African Republic",["africa"],"cf","236"],["Chad",["africa"],"td","235"],["Chile",["america","south-america"],"cl","56"],["China",["asia"],"cn","86","..-........."],["Colombia",["america","south-america"],"co","57","... ... ...."],["Comoros",["africa"],"km","269"],["Congo",["africa"],"cd","243"],["Congo",["africa"],"cg","242"],["Costa Rica",["america","central-america"],"cr","506","....-...."],["Cte dIvoire",["africa"],"ci","225",".. .. .. .."],["Croatia",["europe","eu-union","ex-yugos"],"hr","385"],["Cuba",["america","carribean"],"cu","53"],["Curaao",["america","carribean"],"cw","599","",0],["Cyprus",["europe","eu-union"],"cy","357",".. ......"],["Czech Republic",["europe","eu-union"],"cz","420","... ... ..."],["Denmark",["europe","eu-union","baltic"],"dk","45",".. .. .. .."],["Djibouti",["africa"],"dj","253"],["Dominica",["america","carribean"],"dm","1767"],["Dominican Republic",["america","carribean"],"do","1","",2,["809","829","849"]],["Ecuador",["america","south-america"],"ec","593"],["Egypt",["africa","north-africa"],"eg","20"],["El Salvador",["america","central-america"],"sv","503","....-...."],["Equatorial Guinea",["africa"],"gq","240"],["Eritrea",["africa"],"er","291"],["Estonia",["europe","eu-union","ex-ussr","baltic"],"ee","372",".... ......"],["Ethiopia",["africa"],"et","251"],["Fiji",["oceania"],"fj","679"],["Finland",["europe","eu-union","baltic"],"fi","358",".. ... .. .."],["France",["europe","eu-union"],"fr","33",". .. .. .. .."],["French Guiana",["america","south-america"],"gf","594"],["French Polynesia",["oceania"],"pf","689"],["Gabon",["africa"],"ga","241"],["Gambia",["africa"],"gm","220"],["Georgia",["asia","ex-ussr"],"ge","995"],["Germany",["europe","eu-union","baltic"],"de","49",".... ........"],["Ghana",["africa"],"gh","233"],["Greece",["europe","eu-union"],"gr","30"],["Grenada",["america","carribean"],"gd","1473"],["Guadeloupe",["america","carribean"],"gp","590","",0],["Guam",["oceania"],"gu","1671"],["Guatemala",["america","central-america"],"gt","502","....-...."],["Guinea",["africa"],"gn","224"],["Guinea-Bissau",["africa"],"gw","245"],["Guyana",["america","south-america"],"gy","592"],["Haiti",["america","carribean"],"ht","509","....-...."],["Honduras",["america","central-america"],"hn","504"],["Hong Kong",["asia"],"hk","852",".... ...."],["Hungary",["europe","eu-union"],"hu","36"],["Iceland",["europe"],"is","354","... ...."],["India",["asia"],"in","91",".....-....."],["Indonesia",["asia"],"id","62"],["Iran",["middle-east"],"ir","98","... ... ...."],["Iraq",["middle-east"],"iq","964"],["Ireland",["europe","eu-union"],"ie","353",".. ......."],["Israel",["middle-east"],"il","972","... ... ...."],["Italy",["europe","eu-union"],"it","39","... .......",0],["Jamaica",["america","carribean"],"jm","1876"],["Japan",["asia"],"jp","81",".. .... ...."],["Jordan",["middle-east"],"jo","962"],["Kazakhstan",["asia","ex-ussr"],"kz","7","... ...-..-..",1,["310","311","312","313","315","318","321","324","325","326","327","336","7172","73622"]],["Kenya",["africa"],"ke","254"],["Kiribati",["oceania"],"ki","686"],["Kosovo",["europe","ex-yugos"],"xk","383"],["Kuwait",["middle-east"],"kw","965"],["Kyrgyzstan",["asia","ex-ussr"],"kg","996","... ... ..."],["Laos",["asia"],"la","856"],["Latvia",["europe","eu-union","ex-ussr","baltic"],"lv","371",".. ... ..."],["Lebanon",["middle-east"],"lb","961"],["Lesotho",["africa"],"ls","266"],["Liberia",["africa"],"lr","231"],["Libya",["africa","north-africa"],"ly","218"],["Liechtenstein",["europe"],"li","423"],["Lithuania",["europe","eu-union","ex-ussr","baltic"],"lt","370"],["Luxembourg",["europe","eu-union"],"lu","352"],["Macau",["asia"],"mo","853"],["Macedonia",["europe","ex-yugos"],"mk","389"],["Madagascar",["africa"],"mg","261"],["Malawi",["africa"],"mw","265"],["Malaysia",["asia"],"my","60","..-....-...."],["Maldives",["asia"],"mv","960"],["Mali",["africa"],"ml","223"],["Malta",["europe","eu-union"],"mt","356"],["Marshall Islands",["oceania"],"mh","692"],["Martinique",["america","carribean"],"mq","596"],["Mauritania",["africa"],"mr","222"],["Mauritius",["africa"],"mu","230"],["Mexico",["america","central-america"],"mx","52","... ... ....",0,["55","81","33","656","664","998","774","229"]],["Micronesia",["oceania"],"fm","691"],["Moldova",["europe"],"md","373","(..) ..-..-.."],["Monaco",["europe"],"mc","377"],["Mongolia",["asia"],"mn","976"],["Montenegro",["europe","ex-yugos"],"me","382"],["Morocco",["africa","north-africa"],"ma","212"],["Mozambique",["africa"],"mz","258"],["Myanmar",["asia"],"mm","95"],["Namibia",["africa"],"na","264"],["Nauru",["africa"],"nr","674"],["Nepal",["asia"],"np","977"],["Netherlands",["europe","eu-union"],"nl","31",".. ........"],["New Caledonia",["oceania"],"nc","687"],["New Zealand",["oceania"],"nz","64","...-...-...."],["Nicaragua",["america","central-america"],"ni","505"],["Niger",["africa"],"ne","227"],["Nigeria",["africa"],"ng","234"],["North Korea",["asia"],"kp","850"],["Norway",["europe","baltic"],"no","47","... .. ..."],["Oman",["middle-east"],"om","968"],["Pakistan",["asia"],"pk","92","...-......."],["Palau",["oceania"],"pw","680"],["Palestine",["middle-east"],"ps","970"],["Panama",["america","central-america"],"pa","507"],["Papua New Guinea",["oceania"],"pg","675"],["Paraguay",["america","south-america"],"py","595"],["Peru",["america","south-america"],"pe","51"],["Philippines",["asia"],"ph","63",".... ......."],["Poland",["europe","eu-union","baltic"],"pl","48","...-...-..."],["Portugal",["europe","eu-union"],"pt","351"],["Puerto Rico",["america","carribean"],"pr","1","",3,["787","939"]],["Qatar",["middle-east"],"qa","974"],["Runion",["africa"],"re","262"],["Romania",["europe","eu-union"],"ro","40"],["Russia",["europe","asia","ex-ussr","baltic"],"ru","7","(...) ...-..-..",0],["Rwanda",["africa"],"rw","250"],["Saint Kitts and Nevis",["america","carribean"],"kn","1869"],["Saint Lucia",["america","carribean"],"lc","1758"],["Saint Vincent and the Grenadines",["america","carribean"],"vc","1784"],["Samoa",["oceania"],"ws","685"],["San Marino",["europe"],"sm","378"],["So Tom and Prncipe",["africa"],"st","239"],["Saudi Arabia",["middle-east"],"sa","966"],["Senegal",["africa"],"sn","221"],["Serbia",["europe","ex-yugos"],"rs","381"],["Seychelles",["africa"],"sc","248"],["Sierra Leone",["africa"],"sl","232"],["Singapore",["asia"],"sg","65","....-...."],["Slovakia",["europe","eu-union"],"sk","421"],["Slovenia",["europe","eu-union","ex-yugos"],"si","386"],["Solomon Islands",["oceania"],"sb","677"],["Somalia",["africa"],"so","252"],["South Africa",["africa"],"za","27"],["South Korea",["asia"],"kr","82","... .... ...."],["South Sudan",["africa","north-africa"],"ss","211"],["Spain",["europe","eu-union"],"es","34","... ... ..."],["Sri Lanka",["asia"],"lk","94"],["Sudan",["africa"],"sd","249"],["Suriname",["america","south-america"],"sr","597"],["Swaziland",["africa"],"sz","268"],["Sweden",["europe","eu-union","baltic"],"se","46","(...) ...-..."],["Switzerland",["europe"],"ch","41",".. ... .. .."],["Syria",["middle-east"],"sy","963"],["Taiwan",["asia"],"tw","886"],["Tajikistan",["asia","ex-ussr"],"tj","992"],["Tanzania",["africa"],"tz","255"],["Thailand",["asia"],"th","66"],["Timor-Leste",["asia"],"tl","670"],["Togo",["africa"],"tg","228"],["Tonga",["oceania"],"to","676"],["Trinidad and Tobago",["america","carribean"],"tt","1868"],["Tunisia",["africa","north-africa"],"tn","216"],["Turkey",["europe"],"tr","90","... ... .. .."],["Turkmenistan",["asia","ex-ussr"],"tm","993"],["Tuvalu",["asia"],"tv","688"],["Uganda",["africa"],"ug","256"],["Ukraine",["europe","ex-ussr"],"ua","380","(..) ... .. .."],["United Arab Emirates",["middle-east"],"ae","971"],["United Kingdom",["europe","eu-union"],"gb","44",".... ......"],["United States",["america","north-america"],"us","1","(...) ...-....",0,["907","205","251","256","334","479","501","870","480","520","602","623","928","209","213","310","323","408","415","510","530","559","562","619","626","650","661","707","714","760","805","818","831","858","909","916","925","949","951","303","719","970","203","860","202","302","239","305","321","352","386","407","561","727","772","813","850","863","904","941","954","229","404","478","706","770","912","808","319","515","563","641","712","208","217","309","312","618","630","708","773","815","847","219","260","317","574","765","812","316","620","785","913","270","502","606","859","225","318","337","504","985","413","508","617","781","978","301","410","207","231","248","269","313","517","586","616","734","810","906","989","218","320","507","612","651","763","952","314","417","573","636","660","816","228","601","662","406","252","336","704","828","910","919","701","308","402","603","201","609","732","856","908","973","505","575","702","775","212","315","516","518","585","607","631","716","718","845","914","216","330","419","440","513","614","740","937","405","580","918","503","541","215","412","570","610","717","724","814","401","803","843","864","605","423","615","731","865","901","931","210","214","254","281","325","361","409","432","512","713","806","817","830","903","915","936","940","956","972","979","435","801","276","434","540","703","757","804","802","206","253","360","425","509","262","414","608","715","920","304","307"]],["Uruguay",["america","south-america"],"uy","598"],["Uzbekistan",["asia","ex-ussr"],"uz","998",".. ... .. .."],["Vanuatu",["oceania"],"vu","678"],["Vatican City",["europe"],"va","39",".. .... ....",1],["Venezuela",["america","south-america"],"ve","58"],["Vietnam",["asia"],"vn","84"],["Yemen",["middle-east"],"ye","967"],["Zambia",["africa"],"zm","260"],["Zimbabwe",["africa"],"zw","263"]],he=[["American Samoa",["oceania"],"as","1684"],["Anguilla",["america","carribean"],"ai","1264"],["Bermuda",["america","north-america"],"bm","1441"],["British Virgin Islands",["america","carribean"],"vg","1284"],["Cayman Islands",["america","carribean"],"ky","1345"],["Cook Islands",["oceania"],"ck","682"],["Falkland Islands",["america","south-america"],"fk","500"],["Faroe Islands",["europe"],"fo","298"],["Gibraltar",["europe"],"gi","350"],["Greenland",["america"],"gl","299"],["Jersey",["europe","eu-union"],"je","44",".... ......"],["Montserrat",["america","carribean"],"ms","1664"],["Niue",["asia"],"nu","683"],["Norfolk Island",["oceania"],"nf","672"],["Northern Mariana Islands",["oceania"],"mp","1670"],["Saint Barthlemy",["america","carribean"],"bl","590","",1],["Saint Helena",["africa"],"sh","290"],["Saint Martin",["america","carribean"],"mf","590","",2],["Saint Pierre and Miquelon",["america","north-america"],"pm","508"],["Sint Maarten",["america","carribean"],"sx","1721"],["Tokelau",["oceania"],"tk","690"],["Turks and Caicos Islands",["america","carribean"],"tc","1649"],["U.S. Virgin Islands",["america","carribean"],"vi","1340"],["Wallis and Futuna",["oceania"],"wf","681"]];function Z(I,j,z,J,q){return!z||q?I+"".padEnd(j.length,".")+" "+J:I+"".padEnd(j.length,".")+" "+z}function H(I,j,z,J,q){var P,de,_e=[];return de=j===!0,[(P=[]).concat.apply(P,a(I.map((function(Le){var Fe={name:Le[0],regions:Le[1],iso2:Le[2],countryCode:Le[3],dialCode:Le[3],format:Z(z,Le[3],Le[4],J,q),priority:Le[5]||0},$e=[];return Le[6]&&Le[6].map((function(pe){var Ne=(function(Ve){for(var Ge=1;Ge<arguments.length;Ge++){var le=arguments[Ge]!=null?arguments[Ge]:{},W=Object.keys(le);typeof Object.getOwnPropertySymbols=="function"&&(W=W.concat(Object.getOwnPropertySymbols(le).filter((function(te){return Object.getOwnPropertyDescriptor(le,te).enumerable})))),W.forEach((function(te){s(Ve,te,le[te])}))}return Ve})({},Fe);Ne.dialCode=Le[3]+pe,Ne.isAreaCode=!0,Ne.areaCodeLength=pe.length,$e.push(Ne)})),$e.length>0?(Fe.mainCode=!0,de||j.constructor.name==="Array"&&j.includes(Le[2])?(Fe.hasAreaCodes=!0,[Fe].concat($e)):(_e=_e.concat($e),[Fe])):[Fe]})))),_e]}function k(I,j,z,J){if(z!==null){var q=Object.keys(z),P=Object.values(z);q.forEach((function(de,_e){if(J)return I.push([de,P[_e]]);var Le=I.findIndex((function($e){return $e[0]===de}));if(Le===-1){var Fe=[de];Fe[j]=P[_e],I.push(Fe)}else I[Le][j]=P[_e]}))}}function F(I,j){return j.length===0?I:I.map((function(z){var J=j.findIndex((function(P){return P[0]===z[2]}));if(J===-1)return z;var q=j[J];return q[1]&&(z[4]=q[1]),q[3]&&(z[5]=q[3]),q[2]&&(z[6]=q[2]),z}))}var O=function I(j,z,J,q,P,de,_e,Le,Fe,$e,pe,Ne,Ve,Ge){f(this,I),this.filterRegions=function(ae,ie){if(typeof ae=="string"){var we=ae;return ie.filter((function(Ae){return Ae.regions.some((function(Me){return Me===we}))}))}return ie.filter((function(Ae){return ae.map((function(Me){return Ae.regions.some((function(mt){return mt===Me}))})).some((function(Me){return Me}))}))},this.sortTerritories=function(ae,ie){var we=[].concat(a(ae),a(ie));return we.sort((function(Ae,Me){return Ae.name<Me.name?-1:Ae.name>Me.name?1:0})),we},this.getFilteredCountryList=function(ae,ie,we){return ae.length===0?ie:we?ae.map((function(Ae){var Me=ie.find((function(mt){return mt.iso2===Ae}));if(Me)return Me})).filter((function(Ae){return Ae})):ie.filter((function(Ae){return ae.some((function(Me){return Me===Ae.iso2}))}))},this.localizeCountries=function(ae,ie,we){for(var Ae=0;Ae<ae.length;Ae++)ie[ae[Ae].iso2]!==void 0?ae[Ae].localName=ie[ae[Ae].iso2]:ie[ae[Ae].name]!==void 0&&(ae[Ae].localName=ie[ae[Ae].name]);return we||ae.sort((function(Me,mt){return Me.localName<mt.localName?-1:Me.localName>mt.localName?1:0})),ae},this.getCustomAreas=function(ae,ie){for(var we=[],Ae=0;Ae<ie.length;Ae++){var Me=JSON.parse(JSON.stringify(ae));Me.dialCode+=ie[Ae],we.push(Me)}return we},this.excludeCountries=function(ae,ie){return ie.length===0?ae:ae.filter((function(we){return!ie.includes(we.iso2)}))};var le=(function(ae,ie,we){var Ae=[];return k(Ae,1,ae,!0),k(Ae,3,ie),k(Ae,2,we),Ae})(Le,Fe,$e),W=F(JSON.parse(JSON.stringify(ee)),le),te=F(JSON.parse(JSON.stringify(he)),le),be=$(H(W,j,Ne,Ve,Ge),2),Ie=be[0],Ue=be[1];if(z){var Ke=$(H(te,j,Ne,Ve,Ge),2),We=Ke[0];Ke[1],Ie=this.sortTerritories(We,Ie)}J&&(Ie=this.filterRegions(J,Ie)),this.onlyCountries=this.localizeCountries(this.excludeCountries(this.getFilteredCountryList(q,Ie,_e.includes("onlyCountries")),de),pe,_e.includes("onlyCountries")),this.preferredCountries=P.length===0?[]:this.localizeCountries(this.getFilteredCountryList(P,Ie,_e.includes("preferredCountries")),pe,_e.includes("preferredCountries")),this.hiddenAreaCodes=this.excludeCountries(this.getFilteredCountryList(q,Ue),de)},Y=(function(I){function j(q){var P;f(this,j),(P=(function(le,W){return!W||g(W)!=="object"&&typeof W!="function"?y(le):W})(this,v(j).call(this,q))).getProbableCandidate=N()((function(le){return le&&le.length!==0?P.state.onlyCountries.filter((function(W){return B()(W.name.toLowerCase(),le.toLowerCase())}),y(y(P)))[0]:null})),P.guessSelectedCountry=N()((function(le,W,te,be){var Ie;if(P.props.enableAreaCodes===!1&&(be.some((function(We){if(B()(le,We.dialCode))return te.some((function(ae){if(We.iso2===ae.iso2&&ae.mainCode)return Ie=ae,!0})),!0})),Ie))return Ie;var Ue=te.find((function(We){return We.iso2==W}));if(le.trim()==="")return Ue;var Ke=te.reduce((function(We,ae){return B()(le,ae.dialCode)&&(ae.dialCode.length>We.dialCode.length||ae.dialCode.length===We.dialCode.length&&ae.priority<We.priority)?ae:We}),{dialCode:"",priority:10001},y(y(P)));return Ke.name?Ke:Ue})),P.updateCountry=function(le){var W,te=P.state.onlyCountries;(W=le.indexOf(0)>="0"&&le.indexOf(0)<="9"?te.find((function(be){return be.dialCode==+le})):te.find((function(be){return be.iso2==le})))&&W.dialCode&&P.setState({selectedCountry:W,formattedNumber:P.props.disableCountryCode?"":P.formatNumber(W.dialCode,W)})},P.scrollTo=function(le,W){if(le){var te=P.dropdownRef;if(te&&document.body){var be=te.offsetHeight,Ie=te.getBoundingClientRect().top+document.body.scrollTop,Ue=Ie+be,Ke=le,We=Ke.getBoundingClientRect(),ae=Ke.offsetHeight,ie=We.top+document.body.scrollTop,we=ie+ae,Ae=ie-Ie+te.scrollTop,Me=be/2-ae/2;if(P.props.enableSearch?ie<Ie+32:ie<Ie)W&&(Ae-=Me),te.scrollTop=Ae;else if(we>Ue){W&&(Ae+=Me);var mt=be-ae;te.scrollTop=Ae-mt}}}},P.scrollToTop=function(){var le=P.dropdownRef;le&&document.body&&(le.scrollTop=0)},P.formatNumber=function(le,W){if(!W)return le;var te,be=W.format,Ie=P.props,Ue=Ie.disableCountryCode,Ke=Ie.enableAreaCodeStretch,We=Ie.enableLongNumbers,ae=Ie.autoFormat;if(Ue?((te=be.split(" ")).shift(),te=te.join(" ")):Ke&&W.isAreaCode?((te=be.split(" "))[1]=te[1].replace(/\.+/,"".padEnd(W.areaCodeLength,".")),te=te.join(" ")):te=be,!le||le.length===0)return Ue?"":P.props.prefix;if(le&&le.length<2||!te||!ae)return Ue?le:P.props.prefix+le;var ie,we=G()(te,(function(Ae,Me){if(Ae.remainingText.length===0)return Ae;if(Me!==".")return{formattedText:Ae.formattedText+Me,remainingText:Ae.remainingText};var mt,_t=l(mt=Ae.remainingText)||r(mt)||c(),jt=_t[0],ts=_t.slice(1);return{formattedText:Ae.formattedText+jt,remainingText:ts}}),{formattedText:"",remainingText:le.split("")});return(ie=We?we.formattedText+we.remainingText.join(""):we.formattedText).includes("(")&&!ie.includes(")")&&(ie+=")"),ie},P.cursorToEnd=function(){var le=P.numberInputRef;if(document.activeElement===le){le.focus();var W=le.value.length;le.value.charAt(W-1)===")"&&(W-=1),le.setSelectionRange(W,W)}},P.getElement=function(le){return P["flag_no_".concat(le)]},P.getCountryData=function(){return P.state.selectedCountry?{name:P.state.selectedCountry.name||"",dialCode:P.state.selectedCountry.dialCode||"",countryCode:P.state.selectedCountry.iso2||"",format:P.state.selectedCountry.format||""}:{}},P.handleFlagDropdownClick=function(le){if(le.preventDefault(),P.state.showDropdown||!P.props.disabled){var W=P.state,te=W.preferredCountries,be=W.onlyCountries,Ie=W.selectedCountry,Ue=P.concatPreferredCountries(te,be).findIndex((function(Ke){return Ke.dialCode===Ie.dialCode&&Ke.iso2===Ie.iso2}));P.setState({showDropdown:!P.state.showDropdown,highlightCountryIndex:Ue},(function(){P.state.showDropdown&&P.scrollTo(P.getElement(P.state.highlightCountryIndex))}))}},P.handleInput=function(le){var W=le.target.value,te=P.props,be=te.prefix,Ie=te.onChange,Ue=P.props.disableCountryCode?"":be,Ke=P.state.selectedCountry,We=P.state.freezeSelection;if(!P.props.countryCodeEditable){var ae=be+(Ke.hasAreaCodes?P.state.onlyCountries.find((function(Dt){return Dt.iso2===Ke.iso2&&Dt.mainCode})).dialCode:Ke.dialCode);if(W.slice(0,ae.length)!==ae)return}if(W===be)return Ie&&Ie("",P.getCountryData(),le,""),P.setState({formattedNumber:""});if(!(W.replace(/\D/g,"").length>15&&(P.props.enableLongNumbers===!1||typeof P.props.enableLongNumbers=="number"&&W.replace(/\D/g,"").length>P.props.enableLongNumbers))&&W!==P.state.formattedNumber){le.preventDefault?le.preventDefault():le.returnValue=!1;var ie=P.props.country,we=P.state,Ae=we.onlyCountries,Me=we.selectedCountry,mt=we.hiddenAreaCodes;if(Ie&&le.persist(),W.length>0){var _t=W.replace(/\D/g,"");(!P.state.freezeSelection||Me&&Me.dialCode.length>_t.length)&&(Ke=P.props.disableCountryGuess?Me:P.guessSelectedCountry(_t.substring(0,6),ie,Ae,mt)||Me,We=!1),Ue=P.formatNumber(_t,Ke),Ke=Ke.dialCode?Ke:Me}var jt=le.target.selectionStart,ts=le.target.selectionStart,Ys=P.state.formattedNumber,Os=Ue.length-Ys.length;P.setState({formattedNumber:Ue,freezeSelection:We,selectedCountry:Ke},(function(){Os>0&&(ts-=Os),Ue.charAt(Ue.length-1)==")"?P.numberInputRef.setSelectionRange(Ue.length-1,Ue.length-1):ts>0&&Ys.length>=Ue.length?P.numberInputRef.setSelectionRange(ts,ts):jt<Ys.length&&P.numberInputRef.setSelectionRange(jt,jt),Ie&&Ie(Ue.replace(/[^0-9]+/g,""),P.getCountryData(),le,Ue)}))}},P.handleInputClick=function(le){P.setState({showDropdown:!1}),P.props.onClick&&P.props.onClick(le,P.getCountryData())},P.handleDoubleClick=function(le){var W=le.target.value.length;le.target.setSelectionRange(0,W)},P.handleFlagItemClick=function(le,W){var te=P.state.selectedCountry,be=P.state.onlyCountries.find((function(We){return We==le}));if(be){var Ie=P.state.formattedNumber.replace(" ","").replace("(","").replace(")","").replace("-",""),Ue=Ie.length>1?Ie.replace(te.dialCode,be.dialCode):be.dialCode,Ke=P.formatNumber(Ue.replace(/\D/g,""),be);P.setState({showDropdown:!1,selectedCountry:be,freezeSelection:!0,formattedNumber:Ke,searchValue:""},(function(){P.cursorToEnd(),P.props.onChange&&P.props.onChange(Ke.replace(/[^0-9]+/g,""),P.getCountryData(),W,Ke)}))}},P.handleInputFocus=function(le){P.numberInputRef&&P.numberInputRef.value===P.props.prefix&&P.state.selectedCountry&&!P.props.disableCountryCode&&P.setState({formattedNumber:P.props.prefix+P.state.selectedCountry.dialCode},(function(){P.props.jumpCursorToEnd&&setTimeout(P.cursorToEnd,0)})),P.setState({placeholder:""}),P.props.onFocus&&P.props.onFocus(le,P.getCountryData()),P.props.jumpCursorToEnd&&setTimeout(P.cursorToEnd,0)},P.handleInputBlur=function(le){le.target.value||P.setState({placeholder:P.props.placeholder}),P.props.onBlur&&P.props.onBlur(le,P.getCountryData())},P.handleInputCopy=function(le){if(P.props.copyNumbersOnly){var W=window.getSelection().toString().replace(/[^0-9]+/g,"");le.clipboardData.setData("text/plain",W),le.preventDefault()}},P.getHighlightCountryIndex=function(le){var W=P.state.highlightCountryIndex+le;return W<0||W>=P.state.onlyCountries.length+P.state.preferredCountries.length?W-le:P.props.enableSearch&&W>P.getSearchFilteredCountries().length?0:W},P.searchCountry=function(){var le=P.getProbableCandidate(P.state.queryString)||P.state.onlyCountries[0],W=P.state.onlyCountries.findIndex((function(te){return te==le}))+P.state.preferredCountries.length;P.scrollTo(P.getElement(W),!0),P.setState({queryString:"",highlightCountryIndex:W})},P.handleKeydown=function(le){var W=P.props.keys,te=le.target.className;if(te.includes("selected-flag")&&le.which===W.ENTER&&!P.state.showDropdown)return P.handleFlagDropdownClick(le);if(te.includes("form-control")&&(le.which===W.ENTER||le.which===W.ESC))return le.target.blur();if(P.state.showDropdown&&!P.props.disabled&&(!te.includes("search-box")||le.which===W.UP||le.which===W.DOWN||le.which===W.ENTER||le.which===W.ESC&&le.target.value==="")){le.preventDefault?le.preventDefault():le.returnValue=!1;var be=function(Ie){P.setState({highlightCountryIndex:P.getHighlightCountryIndex(Ie)},(function(){P.scrollTo(P.getElement(P.state.highlightCountryIndex),!0)}))};switch(le.which){case W.DOWN:be(1);break;case W.UP:be(-1);break;case W.ENTER:P.props.enableSearch?P.handleFlagItemClick(P.getSearchFilteredCountries()[P.state.highlightCountryIndex]||P.getSearchFilteredCountries()[0],le):P.handleFlagItemClick([].concat(a(P.state.preferredCountries),a(P.state.onlyCountries))[P.state.highlightCountryIndex],le);break;case W.ESC:case W.TAB:P.setState({showDropdown:!1},P.cursorToEnd);break;default:(le.which>=W.A&&le.which<=W.Z||le.which===W.SPACE)&&P.setState({queryString:P.state.queryString+String.fromCharCode(le.which)},P.state.debouncedQueryStingSearcher)}}},P.handleInputKeyDown=function(le){var W=P.props,te=W.keys,be=W.onEnterKeyPress,Ie=W.onKeyDown;le.which===te.ENTER&&be&&be(le),Ie&&Ie(le)},P.handleClickOutside=function(le){P.dropdownRef&&!P.dropdownContainerRef.contains(le.target)&&P.state.showDropdown&&P.setState({showDropdown:!1})},P.handleSearchChange=function(le){var W=le.currentTarget.value,te=P.state,be=te.preferredCountries,Ie=te.selectedCountry,Ue=0;if(W===""&&Ie){var Ke=P.state.onlyCountries;Ue=P.concatPreferredCountries(be,Ke).findIndex((function(We){return We==Ie})),setTimeout((function(){return P.scrollTo(P.getElement(Ue))}),100)}P.setState({searchValue:W,highlightCountryIndex:Ue})},P.concatPreferredCountries=function(le,W){return le.length>0?a(new Set(le.concat(W))):W},P.getDropdownCountryName=function(le){return le.localName||le.name},P.getSearchFilteredCountries=function(){var le=P.state,W=le.preferredCountries,te=le.onlyCountries,be=le.searchValue,Ie=P.props.enableSearch,Ue=P.concatPreferredCountries(W,te),Ke=be.trim().toLowerCase().replace("+","");if(Ie&&Ke){if(/^\d+$/.test(Ke))return Ue.filter((function(ie){var we=ie.dialCode;return["".concat(we)].some((function(Ae){return Ae.toLowerCase().includes(Ke)}))}));var We=Ue.filter((function(ie){var we=ie.iso2;return["".concat(we)].some((function(Ae){return Ae.toLowerCase().includes(Ke)}))})),ae=Ue.filter((function(ie){var we=ie.name,Ae=ie.localName;return ie.iso2,["".concat(we),"".concat(Ae||"")].some((function(Me){return Me.toLowerCase().includes(Ke)}))}));return P.scrollToTop(),a(new Set([].concat(We,ae)))}return Ue},P.getCountryDropdownList=function(){var le=P.state,W=le.preferredCountries,te=le.highlightCountryIndex,be=le.showDropdown,Ie=le.searchValue,Ue=P.props,Ke=Ue.disableDropdown,We=Ue.prefix,ae=P.props,ie=ae.enableSearch,we=ae.searchNotFound,Ae=ae.disableSearchIcon,Me=ae.searchClass,mt=ae.searchStyle,_t=ae.searchPlaceholder,jt=ae.autocompleteSearch,ts=P.getSearchFilteredCountries().map((function(Dt,Ms){var yn=te===Ms,On=V()({country:!0,preferred:Dt.iso2==="us"||Dt.iso2==="gb",active:Dt.iso2==="us",highlight:yn}),xi="flag ".concat(Dt.iso2);return E.a.createElement("li",Object.assign({ref:function(Wn){return P["flag_no_".concat(Ms)]=Wn},key:"flag_no_".concat(Ms),"data-flag-key":"flag_no_".concat(Ms),className:On,"data-dial-code":"1",tabIndex:Ke?"-1":"0","data-country-code":Dt.iso2,onClick:function(Wn){return P.handleFlagItemClick(Dt,Wn)},role:"option"},yn?{"aria-selected":!0}:{}),E.a.createElement("div",{className:xi}),E.a.createElement("span",{className:"country-name"},P.getDropdownCountryName(Dt)),E.a.createElement("span",{className:"dial-code"},Dt.format?P.formatNumber(Dt.dialCode,Dt):We+Dt.dialCode))})),Ys=E.a.createElement("li",{key:"dashes",className:"divider"});W.length>0&&(!ie||ie&&!Ie.trim())&&ts.splice(W.length,0,Ys);var Os=V()(s({"country-list":!0,hide:!be},P.props.dropdownClass,!0));return E.a.createElement("ul",{ref:function(Dt){return!ie&&Dt&&Dt.focus(),P.dropdownRef=Dt},className:Os,style:P.props.dropdownStyle,role:"listbox",tabIndex:"0"},ie&&E.a.createElement("li",{className:V()(s({search:!0},Me,Me))},!Ae&&E.a.createElement("span",{className:V()(s({"search-emoji":!0},"".concat(Me,"-emoji"),Me)),role:"img","aria-label":"Magnifying glass"},""),E.a.createElement("input",{className:V()(s({"search-box":!0},"".concat(Me,"-box"),Me)),style:mt,type:"search",placeholder:_t,autoFocus:!0,autoComplete:jt?"on":"off",value:Ie,onChange:P.handleSearchChange})),ts.length>0?ts:E.a.createElement("li",{className:"no-entries-message"},E.a.createElement("span",null,we)))};var de,_e=new O(q.enableAreaCodes,q.enableTerritories,q.regions,q.onlyCountries,q.preferredCountries,q.excludeCountries,q.preserveOrder,q.masks,q.priority,q.areaCodes,q.localization,q.prefix,q.defaultMask,q.alwaysDefaultMask),Le=_e.onlyCountries,Fe=_e.preferredCountries,$e=_e.hiddenAreaCodes,pe=q.value?q.value.replace(/\D/g,""):"";de=q.disableInitialCountryGuess?0:pe.length>1?P.guessSelectedCountry(pe.substring(0,6),q.country,Le,$e)||0:q.country&&Le.find((function(le){return le.iso2==q.country}))||0;var Ne,Ve=pe.length<2&&de&&!B()(pe,de.dialCode)?de.dialCode:"";Ne=pe===""&&de===0?"":P.formatNumber((q.disableCountryCode?"":Ve)+pe,de.name?de:void 0);var Ge=Le.findIndex((function(le){return le==de}));return P.state={showDropdown:q.showDropdown,formattedNumber:Ne,onlyCountries:Le,preferredCountries:Fe,hiddenAreaCodes:$e,selectedCountry:de,highlightCountryIndex:Ge,queryString:"",freezeSelection:!1,debouncedQueryStingSearcher:A()(P.searchCountry,250),searchValue:""},P}var z,J;return(function(q,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function");q.prototype=Object.create(P&&P.prototype,{constructor:{value:q,writable:!0,configurable:!0}}),P&&b(q,P)})(j,I),z=j,(J=[{key:"componentDidMount",value:function(){document.addEventListener&&this.props.enableClickOutside&&document.addEventListener("mousedown",this.handleClickOutside),this.props.onMount&&this.props.onMount(this.state.formattedNumber.replace(/[^0-9]+/g,""),this.getCountryData(),this.state.formattedNumber)}},{key:"componentWillUnmount",value:function(){document.removeEventListener&&this.props.enableClickOutside&&document.removeEventListener("mousedown",this.handleClickOutside)}},{key:"componentDidUpdate",value:function(q,P,de){q.country!==this.props.country?this.updateCountry(this.props.country):q.value!==this.props.value&&this.updateFormattedNumber(this.props.value)}},{key:"updateFormattedNumber",value:function(q){if(q===null)return this.setState({selectedCountry:0,formattedNumber:""});var P=this.state,de=P.onlyCountries,_e=P.selectedCountry,Le=P.hiddenAreaCodes,Fe=this.props,$e=Fe.country,pe=Fe.prefix;if(q==="")return this.setState({selectedCountry:_e,formattedNumber:""});var Ne,Ve,Ge=q.replace(/\D/g,"");if(_e&&B()(q,pe+_e.dialCode))Ve=this.formatNumber(Ge,_e),this.setState({formattedNumber:Ve});else{var le=(Ne=this.props.disableCountryGuess?_e:this.guessSelectedCountry(Ge.substring(0,6),$e,de,Le)||_e)&&B()(Ge,pe+Ne.dialCode)?Ne.dialCode:"";Ve=this.formatNumber((this.props.disableCountryCode?"":le)+Ge,Ne||void 0),this.setState({selectedCountry:Ne,formattedNumber:Ve})}}},{key:"render",value:function(){var q,P,de,_e=this,Le=this.state,Fe=Le.onlyCountries,$e=Le.selectedCountry,pe=Le.showDropdown,Ne=Le.formattedNumber,Ve=Le.hiddenAreaCodes,Ge=this.props,le=Ge.disableDropdown,W=Ge.renderStringAsFlag,te=Ge.isValid,be=Ge.defaultErrorMessage,Ie=Ge.specialLabel;if(typeof te=="boolean")P=te;else{var Ue=te(Ne.replace(/\D/g,""),$e,Fe,Ve);typeof Ue=="boolean"?(P=Ue)===!1&&(de=be):(P=!1,de=Ue)}var Ke=V()((s(q={},this.props.containerClass,!0),s(q,"react-tel-input",!0),q)),We=V()({arrow:!0,up:pe}),ae=V()(s({"form-control":!0,"invalid-number":!P,open:pe},this.props.inputClass,!0)),ie=V()({"selected-flag":!0,open:pe}),we=V()(s({"flag-dropdown":!0,"invalid-number":!P,open:pe},this.props.buttonClass,!0)),Ae="flag ".concat($e&&$e.iso2);return E.a.createElement("div",{className:"".concat(Ke," ").concat(this.props.className),style:this.props.style||this.props.containerStyle,onKeyDown:this.handleKeydown},Ie&&E.a.createElement("div",{className:"special-label"},Ie),de&&E.a.createElement("div",{className:"invalid-number-message"},de),E.a.createElement("input",Object.assign({className:ae,style:this.props.inputStyle,onChange:this.handleInput,onClick:this.handleInputClick,onDoubleClick:this.handleDoubleClick,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,onCopy:this.handleInputCopy,value:Ne,onKeyDown:this.handleInputKeyDown,placeholder:this.props.placeholder,disabled:this.props.disabled,type:"tel"},this.props.inputProps,{ref:function(Me){_e.numberInputRef=Me,typeof _e.props.inputProps.ref=="function"?_e.props.inputProps.ref(Me):typeof _e.props.inputProps.ref=="object"&&(_e.props.inputProps.ref.current=Me)}})),E.a.createElement("div",{className:we,style:this.props.buttonStyle,ref:function(Me){return _e.dropdownContainerRef=Me}},W?E.a.createElement("div",{className:ie},W):E.a.createElement("div",{onClick:le?void 0:this.handleFlagDropdownClick,className:ie,title:$e?"".concat($e.localName||$e.name,": + ").concat($e.dialCode):"",tabIndex:le?"-1":"0",role:"button","aria-haspopup":"listbox","aria-expanded":!!pe||void 0},E.a.createElement("div",{className:Ae},!le&&E.a.createElement("div",{className:We}))),pe&&this.getCountryDropdownList()))}}])&&d(z.prototype,J),j})(E.a.Component);Y.defaultProps={country:"",value:"",onlyCountries:[],preferredCountries:[],excludeCountries:[],placeholder:"1 (702) 123-4567",searchPlaceholder:"search",searchNotFound:"No entries to show",flagsImagePath:"./flags.png",disabled:!1,containerStyle:{},inputStyle:{},buttonStyle:{},dropdownStyle:{},searchStyle:{},containerClass:"",inputClass:"",buttonClass:"",dropdownClass:"",searchClass:"",className:"",autoFormat:!0,enableAreaCodes:!1,enableTerritories:!1,disableCountryCode:!1,disableDropdown:!1,enableLongNumbers:!1,countryCodeEditable:!0,enableSearch:!1,disableSearchIcon:!1,disableInitialCountryGuess:!1,disableCountryGuess:!1,regions:"",inputProps:{},localization:{},masks:null,priority:null,areaCodes:null,preserveOrder:[],defaultMask:"... ... ... ... ..",alwaysDefaultMask:!1,prefix:"+",copyNumbersOnly:!0,renderStringAsFlag:"",autocompleteSearch:!1,jumpCursorToEnd:!0,enableAreaCodeStretch:!1,enableClickOutside:!0,showDropdown:!1,isValid:!0,defaultErrorMessage:"",specialLabel:"Phone",onEnterKeyPress:null,keys:{UP:38,DOWN:40,RIGHT:39,LEFT:37,ENTER:13,ESC:27,PLUS:43,A:65,Z:90,SPACE:32,TAB:9}},e.default=Y}])),Em}var $j=Bj();const zl=Ag($j),Vj=({open:n,action:e,userName:t,onCancel:s,onConfirm:r})=>{const[a,l]=ht.useState(""),[c,f]=ht.useState(""),[d,h]=ht.useState(!1);ht.useEffect(()=>{n&&(l(""),f(""),h(!1))},[n]);const g={edit:"edit this user",delete:"delete this user",role:"change the user's role"}[e],y=async()=>{h(!0),f("");try{const v=localStorage.getItem("username");if(!v)throw new Error("Session error: Please re-login.");const b=await Qe("public.fn_login_check",[v,a]);if(!b||!b.length)throw new Error("Incorrect password.");h(!1),r()}catch(v){f(v.message||"Password check failed."),h(!1)}};return n?p.jsx("div",{className:"fixed inset-0 z-[90] overflow-y-auto",children:p.jsxs("div",{className:"min-h-full flex items-center justify-center p-4 relative",children:[p.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm"}),p.jsxs("div",{className:"relative w-full max-w-md bg-white rounded-2xl shadow-2xl border border-gray-200",children:[p.jsxs("div",{className:"px-6 py-5 border-b border-gray-100",children:[p.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Confirm ",e.charAt(0).toUpperCase()+e.slice(1)]}),p.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["To ",p.jsx("span",{className:"font-medium",children:g})," (",p.jsx("b",{children:t}),"), enter your password."]})]}),p.jsxs("div",{className:"px-6 py-5 space-y-3",children:[p.jsx("input",{type:"password",value:a,onChange:v=>{l(v.target.value),f("")},className:`w-full h-[40px] border rounded-lg px-3 outline-none focus:ring-2 focus:ring-blue-500 ${c?"border-red-400":"border-gray-300"}`,placeholder:"Enter your password",autoFocus:!0,disabled:d,onKeyDown:v=>{v.key==="Enter"&&a&&y()}}),c&&p.jsx("p",{className:"text-xs text-red-600",children:c})]}),p.jsxs("div",{className:"px-6 py-3 border-t border-gray-100 bg-gray-50 rounded-b-2xl flex justify-end gap-3",children:[p.jsx("button",{onClick:s,className:"px-4 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-100",children:"Cancel"}),p.jsx("button",{onClick:y,disabled:d||!a,className:`px-4 py-2 rounded-lg text-white shadow-sm ${d||!a?"bg-blue-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:d?"Checking...":"Continue"})]})]})]})}):null};function Gj(n){const e=(n||"").replace(/\D/g,"");if(!e)throw new Error("Contact number is required");return e}async function Hj(n){await Ot("public.ti_fc_sp_insert_dim_user3",[n.orgName,n.firstName,n.lastName,n.userId,n.username,n.password,n.email,Gj(n.contactE164)])}function uE(n){const e=String(n?.message||n?.error?.message||n||""),t=e.toLowerCase();return/(23505|unique constraint|duplicate key)/.test(t)?/\b(dim_user_email_key|users_email_key)\b/i.test(e)||/key\s*\(\s*email\s*\)\s*=\s*\(/i.test(e)?"Email already exists. Choose a different one.":/\b(dim_user_username_key|users_username_key)\b/i.test(e)||/key\s*\(\s*(username|user_name)\s*\)\s*=\s*\(/i.test(e)?"Username already exists. Choose a different one.":/\b(dim_user_pkey)\b/i.test(e)?"Email already exists.":"Record already exists.":null}const yl=(n,e)=>{try{localStorage.setItem(n,JSON.stringify(e))}catch(t){console.error(t),ce.error("Storage limit reached while saving small data. Please clear some saved items.",{position:"top-right"})}},Kj="aman-user-photos",Lr="photos";function jp(){return new Promise((n,e)=>{const t=indexedDB.open(Kj,1);t.onupgradeneeded=()=>{const s=t.result;s.objectStoreNames.contains(Lr)||s.createObjectStore(Lr,{keyPath:"key"})},t.onsuccess=()=>n(t.result),t.onerror=()=>e(t.error)})}async function zj(n,e){const t=await jp();await new Promise((s,r)=>{const a=t.transaction(Lr,"readwrite");a.objectStore(Lr).put({key:n,dataUrl:e}),a.oncomplete=()=>s(),a.onerror=()=>r(a.error)}),t.close()}async function Yj(n){const e=await jp(),t=await new Promise((s,r)=>{const l=e.transaction(Lr,"readonly").objectStore(Lr).get(n);l.onsuccess=()=>s(l.result?.dataUrl),l.onerror=()=>r(l.error)});return e.close(),t}async function qj(n){const e=await jp();await new Promise((t,s)=>{const r=e.transaction(Lr,"readwrite");r.objectStore(Lr).delete(n),r.oncomplete=()=>t(),r.onerror=()=>s(r.error)}),e.close()}const _d=[{key:"front",label:"Front"},{key:"left",label:"Left"},{key:"right",label:"Right"},{key:"up",label:"Up"},{key:"down",label:"Down"}];async function Xj(n){const e=await Promise.all(_d.map(async({key:t})=>[t,await Yj(`${n}:${t}`)]));return Object.fromEntries(e)}async function Wj(n,e){await Promise.all(_d.map(async({key:t})=>{const s=e[t],r=`${n}:${t}`;return s?zj(r,s):qj(r)}))}async function Qj(n,e){const t=new FormData;let s=0;if(_d.forEach((r,a)=>{const l=e[r.key];if(!l)return;const c=l.split(",")[1];if(!c)return;const f=l.match(/data:(.*);base64/)?.[1]||"image/webp",d=atob(c),h=new ArrayBuffer(d.length),g=new Uint8Array(h);for(let v=0;v<d.length;v++)g[v]=d.charCodeAt(v);const y=new Blob([h],{type:f});t.append("photos",y,`${a+1}.jpg`),s++}),s===0)throw new Error("Please add at least one photo before saving.");await w2(n,t)}const Zj=["image/jpeg","image/png","image/webp"];function Jj(n){return Zj.includes(n.type)?n.size/(1024*1024)>25?"Image too large. Please select an image under 25MB.":null:"Only JPG, PNG, or WEBP allowed."}function eU(n,e=800,t=.75){return new Promise((s,r)=>{const a=URL.createObjectURL(n),l=new Image;l.onload=()=>{const c=Math.min(1,e/Math.max(l.width,l.height)),f=Math.max(1,Math.round(l.width*c)),d=Math.max(1,Math.round(l.height*c)),h=document.createElement("canvas");h.width=f,h.height=d;const g=h.getContext("2d");if(!g){URL.revokeObjectURL(a),r(new Error("Canvas not supported"));return}g.drawImage(l,0,0,f,d);const y=h.toDataURL("image/webp",t);URL.revokeObjectURL(a),s(y)},l.onerror=c=>{URL.revokeObjectURL(a),r(c)},l.src=a})}const tU=({label:n,value:e,onPick:t,onRemove:s,onPickCamera:r})=>{const a=R.useRef(null),l=ht.useId(),c=f=>{if(!f)return;const d=Jj(f);if(d)return ce.error(d,{position:"top-right"});t(f)};return R.useEffect(()=>{const f=a.current;if(!f)return;const d=g=>{g.preventDefault(),g.stopPropagation()},h=g=>{g.preventDefault(),g.stopPropagation();const y=g.dataTransfer?.files?.[0];y&&c(y)};return["dragenter","dragover","dragleave","drop"].forEach(g=>f.addEventListener(g,d)),f.addEventListener("drop",h),()=>{["dragenter","dragover","dragleave","drop"].forEach(g=>f.removeEventListener(g,d)),f.removeEventListener("drop",h)}},[]),p.jsxs("div",{className:"border border-gray-300 rounded-xl p-3 bg-white",children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("span",{className:"text-sm font-medium text-gray-700",children:n}),p.jsxs("div",{className:"flex items-center gap-2",children:[e&&p.jsx("button",{type:"button",onClick:s,className:"text-xs text-red-600 hover:text-red-700",children:"Remove"}),p.jsx("button",{type:"button",onClick:()=>r?.(),className:"text-xs text-blue-600 hover:underline mt-1",children:"Take Photo"})]})]}),p.jsxs("label",{ref:a,htmlFor:l,className:"group relative block aspect-[4/3] rounded-lg border border-dashed border-gray-300 overflow-hidden cursor-pointer bg-gray-50 hover:bg-gray-100",title:e?"Click to replace":"Click to upload",children:[e?p.jsx("img",{src:e,alt:n,className:"w-full h-full object-cover"}):p.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-500",children:[p.jsx("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",className:"mb-1",children:p.jsx("path",{d:"M12 5v14m-7-7h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),p.jsx("span",{className:"text-xs",children:"Upload or drop image"})]}),r&&p.jsx("button",{type:"button",className:"absolute top-2 right-2 bg-white rounded-full p-1 shadow hover:bg-gray-100",onClick:r,title:"Take Photo from Camera",children:""})]}),p.jsx("input",{id:l,type:"file",accept:"image/*",className:"hidden",onChange:f=>c(f.target.files?.[0]||void 0)})]})},sU=({userName:n,initialPhotos:e,onClose:t,onSave:s})=>{const[r,a]=R.useState(e),[l,c]=R.useState(null),[f,d]=R.useState(null),h=R.useRef(null),g=v=>{c(v)};R.useEffect(()=>a(e),[e]),R.useEffect(()=>{if(!l){f&&(f.getTracks().forEach(b=>b.stop()),d(null));return}(async()=>{try{const b=await navigator.mediaDevices.getUserMedia({video:!0});d(b),h.current&&(h.current.srcObject=b)}catch(b){ce.error("Cannot access camera: "+b.message,{position:"top-right"})}})()},[l]);const y=async(v,b)=>{try{const T=await eU(b,800,.75);a(E=>({...E,[v]:T}))}catch{ce.error("Failed to read image.",{position:"top-right"})}};return p.jsx("div",{className:"fixed inset-0 z-[70] overflow-y-auto",children:p.jsxs("div",{className:"min-h-full flex items-start justify-center p-4 relative",children:[p.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm"}),p.jsxs("div",{className:"relative w-full max-w-3xl bg-white rounded-2xl shadow-2xl border border-gray-200 flex flex-col",children:[p.jsx("button",{onClick:t,className:"absolute right-3 top-3 text-gray-500 hover:text-gray-800 text-xl leading-none","aria-label":"Close",children:""}),p.jsxs("div",{className:"px-6 py-5 border-b border-gray-100 rounded-t-2xl",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Add Photo"}),p.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["User: ",p.jsx("span",{className:"font-medium",children:n})]}),p.jsx("div",{className:"mt-3 text-xs text-gray-500",children:"Upload clear photos for each angle (Front, Left, Right, Up, Down). Neutral light, face centered."})]}),p.jsxs("div",{className:"p-6",children:[l&&p.jsxs("div",{className:"mb-4 flex flex-col items-center gap-2",children:[p.jsx("video",{ref:h,autoPlay:!0,playsInline:!0,className:"w-80 h-60 rounded-lg border border-gray-300"}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("button",{onClick:()=>{if(!h.current||!l)return;const v=document.createElement("canvas");v.width=h.current.videoWidth,v.height=h.current.videoHeight;const b=v.getContext("2d");if(!b)return;b.drawImage(h.current,0,0,v.width,v.height);const T=v.toDataURL("image/webp",.75);a(E=>({...E,[l]:T})),c(null)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Capture"}),p.jsx("button",{onClick:()=>c(null),className:"px-4 py-2 bg-gray-300 text-black rounded-lg hover:bg-gray-400",children:"Cancel"})]})]}),p.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:_d.map(({key:v,label:b})=>p.jsx(tU,{label:b,value:r[v],onPick:T=>y(v,T),onRemove:()=>a(T=>({...T,[v]:void 0})),onPickCamera:()=>g(v)},v))})]}),p.jsxs("div",{className:"px-6 py-3 border-t border-gray-100 rounded-b-2xl bg-gray-50 flex justify-end gap-3",children:[p.jsx("button",{onClick:t,className:"px-4 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-100",children:"Cancel"}),p.jsx("button",{onClick:()=>s(r),className:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white shadow-sm",children:"Save"})]})]})]})})},nU=({open:n,userName:e,currentRole:t="",roles:s,loadingRoles:r,onClose:a,onChangeRole:l})=>{const[c,f]=ht.useState(s.includes(t)?t:"");if(ht.useEffect(()=>{n&&f(s.includes(t)?t:"")},[n,t,s]),!n)return null;const d=!!c,h=()=>{c&&l(c)};return p.jsx("div",{className:"fixed inset-0 z-[75] overflow-y-auto",children:p.jsxs("div",{className:"min-h-full flex items-start justify-center p-4 md:p-6 relative",children:[p.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm"}),p.jsxs("div",{className:"relative w-full max-w-md bg-white rounded-2xl shadow-2xl border border-gray-200 flex flex-col",children:[p.jsxs("div",{className:"px-6 py-4 border-b border-gray-100",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Change Roles"}),e&&p.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["User: ",p.jsx("span",{className:"font-medium",children:e})]})]}),p.jsx("div",{className:"p-5 space-y-4",children:p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Change Roles"}),p.jsxs("select",{className:"w-full h-[40px] border rounded-lg px-3 outline-none focus:ring-2 focus:ring-blue-500 border-gray-300",value:c,onChange:g=>f(g.target.value),disabled:r,onKeyDown:g=>{g.key==="Enter"&&c&&h()},children:[p.jsx("option",{value:"",children:r?"Loading roles...":"Select role"}),s.map(g=>p.jsx("option",{value:g,children:g},g))]})]})}),p.jsxs("div",{className:"px-6 py-3 border-t border-gray-100 bg-gray-50 rounded-b-2xl flex justify-end gap-3",children:[p.jsx("button",{onClick:a,className:"px-4 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-100",children:"Cancel"}),p.jsx("button",{onClick:h,disabled:!d,className:`px-4 py-2 rounded-lg text-white shadow-sm ${d?"bg-blue-600 hover:bg-blue-700":"bg-blue-300 cursor-not-allowed"}`,children:"Change"})]})]})]})})},Tm=n=>!n||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.trim()),dE=n=>n.length>=6&&n.length<=15,iU={us:"201-555-5555",in:"98765 43210",gb:"7400 123456",ae:"50 123 4567",fr:"06 12 34 56 78",cn:"131 2345 6789"},fE=n=>{const e=(n||"").trim();if(!e)return{firstName:"",lastName:""};const t=e.split(/\s+/);return t.length===1?{firstName:t[0],lastName:""}:{firstName:t.slice(0,-1).join(" "),lastName:t.slice(-1)[0]}},rU=({open:n,editing:e=!1,initial:t,organisations:s,onOrgChangeId:r,onClose:a,onSubmit:l})=>{const{firstName:c,lastName:f}=fE(t?.name),[d,h]=R.useState(!1),[g,y]=R.useState(!1),[v,b]=R.useState({organisationId:t?.organisationId||"",role:t?.role||"",firstName:c,lastName:f,username:t?.username||"",password:t?.password||"",confirmPassword:t?.password||"",email:t?.email||"",contact:t?.contact||"",contactCountry:(t?.contactCountry||"in").toLowerCase(),id:t?.id,userId:t?.userId||t?.id||""}),[T,E]=R.useState({}),[_,A]=R.useState({username:!1,email:!1}),C=R.useRef(null),N=R.useRef(null),w=($,ee)=>E(he=>({...he,[$]:ee})),G=$=>E(ee=>{const he={...ee};return delete he[$],he});R.useEffect(()=>{if(!n)return;const $=(t?.contactCountry||"in").toLowerCase(),{firstName:ee,lastName:he}=fE(t?.name);b({organisationId:t?.organisationId||"",role:t?.role||"",firstName:ee,lastName:he,username:t?.username||"",password:t?.password||"",confirmPassword:t?.password||"",email:t?.email||"",contact:t?.contact||"",contactCountry:$,id:t?.id,userId:t?.userId||""}),h(!1),y(!1),E({})},[n,t]),R.useEffect(()=>{if(!n)return;const $=(v.username||"").trim();if(C.current&&window.clearTimeout(C.current),!!$)return A(ee=>({...ee,username:!0})),C.current=window.setTimeout(async()=>{try{const ee=await Qe("public.user_unique",[$,null,e&&t?.email||null]);(Array.isArray(ee)?ee[0]:ee)?.username_taken?w("username","Username already exists"):G("username")}catch(ee){console.error("username check failed",ee)}finally{A(ee=>({...ee,username:!1}))}},400),()=>{C.current&&window.clearTimeout(C.current)}},[n,v.username,e,t?.email]),R.useEffect(()=>{if(!n)return;const $=(v.email||"").trim();if(N.current&&window.clearTimeout(N.current),!(!$||!Tm($)))return A(ee=>({...ee,email:!0})),N.current=window.setTimeout(async()=>{try{const ee=await Qe("public.user_unique",[null,$,e&&t?.email||null]);(Array.isArray(ee)?ee[0]:ee)?.email_taken?w("email","Email already exists"):G("email")}catch(ee){console.error("email check failed",ee)}finally{A(ee=>({...ee,email:!1}))}},400),()=>{N.current&&window.clearTimeout(N.current)}},[n,v.email,e,t?.email]);const M=($,ee)=>b(he=>({...he,[$]:ee})),B=()=>{const $={};return v.organisationId||($.organisationId="Required"),v.firstName.trim()||($.firstName="Required"),v.lastName.trim()||($.lastName="Required"),v.username.trim()||($.username="Required"),v.password||($.password="Required"),v.confirmPassword||($.confirmPassword="Required"),v.password&&v.confirmPassword&&v.password!==v.confirmPassword&&($.confirmPassword="Passwords do not match"),Tm(v.email)||($.email="Enter a valid email"),v.contact?dE(v.contact.replace("+",""))||($.contact="615 digits required"):$.contact="Required",E($),Object.keys($).length===0},K=async()=>{if(B())try{const $=await Qe("public.user_unique",[(v.username||"").trim(),(v.email||"").trim(),e&&t?.email||null]),ee=Array.isArray($)?$[0]:$||{},he=F=>F===!0||F==="t"||F==="true"||F===1||F==="1",Z=he(ee?.username_taken),H=he(ee?.email_taken);!Z&&T.username==="Username already exists"&&G("username"),!H&&T.email==="Email already exists"&&G("email");let k=!1;if(Z&&(w("username","Username already exists"),ce.error("Username already exists. Choose a different one.",{position:"top-right"}),k=!0),H&&(w("email","Email already exists"),ce.error("Email already exists. Choose a different one.",{position:"top-right"}),k=!0),k)return;l(v)}catch($){console.error($),ce.error("Could not verify uniqueness. Please try again.",{position:"top-right"})}},V=_.username||_.email||!!T.username||!!T.email;return n?p.jsx("div",{className:"fixed inset-0 z-[60] overflow-y-auto",children:p.jsxs("div",{className:"min-h-full flex items-start justify-center p-4 md:p-6 relative",children:[p.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm"}),p.jsxs("div",{className:"relative w-full max-w-[720px] bg-white rounded-2xl shadow-2xl border border-gray-200 flex flex-col",children:[p.jsx("div",{className:"px-6 py-4 border-b border-gray-100 rounded-t-2xl",children:p.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:e?"Edit User":"Add User"})}),p.jsxs("div",{className:"p-5 space-y-4",children:[p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Organisation ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsxs("select",{className:`w-full h-[40px] border rounded-lg px-3 outline-none focus:ring-2 focus:ring-blue-500 ${T.organisationId?"border-red-400":"border-gray-300"} ${e?"bg-gray-100 cursor-not-allowed":""}`,value:v.organisationId,onChange:$=>{const ee=$.target.value;M("organisationId",ee),ee?G("organisationId"):w("organisationId","Required"),r(ee),M("role","")},disabled:e,tabIndex:e?-1:0,style:e?{pointerEvents:"none"}:void 0,children:[p.jsx("option",{value:"",children:"Select Organisation"}),s.map($=>p.jsx("option",{value:$.id,children:$.name},$.id))]}),T.organisationId&&p.jsx("p",{className:"text-xs text-red-600 mt-1",children:T.organisationId})]})}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["First Name ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx("input",{className:`w-full h-[40px] border rounded-lg px-3 outline-none focus:ring-2 focus:ring-blue-500 ${T.firstName?"border-red-400":"border-gray-300"} ${e?"bg-gray-100 cursor-not-allowed":""}`,placeholder:"First Name",value:v.firstName,onChange:$=>{M("firstName",$.target.value),$.target.value.trim()?G("firstName"):w("firstName","Required")},disabled:e}),T.firstName&&p.jsx("p",{className:"text-xs text-red-600 mt-1",children:T.firstName})]}),p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Last Name ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx("input",{className:`w-full h-[40px] border rounded-lg px-3 outline-none focus:ring-2 focus:ring-blue-500 ${T.lastName?"border-red-400":"border-gray-300"} ${e?"bg-gray-100 cursor-not-allowed":""}`,placeholder:"Last Name",value:v.lastName,onChange:$=>{M("lastName",$.target.value),$.target.value.trim()?G("lastName"):w("lastName","Required")},disabled:e}),T.lastName&&p.jsx("p",{className:"text-xs text-red-600 mt-1",children:T.lastName})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["User ID ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx("input",{className:`w-full h-[40px] border rounded-lg px-3 outline-none focus:ring-2 focus:ring-blue-500 ${T.userId?"border-red-400":"border-gray-300"} ${e?"bg-gray-100 cursor-not-allowed":""}`,placeholder:"User ID",value:v.userId,onChange:$=>{M("userId",$.target.value),$.target.value.trim()?G("userId"):w("userId","Required")},disabled:e}),T.userId&&p.jsx("p",{className:"text-xs text-red-600 mt-1",children:T.userId})]}),p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Username ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx("input",{className:`w-full h-[40px] border rounded-lg px-3 outline-none focus:ring-2 focus:ring-blue-500 ${T.username?"border-red-400":"border-gray-300"} ${e?"bg-gray-100 cursor-not-allowed":""}`,placeholder:"Username",value:v.username,onChange:$=>{const ee=$.target.value;M("username",ee),ee.trim()?G("username"):w("username","Required")},onBlur:$=>{$.target.value.trim()||w("username","Required")},disabled:e}),T.username&&p.jsx("p",{className:"text-xs text-red-600 mt-1",children:T.username}),_.username&&!T.username&&p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Checking username"})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Add Password ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsxs("div",{className:"relative",children:[p.jsx("input",{type:d?"text":"password",className:`w-full h-[40px] border rounded-lg px-3 pr-10 outline-none focus:ring-2 focus:ring-blue-500 ${T.password?"border-red-400":"border-gray-300"}`,placeholder:"Enter password",value:v.password,onChange:$=>{M("password",$.target.value),$.target.value?G("password"):w("password","Required");const ee=v.confirmPassword||"";ee&&$.target.value!==ee?w("confirmPassword","Passwords do not match"):G("confirmPassword")}}),p.jsx("button",{type:"button",className:"absolute right-3 top-2.5 text-gray-600",onClick:()=>h($=>!$),"aria-label":"Toggle password",children:d?p.jsx(Dm,{}):p.jsx(Im,{})})]}),T.password&&p.jsx("p",{className:"text-xs text-red-600 mt-1",children:T.password})]}),p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Confirm Password ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsxs("div",{className:"relative",children:[p.jsx("input",{type:g?"text":"password",className:`w-full h-[40px] border rounded-lg px-3 pr-10 outline-none focus:ring-2 focus:ring-blue-500 ${T.confirmPassword?"border-red-400":"border-gray-300"}`,placeholder:"Re-enter password",value:v.confirmPassword||"",onChange:$=>{if(M("confirmPassword",$.target.value),!$.target.value)return w("confirmPassword","Required");$.target.value!==v.password?w("confirmPassword","Passwords do not match"):G("confirmPassword")}}),p.jsx("button",{type:"button",className:"absolute right-3 top-2.5 text-gray-600",onClick:()=>y($=>!$),"aria-label":"Toggle confirm password",children:g?p.jsx(Dm,{}):p.jsx(Im,{})})]}),T.confirmPassword&&p.jsx("p",{className:"text-xs text-red-600 mt-1",children:T.confirmPassword})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),p.jsx("input",{className:`w-full h-[40px] border rounded-lg px-3 outline-none focus:ring-2 focus:ring-blue-500 ${T.email?"border-red-400":"border-gray-300"}`,placeholder:"name@company.com",value:v.email,onChange:$=>M("email",$.target.value),onBlur:$=>{Tm($.target.value)?G("email"):w("email","Enter a valid email")}}),T.email&&p.jsx("p",{className:"text-xs text-red-600 mt-1",children:T.email}),_.email&&!T.email&&p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Checking email"})]}),p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Contact Number ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx(zl,{country:v.contactCountry||"in",value:v.contact.replace("+",""),placeholder:iU[v.contactCountry||"in"]||"201-555-5555",onChange:($,ee)=>{const he=$?`+${$}`:"",Z=(ee?.countryCode||"in").toLowerCase();b(H=>({...H,contact:he,contactCountry:Z})),!$||dE($)?G("contact"):w("contact","615 digits required")},enableSearch:!0,countryCodeEditable:!1,inputProps:{name:"contact",required:!0,onKeyDown:$=>{$.key==="Enter"&&K()}},containerClass:"w-full",inputClass:"!w-full !h-[40px] !text-[14px] !rounded-lg !border !border-gray-300 !pl-12 !pr-3 focus:!border-blue-500",buttonClass:"!rounded-l-lg !border !border-gray-300",dropdownClass:"!rounded-xl !shadow-lg"}),T.contact&&p.jsx("p",{className:"text-xs text-red-600 mt-1",children:T.contact})]})]})]}),p.jsxs("div",{className:"px-6 py-3 border-t border-gray-100 bg-gray-50 rounded-b-2xl flex justify-end gap-3",children:[p.jsx("button",{onClick:a,className:"px-4 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-100",children:"Cancel"}),p.jsx("button",{onClick:K,disabled:V,className:`px-4 py-2 rounded-lg text-white shadow-sm ${V?"bg-blue-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:e?"Update":"Add"})]})]})]})}):null},aU=({open:n,users:e,onClose:t,onAssign:s})=>{const[r,a]=R.useState(""),[l,c]=R.useState(null),[f,d]=R.useState([]),[h,g]=R.useState([]),[y,v]=R.useState(""),[b,T]=R.useState(""),[E,_]=R.useState([]),[A,C]=R.useState(""),[N,w]=R.useState(!1),[,G]=R.useState(!1),[M,B]=R.useState(!1),[K,V]=R.useState(!1),[$,ee]=R.useState(!1);R.useEffect(()=>{n&&(a(""),c(null),d([]),g([]),v(""),T(""),G(!1),B(!1),V(!1),ee(!1))},[n]),R.useEffect(()=>{(async()=>{if(c(null),d([]),g([]),v(""),T(""),!!r)try{G(!0);const k=await Qe("public.fn_org_by_username",[r]),F=Array.isArray(k)?k[0]:null;if(!F){ce.error(`No organisation found for user "${r}"`,{position:"top-right"});return}c(F),B(!0);const O=await Qe("public.fn_list_plants_by_org",[F.org_id]),Y=(Array.isArray(O)?O:[]).map(I=>({pid:Number(I.pid),p_name:String(I.p_name)}));d(Y)}catch(k){console.error(k),ce.error(`Failed to resolve organisation/plants: ${k.message||k}`,{position:"top-right"})}finally{G(!1),B(!1)}})()},[r]),R.useEffect(()=>{(async()=>{if(g([]),T(""),!(!l||!y||!A))try{V(!0);const k=f.find(j=>j.pid===y)?.p_name||"",F=l.org_name||"",O=A;if(!k||!F||!O)return;const Y=await Qe("public.fn_list_stations_by_unit",[F,k,O]),I=(Array.isArray(Y)?Y:[]).map((j,z)=>({sid:z+1,s_name:String(j.sname||j.s_name)}));g(I)}catch(k){console.error(k),ce.error(`Failed to load stations: ${k.message||k}`,{position:"top-right"})}finally{V(!1)}})()},[l,y,A,f]);const he=!!(r&&y&&b&&l?.org_id),Z=async()=>{if(he)try{ee(!0);const H=f.find(j=>j.pid===y)?.p_name||"",k=h.find(j=>j.sid===b)?.s_name||"",F=A||"";if(!H||!k){ce.error("Invalid plant/station selection.",{position:"top-right"});return}const O=e.find(j=>j.username===r),Y=O?O.userId:"",I=l?l.org_name:"";await Ot("public.ti_fc_sp_map_user_to_station",[r,Y,k,F,H,I]),s({id:crypto.randomUUID(),plantId:String(y),stationId:String(b),userId:e.find(j=>j.username===r)?.id||r}),ce.success("User mapped successfully.",{position:"top-right"}),t()}catch(H){console.error(H),ce.error(`Assign failed: ${H.message||H}`,{position:"top-right"})}finally{ee(!1)}};return n?p.jsx("div",{className:"fixed inset-0 z-[65] overflow-y-auto",children:p.jsxs("div",{className:"min-h-full flex items-start justify-center p-4 md:p-6 relative",children:[p.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm"}),p.jsxs("div",{className:"relative w-full max-w-lg bg-white rounded-2xl shadow-2xl border border-gray-200 flex flex-col",children:[p.jsxs("div",{className:"px-6 py-4 border-b border-gray-100",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Assign Users"}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pick a Username  well auto-detect their Organisation, then select Plant and Station."})]}),p.jsxs("div",{className:"p-5 space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Username"}),p.jsxs("select",{className:"w-full h-[40px] border rounded-lg px-3 outline-none focus:ring-2 focus:ring-blue-500 border-gray-300",value:r,onChange:H=>a(H.target.value),children:[p.jsx("option",{value:"",children:"Select User"}),e.map(H=>p.jsx("option",{value:H.username,children:H.username},H.id))]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Plant"}),p.jsxs("select",{className:"w-full h-[40px] border rounded-lg px-3 outline-none focus:ring-2 focus:ring-blue-500 border-gray-300",value:y,onChange:async H=>{const k=H.target.value?Number(H.target.value):"";if(v(k),C(""),_([]),T(""),g([]),k){w(!0);try{const O=f.find(j=>j.pid===k)?.p_name||"",Y=l?.org_name||"",I=await Qe("public.fn_list_units_by_plant",[Y,O]);_((Array.isArray(I)?I:[]).map((j,z)=>({unit_id:z+1,unit_name:String(j.uname)})))}catch{ce.error("Failed to load units"),_([])}finally{w(!1)}}},disabled:!l||M,children:[p.jsx("option",{value:"",children:M?"Loading plants":l?"Select Plant":"Select User first"}),f.map(H=>p.jsx("option",{value:H.pid,children:H.p_name},H.pid))]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unit"}),p.jsxs("select",{className:"w-full h-[40px] border rounded-lg px-3 outline-none focus:ring-2 focus:ring-blue-500 border-gray-300",value:A,onChange:H=>{C(H.target.value),T(""),g([])},disabled:!y||N,children:[p.jsx("option",{value:"",children:N?"Loading units":y?"Select Unit":"Select Plant first"}),E.map(H=>p.jsx("option",{value:H.unit_name,children:H.unit_name},H.unit_name))]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Station"}),p.jsxs("select",{className:"w-full h-[40px] border rounded-lg px-3 outline-none focus:ring-2 focus:ring-blue-500 border-gray-300",value:b,onChange:H=>T(H.target.value?Number(H.target.value):""),disabled:!y||!A||K,children:[p.jsx("option",{value:"",children:K?"Loading stations":y?"Select Station":"Select Plant first"}),h.map(H=>p.jsx("option",{value:H.sid,children:H.s_name},H.sid))]})]})]}),p.jsxs("div",{className:"px-6 py-3 border-t border-gray-100 bg-gray-50 rounded-b-2xl flex justify-end gap-3",children:[p.jsx("button",{onClick:t,className:"px-4 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-100",children:"Cancel"}),p.jsx("button",{onClick:Z,disabled:!he||$,className:`px-4 py-2 rounded-lg text-white shadow-sm ${he&&!$?"bg-blue-600 hover:bg-blue-700":"bg-blue-300 cursor-not-allowed"}`,children:$?"Assigning":"Assign"})]})]})]})}):null},oU=()=>{const[,n]=R.useState(null),[e,t]=R.useState([]),[s,r]=R.useState([]);R.useEffect(()=>{(async()=>{try{const Ne=await Qe("public.list_organisations",[]),Ve=(Array.isArray(Ne)?Ne:[]).map(Ge=>({id:Ge.org_code,name:Ge.org_name,code:Ge.org_code}));r(Ve)}catch{ce.error("Failed to fetch organisations from DB"),r([])}})()},[]);const[a,l]=R.useState([]),[c,f]=R.useState(!1),[d,h]=R.useState(!1),[g,y]=R.useState(null),[v,b]=R.useState(!1),[T,E]=R.useState(null),[_,A]=R.useState({front:void 0,left:void 0,right:void 0,up:void 0,down:void 0}),[C]=R.useState(!1),[,N]=R.useState(null),[w,G]=R.useState(!1),[M,B]=R.useState(null),[K,V]=R.useState([]),[$,ee]=R.useState(!1),[he,Z]=R.useState({open:!1,action:null,user:null}),H=async pe=>{if(!pe){V([]);return}try{ee(!0);const Ne=await Qe("public.role_list_by_org",[pe]),Ve=(Array.isArray(Ne)?Ne:[]).map(Ge=>String(Ge.role_name??Ge.role_nam??Ge.role??"")).filter(Boolean);V(Ve)}catch(Ne){console.error("Failed to load roles by org id:",Ne),V([])}finally{ee(!1)}},k=R.useMemo(()=>{const pe={};for(const Ne of s)pe[Ne.id]=Ne;return pe},[s]);R.useEffect(()=>{const pe=c||v||C||d||w||!!(he&&he.open);return document.body.style.overflow=pe?"hidden":"",()=>{document.body.style.overflow=""}},[c,v,C,d,w,he]),R.useEffect(()=>{(async()=>{try{const Ne=await Qe("public.fn_list_users",[]),Ve=(Array.isArray(Ne)?Ne:[]).map((Ge,le)=>({id:Ge.u_code||le,userId:Ge.u_code||le,name:Ge.fullname||"",username:Ge.username,password:Ge.u_password||"",email:Ge.u_email,contact:Ge.u_contact?String(Ge.u_contact):"",role:Ge.role_nam||"",organisationId:Ge.org_id||Ge.organisation_id||"",contactCountry:"in"}));t(Ve)}catch{ce.error("Failed to fetch users from DB"),t([])}})()},[]);const F=()=>{y(null),V([]),f(!0)},O=pe=>{y(pe),f(!0)},Y=()=>h(!0),I=pe=>{const Ne=k[pe.organisationId]?.code||pe.organisationId||"";B(pe),H(Ne),G(!0)},j=pe=>pe.trim().toLowerCase(),z=(pe,Ne)=>e.some(Ve=>j(Ve.username)===j(pe)&&Ve.id!==Ne),J=async pe=>{if(z(pe.username,pe.id)){ce.error("Username already exists. Choose a different one.",{position:"top-right"});return}const Ne=(pe.firstName||"").trim(),Ve=(pe.lastName||"").trim(),Ge=`${Ne} ${Ve}`.trim();try{if(g){const le=e.find(W=>W.id===g);if(!le)return;try{await Ot("public.ti_fc_sp_update_dim_user1",[le.id,pe.password||null,pe.email||null,pe.contact||null]);const W=e.map(te=>te.id===g?{...te,name:`${pe.firstName} ${pe.lastName}`.trim(),username:pe.username,password:pe.password,contact:pe.contact,contactCountry:pe.contactCountry,email:pe.email}:te);t(W),yl("users",W),ce.success("User updated via stored procedure.",{position:"top-right"}),f(!1)}catch(W){ce.error(`Update failed: ${W.message||W}`,{position:"top-right"})}}else{const le=s.find(Ie=>Ie.id===pe.organisationId);if(!le){ce.error("Invalid organisation selected.",{position:"top-right"});return}const W=le.name;try{await Hj({userId:pe.userId,firstName:Ne,lastName:Ve,username:pe.username,password:pe.password,email:pe.email,contactE164:pe.contact,orgName:W})}catch(Ie){console.error("Insert failed:",Ie);const Ue=uE(Ie);if(Ue){ce.error(Ue,{position:"top-right"});return}throw Ie}const te={id:crypto.randomUUID(),userId:pe.userId,name:Ge,username:pe.username,password:pe.password,email:pe.email,contact:pe.contact,contactCountry:pe.contactCountry,organisationId:pe.organisationId,role:pe.role},be=[...e,te];t(be),yl("users",be),ce.success("User inserted via stored procedure.",{position:"top-right"})}f(!1)}catch(le){const W=uE(le);W?ce.error(W,{position:"top-right"}):(ce.error("Save failed. Please try again.",{position:"top-right"}),console.error(le))}},q=pe=>{Z({open:!0,action:"delete",user:pe,afterConfirm:async()=>{Z({open:!1,action:null,user:null}),N(pe),await P(pe)}})},P=async pe=>{if(pe)try{await Ot("public.ti_fc_sp_delete_dim_user",[pe.email]);const Ne=e.filter(Ve=>Ve.id!==pe.id);t(Ne),yl("users",Ne),ce.success("User deleted via stored procedure.",{position:"top-right"})}catch(Ne){ce.error(`Delete failed: ${Ne.message||Ne}`,{position:"top-right"})}finally{N(null)}},de=async pe=>{E(pe);const Ne=await Xj(pe.id);A(Ne),b(!0)},_e=async pe=>{if(T)try{await Qj(T.username,pe),await Wj(T.id,pe),ce.success("Photos saved locally and to backend folder",{position:"top-right"})}catch(Ne){console.error(Ne),ce.error("Failed to save photos.",{position:"top-right"})}finally{b(!1),E(null)}},Le=g?(()=>{const pe=e.find(Ve=>Ve.id===g);if(!pe)return;const Ne=pe.password??pe.passkey??"";return{...pe,password:Ne}})():void 0,Fe=pe=>{const Ne=[...a,pe];l(Ne),yl("user_assignments",Ne),ce.success("User assigned successfully.",{position:"top-right"}),h(!1)},$e=async pe=>{if(!M)return;const Ne=k[M.organisationId]?.code||null;if(!Ne){ce.error("Organisation code not found. Cannot update role.",{position:"top-right"});return}try{await Ot("public.ti_fc_sp_map_user_to_role2",[M.username,pe,Ne]);const Ve=e.map(Ge=>Ge.id===M.id?{...Ge,role:pe}:Ge);t(Ve),yl("users",Ve),ce.success(`Role changed to ${pe}`,{position:"top-right"})}catch(Ve){ce.error(`Role change failed: ${Ve.message||Ve}`,{position:"top-right"})}finally{G(!1),B(null)}};return p.jsxs("div",{className:"p-6 space-y-6",children:[p.jsxs("div",{className:"flex flex-wrap md:flex-nowrap items-center justify-between gap-3",children:[p.jsx("div",{className:"min-w-0",children:p.jsx("h2",{className:"text-xl font-semibold text-gray-800 truncate",children:"Users"})}),p.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[p.jsx("button",{onClick:Y,className:"px-3 py-2 rounded-lg bg-white border border-blue-300 text-blue-700 hover:bg-blue-50 shadow-sm w-full sm:w-auto",children:"Assign Users"}),p.jsx("button",{onClick:F,className:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white shadow-sm transition w-full sm:w-auto",children:"Add User"})]})]}),p.jsx("div",{className:"mt-2 bg-white border border-[#cfe7ff] rounded-sm shadow-lg overflow-hidden w-full",children:p.jsx("div",{className:"overflow-x-auto w-full",children:p.jsxs("table",{className:"min-w-max w-full text-sm border-separate border-spacing-0",children:[p.jsx("thead",{children:p.jsxs("tr",{className:"bg-[#cfe7ff] text-[#0c1e36] text-left text-sm",children:[p.jsx("th",{className:"px-4 py-3 min-w-0",children:"User ID"}),p.jsx("th",{className:"px-4 py-3 min-w-0",children:"Name"}),p.jsx("th",{className:"px-4 py-3 min-w-0",children:"Username"}),p.jsx("th",{className:"px-4 py-3 min-w-0",children:"Role"}),p.jsx("th",{className:"px-4 py-3 min-w-0",children:"Email"}),p.jsx("th",{className:"px-4 py-3 min-w-0",children:"Contact"}),p.jsx("th",{className:"px-4 py-3 min-w-0",children:"Actions"})]})}),p.jsxs("tbody",{className:"text-sm",children:[e.map(pe=>p.jsxs("tr",{className:"bg-white text-[#0c1e36] shadow-sm hover:bg-[#e7f3ff] transition",children:[p.jsx("td",{className:"px-4 py-3 min-w-0 truncate",children:pe.userId}),p.jsx("td",{className:"px-4 py-3 min-w-0 truncate",children:pe.name}),p.jsx("td",{className:"px-4 py-3 min-w-0 truncate",children:pe.username}),p.jsx("td",{className:"px-4 py-3 min-w-0 truncate",children:pe.role}),p.jsx("td",{className:"px-4 py-3 min-w-0 truncate",children:pe.email||"-"}),p.jsx("td",{className:"px-4 py-3 min-w-0 truncate",children:pe.contact||"-"}),p.jsx("td",{className:"px-4 py-3 min-w-0",children:p.jsxs("div",{className:"flex items-center gap-7 flex-wrap",children:[p.jsx("button",{onClick:()=>O(pe.id),className:"text-blue-600 hover:underline",children:"Edit"}),p.jsx("button",{onClick:()=>I(pe),className:"text-indigo-600 hover:underline",children:"Role"}),p.jsx("button",{onClick:()=>q(pe),className:"text-red-600 hover:underline",children:"Delete"}),p.jsx("button",{onClick:()=>de(pe),className:"text-gray-600 hover:underline",children:"Add Photo"})]})})]},pe.id)),e.length===0&&p.jsx("tr",{children:p.jsx("td",{className:"px-4 py-6 text-gray-500 italic",colSpan:7,children:"No users found."})})]})]})})}),p.jsx(rU,{open:c,editing:!!g,initial:Le,organisations:s,roles:K,loadingRoles:$,onOrgChangeId:pe=>H(pe),onClose:()=>f(!1),onSubmit:pe=>{g?(n({type:"edit",data:pe}),Z({open:!0,action:"edit",user:e.find(Ne=>Ne.id===g)||null,afterConfirm:()=>{Z({open:!1,action:null,user:null}),J(pe),n(null)}})):J(pe)}}),p.jsx(aU,{open:d,users:e,onClose:()=>h(!1),onAssign:Fe}),v&&T&&p.jsx(sU,{userName:T.name,initialPhotos:_,onClose:()=>{b(!1),E(null)},onSave:_e}),p.jsx(nU,{open:w,userName:M?.name,currentRole:M?.role,roles:K,loadingRoles:$,onClose:()=>{G(!1),B(null)},onChangeRole:pe=>{n({type:"role",data:pe}),Z({open:!0,action:"role",user:M,afterConfirm:()=>{Z({open:!1,action:null,user:null}),$e(pe),n(null)}})}}),p.jsx(Vj,{open:he.open,action:he.action,userName:he.user?.name||"",onCancel:()=>Z({open:!1,action:null,user:null}),onConfirm:he.afterConfirm||(()=>{})}),p.jsx(Dr,{})]})},o_=/^\d{1,3}(\.\d{1,3}){3}$/;function Tg(n){const e=n.trim();if(!o_.test(e))return!1;const t=e.split(".");for(const s of t){if(s.length>1&&s[0]===" ")return!1;const r=Number(s);if(!Number.isInteger(r)||r<0||r>255)return!1}return!0}function hE(n){const e=n.trim(),t=e.split("://")[0]?.toLowerCase();if(!["rtsp","http","https"].includes(t)||!/^(rtsp|http|https):\/\/[^/\s]+(\/\S*)?$/i.test(e))return!1;const a=e.replace(/^(rtsp|http|https):\/\//i,"").split("/")[0].split("@").pop().split(":")[0];return o_.test(a)?Tg(a):!0}function mE(n){return n.replace(/[^a-zA-Z0-9]/g,"").toUpperCase()}function gE(n){return/^[A-Z0-9]{3,20}$/.test(n)}const pE=({open:n,onClose:e,children:t})=>n?p.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:p.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 relative animate-slideInUp",children:[p.jsx("button",{className:"absolute top-2 right-4 text-gray-400 hover:text-red-500 text-lg",onClick:e,children:""}),t]})}):null,lU=()=>{const[n,e]=R.useState([]),[t,s]=R.useState([]),[r,a]=R.useState([]),[l,c]=R.useState(!1),[f,d]=R.useState(!1),[h,g]=R.useState(null),[y,v]=R.useState(""),[b,T]=R.useState(""),[E,_]=R.useState(""),[A,C]=R.useState(""),[N,w]=R.useState(""),[G,M]=R.useState(""),[B,K]=R.useState(""),[V,$]=R.useState(""),[ee,he]=R.useState(""),[Z,H]=R.useState([]),[k,F]=R.useState(!1),[O,Y]=R.useState(""),[I,j]=R.useState([]),[z,J]=R.useState(!1),[q,P]=R.useState([]);R.useEffect(()=>{Qe("public.fn_list_dim_camera").then(W=>e(Array.isArray(W)?W:[])).catch(()=>e([])),Qe("public.fn_list_dim_plant").then(W=>s(Array.isArray(W)?W:[])).catch(()=>s([])),Qe("public.fn_list_dim_station").then(W=>{const be=(Array.isArray(W)?W:[]).map(Ie=>({s_code:Ie.id||Ie.s_code,s_name:Ie.name||Ie.s_name,p_code:Ie.plant_id||Ie.p_code}));a(be)}).catch(()=>a([])),Qe("public.fn_list_dim_organisation").then(W=>P(Array.isArray(W)?W:W?.rows||[])).catch(()=>P([]))},[]);function de(W){if(!W)return w("");if(!Tg(W))return w("Enter a valid IPv4 (e.g., 192.168.1.10).");const te=n.some(be=>be.c_ip===W&&(!h||be.c_code!==h.c_code));w(te?"Camera IP already exists":"")}function _e(W){if(!W)return M("");if(!hE(W))return M("URL must start with rtsp://, http:// or https:// and include a valid host.");const te=n.some(be=>be.c_url===W&&(!h||be.c_code!==h.c_code));M(te?"Camera URL already exists":"")}function Le(W){if(!W)return C("");if(!gE(W))return C("Alphanumeric only (320 chars), e.g., CC001.");const te=n.some(be=>be.c_code===W&&(!h||be.c_code!==h.c_code));C(te?"Camera code already exists":"")}const Fe=()=>{v(""),T(""),_(""),g(null),C(""),w(""),M("")},$e=()=>{Fe(),c(!0)},pe=W=>{g(W),v(W.c_ip),T(W.c_url),_(W.c_code),C(""),w(""),M(""),c(!0)},Ne=()=>(de(y),_e(b),Le(E),!N&&!G&&!A&&Tg(y)&&hE(b)&&gE(E)),Ve=async()=>{if(!y||!b||!E){ce.error("Please fill all fields.");return}if(!Ne()){ce.error("Fix the highlighted errors.");return}try{h?(await Ot("public.ti_fc_sp_update_camera",[E,y,b]),ce.success("Camera updated in DB")):(await Ot("public.ti_fc_sp_insert_camera",[E,y,b]),ce.success("Camera added to DB"));const W=await Qe("public.fn_list_dim_camera");e(Array.isArray(W)?W:[]),c(!1),Fe()}catch(W){const te=(W.message||W).toString();te.includes("Camera code already exists")?(C("Camera code already exists."),ce.error("Camera code already exists.")):te.includes("Camera IP already exists")?(w("Camera IP already exists."),ce.error("Camera IP already exists.")):te.includes("Camera URL already exists")?(M("Camera URL already exists."),ce.error("Camera URL already exists.")):ce.error("Failed to save camera: "+te)}},Ge=async W=>{const te=n.find(be=>be.c_code===W);if(te)try{await Ot("public.ti_fc_sp_delete_camera",[te.c_code]),e(await Qe("public.fn_list_dim_camera")),ce.success("Camera deleted (flagged) in DB")}catch(be){ce.error("Failed to delete camera: "+(be.message||be))}},le=async()=>{if(!B||!V||!O||!ee){ce.error("Please select all mapping fields.");return}const W=t.find(we=>String(we.p_code)===String(V)),te=W?.p_name,be=W?.org_id,Ue=q.find(we=>we.id===be)?.name,We=I.find(we=>we.unit_code===O)?.unit_name,ie=Z.find(we=>we.s_code===ee)?.s_name;if(!te||!We||!ie||!Ue){ce.error("Failed to resolve all mapping names.");return}try{await Ot("public.ti_fc_sp_map_camera_to_plant_station",[B,te,We,ie,Ue]),ce.success("Camera mapped successfully"),d(!1),K(""),$(""),he(""),H([]),e(await Qe("public.fn_list_dim_camera"))}catch(we){let Ae="Failed to map camera";we&&typeof we=="object"&&"message"in we?Ae=we.message:typeof we=="string"&&(Ae=we),ce.error("Failed to map camera: "+Ae)}};return p.jsxs("div",{className:"min-h-screen bg-gray-100 w-full",children:[p.jsxs("div",{className:"flex justify-between items-center mb-6 px-10",children:[p.jsx("h2",{className:"text-3xl font-bold text-blue-900",children:"Cameras"}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:()=>d(!0),className:"bg-green-600 text-white px-6 py-3 rounded-xl shadow hover:bg-green-700 transition",children:"Map Camera"}),p.jsx("button",{onClick:$e,className:"bg-blue-600 text-white px-6 py-3 rounded-xl shadow hover:bg-blue-700 transition",children:"+ Add Camera"})]})]}),p.jsx("div",{className:"pb-10",children:p.jsx("div",{className:"overflow-x-auto",children:p.jsx("div",{className:"bg-white border border-[#cfe7ff] rounded-sm shadow-lg overflow-hidden w-full",children:p.jsxs("table",{className:"min-w-[800px] w-full text-sm border-separate border-spacing-0",children:[p.jsx("thead",{children:p.jsxs("tr",{className:"bg-[#cfe7ff] text-[#0c1e36] text-left text-sm",children:[p.jsx("th",{className:"px-4 py-3 font-semibold",children:"Camera Code"}),p.jsx("th",{className:"px-4 py-3 font-semibold",children:"IP"}),p.jsx("th",{className:"px-4 py-3 font-semibold",children:"URL"}),p.jsx("th",{className:"px-4 py-3 font-semibold",children:"Plant"}),p.jsx("th",{className:"px-4 py-3 font-semibold",children:"Station"}),p.jsx("th",{className:"px-4 py-3 font-semibold text-center w-40",children:"Actions"})]})}),p.jsx("tbody",{children:n.length===0?p.jsx("tr",{children:p.jsx("td",{colSpan:6,className:"px-4 py-6 text-center text-gray-400 italic",children:"No cameras added yet."})}):n.map(W=>p.jsxs("tr",{className:"bg-white text-[#0c1e36] shadow-sm hover:bg-[#e7f3ff] transition",children:[p.jsx("td",{className:"px-4 py-3 font-medium",children:W.c_code}),p.jsx("td",{className:"px-4 py-3 text-gray-700",children:W.c_ip}),p.jsx("td",{className:"px-4 py-3 text-blue-600 max-w-[480px] truncate",children:p.jsx("a",{href:W.c_url,target:"_blank",rel:"noreferrer",className:"hover:underline",title:W.c_url,children:W.c_url})}),p.jsx("td",{className:"px-4 py-3 text-gray-700",children:W.plant_code?t.find(te=>String(te.p_code).trim().toUpperCase()===String(W.plant_code).trim().toUpperCase())?.p_name||W.plant_code:"Not Mapped"}),p.jsx("td",{className:"px-4 py-3 text-gray-700",children:W.station_code?r.find(te=>String(te.s_code).trim().toUpperCase()===String(W.station_code).trim().toUpperCase())?.s_name||W.station_code:"Not Mapped"}),p.jsxs("td",{className:"px-4 py-3 text-center",children:[p.jsx("button",{onClick:()=>pe(W),className:"inline-block px-3 py-1 rounded-full text-blue-600 bg-blue-100 hover:bg-blue-200 text-xs font-semibold mr-2 transition",children:"Edit"}),p.jsx("button",{onClick:()=>Ge(W.c_code),className:"inline-block px-3 py-1 rounded-full text-red-600 bg-red-100 hover:bg-red-200 text-xs font-semibold transition",children:"Delete"})]})]},W.c_code))})]})})})}),p.jsxs(pE,{open:l,onClose:()=>c(!1),children:[p.jsx("h3",{className:"text-lg font-semibold mb-3",children:h?"Edit Camera":"Add Camera"}),p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Camera IP"}),p.jsx("input",{value:y,onChange:W=>{v(W.target.value),de(W.target.value)},onBlur:W=>de(W.target.value),placeholder:"e.g., 192.168.1.10",className:"border border-gray-300 rounded-lg w-full p-2 mb-1",onKeyDown:W=>{W.key==="Enter"&&Ve()}}),N&&p.jsx("div",{className:"text-red-500 text-xs mb-2",children:N}),p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Camera URL"}),p.jsx("input",{value:b,onChange:W=>{T(W.target.value),_e(W.target.value)},onBlur:W=>_e(W.target.value),placeholder:"e.g., rtsp://192.168.1.10:554/stream1 ",className:"border border-gray-300 rounded-lg w-full p-2 mb-1",onKeyDown:W=>{W.key==="Enter"&&Ve()}}),G&&p.jsx("div",{className:"text-red-500 text-xs mb-2",children:G}),p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Camera Code"}),p.jsx("input",{value:E,onChange:W=>{const te=mE(W.target.value);_(te),Le(te)},onBlur:W=>Le(mE(W.target.value)),placeholder:"e.g., CC001 (alphanumeric only)",className:"border border-gray-300 rounded-lg w-full p-2 mb-1",disabled:!!h,onKeyDown:W=>{W.key==="Enter"&&Ve()}}),A&&p.jsx("div",{className:"text-red-500 text-xs mb-2",children:A}),p.jsxs("div",{className:"flex justify-end gap-2 pt-1",children:[p.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 bg-gray-200 rounded-xl text-sm",children:"Cancel"}),p.jsx("button",{onClick:Ve,className:"px-4 py-2 bg-blue-600 text-white rounded-xl text-sm",children:h?"Update":"Add"})]})]}),p.jsxs(pE,{open:f,onClose:()=>d(!1),children:[p.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Map Camera"}),p.jsxs("select",{value:B,onChange:W=>K(W.target.value),className:"border border-gray-300 rounded-lg w-full p-2 mb-2",onKeyDown:W=>{W.key==="Enter"&&le()},children:[p.jsx("option",{value:"",children:"Select Camera"}),n.map(W=>p.jsx("option",{value:W.c_code,children:W.c_code},W.c_code))]}),p.jsxs("select",{value:V,onChange:async W=>{const te=W.target.value;if($(te),Y(""),he(""),j([]),H([]),!te)return;const be=t.find(ae=>String(ae.p_code)===String(te)),Ie=be?.org_id,Ue=be?.p_name,We=q.find(ae=>ae.id===Ie)?.name;if(!We||!Ue){j([]);return}J(!0);try{const ae=await Qe("public.fn_list_units_by_plant",[We,Ue]),ie=(Array.isArray(ae)?ae:ae?.rows||[]).map(we=>({unit_code:we.uname,unit_name:we.uname}));j(ie)}catch{j([])}J(!1)},className:"border border-gray-300 rounded-lg w-full p-2 mb-2",onKeyDown:W=>{W.key==="Enter"&&le()},children:[p.jsx("option",{value:"",children:"Select Plant"}),t.map(W=>p.jsx("option",{value:W.p_code,children:W.p_name},W.p_code))]}),p.jsxs("select",{value:O,onChange:async W=>{const te=W.target.value;if(Y(te),he(""),H([]),!te||!V)return;F(!0);const be=t.find(we=>String(we.p_code)===String(V)),Ie=be?.org_id,Ue=be?.p_name,We=q.find(we=>we.id===Ie)?.name,ie=I.find(we=>we.unit_code===te)?.unit_name;if(!We||!Ue||!ie){H([]),F(!1);return}try{const we=await Qe("public.fn_list_stations_by_unit",[We,Ue,ie]);let Ae=(Array.isArray(we)?we:we?.rows||[]).map(Me=>({s_code:Me.sname,s_name:Me.sname,p_code:V}));H(Ae)}catch{H([])}F(!1)},className:"border border-gray-300 rounded-lg w-full p-2 mb-2",disabled:!V||z,onKeyDown:W=>{W.key==="Enter"&&le()},children:[p.jsx("option",{value:"",children:"Select Unit"}),I.map(W=>p.jsx("option",{value:W.unit_code,children:W.unit_name},W.unit_code))]}),p.jsxs("select",{value:ee,onChange:W=>he(W.target.value),className:"border border-gray-300 rounded-lg w-full p-2 mb-2",disabled:!O||k,onKeyDown:W=>{W.key==="Enter"&&le()},children:[p.jsx("option",{value:"",children:"Select Station"}),Z.map(W=>p.jsx("option",{value:W.s_code,children:W.s_name},W.s_code))]}),k&&p.jsx("div",{className:"text-xs text-gray-400 px-2",children:"Loading stations..."}),p.jsxs("div",{className:"flex justify-end gap-2 pt-1",children:[p.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 bg-gray-200 rounded-xl text-sm",children:"Cancel"}),p.jsx("button",{onClick:le,className:"px-4 py-2 bg-green-600 text-white rounded-xl text-sm",children:"Map"})]})]}),p.jsx(Dr,{position:"top-right",autoClose:2e3})]})};var Ku={exports:{}},cU=Ku.exports,yE;function uU(){return yE||(yE=1,(function(n,e){(function(t,s){n.exports=s()})(cU,(function(){var t=1e3,s=6e4,r=36e5,a="millisecond",l="second",c="minute",f="hour",d="day",h="week",g="month",y="quarter",v="year",b="date",T="Invalid Date",E=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,_=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,A={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(Z){var H=["th","st","nd","rd"],k=Z%100;return"["+Z+(H[(k-20)%10]||H[k]||H[0])+"]"}},C=function(Z,H,k){var F=String(Z);return!F||F.length>=H?Z:""+Array(H+1-F.length).join(k)+Z},N={s:C,z:function(Z){var H=-Z.utcOffset(),k=Math.abs(H),F=Math.floor(k/60),O=k%60;return(H<=0?"+":"-")+C(F,2,"0")+":"+C(O,2,"0")},m:function Z(H,k){if(H.date()<k.date())return-Z(k,H);var F=12*(k.year()-H.year())+(k.month()-H.month()),O=H.clone().add(F,g),Y=k-O<0,I=H.clone().add(F+(Y?-1:1),g);return+(-(F+(k-O)/(Y?O-I:I-O))||0)},a:function(Z){return Z<0?Math.ceil(Z)||0:Math.floor(Z)},p:function(Z){return{M:g,y:v,w:h,d,D:b,h:f,m:c,s:l,ms:a,Q:y}[Z]||String(Z||"").toLowerCase().replace(/s$/,"")},u:function(Z){return Z===void 0}},w="en",G={};G[w]=A;var M="$isDayjsObject",B=function(Z){return Z instanceof ee||!(!Z||!Z[M])},K=function Z(H,k,F){var O;if(!H)return w;if(typeof H=="string"){var Y=H.toLowerCase();G[Y]&&(O=Y),k&&(G[Y]=k,O=Y);var I=H.split("-");if(!O&&I.length>1)return Z(I[0])}else{var j=H.name;G[j]=H,O=j}return!F&&O&&(w=O),O||!F&&w},V=function(Z,H){if(B(Z))return Z.clone();var k=typeof H=="object"?H:{};return k.date=Z,k.args=arguments,new ee(k)},$=N;$.l=K,$.i=B,$.w=function(Z,H){return V(Z,{locale:H.$L,utc:H.$u,x:H.$x,$offset:H.$offset})};var ee=(function(){function Z(k){this.$L=K(k.locale,null,!0),this.parse(k),this.$x=this.$x||k.x||{},this[M]=!0}var H=Z.prototype;return H.parse=function(k){this.$d=(function(F){var O=F.date,Y=F.utc;if(O===null)return new Date(NaN);if($.u(O))return new Date;if(O instanceof Date)return new Date(O);if(typeof O=="string"&&!/Z$/i.test(O)){var I=O.match(E);if(I){var j=I[2]-1||0,z=(I[7]||"0").substring(0,3);return Y?new Date(Date.UTC(I[1],j,I[3]||1,I[4]||0,I[5]||0,I[6]||0,z)):new Date(I[1],j,I[3]||1,I[4]||0,I[5]||0,I[6]||0,z)}}return new Date(O)})(k),this.init()},H.init=function(){var k=this.$d;this.$y=k.getFullYear(),this.$M=k.getMonth(),this.$D=k.getDate(),this.$W=k.getDay(),this.$H=k.getHours(),this.$m=k.getMinutes(),this.$s=k.getSeconds(),this.$ms=k.getMilliseconds()},H.$utils=function(){return $},H.isValid=function(){return this.$d.toString()!==T},H.isSame=function(k,F){var O=V(k);return this.startOf(F)<=O&&O<=this.endOf(F)},H.isAfter=function(k,F){return V(k)<this.startOf(F)},H.isBefore=function(k,F){return this.endOf(F)<V(k)},H.$g=function(k,F,O){return $.u(k)?this[F]:this.set(O,k)},H.unix=function(){return Math.floor(this.valueOf()/1e3)},H.valueOf=function(){return this.$d.getTime()},H.startOf=function(k,F){var O=this,Y=!!$.u(F)||F,I=$.p(k),j=function(Fe,$e){var pe=$.w(O.$u?Date.UTC(O.$y,$e,Fe):new Date(O.$y,$e,Fe),O);return Y?pe:pe.endOf(d)},z=function(Fe,$e){return $.w(O.toDate()[Fe].apply(O.toDate("s"),(Y?[0,0,0,0]:[23,59,59,999]).slice($e)),O)},J=this.$W,q=this.$M,P=this.$D,de="set"+(this.$u?"UTC":"");switch(I){case v:return Y?j(1,0):j(31,11);case g:return Y?j(1,q):j(0,q+1);case h:var _e=this.$locale().weekStart||0,Le=(J<_e?J+7:J)-_e;return j(Y?P-Le:P+(6-Le),q);case d:case b:return z(de+"Hours",0);case f:return z(de+"Minutes",1);case c:return z(de+"Seconds",2);case l:return z(de+"Milliseconds",3);default:return this.clone()}},H.endOf=function(k){return this.startOf(k,!1)},H.$set=function(k,F){var O,Y=$.p(k),I="set"+(this.$u?"UTC":""),j=(O={},O[d]=I+"Date",O[b]=I+"Date",O[g]=I+"Month",O[v]=I+"FullYear",O[f]=I+"Hours",O[c]=I+"Minutes",O[l]=I+"Seconds",O[a]=I+"Milliseconds",O)[Y],z=Y===d?this.$D+(F-this.$W):F;if(Y===g||Y===v){var J=this.clone().set(b,1);J.$d[j](z),J.init(),this.$d=J.set(b,Math.min(this.$D,J.daysInMonth())).$d}else j&&this.$d[j](z);return this.init(),this},H.set=function(k,F){return this.clone().$set(k,F)},H.get=function(k){return this[$.p(k)]()},H.add=function(k,F){var O,Y=this;k=Number(k);var I=$.p(F),j=function(q){var P=V(Y);return $.w(P.date(P.date()+Math.round(q*k)),Y)};if(I===g)return this.set(g,this.$M+k);if(I===v)return this.set(v,this.$y+k);if(I===d)return j(1);if(I===h)return j(7);var z=(O={},O[c]=s,O[f]=r,O[l]=t,O)[I]||1,J=this.$d.getTime()+k*z;return $.w(J,this)},H.subtract=function(k,F){return this.add(-1*k,F)},H.format=function(k){var F=this,O=this.$locale();if(!this.isValid())return O.invalidDate||T;var Y=k||"YYYY-MM-DDTHH:mm:ssZ",I=$.z(this),j=this.$H,z=this.$m,J=this.$M,q=O.weekdays,P=O.months,de=O.meridiem,_e=function($e,pe,Ne,Ve){return $e&&($e[pe]||$e(F,Y))||Ne[pe].slice(0,Ve)},Le=function($e){return $.s(j%12||12,$e,"0")},Fe=de||function($e,pe,Ne){var Ve=$e<12?"AM":"PM";return Ne?Ve.toLowerCase():Ve};return Y.replace(_,(function($e,pe){return pe||(function(Ne){switch(Ne){case"YY":return String(F.$y).slice(-2);case"YYYY":return $.s(F.$y,4,"0");case"M":return J+1;case"MM":return $.s(J+1,2,"0");case"MMM":return _e(O.monthsShort,J,P,3);case"MMMM":return _e(P,J);case"D":return F.$D;case"DD":return $.s(F.$D,2,"0");case"d":return String(F.$W);case"dd":return _e(O.weekdaysMin,F.$W,q,2);case"ddd":return _e(O.weekdaysShort,F.$W,q,3);case"dddd":return q[F.$W];case"H":return String(j);case"HH":return $.s(j,2,"0");case"h":return Le(1);case"hh":return Le(2);case"a":return Fe(j,z,!0);case"A":return Fe(j,z,!1);case"m":return String(z);case"mm":return $.s(z,2,"0");case"s":return String(F.$s);case"ss":return $.s(F.$s,2,"0");case"SSS":return $.s(F.$ms,3,"0");case"Z":return I}return null})($e)||I.replace(":","")}))},H.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},H.diff=function(k,F,O){var Y,I=this,j=$.p(F),z=V(k),J=(z.utcOffset()-this.utcOffset())*s,q=this-z,P=function(){return $.m(I,z)};switch(j){case v:Y=P()/12;break;case g:Y=P();break;case y:Y=P()/3;break;case h:Y=(q-J)/6048e5;break;case d:Y=(q-J)/864e5;break;case f:Y=q/r;break;case c:Y=q/s;break;case l:Y=q/t;break;default:Y=q}return O?Y:$.a(Y)},H.daysInMonth=function(){return this.endOf(g).$D},H.$locale=function(){return G[this.$L]},H.locale=function(k,F){if(!k)return this.$L;var O=this.clone(),Y=K(k,F,!0);return Y&&(O.$L=Y),O},H.clone=function(){return $.w(this.$d,this)},H.toDate=function(){return new Date(this.valueOf())},H.toJSON=function(){return this.isValid()?this.toISOString():null},H.toISOString=function(){return this.$d.toISOString()},H.toString=function(){return this.$d.toUTCString()},Z})(),he=ee.prototype;return V.prototype=he,[["$ms",a],["$s",l],["$m",c],["$H",f],["$W",d],["$M",g],["$y",v],["$D",b]].forEach((function(Z){he[Z[1]]=function(H){return this.$g(H,Z[0],Z[1])}})),V.extend=function(Z,H){return Z.$i||(Z(H,ee,V),Z.$i=!0),V},V.locale=K,V.isDayjs=B,V.unix=function(Z){return V(1e3*Z)},V.en=G[w],V.Ls=G,V.p={},V}))})(Ku)),Ku.exports}var dU=uU();const br=Ag(dU),xE=["A","B","C"],vE=["Day 1","Day 2"],Am=[{id:"p1",name:"Alpha Plant"},{id:"p2",name:"Beta Plant"}],_m=[{id:"s1",name:"Station A1",plantId:"p1"},{id:"s2",name:"Station A2",plantId:"p1"},{id:"s3",name:"Station B1",plantId:"p2"},{id:"s4",name:"Station B2",plantId:"p2"}],Ru=[{id:"e1",name:"Alice",plantId:"p1"},{id:"e2",name:"Bob",plantId:"p1"},{id:"e3",name:"Charlie",plantId:"p1"},{id:"e4",name:"David",plantId:"p2"},{id:"e5",name:"Eve",plantId:"p2"},{id:"e6",name:"Frank",plantId:"p2"}],bE=n=>{const e=localStorage.getItem(n);try{return e?JSON.parse(e):[]}catch{return[]}},SE=(n,e)=>{localStorage.setItem(n,JSON.stringify(e))},xl=br().format("YYYY-MM-DD"),fU=()=>{const[n,e]=R.useState(bE("mappedPlantShifts")),[t,s]=R.useState(bE("shifts")),[r,a]=R.useState(0),[,l]=R.useState(!1),[c,f]=R.useState(null),[d,h]=R.useState(!1),[g,y]=R.useState(!1),[v,b]=R.useState([]),[T,E]=R.useState(""),[_,A]=R.useState([]),[C,N]=R.useState(!1),[w,G]=R.useState(""),[M,B]=R.useState([]),[K,V]=R.useState([]),[$,ee]=R.useState([]),[he,Z]=R.useState([]),[H,k]=R.useState(""),[F,O]=R.useState(""),[Y,I]=R.useState(""),[j,z]=R.useState(xl),[J,q]=R.useState(""),[P,de]=R.useState([]),[_e,Le]=R.useState([]),[Fe,$e]=R.useState(!1),[pe,Ne]=R.useState(!1),[Ve,Ge]=R.useState(!1),[le,W]=R.useState(!1),[,te]=R.useState([]),[be,Ie]=R.useState(null),[Ue,Ke]=R.useState([]),[We,ae]=R.useState(!1),[ie,we]=R.useState({visible:!1,mode:null,message:"",payload:null}),Ae=ne=>ne?Array.isArray(ne)?ne:ne.rows?ne.rows:ne.data?ne.data:ne.result?ne.result:[]:[],Me=R.useMemo(()=>(P.length?P:_m).filter(ne=>String(ne.plantId)===String(F)),[F,P,_m]),mt=R.useMemo(()=>(_e.length?_e:Ru).filter(Re=>String(Re.plantId)===String(F)),[F,_e]);R.useEffect(()=>SE("shifts",t),[t]),R.useEffect(()=>SE("mappedPlantShifts",n),[n]),R.useEffect(()=>{if(!F||!Y||!j){te([]);return}const ne=br(j),ke=br(j).diff(ne,"day"),je=[];for(let ze=0;ze<=ke;ze++){const De=ne.add(ze,"day"),Pe=De.format("DD-MM-YYYY"),qe=De.format("dddd"),tt={A:"",B:"",C:""};if(be){const St={...tt};xE.forEach(At=>{const Xs=be.find(ws=>ws.date===Pe&&ws.shiftType===At);Xs&&(St[At]=Xs.employeeId)}),je.push({date:Pe,day:qe,shifts:St})}else je.push({date:Pe,day:qe,shifts:tt})}te(je)},[F,Y,j,be]),R.useEffect(()=>{d&&(async()=>{try{N(!0);const ne=await Qe("public.list_organisations",[]),ke=((Array.isArray(ne)?ne:ne?.rows??ne?.data??ne?.result??[])||[]).map(je=>{const ze=je.rid??je.id??null,De=je.org_code??je.code??"",Pe=je.org_name??je.name??"";return{id:String(ze??De??""),code:String(De??""),name:String(Pe??"")}}).filter(je=>je.id&&je.name);A(ke),!T&&ke.length&&E(ke[0].id)}catch(ne){console.error("Failed to fetch organisations for Add Shift modal:",ne),A([]),ce.error("Failed to fetch organisations for Add Shift modal.")}finally{N(!1)}})()},[d]),R.useEffect(()=>{(async()=>{try{const ne=await Qe("public.list_organisations",[]),ke=((Array.isArray(ne)?ne:ne?.rows??[])||[]).map(je=>({id:String(je.rid??je.org_code??""),code:String(je.org_code??""),name:String(je.org_name??je.name??"")}));B(ke)}catch(ne){console.error("Failed to load organisations on mount:",ne)}})()},[]),R.useEffect(()=>{if(V([]),de([]),O(""),I(""),!w)return;let ne=!1;return(async()=>{Ne(!0);try{const Re=Number.isFinite(Number(w))?Number(w):w;console.debug("[Plan] loading plants for org:",w,"arg:",Re);const ke=await Qe("public.fn_list_plants_by_org",[Re]),ze=(Ae(ke)||[]).map(De=>{const Pe=De.pid??De.p_id??De.id??"",qe=De.p_code??De.plant_code??"",tt=De.p_name??De.pname??De.plant_name??De.name??"";return{id:qe?String(qe):Pe!==void 0?String(Pe):"",name:tt}}).filter(De=>De.id&&De.name);console.debug("[Plan] plants returned:",ze),ne||V(ze)}catch(Re){console.error("Failed to load plants for plan orgId",w,Re),ne||V([]),ce.error("Failed to load plants for selected organisation (Plan).")}finally{ne||Ne(!1)}})(),()=>{ne=!0}},[w]),R.useEffect(()=>{if(ee([]),q(""),!T)return;let ne=!1;return(async()=>{Ge(!0);try{const Re=Number.isFinite(Number(T))?Number(T):T;console.debug("[Add] loading plants for addOrgId:",T,"arg:",Re);const ke=await Qe("public.fn_list_plants_by_org",[Re]),ze=(Ae(ke)||[]).map(De=>{const Pe=De.pid??De.p_id??De.id??"",qe=De.p_code??De.plant_code??"",tt=De.p_name??De.pname??De.plant_name??De.name??"";return{id:qe?String(qe):Pe!==void 0?String(Pe):"",name:tt}}).filter(De=>De.id&&De.name);console.debug("[Add] plants returned:",ze),ne||(ee(ze),!J&&ze.length&&q(ze[0].id))}catch(Re){console.error("Failed to load plants for addOrgId",T,Re),ne||ee([]),ce.error("Failed to load plants for selected organisation (Add).")}finally{ne||Ge(!1)}})(),()=>{ne=!0}},[T]),R.useEffect(()=>{if(de([]),I(""),!w||!F||!H)return;let ne=!1;const Re=M.find(De=>String(De.id)===String(w)||String(De.code)===String(w)),ke=K.find(De=>String(De.id)===String(F)),je=Re?Re.name:w,ze=ke?ke.name:F;return(async()=>{W(!0);try{const De=await Qe("public.fn_list_stations_by_unit",[je,ze,H]),qe=(Array.isArray(De)?De:De?.rows??De?.data??De?.result??[]).map(tt=>({id:tt.sname??tt.id??tt.name??"",name:tt.sname??tt.name??"",plantId:F})).filter(tt=>tt.id&&tt.name);ne||de(qe)}catch(De){ne||de([]),console.error("Failed to load stations for selected unit:",De),ce.error("Failed to load stations for selected unit.")}finally{ne||W(!1)}})(),()=>{ne=!0}},[w,F,H,M,K]),R.useEffect(()=>{if(Z([]),k(""),!w||!F)return;let ne=!1;const Re=M.find(De=>String(De.id)===String(w)||String(De.code)===String(w)),ke=K.find(De=>String(De.id)===String(F)),je=Re?Re.name:w,ze=ke?ke.name:F;return(async()=>{try{const De=await Qe("public.fn_list_units_by_plant",[je,ze]),qe=(Array.isArray(De)?De:De?.rows??De?.data??De?.result??[]).map(tt=>String(tt.uname)).filter(Boolean);ne||Z(qe),!ne&&qe.length&&k(qe[0])}catch(De){ne||Z([]),console.error("Failed to load units:",De),ce.error("Failed to load units for selected plant/organisation.")}})(),()=>{ne=!0}},[w,F,M,K]),R.useEffect(()=>{if(Ke([]),!w||!F)return;let ne=!1;const Re=M.find(De=>String(De.id)===String(w)||String(De.code)===String(w)),ke=K.find(De=>String(De.id)===String(F)),je=Re?Re.name:String(w),ze=ke?ke.name:String(F);return(async()=>{ae(!0);try{const De=[je,ze];let Pe;try{Pe=await Qe("public.fn_list_shift_by_plant",De)}catch{Pe=await Qe("public.fn_list_shifts_by_plant",De)}let qe=Array.isArray(Pe)?Pe:Pe?.rows??Pe?.data??Pe?.result??[];if((!qe||qe.length===0)&&H)try{Pe=await Qe("public.fn_list_shift_by_unit",[je,ze,H]),qe=Array.isArray(Pe)?Pe:Pe?.rows??Pe?.data??Pe?.result??[]}catch{}const tt=(qe||[]).map(At=>String(At.sf_name??At.shift_name??At.s_name??At.sfname??At.shift??At.type??At.name??"").trim()).filter(Boolean),St=[...new Set(tt)];ne||(Ke(St.length?St:["A","B","C"]),St.length||(console.warn("[Plan] No shifts returned; using A/B/C fallback"),ce.info("No shifts returned for this plant; showing default A/B/C.")))}catch(De){ne||Ke(["A","B","C"]),console.error("Failed to load shifts:",De),ce.error("Failed to load shifts for selected plant/organisation.")}finally{ne||ae(!1)}})(),()=>{ne=!0}},[w,F,H,M,K]),R.useEffect(()=>{let ne=!1;return(async()=>{l(!0);try{const Re=await Qe("public.fn_list_planned_shifts",[]),je=(Ae(Re)||[]).map((ze,De)=>{const Pe=ze.org_code??"",qe=ze.plant_code??"",tt=ze.station_code??"",St=String(ze.shift??"")||"A",At=String(ze.user_code??""),Xs=M.find(ve=>String(ve.code)===String(Pe)||String(ve.id)===String(Pe)),ws=Xs?Xs.name:Pe,js=K.find(ve=>String(ve.id)===String(qe)||String(ve.name)===String(qe))||$.find(ve=>String(ve.id)===String(qe)||String(ve.name)===String(qe))||Am.find(ve=>String(ve.id)===String(qe)||String(ve.name)===String(qe)),Ts=js?js.name:qe,Et=P.find(ve=>String(ve.id)===String(tt)||String(ve.name)===String(tt))||_m.find(ve=>String(ve.id)===String(tt)||String(ve.name)===String(tt)),Vt=Et?Et.name:tt,Zn=(_e.length?_e:Ru).find(ve=>String(ve.u_code??ve.username??ve.id)===String(At)||String(ve.id)===String(At)||String(ve.name)===String(At)),ua=Zn?Zn.name:At,X=br().format("DD-MM-YYYY"),ge=br().format("dddd");return{id:`${X}-${St}-${tt}-${De}-${Math.random().toString(36).slice(2,6)}`,date:X,day:ge,shiftType:St,employeeId:String(At),employeeName:ua,plantId:String(qe),unitName:ze.unit_name??ze.unitName??"",plantName:Ts,stationId:String(tt),stationName:Vt,orgId:String(Pe),orgName:ws,dbRid:ze.rid}});ne||e(je)}catch(Re){console.error("Failed to fetch planned shifts:",Re),ce.error("Failed to load planned shifts.")}finally{ne||l(!1)}})(),()=>{ne=!0}},[r,M,K,$,P,_e]),R.useEffect(()=>{if(Le([]),$e(!0),!w&&!F){$e(!1);return}let ne=!1;return(async()=>{try{const Re=await Qe("public.fn_list_users",[]),ke=Ae(Re),je=M.find(Pe=>String(Pe.id)===String(w)||String(Pe.code)===String(w)||String(Pe.name)===String(w)),ze=[];je?(ze.push(String(je.id)),je.code&&ze.push(String(je.code)),je.name&&ze.push(String(je.name))):w&&ze.push(String(w));const De=(ke||[]).filter(Pe=>{if((Pe.role_name??Pe.role_nam??Pe.rolecode??"").toString().trim().toLowerCase()!=="operator")return!1;if(!ze.length)return!0;const tt=String(Pe.org_id??Pe.orgcode??Pe.org??"").trim();return ze.some(St=>String(St).trim()===tt)});if(console.debug("[Users] filtered operators:",De?.length??0),(De||[]).length>0){const Pe=De.map(qe=>{const tt=(qe.u_first_name??qe.first_name??"").toString().trim(),St=(qe.u_last_name??qe.last_name??"").toString().trim(),At=tt||St?`${tt} ${St}`.trim():qe.username??qe.u_email??"";return{id:String(qe.u_code??qe.username??qe.u_email??qe.uid??""),name:At,firstName:tt,lastName:St,plantId:F?String(F):"",username:String(qe.username??""),u_code:String(qe.u_code??"")}}).filter(qe=>qe.id&&qe.name);ne||Le(Pe),$e(!1);return}throw console.debug("[Users] list_users2 returned no operators for org; falling back to fn_list_employees_by_plant"),new Error("No operators found via list_users2")}catch{try{if(!F){ne||Le([]);return}const ke=Number.isFinite(Number(F))?Number(F):F,je=await Qe("public.fn_list_employees_by_plant",[ke]),De=(Ae(je)||[]).map(Pe=>{const qe=(Pe.emp_first_name??Pe.u_first_name??Pe.first_name??"").toString().trim(),tt=(Pe.emp_last_name??Pe.u_last_name??Pe.last_name??"").toString().trim(),St=qe||tt?`${qe} ${tt}`.trim():Pe.emp_name??Pe.name??Pe.display_name??Pe.username??"";return{id:String(Pe.emp_id??Pe.id??Pe.uid??Pe.emp_code??Pe.username??""),name:St,firstName:qe,lastName:tt,plantId:String(F),username:String(Pe.username??""),u_code:String(Pe.emp_code??Pe.u_code??"")}}).filter(Pe=>Pe.id&&Pe.name);ne||Le(De)}catch(ke){console.error("Failed to fetch employees (both list_users2 and fn_list_employees_by_plant failed):",ke),ne||Le([]),ce.error("Failed to load users for selected plant/organisation.")}finally{ne||$e(!1)}}})(),()=>{ne=!0}},[w,F,M]);const _t=ne=>{const Re=n.find(ke=>ke.id===ne);Re&&(O(Re.plantId?String(Re.plantId):""),I(Re.stationId?String(Re.stationId):""),z(br(Re.date,"DD-MM-YYYY").format("YYYY-MM-DD")),xn(Re.shiftType??""),vn(Re.employeeName??""),Ie([Re]),f(Re.dbRid?Number(Re.dbRid):null),y(!0))},jt=(ne,Re,ke)=>{b(je=>{const ze=[...je];return ze[ne][Re]=ke,ze})},ts=()=>{b([{id:"",type:"A",dayStart:"Day 1",startTime:"",dayEnd:"Day 1",endTime:""},{id:"",type:"B",dayStart:"Day 1",startTime:"",dayEnd:"Day 1",endTime:""},{id:"",type:"C",dayStart:"Day 1",startTime:"",dayEnd:"Day 2",endTime:""}]),E(""),q(""),ee([]),h(!0)},Ys=()=>{T&&(console.debug("Opening Plan modal with addOrgId:",T),G(T)),f(null),y(!0)},Os=(ne,Re,ke)=>we({visible:!0,mode:ne,message:Re,payload:ke}),Dt=()=>we({visible:!1,mode:null,message:"",payload:null}),Ms=async()=>{if(!ie.mode){Dt();return}try{ie.mode==="delete"?ie.payload&&ie.payload.rid?await yn(ie.payload.rid):await On(ie.payload):ie.mode==="update"&&await xi(ie.payload)}catch(ne){console.error("Error during confirm action:",ne)}finally{Dt()}},yn=async ne=>{if(!ne){ce.error("Missing record id (rid).");return}try{await Ot("public.ti_fc_sp_delete_planned_shift",[Number(ne)]),ce.success("Planned shift deleted."),a(Re=>Re+1)}catch(Re){console.error("Failed to delete planned shift:",Re),ce.error(`Delete failed: ${Re?.message||Re}`)}},On=async ne=>{try{const Re=ne.orgName||_.find(ke=>ke.id===ne.orgId)?.name||"";if(!Re){ce.error("Organisation name not available for delete.");return}await Ot("public.ti_fc_sp_delete_shift_details",[ne.type,Re]),s(ke=>ke.filter(je=>je.id!==ne.id)),ce.success(`Shift ${ne.type} deleted (soft-delete).`)}catch(Re){console.error("Failed to delete shift:",Re),ce.error(`Failed to delete shift: ${Re?.message||Re}`)}},xi=async ne=>{try{const{fs:Re,orgName:ke}=ne,je=`${Re.startTime}:00`,ze=`${Re.endTime}:00`;await Ot("public.ti_fc_sp_update_shift_details",[Re.type,je,ze,ke]),s(De=>De.map(Pe=>Pe.id===Re.id?{...Pe,startTime:Re.startTime,endTime:Re.endTime}:Pe)),h(!1),b([]),E(""),ee([]),ce.success(`Shift ${Re.type} updated successfully.`)}catch(Re){console.error("Failed to update shift:",Re),ce.error(`Failed to update shift: ${Re?.message||Re}`)}},Wn=async()=>{if(!T){ce.error("Please select an Organisation before saving shifts.");return}for(let ke=0;ke<v.length;ke++){const je=v[ke];if(!je.startTime||!je.endTime){ce.error("Please provide Start and End times for all shifts.");return}}const ne=_.find(ke=>String(ke.id)===String(T)||String(ke.code)===String(T));if(!ne){console.error("Organisation lookup failed in saveShifts()",{addOrgId:T,orgsForAdd:_}),ce.error("Organisation name not found. Please re-select the organisation.");return}const Re=ne.name;try{if(v.length===1&&!!v[0].id&&t.some(Pe=>Pe.id===v[0].id)){Os("update",`Confirm update shift ${v[0].type}?`,{fs:v[0],orgName:Re});return}const je=$.find(Pe=>String(Pe.id)===String(J)),ze=je?je.name:J;for(const Pe of v){const qe=Pe.startTime,tt=Pe.endTime;await Ot("public.ti_fc_sp_insert_shift_details2",[Re,ze,Pe.type,qe,tt])}const De=v.map(Pe=>({...Pe,id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,orgId:T,orgName:Re}));s(Pe=>[...Pe,...De]),h(!1),b([]),E(""),ee([]),q(""),ce.success("Shifts saved successfully (organisation only).")}catch(ke){console.error("Failed to save shifts:",ke),ce.error(`Failed to save shifts: ${ke?.message||ke}`)}},[Qn,xn]=R.useState(""),[ps,vn]=R.useState(""),vi=async()=>{if(!c){ce.error("Missing record id (rid).");return}const ne=String(ps??""),Re=P.find(je=>String(je.id)===String(Y)),ke=Re?Re.name:String(Y??"");if((!ne||ne==="")&&(!ke||ke==="")){ce.error("Please select a user or station to update.");return}try{await Ot("public.ti_fc_sp_update_planned_shifts",[Number(c),ke,ne]),ce.success("Planned shift updated."),a(je=>je+1),xn(""),vn(""),z(xl),O(""),I(""),Ie(null),f(null),Le([]),de([]),y(!1)}catch(je){console.error("Failed to update planned shift:",je),ce.error(`Update failed: ${je?.message||je}`)}},Mn=async()=>{if(!w){ce.error("Please select an Organisation (Plan).");return}if(!F){ce.error("Please select a Plant.");return}if(!Y){ce.error("Please select a Station.");return}if(!Qn){ce.error("Please select a Shift.");return}if(!ps){ce.error("Please select a User.");return}try{const ne=M.find(Et=>String(Et.id)===String(w)||String(Et.code)===String(w)),Re=ne?.name??String(w??""),je=K.find(Et=>String(Et.id)===String(F))?.name??Am.find(Et=>String(Et.id)===String(F))?.name??String(F??""),De=P.find(Et=>String(Et.id)===String(Y))?.name??Me.find(Et=>String(Et.id)===String(Y))?.name??String(Y??""),qe=(_e.length?_e:Ru).find(Et=>String(Et.name)===String(ps)||String(Et.u_code??Et.username??Et.id)===String(ps)||String(Et.id)===String(ps));let tt=String(ps??"").trim();(!tt||tt==="undefined")&&qe&&(tt=qe.name??String(qe.id));const St=String(Qn??"").trim().toUpperCase();if(!Re||!je||!De||!tt||!St){ce.error("Missing values. Please ensure Organisation, Plant, Station, Shift and User are selected.");return}const At=[Re,je,H,De,St,tt];console.log("[Plan] Sending SP args array ->",At),await Ot("public.ti_fc_sp_insert_planned_shifts",At);const Xs=qe??(_e.length?_e[0]:Ru[0])??{id:String(ps),name:tt},ws=je,js=De,Ts={id:`${j}-${Qn}-${ps}-${Math.random().toString(36).slice(2,6)}`,date:br(j).format("DD-MM-YYYY"),day:br(j).format("dddd"),shiftType:Qn,employeeId:ps,employeeName:Xs?.name||tt||"",plantId:String(F),plantName:ws,stationId:String(Y),stationName:js,orgId:String(ne?.id??w??""),orgName:String(ne?.name??Re??"")};e(Et=>[...Et.filter(Vt=>!(Vt.date===Ts.date&&Vt.plantId===Ts.plantId&&Vt.stationId===Ts.stationId&&Vt.shiftType===Ts.shiftType)),Ts]),ce.success("Planned shift saved (inserted in DB)."),a(Et=>Et+1),xn(""),vn(""),z(xl),O(""),I(""),G(""),Le([]),de([]),y(!1)}catch(ne){console.error("Failed to save planned shift via SP:",ne),ce.error(`Failed to save planned shift: ${ne?.message||ne}`)}},qs=()=>{Ys()},zi=ne=>{Os("delete",`Are you sure you want to delete shift ${ne.type} for ${ne.orgName||"this organisation"}?`,ne)};return p.jsxs("div",{className:"h-screen bg-blue-50 py-2 overflow-hidden",children:[p.jsxs("div",{className:"mx-auto max-w-[1400px] px-3",children:[p.jsxs("div",{className:"flex justify-between items-center mb-2",children:[p.jsx("h2",{className:"text-2xl font-bold text-blue-900",children:"Shift Management"}),p.jsxs("div",{className:"space-x-2",children:[p.jsx("button",{onClick:ts,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Add Shift"}),p.jsx("button",{onClick:qs,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Plan Shift"})]})]}),d&&p.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center",children:p.jsxs("div",{className:"bg-white p-6 rounded-xl w-full max-w-3xl space-y-4 shadow-lg",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("h3",{className:"text-xl font-semibold",children:"Add Shift"}),p.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 text-xl","aria-label":"Close",children:""})]}),p.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-2",children:[p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Organisation"}),p.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:T,onChange:ne=>E(String(ne.target.value)),children:[p.jsx("option",{value:"",children:C?"Loading organisations...":"Select Organisation"}),_.map(ne=>p.jsx("option",{value:ne.id,children:ne.name},ne.id))]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Plant"}),p.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:J,onChange:ne=>q(String(ne.target.value)),disabled:!T||Ve,children:[p.jsx("option",{value:"",children:Ve?"Loading plants":T?"Select Plant":"Select Org first"}),$.map(ne=>p.jsx("option",{value:String(ne.id),children:ne.name},String(ne.id)))]}),p.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Plants shown are filtered by the Organisation selected above."})]}),p.jsx("div",{})," "]}),p.jsxs("div",{className:"grid grid-cols-5 gap-4 font-semibold",children:[p.jsx("div",{children:"Shift"}),p.jsx("div",{children:"Start Day"}),p.jsx("div",{children:"Start Time"}),p.jsx("div",{children:"End Day"}),p.jsx("div",{children:"End Time"})]}),v.map((ne,Re)=>p.jsxs("div",{className:"grid grid-cols-5 gap-4 items-center",children:[p.jsx("select",{className:"border rounded px-2 py-1",value:ne.type,onChange:ke=>jt(Re,"type",ke.target.value),children:xE.map(ke=>p.jsx("option",{value:ke,children:ke},ke))}),p.jsx("select",{className:"border rounded px-2 py-1",value:ne.dayStart,onChange:ke=>jt(Re,"dayStart",ke.target.value),children:vE.map(ke=>p.jsx("option",{value:ke,children:ke},ke))}),p.jsx("input",{type:"time",className:"border rounded px-2 py-1",value:ne.startTime,onChange:ke=>jt(Re,"startTime",ke.target.value)}),p.jsx("select",{className:"border rounded px-2 py-1",value:ne.dayEnd,onChange:ke=>jt(Re,"dayEnd",ke.target.value),children:vE.map(ke=>p.jsx("option",{value:ke,children:ke},ke))}),p.jsx("input",{type:"time",className:"border rounded px-2 py-1",value:ne.endTime,onChange:ke=>jt(Re,"endTime",ke.target.value)})]},Re)),p.jsx("div",{className:"text-right",children:p.jsx("button",{className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:opacity-50",onClick:Wn,disabled:!T,children:"Save Shifts"})})]})}),g&&p.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:p.jsxs("div",{className:"bg-white rounded-lg w-full max-w-xl p-6 shadow-lg",children:[p.jsxs("div",{className:"flex justify-between mb-4",children:[p.jsx("h3",{className:"text-xl font-semibold",children:"Plan Single Shift"}),p.jsx("button",{onClick:()=>{xn(""),vn(""),z(xl),O(""),I(""),Ie(null),y(!1),G(""),f(null)},className:"text-xl","aria-label":"Close",children:""})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium block mb-1",children:"Organisation"}),p.jsxs("select",{value:w,onChange:ne=>G(String(ne.target.value)),className:"w-full border px-3 py-2 rounded",children:[p.jsx("option",{value:"",children:M.length?"Select Organisation":"Loading Organisations..."}),M.map(ne=>p.jsx("option",{value:ne.id,children:ne.name},ne.id))]}),p.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Choose organisation first  Plant list is filtered by this."})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium block mb-1",children:"Plant"}),p.jsxs("select",{value:F!==""?String(F):"",onChange:ne=>{const Re=ne.target.value;console.debug("[Plan Modal] plant changed:",Re),O(Re),I(""),vn("")},className:"w-full border px-3 py-2 rounded",disabled:!w||pe,children:[p.jsx("option",{value:"",children:pe?"Loading plants":w?"Select Plant":"Select Organisation first"}),(K.length?K:Am).map(ne=>p.jsx("option",{value:String(ne.id),children:ne.name},String(ne.id)))]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium block mb-1",children:"Unit"}),p.jsxs("select",{value:H,onChange:ne=>k(ne.target.value),className:"w-full border px-3 py-2 rounded",disabled:!F||!he.length,children:[p.jsx("option",{value:"",children:he.length?"Select Unit":"No units"}),he.map(ne=>p.jsx("option",{value:ne,children:ne},ne))]}),p.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Units depend on Plant and Organisation."})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium block mb-1",children:"Station"}),p.jsxs("select",{value:Y!==""?String(Y):"",onChange:ne=>I(String(ne.target.value)),className:"w-full border px-3 py-2 rounded",disabled:!F||le,children:[p.jsx("option",{value:"",children:le?"Loading stations":F?"Select Station":"Select Plant first"}),(P.length?P:Me).map(ne=>p.jsx("option",{value:String(ne.id),children:ne.name},String(ne.id)))]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium block mb-1",children:"Shift"}),p.jsxs("select",{value:Qn,onChange:ne=>xn(ne.target.value),className:"w-full border px-3 py-2 rounded",disabled:!F||We,children:[p.jsx("option",{value:"",children:We?"Loading shifts":F?"Select Shift":"Select Plant first"}),Ue.map(ne=>p.jsx("option",{value:ne,children:ne},ne))]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium block mb-1",children:"User"}),p.jsxs("select",{value:ps,onChange:ne=>vn(ne.target.value),className:"w-full border px-3 py-2 rounded",disabled:!F||Fe,children:[p.jsx("option",{value:"",children:Fe?"Loading users":F?"Select User":"Select Plant first"}),mt.map(ne=>p.jsx("option",{value:ne.id,children:ne.name},ne.id))]})]})]}),p.jsxs("div",{className:"text-right",children:[p.jsx("button",{onClick:()=>{xn(""),vn(""),z(xl),O(""),I(""),Ie(null),y(!1),G("")},className:"px-4 py-2 rounded border mr-2",children:"Cancel"}),p.jsx("button",{onClick:()=>{c?vi():Mn()},className:"px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700",children:"Save & Close"})]})]})}),p.jsxs("div",{className:"bg-white rounded-2xl shadow-md px-5 py-3 border border-gray-100 mt-6",children:[p.jsxs("div",{className:"flex justify-between items-center mb-4",children:[p.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Created Shifts"}),t.length>0&&p.jsxs("span",{className:"text-sm text-gray-500",children:[t.length," total"]})]}),t.length===0?p.jsx("div",{className:"text-center py-8 text-gray-400 italic",children:"No shifts created yet."}):p.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200",children:p.jsxs("table",{className:"w-full text-sm",children:[p.jsx("thead",{className:"bg-blue-50",children:p.jsxs("tr",{className:"text-blue-800",children:[p.jsx("th",{className:"px-5 py-3 text-left font-semibold",children:"Shift"}),p.jsx("th",{className:"px-5 py-3 text-left font-semibold",children:"Timing"}),p.jsx("th",{className:"px-5 py-3 text-center font-semibold",children:"Actions"})]})}),p.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:t.map(ne=>p.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[p.jsx("td",{className:"px-5 py-3 font-medium text-gray-800",children:ne.type}),p.jsxs("td",{className:"px-5 py-3 text-gray-700",children:[ne.dayStart," ",ne.startTime,"  ",ne.dayEnd," ",ne.endTime,ne.orgName?p.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Org: ",ne.orgName]}):null]}),p.jsxs("td",{className:"px-5 py-3 text-center",children:[p.jsx("button",{onClick:()=>{if(b([ne]),ne.orgId)E(ne.orgId);else if(ne.orgName){const Re=_.find(ke=>ke.name===ne.orgName);Re&&E(Re.id)}h(!0)},className:"text-blue-600 hover:text-blue-800 font-medium transition mr-4",children:"Edit"}),p.jsx("button",{onClick:()=>zi(ne),className:"text-red-500 hover:text-red-600 font-medium transition",children:"Delete"})]})]},ne.id))})]})})]}),p.jsxs("div",{className:"mt-8 bg-white rounded-2xl shadow-lg px-5 py-3 border border-gray-100",children:[p.jsxs("div",{className:"flex justify-between items-center mb-4",children:[p.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Planned Shifts"}),n.length>0&&p.jsxs("span",{className:"text-sm text-gray-500",children:[n.length," total"]})]}),n.length===0?p.jsx("div",{className:"text-center py-8 text-gray-400 italic",children:"No shifts planned yet."}):p.jsx("div",{className:"overflow-y-auto max-h-[400px] rounded-lg border border-gray-200",children:p.jsxs("table",{className:"w-full text-sm",children:[p.jsx("thead",{className:"bg-blue-50 text-blue-800 sticky top-0 z-10",children:p.jsxs("tr",{children:[p.jsx("th",{className:"px-5 py-3 text-left font-semibold",children:"Day"}),p.jsx("th",{className:"px-5 py-3 text-left font-semibold",children:"Date"}),p.jsx("th",{className:"px-5 py-3 text-left font-semibold",children:"Shift"}),p.jsx("th",{className:"px-5 py-3 text-left font-semibold",children:"Employee"}),p.jsx("th",{className:"px-5 py-3 text-left font-semibold",children:"Organisation"}),p.jsx("th",{className:"px-5 py-3 text-left font-semibold",children:"Plant"}),p.jsx("th",{className:"px-5 py-3 text-left font-semibold",children:"Unit"}),p.jsx("th",{className:"px-5 py-3 text-left font-semibold",children:"Station"}),p.jsx("th",{className:"px-5 py-3 text-center font-semibold",children:"Actions"})]})}),p.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:n.map(ne=>p.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[p.jsx("td",{className:"px-5 py-3 text-gray-800",children:ne.day}),p.jsx("td",{className:"px-5 py-3 text-gray-800",children:ne.date}),p.jsx("td",{className:"px-5 py-3 text-gray-800",children:ne.shiftType}),p.jsx("td",{className:"px-5 py-3 text-gray-800",children:ne.employeeName}),p.jsx("td",{className:"px-5 py-3 text-gray-800",children:ne.orgName||"-"}),p.jsx("td",{className:"px-5 py-3 text-gray-800",children:ne.plantName}),p.jsx("td",{className:"px-5 py-3 text-gray-800",children:ne.unitName||"-"}),p.jsx("td",{className:"px-5 py-3 text-gray-800",children:ne.stationName}),p.jsxs("td",{className:"px-5 py-3 text-center",children:[p.jsx("button",{onClick:()=>_t(ne.id),className:"text-blue-600 hover:text-blue-800 font-medium transition mr-4",children:"Edit"}),p.jsx("button",{onClick:()=>Os("delete",`Delete planned shift for ${ne.employeeName} on ${ne.date}?`,{rid:ne.dbRid}),className:"text-red-500 hover:text-red-600 font-medium transition",children:"Delete"})]})]},ne.id))})]})})]})]}),ie.visible&&p.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/40",children:p.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md shadow-lg",children:[p.jsx("h4",{className:"text-lg font-semibold mb-3",children:"Please confirm"}),p.jsx("p",{className:"text-sm text-gray-700 mb-6",children:ie.message}),p.jsxs("div",{className:"flex justify-end gap-3",children:[p.jsx("button",{onClick:Dt,className:"px-4 py-2 rounded border hover:bg-gray-50",children:"Cancel"}),p.jsx("button",{onClick:Ms,className:"px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700",children:"Confirm"})]})]})}),p.jsx(Dr,{position:"top-right"})]})},Du=({open:n,onClose:e,children:t})=>n?p.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:p.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 relative animate-slideInUp",children:[p.jsx("button",{className:"absolute top-2 right-4 text-gray-400 hover:text-red-500 text-lg",onClick:e,"aria-label":"Close modal",children:""}),t]})}):null,hU=()=>{const[n,e]=R.useState([]),[t,s]=R.useState(!1),[r,a]=R.useState(null),[l,c]=R.useState(""),[f,d]=R.useState(!1),[h,g]=R.useState(null),[y,v]=R.useState(!1),[b,T]=R.useState(null),[E,_]=R.useState(""),[A,C]=R.useState(null),[N,w]=R.useState(!1),[G,M]=R.useState(null),[B,K]=R.useState(""),[V,$]=R.useState(""),[ee,he]=R.useState(!1),[Z,H]=R.useState(!1),[k,F]=R.useState(null),[O,Y]=R.useState(""),[I,j]=R.useState(""),[z,J]=R.useState(!1),q=async()=>{d(!0),g(null);try{const te=await Qe("public.list_organisations",[]);e(Array.isArray(te)?te.filter(be=>be.del_flag===0).map(be=>({rid:Number(be.rid),org_code:String(be.org_code),org_name:be.org_name,created_at:be.created_at})):[])}catch(te){g("Failed to fetch organisations. "+(te.message||"")),ce.error("Failed to fetch organisations.",{position:"top-right"})}d(!1)};R.useEffect(()=>{q()},[]);const P=()=>{a(null),c(""),s(!0)},de=te=>{a(te),c(te.org_name),s(!0)},_e=async te=>{d(!0),g(null);try{await Ot("public.ti_fc_sp_delete_organization",[te]),await q(),ce.success("Organisation deleted.",{position:"top-right"})}catch(be){g("Failed to delete organisation: "+(be.message||"")),ce.error("Failed to delete organisation.",{position:"top-right"})}finally{d(!1)}},Le=async()=>{const te=l.trim();if(!te){g("Organisation Name is required."),ce.error("Organisation Name is required.",{position:"top-right"});return}d(!0),g(null);try{r?(await Ot("public.ti_fc_sp_update_organization",[r.rid,r.org_code,te]),ce.success("Organisation updated.",{position:"top-right"})):(await Ot("public.ti_fc_sp_insert_organization",[te]),ce.success("Organisation added.",{position:"top-right"})),await q(),s(!1),c(""),a(null)}catch(be){g("Failed to save organisation: "+(be.message||be)),ce.error("Failed to save organisation.",{position:"top-right"})}finally{d(!1)}},Fe=async te=>{try{return(await Qe("public.role_list_by_org",[te.org_code]))?.map(Ie=>Ie.role_name)??[]}catch{return[]}},$e=async te=>{T({...te,roles:[]}),_(""),C(null),v(!0);const be=await Fe(te);T({...te,roles:be})},pe=()=>{v(!1),T(null),_(""),C(null)},Ne=async()=>{if(!b)return;const te=E.trim();if(!te){C("Role cannot be empty."),ce.error("Role cannot be empty.",{position:"top-right"});return}try{await Ot("public.ti_fc_sp_insert_master_roles3",[te,b.org_code]);const be=await Fe(b);T({...b,roles:be}),_(""),C(null),ce.success("Role added.",{position:"top-right"})}catch(be){C("Failed to add role: "+(be.message||"")),ce.error("Failed to add role.",{position:"top-right"})}},Ve=te=>{F(te),H(!0),Y(""),j("")},Ge=async()=>{J(!0),j("");try{const te=localStorage.getItem("username");if(!te){j("Session error: Please re-login."),J(!1),ce.error("Session error: Please re-login.",{position:"top-right"});return}const be=await Qe("public.fn_login_check",[te,O]);if(!be||!be.length){j("Incorrect password."),J(!1),ce.error("Incorrect password.",{position:"top-right"});return}if(b&&k){await Ot("public.ti_fc_sp_delete_roles",[k,b.org_code]);const Ie=await Fe(b);T({...b,roles:Ie}),ce.success("Role deleted.",{position:"top-right"})}H(!1),F(null),Y("")}catch{j("Password check failed."),ce.error("Password check failed.",{position:"top-right"})}J(!1)},le=async te=>{Ve(te)},W=te=>{M(te),w(!0),K(""),$("")};return p.jsxs("div",{className:"p-8",children:[p.jsx(Dr,{}),p.jsxs("div",{className:"flex justify-between items-center mb-6",children:[p.jsx("h2",{className:"text-2xl font-semibold text-blue-900",children:"Organisations"}),p.jsx("button",{className:"bg-blue-600 text-white rounded-xl px-4 py-2 font-semibold shadow hover:bg-blue-700 transition",onClick:P,children:"+ Add Organisation"})]}),h&&p.jsx("div",{className:"text-red-600 mb-4",children:h}),p.jsx("div",{className:"bg-white border border-[#cfe7ff] rounded-sm shadow-lg overflow-hidden w-full",children:p.jsx("div",{className:"overflow-x-auto w-full",children:p.jsxs("table",{className:"min-w-[480px] w-full text-sm border-separate border-spacing-0",children:[p.jsx("thead",{children:p.jsxs("tr",{className:"bg-[#cfe7ff] text-[#0c1e36] text-left text-sm",children:[p.jsx("th",{className:"px-4 py-3 font-semibold",children:"Organisation"}),p.jsx("th",{className:"px-4 py-3 font-semibold",children:"Org Code"}),p.jsx("th",{className:"px-4 py-3 font-semibold text-center w-56",children:"Actions"})]})}),p.jsx("tbody",{children:f?p.jsx("tr",{children:p.jsx("td",{colSpan:3,className:"py-6 text-center text-blue-400 italic",children:"Loading..."})}):n.length===0?p.jsx("tr",{children:p.jsx("td",{colSpan:3,className:"py-6 text-center text-gray-400 italic",children:"No organisations added."})}):n.map((te,be)=>p.jsxs("tr",{className:"bg-white text-[#0c1e36] shadow-sm hover:bg-[#e7f3ff] transition",children:[p.jsx("td",{className:"px-4 py-3",children:te.org_name}),p.jsx("td",{className:"px-4 py-3",children:te.org_code}),p.jsxs("td",{className:"px-4 py-3 text-center space-x-2",children:[p.jsx("button",{onClick:async()=>await $e(te),className:"px-3 py-1 rounded-full text-indigo-600 bg-indigo-100 hover:bg-indigo-200 text-xs font-semibold",title:"Manage Roles",children:"Roles"}),p.jsx("button",{onClick:()=>de(te),className:"px-3 py-1 rounded-full text-blue-600 bg-blue-100 hover:bg-blue-200 text-xs font-semibold",children:"Edit"}),p.jsx("button",{onClick:()=>W(te),className:"px-3 py-1 rounded-full text-red-600 bg-red-100 hover:bg-red-200 text-xs font-semibold",children:"Delete"})]})]},te.org_code+"-"+be))})]})})}),p.jsxs(Du,{open:t,onClose:()=>s(!1),children:[p.jsx("h3",{className:"text-lg font-semibold mb-4",children:r?"Edit Organisation":"Add Organisation"}),p.jsx("input",{value:l,onChange:te=>c(te.target.value),placeholder:"Organisation Name",className:"border border-gray-300 rounded-lg w-full p-2 mb-4 focus:border-blue-500 outline-none",autoFocus:!0,onKeyDown:te=>{te.key==="Enter"&&Le()}}),p.jsxs("div",{className:"flex justify-end",children:[p.jsx("button",{className:"mr-3 px-4 py-2 bg-gray-200 rounded-xl text-gray-700 hover:bg-gray-300",onClick:()=>s(!1),children:"Cancel"}),p.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition",onClick:Le,disabled:f,children:r?"Update":"Add"})]})]}),p.jsxs(Du,{open:y,onClose:pe,children:[p.jsx("h3",{className:"text-lg font-semibold mb-2",children:b?`Roles  ${b.org_name}`:"Roles"}),p.jsx("div",{className:"mb-4 max-h-56 overflow-auto",children:b&&b.roles&&b.roles.length>0?p.jsx("ul",{className:"space-y-2",children:b.roles.map(te=>p.jsxs("li",{className:"flex items-center justify-between bg-gray-50 border border-gray-200 rounded-lg px-3 py-2",children:[p.jsx("span",{className:"text-sm text-gray-800",children:te}),p.jsx("button",{onClick:()=>le(te),className:"px-2 py-1 text-xs rounded-full bg-red-100 text-red-600 hover:bg-red-200 font-semibold",children:"Delete"})]},te))}):p.jsx("div",{className:"text-gray-400 italic",children:"No roles found."})}),p.jsxs("div",{className:"mb-1",children:[p.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Add Role"}),p.jsx("input",{value:E,onChange:te=>{_(te.target.value),A&&C(null)},placeholder:'e.g. "Admin", "Operator"',className:`border rounded-lg w-full p-2 outline-none ${A?"border-red-400":"border-gray-300 focus:border-blue-500"}`,onKeyDown:te=>{te.key==="Enter"&&Ne()}}),A&&p.jsx("p",{className:"text-xs text-red-600 mt-1",children:A})]}),p.jsxs("div",{className:"flex justify-end mt-4",children:[p.jsx("button",{className:"mr-3 px-4 py-2 bg-gray-200 rounded-xl text-gray-700 hover:bg-gray-300",onClick:pe,children:"Close"}),p.jsx("button",{className:"px-4 py-2 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition",onClick:Ne,children:"Add Role"})]})]}),p.jsxs(Du,{open:Z,onClose:()=>H(!1),children:[p.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Confirm Delete Role:"," ",p.jsx("span",{className:"text-red-600",children:k})]}),(()=>{const te=localStorage.getItem("username");return te?p.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:["Username: ",p.jsx("span",{className:"font-mono",children:te})]}):null})(),p.jsx("p",{className:"mb-3 text-sm text-gray-700",children:"Please enter your password to confirm deletion of this role."}),p.jsx("input",{type:"password",className:"w-full border border-gray-300 rounded-lg p-2 mb-2",placeholder:"Enter your password",value:O,onChange:te=>{Y(te.target.value),j("")},autoFocus:!0,onKeyDown:te=>{te.key==="Enter"&&O&&Ge()}}),I&&p.jsx("div",{className:"text-red-600 text-xs mb-2",children:I}),p.jsxs("div",{className:"flex justify-end",children:[p.jsx("button",{className:"mr-3 px-4 py-2 bg-gray-200 rounded-xl text-gray-700 hover:bg-gray-300",onClick:()=>H(!1),disabled:z,children:"Cancel"}),p.jsx("button",{className:"px-4 py-2 bg-red-600 text-white rounded-xl font-semibold hover:bg-red-700 transition",onClick:Ge,disabled:z||!O,children:z?"Checking...":"Confirm Delete"})]})]}),p.jsxs(Du,{open:N,onClose:()=>w(!1),children:[p.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Confirm Deletion:"," ",p.jsx("span",{className:"text-red-600",children:G?.org_name})]}),(()=>{const te=localStorage.getItem("username");return te?p.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:["Username: ",p.jsx("span",{className:"font-mono",children:te})]}):null})(),p.jsx("p",{className:"mb-3 text-sm text-gray-700",children:"Please enter your password to confirm deletion of this organisation."}),p.jsx("input",{type:"password",className:"w-full border border-gray-300 rounded-lg p-2 mb-2",placeholder:"Enter your password",value:B,onChange:te=>{K(te.target.value),$("")},autoFocus:!0,onKeyDown:te=>{te.key==="Enter"&&B&&(async()=>{he(!0),$("");try{const be=localStorage.getItem("username");if(!be){$("Session error: Please re-login."),he(!1),ce.error("Session error: Please re-login.",{position:"top-right"});return}const Ie=await Qe("public.fn_login_check",[be,B]);if(!Ie||!Ie.length){$("Incorrect password."),he(!1),ce.error("Incorrect password.",{position:"top-right"});return}G&&await _e(G.rid),w(!1),K(""),M(null)}catch{$("Password check failed."),ce.error("Password check failed.",{position:"top-right"})}he(!1)})()}}),V&&p.jsx("div",{className:"text-red-600 text-xs mb-2",children:V}),p.jsxs("div",{className:"flex justify-end",children:[p.jsx("button",{className:"mr-3 px-4 py-2 bg-gray-200 rounded-xl text-gray-700 hover:bg-gray-300",onClick:()=>w(!1),disabled:ee,children:"Cancel"}),p.jsx("button",{className:"px-4 py-2 bg-red-600 text-white rounded-xl font-semibold hover:bg-red-700 transition",onClick:async()=>{he(!0),$("");try{const te=localStorage.getItem("username");if(!te){$("Session error: Please re-login."),he(!1),ce.error("Session error: Please re-login.",{position:"top-right"});return}const be=await Qe("public.fn_login_check",[te,B]);if(!be||!be.length){$("Incorrect password."),he(!1),ce.error("Incorrect password.",{position:"top-right"});return}G&&await _e(G.rid),w(!1),K(""),M(null)}catch{$("Password check failed."),ce.error("Password check failed.",{position:"top-right"})}he(!1)},disabled:ee||!B,children:ee?"Checking...":"Confirm Delete"})]})]})]})},mU=/^[^\s@]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/,vl="w-full rounded-lg border px-3 py-2 text-[15px] placeholder:text-gray-400 outline-none border-gray-300 focus:border-blue-500 bg-white",Cm=({open:n,onClose:e,children:t,title:s})=>n?p.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:p.jsxs("div",{className:"w-full max-w-3xl rounded-2xl bg-white/95 backdrop-blur-md shadow-2xl ring-1 ring-black/5",style:{maxHeight:"86vh"},children:[p.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-black/10",children:[p.jsx("h3",{className:"text-lg font-semibold",children:s}),p.jsx("button",{className:"text-gray-400 hover:text-red-500 text-xl leading-none",onClick:e,"aria-label":"Close",type:"button",children:""})]}),p.jsx("div",{className:"overflow-y-auto px-5 md:px-6 py-5",children:t})]})}):null,Xa=({label:n,required:e,error:t,children:s,hint:r})=>p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm font-medium mb-1",children:[n," ",e&&p.jsx("span",{className:"text-red-500",children:"*"})]}),s,r&&!t&&p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r}),t&&p.jsx("p",{className:"text-xs text-red-500 mt-1",children:t})]}),gU=()=>{const[n,e]=R.useState([]),[t,s]=R.useState([]),[r,a]=R.useState(!1),[l,c]=R.useState(null),[f,d]=R.useState(""),[h,g]=R.useState(""),[y,v]=R.useState(""),[b,T]=R.useState(""),[E,_]=R.useState(""),[A,C]=R.useState(""),[,N]=R.useState(""),[w,G]=R.useState({}),[M,B]=R.useState(null),K=A.replace(/[^\d]/g,""),[V,$]=R.useState(!1),[ee,he]=R.useState(null),[Z,H]=R.useState(""),[k,F]=R.useState(""),[O,Y]=R.useState(!1),[I,j]=R.useState(!1),[z,J]=R.useState(null),[q,P]=R.useState(""),[de,_e]=R.useState(""),[Le,Fe]=R.useState(!1);R.useEffect(()=>{$e(),pe()},[]);const $e=async()=>{try{const ie=await Qe("public.list_organisations",[]);e(Array.isArray(ie)?ie.filter(we=>we.del_flag===0).map(we=>({id:String(we.org_code),name:we.org_name})):[])}catch{e([])}},pe=async()=>{try{const we=(await Qe("public.fn_list_dim_plant",[])||[]).map(Ae=>({id:Ae.p_code,pcode:Ae.p_code,name:Ae.p_name,organisationId:Ae.org_id?String(Ae.org_id):"",email:Ae.p_email??"",incharge:Ae.p_incharge??"",inchargeId:Ae.p_inchg_id??"",contact:Ae.p_contact?"+"+Ae.p_contact:""}));s(we)}catch{ce.error("Failed to fetch plants from DB")}},Ne=()=>{d(""),g(""),v(""),T(""),_(""),C(""),N(""),G({}),B(null)},Ve=()=>{c(null),Ne(),a(!0)},Ge=ie=>{J(ie),j(!0),P(""),_e("")},le=async()=>{Fe(!0),_e("");try{const ie=localStorage.getItem("username");if(!ie){_e("Session error: Please re-login."),Fe(!1),ce.error("Session error: Please re-login.");return}const we=await Qe("public.fn_login_check",[ie,q]);if(!we||!we.length){_e("Incorrect password."),Fe(!1),ce.error("Incorrect password.");return}z&&(c(z),d(z.name),g(z.organisationId),v(z.email),T(z.incharge),_(z.inchargeId),C(z.contact),N(z.pcode),G({}),B(null),a(!0),J(null)),j(!1),P("")}catch{_e("Password check failed."),ce.error("Password check failed.")}Fe(!1)},W=ie=>{he(ie),$(!0),H(""),F("")},te=async ie=>{try{await Ot("public.ti_fc_sp_delete_dim_plant",[ie]),ce.success("Plant deleted from database."),await pe()}catch(we){ce.error("Failed to delete plant: "+(we.message||we))}},be=async()=>{Y(!0),F("");try{const ie=localStorage.getItem("username");if(!ie){F("Session error: Please re-login."),Y(!1),ce.error("Session error: Please re-login.");return}const we=await Qe("public.fn_login_check",[ie,Z]);if(!we||!we.length){F("Incorrect password."),Y(!1),ce.error("Incorrect password.");return}ee&&await te(ee.pcode),$(!1),H(""),he(null)}catch{F("Password check failed."),ce.error("Password check failed.")}Y(!1)},Ie=()=>{const ie={};return h||(ie.organisation="Organisation is required."),f.trim()||(ie.plantName="Plant name is required."),y.trim()?/^[^\s@]+@[^\s@]+\.[A-Za-z]{2,}$/.test(y.trim())||(ie.email="Enter a valid email (e.g., name@example.com)."):ie.email="Email is required.",b.trim()||(ie.incharge="Incharge name is required."),E.trim()||(ie.inchargeId="Incharge ID is required."),A?(K.length<6||K.length>15)&&(ie.contact="Phone must be 615 digits."):ie.contact="Contact number is required.",G(ie),Object.keys(ie).length?(B(Object.values(ie)[0]),!1):(B(null),!0)},Ue=async ie=>{if(ie.preventDefault(),!!Ie())try{if(l)await Ot("public.ti_fc_sp_update_dim_plant",[l.pcode,f.trim(),y.trim(),b.trim(),E.trim(),Number(K)]),ce.success("Plant updated successfully!");else{const we=n.find(Ae=>Ae.id===h)?.name||"";await Ot("public.ti_fc_sp_insert_dim_plant3",[f.trim(),y.trim(),b.trim(),E.trim(),Number(K),we]),ce.success("Plant saved to database!")}a(!1),c(null),Ne(),await pe()}catch(we){ce.error("Failed to save plant: "+(we.message||we))}},Ke=h&&f.trim()&&mU.test(y.trim())&&b.trim()&&E.trim()&&K.length>=6&&K.length<=15,We=p.jsxs(Cm,{open:V,onClose:()=>$(!1),children:[p.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Confirm Deletion: ",p.jsx("span",{className:"text-red-600",children:ee?.name})]}),(()=>{const ie=localStorage.getItem("username");return ie?p.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:["Username: ",p.jsx("span",{className:"font-mono",children:ie})]}):null})(),p.jsx("p",{className:"mb-3 text-sm text-gray-700",children:"Please enter your password to confirm deletion of this plant."}),p.jsx("input",{type:"password",className:"w-full border border-gray-300 rounded-lg p-2 mb-2",placeholder:"Enter your password",value:Z,onChange:ie=>{H(ie.target.value),F("")},autoFocus:!0,onKeyDown:async ie=>{ie.key==="Enter"&&Z&&await be()}}),k&&p.jsx("div",{className:"text-red-600 text-xs mb-2",children:k}),p.jsxs("div",{className:"flex justify-end",children:[p.jsx("button",{className:"mr-3 px-4 py-2 bg-gray-200 rounded-xl text-gray-700 hover:bg-gray-300",onClick:()=>$(!1),disabled:O,children:"Cancel"}),p.jsx("button",{className:"px-4 py-2 bg-red-600 text-white rounded-xl font-semibold hover:bg-red-700 transition",onClick:be,disabled:O||!Z,children:O?"Checking...":"Confirm Delete"})]})]}),ae=p.jsxs(Cm,{open:I,onClose:()=>j(!1),children:[p.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Confirm Edit: ",p.jsx("span",{className:"text-blue-700",children:z?.name})]}),(()=>{const ie=localStorage.getItem("username");return ie?p.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:["Username: ",p.jsx("span",{className:"font-mono",children:ie})]}):null})(),p.jsx("p",{className:"mb-3 text-sm text-gray-700",children:"Please enter your password to edit this plant."}),p.jsx("input",{type:"password",className:"w-full border border-gray-300 rounded-lg p-2 mb-2",placeholder:"Enter your password",value:q,onChange:ie=>{P(ie.target.value),_e("")},autoFocus:!0,onKeyDown:async ie=>{ie.key==="Enter"&&q&&await le()}}),de&&p.jsx("div",{className:"text-red-600 text-xs mb-2",children:de}),p.jsxs("div",{className:"flex justify-end",children:[p.jsx("button",{className:"mr-3 px-4 py-2 bg-gray-200 rounded-xl text-gray-700 hover:bg-gray-300",onClick:()=>j(!1),disabled:Le,children:"Cancel"}),p.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition",onClick:le,disabled:Le||!q,children:Le?"Checking...":"Confirm"})]})]});return p.jsxs("div",{className:"p-6 md:p-8",children:[p.jsx(Dr,{position:"top-right",autoClose:2e3}),We,ae,p.jsxs("div",{className:"flex justify-between items-center mb-6",children:[p.jsx("h2",{className:"text-2xl font-semibold text-blue-900",children:"Plants"}),p.jsx("button",{className:"bg-blue-600 text-white rounded-xl px-4 py-2 font-semibold shadow hover:bg-blue-700 transition",onClick:Ve,type:"button",children:"+ Add Plant"})]}),p.jsx("div",{className:"mt-2 bg-white border border-[#cfe7ff] rounded-sm shadow-lg overflow-hidden w-full",children:p.jsx("div",{className:"overflow-x-auto w-full",children:p.jsxs("table",{className:"min-w-[900px] w-full text-sm border-separate border-spacing-0",children:[p.jsx("thead",{children:p.jsxs("tr",{className:"bg-[#cfe7ff] text-[#0c1e36] text-left text-sm",children:[p.jsx("th",{className:"px-4 py-3 text-left",children:"Plant Name"}),p.jsx("th",{className:"px-4 py-3 text-left",children:"Code"}),p.jsx("th",{className:"px-4 py-3 text-left",children:"Organisation"}),p.jsx("th",{className:"px-4 py-3 text-left",children:"Email"}),p.jsx("th",{className:"px-4 py-3 text-left",children:"Incharge"}),p.jsx("th",{className:"px-4 py-3 text-left",children:"Incharge ID"}),p.jsx("th",{className:"px-4 py-3 text-left",children:"Contact"}),p.jsx("th",{className:"px-4 py-3 text-center w-40",children:"Actions"})]})}),p.jsx("tbody",{children:t.length===0?p.jsx("tr",{children:p.jsx("td",{colSpan:8,className:"py-6 text-center text-gray-400 italic",children:"No plants added."})}):t.map(ie=>{const we=n.find(Ae=>Ae.id===ie.organisationId)?.name||"-";return p.jsxs("tr",{className:"bg-white text-[#0c1e36] shadow-sm hover:bg-[#e7f3ff] transition",children:[p.jsx("td",{className:"px-4 py-3",children:ie.name}),p.jsx("td",{className:"px-4 py-3",children:ie.pcode}),p.jsx("td",{className:"px-4 py-3",children:we}),p.jsx("td",{className:"px-4 py-3",children:ie.email}),p.jsx("td",{className:"px-4 py-3",children:ie.incharge}),p.jsx("td",{className:"px-4 py-3",children:ie.inchargeId}),p.jsx("td",{className:"px-4 py-3",children:ie.contact}),p.jsxs("td",{className:"px-4 py-3 text-center space-x-2",children:[p.jsx("button",{onClick:()=>Ge(ie),className:"px-3 py-1 rounded-full text-blue-600 bg-blue-100 hover:bg-blue-200 text-xs font-semibold",type:"button",children:"Edit"}),p.jsx("button",{onClick:()=>W(ie),className:"px-3 py-1 rounded-full text-red-600 bg-red-100 hover:bg-red-200 text-xs font-semibold",type:"button",children:"Delete"})]})]},ie.id)})})]})})}),p.jsxs(Cm,{open:r,onClose:()=>a(!1),title:l?"Edit Plant":"Add Plant",children:[M&&p.jsx("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 text-red-700 text-sm px-3 py-2",children:M}),p.jsxs("form",{onSubmit:Ue,noValidate:!0,children:[p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsx(Xa,{label:"Organisation",required:!l,error:w.organisation,children:p.jsxs("select",{value:h,onChange:ie=>g(ie.target.value),className:vl+(l?" bg-gray-100 cursor-not-allowed":""),"aria-invalid":!!w.organisation,disabled:!!l,children:[p.jsx("option",{value:"",children:"Select Organisation"}),n.map(ie=>p.jsx("option",{value:ie.id,children:ie.name},ie.id))]})}),p.jsx(Xa,{label:"Plant Name",required:!l,error:w.plantName,children:p.jsx("input",{value:f,onChange:ie=>d(ie.target.value),className:vl+(l?" bg-gray-100 cursor-not-allowed":""),placeholder:"e.g., Alpha Plant","aria-invalid":!!w.plantName,disabled:!!l})}),p.jsx(Xa,{label:"Plant Email",required:!l,error:w.email,children:p.jsx("input",{value:y,onChange:ie=>v(ie.target.value),className:vl,placeholder:"name@example.com",type:"email","aria-invalid":!!w.email})}),p.jsx(Xa,{label:"Incharge Name",required:!l,error:w.incharge,children:p.jsx("input",{value:b,onChange:ie=>T(ie.target.value),className:vl,placeholder:"Person name","aria-invalid":!!w.incharge})}),p.jsx(Xa,{label:"Incharge ID",required:!l,error:w.inchargeId,children:p.jsx("input",{value:E,onChange:ie=>_(ie.target.value),className:vl,placeholder:"Employee ID","aria-invalid":!!w.inchargeId})}),p.jsx(Xa,{label:"Contact Number",required:!l,error:w.contact,hint:"Digits only, 615 length.",children:p.jsx(zl,{country:"in",value:A.replace("+",""),onChange:ie=>C(ie?`+${ie}`:""),containerClass:"w-full",inputClass:"!w-full !h-[40px] !text-[15px] !px-12 !py-2 !border !border-gray-300 !rounded-lg !bg-white focus:!border-blue-500",buttonClass:"!border !border-gray-300 !bg-white !rounded-l-lg",dropdownClass:"!bg-white !text-sm !shadow-lg",enableSearch:!0,disableSearchIcon:!0,countryCodeEditable:!1})})]}),p.jsxs("div",{className:"flex justify-end gap-3 pt-6",children:[p.jsx("button",{className:"px-4 py-2 rounded-xl text-gray-700 bg-gray-200 hover:bg-gray-300",onClick:()=>a(!1),type:"button",children:"Cancel"}),p.jsx("button",{disabled:!Ke,className:`px-5 py-2 rounded-xl font-semibold text-white transition
                ${Ke?"bg-blue-600 hover:bg-blue-700":"bg-blue-300 cursor-not-allowed"}
              `,title:Ke?"":"Fill all required fields with valid values",type:"submit",children:l?"Update":"Add"})]})]})]})]})};function pU(){const[n,e]=R.useState([]),[t,s]=R.useState([]),[r,a]=R.useState([]),[l,c]=R.useState(!1),[f,d]=R.useState({org_id:"",plant_id:"",unit_name:"",incharge_name:"",contact:""}),[h,g]=R.useState(!1),[y,v]=R.useState(null),[b,T]=R.useState(!1),[E,_]=R.useState(""),[A,C]=R.useState(!1),[N,w]=R.useState(""),[G,M]=R.useState(null),[B,K]=R.useState(!1),[V,$]=R.useState(""),[ee,he]=R.useState(!1),[Z,H]=R.useState(""),[k,F]=R.useState(null);R.useEffect(()=>{(async()=>{try{const P=await Qe("public.fn_list_dim_organisation",[]);s(Array.isArray(P)?P.map(de=>({org_id:String(de.id||de.org_id),org_name:de.name||de.org_name})):[])}catch{s([])}})()},[]),R.useEffect(()=>{(async()=>{try{const P=await Qe("public.fn_list_dim_plant",[]);a(Array.isArray(P)?P.map(de=>({plant_id:String(de.p_code||de.plant_id),plant_name:de.p_name||de.plant_name,org_id:String(de.org_id)})):[])}catch{a([])}})()},[]),R.useEffect(()=>{(async()=>{try{const P=await Qe("public.fn_list_dim_unit",[]);e(Array.isArray(P)?P.map(de=>({unit_id:de.unit_id,unit_name:de.unit_name,org_name:de.org_name,plant_name:de.plant_name,incharge_name:de.incharge_name,contact:de.contact})):[])}catch{e([])}})()},[]);const O=async()=>{try{const q=t.find(_e=>_e.org_id===f.org_id)?.org_name||"",P=r.find(_e=>_e.plant_id===f.plant_id)?.plant_name||"";await Ot("public.ti_fc_sp_insert_dim_unit",[q,P,f.unit_name,f.incharge_name,f.contact]);const de=await Qe("public.fn_list_dim_unit",[]);e(Array.isArray(de)?de:[]),ce.success("Unit added successfully!")}catch{ce.error("Failed to add unit. Please try again.")}c(!1),d({org_id:"",plant_id:"",unit_name:"",incharge_name:"",contact:""})},Y=q=>{F(q),$(""),H(""),K(!0)},I=async()=>{he(!0),H("");try{const q=localStorage.getItem("username");if(!q){H("Session error. Please re-login."),he(!1);return}const P=await Qe("public.fn_login_check",[q,V]);if(!P||!P.length){H("Incorrect password."),he(!1);return}v(k),g(!0),K(!1),F(null),$("")}catch{H("Password check failed.")}he(!1)},j=q=>{M(q),_(""),w(""),T(!0)},z=async()=>{C(!0),w("");try{const q=localStorage.getItem("username");if(!q){w("Session error. Please re-login."),C(!1);return}const P=await Qe("public.fn_login_check",[q,E]);if(!P||!P.length){w("Incorrect password."),C(!1);return}if(!G)return;try{await Ot("public.ti_fc_sp_delete_dim_unit",[G.org_name,G.plant_name,G.unit_name]);const de=await Qe("public.fn_list_dim_unit",[]);e(Array.isArray(de)?de:[]),ce.success("Unit deleted successfully!")}catch{ce.error("Delete failed. Please try again.")}T(!1),M(null),_("")}catch{w("Password check failed.")}C(!1)},J=r.filter(q=>q.org_id===f.org_id);return p.jsxs("div",{className:"p-8 min-h-screen bg-[#F8FAFC]",children:[p.jsx(Dr,{position:"top-right",autoClose:2500}),B&&p.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/40",children:p.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-8 w-full max-w-md",children:[p.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-900",children:"Enter password to edit unit"}),p.jsx("input",{type:"password",className:"w-full border border-gray-300 rounded-lg p-2 mb-2",placeholder:"Enter your password",value:V,onChange:q=>$(q.target.value),autoFocus:!0,onKeyDown:async q=>{q.key==="Enter"&&V&&await I()}}),Z&&p.jsx("div",{className:"text-red-600 text-xs mb-2",children:Z}),p.jsxs("div",{className:"flex justify-end gap-3 mt-3",children:[p.jsx("button",{className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded",onClick:()=>K(!1),disabled:ee,children:"Cancel"}),p.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-5 py-2 rounded font-semibold",onClick:I,disabled:ee||!V,children:ee?"Checking...":"Proceed"})]})]})}),b&&p.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/40",children:p.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-8 w-full max-w-md",children:[p.jsx("h3",{className:"text-lg font-semibold mb-4 text-red-700",children:"Enter password to delete unit"}),p.jsx("input",{type:"password",className:"w-full border border-gray-300 rounded-lg p-2 mb-2",placeholder:"Enter your password",value:E,onChange:q=>_(q.target.value),autoFocus:!0,onKeyDown:async q=>{q.key==="Enter"&&E&&await z()}}),N&&p.jsx("div",{className:"text-red-600 text-xs mb-2",children:N}),p.jsxs("div",{className:"flex justify-end gap-3 mt-3",children:[p.jsx("button",{className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded",onClick:()=>T(!1),disabled:A,children:"Cancel"}),p.jsx("button",{className:"bg-red-500 hover:bg-red-600 text-white px-5 py-2 rounded font-semibold",onClick:z,disabled:A||!E,children:A?"Checking...":"Delete"})]})]})}),p.jsxs("div",{className:"flex justify-between items-center mb-6",children:[p.jsx("h2",{className:"text-2xl font-semibold text-[#225AA7]",children:"Units"}),p.jsx("button",{onClick:()=>c(!0),className:"bg-blue-500 hover:bg-blue-600 text-white px-5 py-2 rounded-full text-base font-semibold shadow transition",children:"+ Add Unit"})]}),p.jsx("div",{className:"bg-white rounded-xl shadow p-1",children:p.jsxs("table",{className:"w-full text-left",children:[p.jsx("thead",{children:p.jsxs("tr",{className:"bg-blue-100 text-[#225AA7] font-semibold",children:[p.jsx("th",{className:"py-3 px-4 rounded-tl-xl",children:"Unit Name"}),p.jsx("th",{className:"py-3 px-4",children:"Organisation"}),p.jsx("th",{className:"py-3 px-4",children:"Plant"}),p.jsx("th",{className:"py-3 px-4",children:"Incharge"}),p.jsx("th",{className:"py-3 px-4",children:"Contact"}),p.jsx("th",{className:"py-3 px-4 rounded-tr-xl",children:"Actions"})]})}),p.jsxs("tbody",{children:[n.length===0&&p.jsx("tr",{children:p.jsx("td",{colSpan:6,className:"py-4 text-center text-gray-400",children:"No units found."})}),n.map((q,P)=>p.jsxs("tr",{className:"hover:bg-blue-50 transition-colors",children:[p.jsx("td",{className:"py-2 px-4",children:q.unit_name}),p.jsx("td",{className:"py-2 px-4",children:q.org_name}),p.jsx("td",{className:"py-2 px-4",children:q.plant_name}),p.jsx("td",{className:"py-2 px-4",children:q.incharge_name}),p.jsx("td",{className:"py-2 px-4",children:q.contact}),p.jsxs("td",{className:"py-2 px-4 flex gap-2",children:[p.jsx("button",{className:"bg-blue-100 hover:bg-blue-200 text-blue-700 font-semibold px-3 py-1 rounded",onClick:()=>Y(q),children:"Edit"}),p.jsx("button",{className:"bg-red-100 hover:bg-red-200 text-red-700 font-semibold px-3 py-1 rounded",onClick:()=>j(q),children:"Delete"})]})]},P))]})]})}),l&&p.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/30",children:p.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-8 w-full max-w-md",children:[p.jsx("div",{className:"mb-6",children:p.jsx("h3",{className:"text-xl font-bold text-[#225AA7]",children:"Add Unit"})}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block mb-1 font-semibold text-gray-700",children:"Organisation"}),p.jsxs("select",{className:"w-full px-3 py-2 border rounded focus:outline-none",value:f.org_id,onChange:q=>d(P=>({...P,org_id:q.target.value,plant_id:""})),children:[p.jsx("option",{value:"",children:"Select organisation"}),t.map(q=>p.jsx("option",{value:q.org_id,children:q.org_name},q.org_id))]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block mb-1 font-semibold text-gray-700",children:"Plant"}),p.jsxs("select",{className:"w-full px-3 py-2 border rounded focus:outline-none",value:f.plant_id,onChange:q=>d(P=>({...P,plant_id:q.target.value})),disabled:!f.org_id,children:[p.jsx("option",{value:"",children:"Select plant"}),J.map(q=>p.jsx("option",{value:q.plant_id,children:q.plant_name},q.plant_id))]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block mb-1 font-semibold text-gray-700",children:"Unit Name"}),p.jsx("input",{className:"w-full px-3 py-2 border rounded focus:outline-none",value:f.unit_name,onChange:q=>d(P=>({...P,unit_name:q.target.value})),placeholder:"Enter unit name"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block mb-1 font-semibold text-gray-700",children:"Incharge Name"}),p.jsx("input",{className:"w-full px-3 py-2 border rounded focus:outline-none",value:f.incharge_name,onChange:q=>d(P=>({...P,incharge_name:q.target.value})),placeholder:"Enter incharge name"})]}),p.jsxs("div",{children:[p.jsxs("label",{className:"block mb-1 font-semibold text-gray-700",children:["Contact Number ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx(zl,{country:"in",value:f.contact,onChange:q=>d(P=>({...P,contact:q})),inputClass:"!w-full !h-[40px] !text-[15px] !px-12 !py-2 !border !border-gray-300 !rounded-lg !bg-white focus:!border-blue-500",buttonClass:"!border !border-gray-300 !bg-white !rounded-l-lg",dropdownClass:"!bg-white !text-sm !shadow-lg",enableSearch:!0,disableSearchIcon:!0,countryCodeEditable:!1}),p.jsx("span",{className:"text-xs text-gray-500 pl-1",children:"Digits only, 615 length."})]})]}),p.jsxs("div",{className:"flex justify-end mt-6 gap-2",children:[p.jsx("button",{className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded",onClick:()=>c(!1),children:"Cancel"}),p.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-5 py-2 rounded font-semibold",onClick:O,disabled:!f.unit_name||!f.org_id||!f.plant_id||!f.incharge_name||!f.contact,children:"Add Unit"})]})]})}),h&&y&&p.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/30",children:p.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-8 w-full max-w-md",children:[p.jsx("div",{className:"mb-6",children:p.jsx("h3",{className:"text-xl font-bold text-[#225AA7]",children:"Edit Unit"})}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block mb-1 font-semibold text-gray-700",children:"Organisation"}),p.jsx("div",{className:"relative group",children:p.jsx("input",{className:"w-full px-3 py-2 border rounded bg-gray-100 cursor-not-allowed",value:y.org_name,readOnly:!0,disabled:!0})})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block mb-1 font-semibold text-gray-700",children:"Plant"}),p.jsx("div",{className:"relative group",children:p.jsx("input",{className:"w-full px-3 py-2 border rounded bg-gray-100 cursor-not-allowed",value:y.plant_name,readOnly:!0,disabled:!0})})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block mb-1 font-semibold text-gray-700",children:"Unit Name"}),p.jsx("input",{className:"w-full px-3 py-2 border rounded",value:y.unit_name,onChange:q=>v(P=>P&&{...P,unit_name:q.target.value})})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block mb-1 font-semibold text-gray-700",children:"Incharge Name"}),p.jsx("input",{className:"w-full px-3 py-2 border rounded",value:y.incharge_name,onChange:q=>v(P=>P&&{...P,incharge_name:q.target.value}),placeholder:"Enter incharge name"})]}),p.jsxs("div",{children:[p.jsxs("label",{className:"block mb-1 font-semibold text-gray-700",children:["Contact Number ",p.jsx("span",{className:"text-red-500"})]}),p.jsx(zl,{country:"in",value:y.contact,onChange:q=>v(P=>P&&{...P,contact:q}),inputClass:"!w-full !h-[40px] !text-[15px] !px-12 !py-2 !border !border-gray-300 !rounded-lg !bg-white focus:!border-blue-500",buttonClass:"!border !border-gray-300 !bg-white !rounded-l-lg",dropdownClass:"!bg-white !text-sm !shadow-lg",enableSearch:!0,disableSearchIcon:!0,countryCodeEditable:!1}),p.jsx("span",{className:"text-xs text-gray-500 pl-1",children:"Digits only, 615 length."})]})]}),p.jsxs("div",{className:"flex justify-end mt-6 gap-2",children:[p.jsx("button",{className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded",onClick:()=>{g(!1),v(null)},children:"Cancel"}),p.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-5 py-2 rounded font-semibold",onClick:async()=>{try{await Ot("public.ti_fc_sp_update_dim_unit",[y.org_name,y.plant_name,y.unit_name,y.incharge_name,y.contact]);const q=await Qe("public.fn_list_dim_unit",[]);e(Array.isArray(q)?q:[]),g(!1),v(null),ce.success("Unit updated successfully!")}catch{ce.error("Failed to update unit. Please try again.")}},children:"Update"})]})]})})]})}const Lm=({open:n,onClose:e,children:t})=>n?p.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:p.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 relative animate-slideInUp",children:[p.jsx("button",{className:"absolute top-2 right-4 text-gray-400 hover:text-red-500 text-lg",onClick:e,"aria-label":"Close modal",children:""}),t]})}):null,yU=()=>{const[n,e]=R.useState([]),[t,s]=R.useState([]),[r,a]=R.useState([]),[l,c]=R.useState([]),[f,d]=R.useState(!1),[h,g]=R.useState(null),[y,v]=R.useState(""),[b,T]=R.useState(""),[E,_]=R.useState(""),[A,C]=R.useState(""),[N,w]=R.useState(""),[G,M]=R.useState(""),[B,K]=R.useState(!1);R.useEffect(()=>{f&&h&&(v(h.name||""),w(h.line||""),M(h.contact||"")),f&&!h&&(v(""),w(""),M(""))},[f,h]);const[V,$]=R.useState(!1),[ee,he]=R.useState(""),[Z,H]=R.useState(!1),[k,F]=R.useState(null),[O,Y]=R.useState(""),[I,j]=R.useState(!1),[z,J]=R.useState(""),[q,P]=R.useState(!1),[de,_e]=R.useState(""),[Le,Fe]=R.useState(null);R.useEffect(()=>{$e(),pe(),Ne()},[]);const $e=async()=>{try{const ae=await Qe("public.fn_list_dim_organisation",[]);e(Array.isArray(ae)?ae.map(ie=>({id:String(ie.id),name:ie.name})):[])}catch{e([])}},pe=async()=>{try{const ae=await Qe("public.fn_list_dim_plant",[]);s(Array.isArray(ae)?ae.map(ie=>({id:String(ie.p_code),name:ie.p_name,organisationId:String(ie.org_id)})):[])}catch{s([])}},Ne=async()=>{try{const ae=await Qe("public.fn_list_dim_station",[]);c(Array.isArray(ae)?ae.map((ie,we)=>({id:String(we),name:ie.station_name,plantName:ie.plant_name,unitName:ie.unit,organisation:ie.organisation,line:ie.line,contact:ie.contact})):[])}catch{c([])}};R.useEffect(()=>{if(!b||!E){a([]),C("");return}const ae=n.find(Ae=>Ae.id===b)?.name||"",ie=t.find(Ae=>Ae.id===E)?.name||"";if(!ae||!ie){a([]),C("");return}(async()=>{try{const Ae=await Qe("fn_list_units_by_plant",[ae,ie]);a(Array.isArray(Ae)?Ae.map(Me=>({id:Me.uname,name:Me.uname,plantId:E})):[])}catch{a([])}})()},[b,E]);const Ve=()=>{g(null),v(""),T(""),_(""),C(""),w(""),M("")},Ge=()=>{Ve(),d(!0)},le=ae=>{Fe(ae),j(!0),J(""),_e("")},W=ae=>{F(ae),$(!0),he(""),Y("")},te=async ae=>{if(!ae)return ce.error("Station id required.");const ie=l.find(we=>we.id===ae);if(!ie){ce.error("Could not find station details for delete.");return}try{await Ot("public.ti_fc_sp_delete_dim_station",[ie.organisation,ie.plantName,ie.unitName,ie.name]),ce.success("Station deleted.",{autoClose:1800}),Ne()}catch(we){ce.error("Delete failed: "+(we.message||we),{autoClose:3e3})}},be=async()=>{H(!0),Y("");try{const ae=localStorage.getItem("username");if(!ae){Y("Session error: Please re-login."),H(!1),ce.error("Session error: Please re-login.");return}const ie=await Qe("public.fn_login_check",[ae,ee]);if(!ie||!ie.length){Y("Incorrect password."),H(!1),ce.error("Incorrect password.");return}k&&await te(k.id),$(!1),he(""),F(null)}catch{Y("Password check failed."),ce.error("Password check failed.")}H(!1)},Ie=async()=>{P(!0),_e("");try{const ae=localStorage.getItem("username");if(!ae){_e("Session error: Please re-login."),P(!1),ce.error("Session error: Please re-login.");return}const ie=await Qe("public.fn_login_check",[ae,z]);if(!ie||!ie.length){_e("Incorrect password."),P(!1),ce.error("Incorrect password.");return}Le&&(g(Le),d(!0),Fe(null),j(!1),J(""))}catch{_e("Password check failed."),ce.error("Password check failed.")}P(!1)},Ue=ae=>ae.replace(/\D/g,"").length>=6&&ae.replace(/\D/g,"").length<=15,Ke=()=>{if(!h){if(!b)return ce.error("Select organisation."),!1;if(!E)return ce.error("Select plant."),!1;if(!A)return ce.error("Select unit."),!1}return N.trim()?y.trim()?G.trim()?Ue(G)?!0:(ce.error("Contact number invalid."),!1):(ce.error("Contact number required."),!1):(ce.error("Station name required."),!1):(ce.error("Line is required."),!1)},We=async()=>{if(Ke()){K(!0);try{if(h)await Ot("public.ti_fc_sp_update_dim_station1",[h.organisation,h.plantName,h.unitName||"",y,N,G]),ce.success("Station updated in database.",{autoClose:1800});else{const ae=n.find(Ae=>Ae.id===b)?.name||"",ie=t.find(Ae=>Ae.id===E)?.name||"",we=r.find(Ae=>Ae.id===A)?.name||"";await Ot("public.ti_fc_sp_insert_dim_station",[ae,ie,we,y,N,String(G)]),ce.success("Station saved to database.",{autoClose:1800})}d(!1),Ve(),Ne()}catch(ae){ce.error("Failed to save station: "+(ae.message||ae),{autoClose:3e3})}K(!1)}};return p.jsxs("div",{className:"p-8",children:[p.jsx(Dr,{position:"top-right",theme:"colored"}),V&&p.jsxs(Lm,{open:V,onClose:()=>$(!1),children:[p.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Confirm Deletion"}),p.jsx("p",{className:"mb-3 text-sm text-gray-700",children:"Enter your password to delete this station."}),p.jsx("input",{type:"password",className:"w-full border border-gray-300 rounded-lg p-2 mb-2",placeholder:"Enter your password",value:ee,onChange:ae=>{he(ae.target.value),Y("")},autoFocus:!0,onKeyDown:async ae=>{ae.key==="Enter"&&ee&&await be()}}),O&&p.jsx("div",{className:"text-red-600 text-xs mb-2",children:O}),p.jsxs("div",{className:"flex justify-end gap-2",children:[p.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded-xl text-gray-700",onClick:()=>$(!1),children:"Cancel"}),p.jsx("button",{className:"px-4 py-2 bg-red-600 text-white rounded-xl font-semibold hover:bg-red-700",onClick:be,disabled:!ee||Z,children:Z?"Checking...":"Delete"})]})]}),I&&p.jsxs(Lm,{open:I,onClose:()=>j(!1),children:[p.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Enter Password to Edit"}),p.jsx("p",{className:"mb-3 text-sm text-gray-700",children:"Enter your password to edit this station."}),p.jsx("input",{type:"password",className:"w-full border border-gray-300 rounded-lg p-2 mb-2",placeholder:"Enter your password",value:z,onChange:ae=>{J(ae.target.value),_e("")},autoFocus:!0,onKeyDown:async ae=>{ae.key==="Enter"&&z&&await Ie()}}),de&&p.jsx("div",{className:"text-red-600 text-xs mb-2",children:de}),p.jsxs("div",{className:"flex justify-end gap-2",children:[p.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded-xl text-gray-700",onClick:()=>j(!1),children:"Cancel"}),p.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700",onClick:Ie,disabled:!z||q,children:q?"Checking...":"Proceed"})]})]}),p.jsxs("div",{className:"flex justify-between items-center mb-6",children:[p.jsx("h2",{className:"text-2xl font-semibold text-blue-900",children:"Stations"}),p.jsx("button",{className:"bg-blue-600 text-white rounded-xl px-4 py-2 font-semibold shadow hover:bg-blue-700 transition",onClick:Ge,children:"+ Add Station"})]}),p.jsx("div",{className:"mt-2 bg-white border border-[#cfe7ff] rounded-sm shadow-lg overflow-hidden w-full",children:p.jsx("div",{className:"overflow-x-auto w-full",children:p.jsxs("table",{className:"min-w-[900px] w-full text-sm border-separate border-spacing-0",children:[p.jsx("thead",{children:p.jsxs("tr",{className:"bg-[#cfe7ff] text-[#0c1e36] text-left text-sm",children:[p.jsx("th",{className:"px-4 py-3 font-semibold",children:"Station Name"}),p.jsx("th",{className:"px-4 py-3 font-semibold",children:"Plant"}),p.jsx("th",{className:"px-4 py-3 font-semibold",children:"Unit"}),p.jsx("th",{className:"px-4 py-3 font-semibold",children:"Organisation"}),p.jsx("th",{className:"px-4 py-3 font-semibold",children:"Line"}),p.jsx("th",{className:"px-4 py-3 font-semibold",children:"Contact"}),p.jsx("th",{className:"px-4 py-3 font-semibold text-center w-40",children:"Actions"})]})}),p.jsx("tbody",{children:l.length===0?p.jsx("tr",{children:p.jsx("td",{colSpan:8,className:"py-6 text-center text-gray-400 italic",children:"No stations added."})}):l.map(ae=>p.jsxs("tr",{className:"border-t border-gray-100 hover:bg-blue-50 transition",children:[p.jsx("td",{className:"px-4 py-3",children:ae.name}),p.jsx("td",{className:"px-4 py-3",children:ae.plantName||"-"}),p.jsx("td",{className:"px-4 py-3",children:ae.unitName||"-"}),p.jsx("td",{className:"px-4 py-3",children:ae.organisation||"-"}),p.jsx("td",{className:"px-4 py-3",children:ae.line}),p.jsx("td",{className:"px-4 py-3",children:ae.contact}),p.jsxs("td",{className:"px-4 py-3 text-center space-x-2",children:[p.jsx("button",{onClick:()=>le(ae),className:"px-3 py-1 rounded-full text-blue-600 bg-blue-100 hover:bg-blue-200 text-xs font-semibold",children:"Edit"}),p.jsx("button",{onClick:()=>W(ae),className:"px-3 py-1 rounded-full text-red-600 bg-red-100 hover:bg-red-200 text-xs font-semibold",children:"Delete"})]})]},ae.id))})]})})}),p.jsxs(Lm,{open:f,onClose:()=>d(!1),children:[p.jsx("h3",{className:"text-lg font-semibold mb-4",children:h?"Edit Station":"Add Station"}),!h&&p.jsxs(p.Fragment,{children:[p.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Organisation ",!h&&p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsxs("select",{value:b,onChange:ae=>{T(ae.target.value),_(""),C("")},className:"border border-gray-300 rounded-lg w-full p-2 mb-4",children:[p.jsx("option",{value:"",children:"Select Organisation"}),n.map(ae=>p.jsx("option",{value:ae.id,children:ae.name},ae.id))]}),p.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Plant ",!h&&p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsxs("select",{value:E,onChange:ae=>{_(ae.target.value),C("")},className:"border border-gray-300 rounded-lg w-full p-2 mb-4",disabled:!b,children:[p.jsx("option",{value:"",children:"Select Plant"}),t.filter(ae=>ae.organisationId===b).map(ae=>p.jsx("option",{value:ae.id,children:ae.name},ae.id))]}),p.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Unit ",!h&&p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsxs("select",{value:A,onChange:ae=>C(ae.target.value),className:"border border-gray-300 rounded-lg w-full p-2 mb-4",disabled:!E,children:[p.jsx("option",{value:"",children:"Select Unit"}),r.filter(ae=>ae.plantId===E).map(ae=>p.jsx("option",{value:ae.id,children:ae.name},ae.id))]})]}),h&&p.jsxs(p.Fragment,{children:[p.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Organisation"}),p.jsx("div",{className:"relative group mb-3",children:p.jsx("input",{value:h.organisation,className:"border border-gray-200 rounded-lg w-full p-2 bg-gray-100 cursor-not-allowed",readOnly:!0,disabled:!0})}),p.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Plant"}),p.jsx("div",{className:"relative group mb-3",children:p.jsx("input",{value:h.plantName,className:"border border-gray-200 rounded-lg w-full p-2 bg-gray-100 cursor-not-allowed",readOnly:!0,disabled:!0})}),p.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Unit"}),p.jsx("div",{className:"relative group mb-3",children:p.jsx("input",{value:h.unitName||"",className:"border border-gray-200 rounded-lg w-full p-2 bg-gray-100 cursor-not-allowed",readOnly:!0,disabled:!0})})]}),p.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Line ",!h&&p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx("input",{type:"text",value:N,onChange:ae=>w(ae.target.value),placeholder:"Line",className:"border border-gray-300 rounded-lg w-full p-2 mb-3",onKeyDown:ae=>{ae.key==="Enter"&&We()}}),p.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Station Name ",!h&&p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx("input",{value:y,onChange:ae=>v(ae.target.value),placeholder:"Station Name",className:"border border-gray-300 rounded-lg w-full p-2 mb-3",disabled:!1,onKeyDown:ae=>{ae.key==="Enter"&&We()}}),p.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Contact ",!h&&p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx(zl,{country:"in",value:G,onChange:ae=>M(ae),inputProps:{name:"contact",required:!0,autoFocus:!1,placeholder:"Contact Number",onKeyDown:ae=>{ae.key==="Enter"&&We()}},inputClass:"!w-full !rounded-lg !border !border-gray-300 !pl-12 !pr-3 focus:!border-blue-500",buttonClass:"!rounded-l-lg !border !border-gray-300",dropdownClass:"!rounded-xl !shadow-lg",enableSearch:!0,countryCodeEditable:!1,disabled:!1}),p.jsxs("div",{className:"flex justify-end mt-6",children:[p.jsx("button",{className:"mr-3 px-4 py-2 bg-gray-200 rounded-xl text-gray-700 hover:bg-gray-300",onClick:()=>d(!1),disabled:B,children:"Cancel"}),p.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition",onClick:We,disabled:B,children:h?"Update":"Add"})]})]})]})},xU=()=>{const[n,e]=R.useState(!1),[t,s]=R.useState(!1),[r,a]=R.useState(!1),l=kn(),c=()=>{const f=localStorage.getItem("isLoggedIn")==="true",d=localStorage.getItem("isSuperAdmin")==="true";e(f),s(d),a(!0),console.log(" Auth refreshed  loggedIn:",f,"isSuperAdmin:",d)};return R.useLayoutEffect(()=>{c()},[l.pathname]),R.useEffect(()=>{const f=()=>c();return window.addEventListener("storage",f),()=>window.removeEventListener("storage",f)},[]),r?p.jsxs(Ev,{children:[p.jsx(Bs,{path:"/login",element:p.jsx(D2,{})}),n?p.jsx(Bs,{path:"/*",element:p.jsx(Fj,{children:p.jsxs(Ev,{children:[p.jsx(Bs,{path:"/station",element:p.jsx(U3,{})}),p.jsx(Bs,{path:"/camera",element:p.jsx(B3,{})}),p.jsx(Bs,{path:"/surveillance",element:p.jsx(Tj,{})}),t&&p.jsxs(p.Fragment,{children:[p.jsx(Bs,{path:"/administration",element:p.jsx(Aj,{})}),p.jsx(Bs,{path:"/administration/users",element:p.jsx(oU,{})}),p.jsx(Bs,{path:"/administration/camera",element:p.jsx(lU,{})}),p.jsx(Bs,{path:"/administration/shift",element:p.jsx(fU,{})}),p.jsx(Bs,{path:"/administration/organization",element:p.jsx(hU,{})}),p.jsx(Bs,{path:"/administration/plant",element:p.jsx(gU,{})}),p.jsx(Bs,{path:"/administration/unit",element:p.jsx(pU,{})}),p.jsx(Bs,{path:"/administration/station",element:p.jsx(yU,{})})]}),p.jsx(Bs,{path:"*",element:t?p.jsx(Nh,{to:"/station",replace:!0}):p.jsx(Nh,{to:"/camera",replace:!0})})]})})}):p.jsx(Bs,{path:"/*",element:p.jsx(Nh,{to:"/login",replace:!0})})]}):(console.warn(" App not initialized yet..."),null)};pL.createRoot(document.getElementById("root")).render(p.jsx(R.StrictMode,{children:p.jsx(ww,{children:p.jsx(xU,{})})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(n=>{console.log(" Service Worker registered:",n)}).catch(n=>{console.error(" Service Worker registration failed:",n)})});
